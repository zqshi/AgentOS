### **「灵枢」平台 - “动态知识图谱”模块详细产品需求文档**

**文档编号**：LS-PRD-FR3
**模块名称**：动态知识图谱
**产品定位**：承载企业“活”的记忆与认知的网络化核心存储与计算引擎。
**核心目标**：提供一个不仅存储“事实”、更能管理“事实”的生命周期、上下文和复杂关联，并支持基于业务逻辑进行智能查询与推理的下一代知识基础设施。

---

### **一、 模块全景与核心价值**

#### **1.1 要解决的根本问题**
传统知识库（文档库、数据库）存储的是**静态、孤立、扁平的记录**，无法有效表达：
1.  **动态性**：知识的有效性随时间、场景和审批状态而变化。
2.  **关联性**：知识之间复杂、多维的关系网络。
3.  **语境性**：同一条知识对不同部门、不同场景可能有不同含义。
4.  **可计算性**：无法基于存储的内容进行自动化逻辑推理和深度洞察发现。

#### **1.2 核心设计理念**
1.  **对象化 (Object-Centric)**：一切皆对象，每个知识对象具备完整的身份、状态和生命周期。
2.  **关系为一等公民 (Relationships as First-Class Citizens)**：关系与实体同等重要，且关系本身可携带丰富的属性。
3.  **上下文感知 (Context-Aware)**：所有查询和推理必须在明确的业务上下文中进行，结果因上下文而异。
4.  **可追溯 (Fully Traceable)**：知识的起源与每一次演变都必须有迹可循。

#### **1.3 核心用户角色**
| 角色 | 职责与目标 | 核心使用场景 |
| :--- | :--- | :--- |
| **所有用户 (通过智核/API)** | 检索信息、获取洞察、验证决策。 | 在智核中搜索问题，获得由知识图谱综合生成的答案和关联网络。 |
| **领域专家/知识审核员** | 维护知识的状态与有效性。 | 审核知识草稿，将其状态从“草稿”改为“已生效”，或对过期知识进行归档。 |
| **数据分析师/管理者** | 进行复杂的业务洞察与影响分析。 | 使用图查询语言分析风险传播路径，或使用图算法发现知识社群。 |
| **智能体 (Agent)** | 获取推理所需的上下文和事实依据。 | 在执行任务时，查询图谱以验证信息或获取关联规则。 |

---

### **二、 详细功能需求**

#### **FR3.1 知识对象模型**

**目标**：定义图谱中每个节点（知识对象）的完整“基因”，使其成为一个具有身份、状态、背景和历史的智能实体。

| 功能组件 | 详细需求描述 |
| :--- | :--- |
| **1. 核心属性定义与管理** | • **唯一标识符**：系统生成的全局唯一、不可变ID，作为对象的终身身份标识。<br>• **版本号**：每次对象内容（属性值）发生变更，版本号自动递增。可查询任意历史版本。<br>• **本体类型**：指向FR1定义的本体实体（如 `实体:产品`），决定了该对象必须遵守的结构和业务规则。 |
| **2. 生命周期状态引擎** | • **状态类型**：预定义一套标准状态（**草稿、审核中、已生效、已受限、已归档、已废止**），并允许扩展业务特定状态。<br>• **状态转移工作流**：<br>  &nbsp;&nbsp;- **可视化配置**：可配置状态间的允许转移路径（如“草稿”只能到“审核中”或“废止”）。<br>  &nbsp;&nbsp;- **转移条件**：可为转移设置条件（如：只有“审核人”角色才能执行“审核中→已生效”）。<br>  &nbsp;&nbsp;- **自动转移规则**：可配置基于时间的规则（如：`生效后730天，自动触发“已生效→待复审”`）。<br>• **状态影响**：对象的可检索性和可操作性受状态控制（如“已归档”对象默认不出现在通用搜索结果中，但可被专门查询）。 |
| **3. 生效上下文配置器** | • **多维上下文定义**：为每个对象配置其生效的维度：<br>  &nbsp;&nbsp;- **时间上下文**：生效开始/结束时间。<br>  &nbsp;&nbsp;- **组织上下文**：对哪些部门、团队、角色生效（基于企业组织架构树选择）。<br>  &nbsp;&nbsp;- **业务上下文**：在哪些产品线、项目、市场区域生效。<br>• **上下文继承**：允许对象从其所关联的父对象（如一份“部门规范”继承其部门的组织上下文）或本体定义中继承部分上下文。<br>• **上下文冲突解决**：当对象有多个上下文时，需定义优先级或交集逻辑。 |
| **4. 来源与谱系追溯** | • **数据谱系图**：为每个对象自动记录并可视化其“出身”：<br>  &nbsp;&nbsp;`原始数据源(销售系统) → 加工流水线A(版本v2.1) → 知识对象O`。<br>• **操作审计日志**：记录对象的创建、每次属性更新、状态变更、关联变动等操作（操作人、时间、具体变更内容）。 |
| **5. 关联关系管理** | • **关系类型化**：关系必须基于FR1定义的本体关系（如 `<供应>`），不能随意创建未定义的关系。<br>• **关系属性**：支持为关系添加属性（如 `<合作>关系` 可拥有“合作起始日期”、“合作等级”属性）。<br>• **关系置信度**：系统可自动或手动为关系标注一个置信度分数（0-1），反映该关系的确凿程度。 |

#### **FR3.2 图谱查询与计算服务**

**目标**：提供强大、灵活且智能的接口，让用户和系统能以多种方式“唤醒”和“利用”图谱中的知识。

| 功能组件 | 详细需求描述 |
| :--- | :--- |
| **1. 统一查询门户** | • **单一入口**：提供统一的RESTful API和查询语言端点，接受各类查询请求。<br>• **查询路由与联邦**：根据查询条件，自动将请求路由至最合适的底层引擎（全文索引、向量数据库、图数据库），并合并结果。 |
| **2. 混合检索与智能排序** | • **多模式查询**：<br>  &nbsp;&nbsp;- **关键词检索**：基于倒排索引，快速匹配标题、内容、标签中的关键词。<br>  &nbsp;&nbsp;- **语义检索**：将查询文本向量化，在向量空间中查找最相似的知识对象。<br>  &nbsp;&nbsp;- **图谱遍历查询**：支持用户或应用提交类Gremlin的图查询语句，进行复杂的多跳关系查询。<br>• **结果融合排序**：对来自不同检索模式的结果进行去重、相关性打分和智能融合。排序权重应考虑：关键词匹配度、语义相似度、对象的状态（生效>草稿）、置信度、新鲜度、用户画像偏好等。 |
| **3. 嵌入式规则推理引擎** | • **实时逻辑推导**：在查询或写入时，自动触发与当前操作相关的、挂载在本体上的业务规则。<br>• **场景示例**：<br>  &nbsp;&nbsp;1. **查询时推导**：当查询“高风险客户”时，系统自动应用规则 `IF (客户.逾期次数>3 AND 客户.行业=‘高风险’) THEN 标记为‘高风险’`，动态将符合条件但未显式标记的客户加入结果集。<br>  &nbsp;&nbsp;2. **写入时校验**：当试图创建一条“付款记录”并关联一个“已废止”的合同时，系统自动触发规则告警，阻止非法关联。<br>• **推理过程可解释**：可返回推理所依据的规则和事实链。 |
| **4. 高级图算法工作台** | • **算法工具箱**：以API或可视化工具形式，提供以下常用图算法：<br>  &nbsp;&nbsp;- **社区发现**：自动识别图谱中紧密关联的知识集群（如围绕某个技术主题的所有专利、文档、专家）。<br>  &nbsp;&nbsp;- **中心性分析**：找出图谱中最重要的节点（如被引用最多的核心技术文档、关联最广的关键人物）。<br>  &nbsp;&nbsp;- **路径查找**：查找两个实体间的所有关联路径，用于影响分析或根因追溯（如“从服务器故障到受影响客户的订单路径”）。<br>• **交互式分析界面**：允许分析师在子图上运行算法，并可视化结果（如用不同颜色高亮显示不同的社区）。 |

#### **FR3.3 图谱版本与快照**

**目标**：为这个动态变化的“企业记忆”拍摄可回溯的历史照片，满足审计、复盘、法律合规和趋势分析的需求。

| 功能组件 | 详细需求描述 |
| :--- | :--- |
| **1. 快照创建与管理** | • **触发方式**：<br>  &nbsp;&nbsp;- **计划快照**：按固定周期（如每日、每周）自动创建全图谱一致性快照。<br>  &nbsp;&nbsp;- **事件快照**：在重大业务事件（如产品发布、法规变更）前后手动触发快照。<br>• **增量快照**：为节省存储，支持基于上一个全量快照的增量存储，但对外提供完整的逻辑视图。<br>• **快照元数据**：为每个快照记录时间点、触发原因、创建者。 |
| **2. 历史查询与对比分析** | • **时间旅行查询**：允许用户或API在查询时指定一个历史时间点或快照标签，系统返回该时间点上的图谱状态。<br>• **可视化对比**：选择两个快照，系统可生成对比报告，显示其间新增、删除、修改的知识对象及关联，并以图形化方式高亮变化部分。<br>• **版本差异查询**：针对单个知识对象，可查询其任意两个版本之间的具体属性差异。 |

---

### **三、 核心业务流程示例**

**流程：处理一次产品安全合规审计**
1.  **情境设定**：法务部门需要对“数据跨境传输”相关的所有知识进行审计，审计范围是“欧洲分公司”在过去一年（2023年）的所有政策、流程和合同。
2.  **上下文化查询**：审计员在**智核**中发起查询，系统自动将**生效上下文**限定为：`组织=欧洲分公司`， `时间=2023-01-01至2023-12-31`。
3.  **复杂图遍历**：系统执行图谱查询，寻找所有 `类型=政策/流程/合同` 且 `内容涉及“数据跨境传输”` 的对象。进一步遍历这些对象的所有 `关联`，找到相关的 `员工培训记录`、`技术方案`、`风险评估报告`，形成一个完整的证据网络。
4.  **历史追溯**：审计员对某份关键政策存疑。他使用 **“时间旅行查询”**，查看该政策在2023年中的历史版本，确认其在审计期间的具体内容，并与最新的修改进行对比。
5.  **洞察发现**：审计员使用 **“社区发现”算法**，分析所有相关对象，发现“营销部门”的相关文档与“法务部门”的标准存在一个弱关联社群，提示可能存在合规风险盲区。
6.  **结果输出**：系统将整个查询、遍历、分析的结果，打包成一个结构化的 **“合规证据包”**，包含知识网络图、版本对比报告和算法洞察，供审计报告使用。

---
**文档状态**：`评审中`
**下一步**：本PRD确认后，需与FR1（本体论工厂）就规则推理的触发机制进行对接联调，并与FR2（知识熔炉）明确知识原料的最终注入格式和协议。同时，需定义与FR4（智能体工厂）的接口，供智能体进行复杂查询。