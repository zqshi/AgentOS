<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智核 - 智能工作台</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    <script>
        // 全局导航函数，处理所有页面切换
        function showPage(pageName) {
            console.log('showPage函数被调用:', pageName);
            
            // 1. 隐藏所有页面
            const allPages = document.querySelectorAll('.page');
            allPages.forEach(page => {
                page.classList.remove('active');
                page.style.display = 'none';
                page.style.opacity = '0';
                page.style.transform = 'translateY(20px)';
                console.log('隐藏页面:', page.id);
            });
            
            // 2. 显示目标页面
            const targetPageId = `page-${pageName}`;
            const targetPage = document.getElementById(targetPageId);
            
            if (targetPage) {
                console.log('显示目标页面:', targetPageId);
                targetPage.classList.add('active');
                targetPage.style.display = 'flex';
                targetPage.style.minHeight = 'calc(100vh - 120px)';
                targetPage.style.height = 'auto';
                targetPage.style.overflow = 'auto';
                targetPage.style.opacity = '1';
                targetPage.style.transform = 'translateY(0)';
                
                console.log('目标页面样式:', window.getComputedStyle(targetPage).display);
            } else {
                console.error('未找到目标页面:', targetPageId);
                alert('未找到目标页面: ' + targetPageId);
            }
            
            // 3. 更新导航按钮样式
            const navButtons = document.querySelectorAll('.nav-btn');
            navButtons.forEach(btn => {
                btn.classList.remove('bg-primary/10', 'text-primary');
                btn.classList.add('text-muted');
            });
            
            const currentBtn = document.querySelector(`[data-page="${pageName}"]`);
            if (currentBtn) {
                currentBtn.classList.add('bg-primary/10', 'text-primary');
                currentBtn.classList.remove('text-muted');
            }
            
            console.log('导航按钮样式已更新');
            
            // 4. 滚动到顶部
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            console.log('showPage函数执行完成');
        }
        
        // 批注系统功能
        function openCommentForm(paragraphId) {
            // 先移除已存在的批注表单
            const existingForm = document.querySelector('.comment-form-container');
            if (existingForm) {
                existingForm.remove();
            }

            // 获取当前段落
            const paragraph = document.querySelector(`[data-paragraph-id="${paragraphId}"]`);
            if (!paragraph) return;

            // 创建批注表单容器
            const formContainer = document.createElement('div');
            formContainer.className = 'comment-form-container absolute z-10 bg-white rounded-xl shadow-lg p-4 border border-line w-96 max-w-full mt-2';
            formContainer.innerHTML = `
                <div class="flex items-center justify-between mb-3">
                    <h4 class="font-medium">添加批注</h4>
                    <button class="p-1 text-muted hover:text-primary rounded" onclick="this.closest('.comment-form-container').remove()">
                        <i class="fa fa-times"></i>
                    </button>
                </div>
                
                <!-- 批注类型选择 -->
                <div class="mb-3">
                    <label class="block text-sm text-muted mb-2">批注类型</label>
                    <div class="flex gap-2 flex-wrap">
                        <button type="button" class="comment-type-btn px-3 py-1 rounded-full text-xs bg-danger/20 text-danger border border-danger/30 active" data-type="error">
                            <i class="fa fa-times-circle mr-1"></i>错误
                        </button>
                        <button type="button" class="comment-type-btn px-3 py-1 rounded-full text-xs bg-warning/20 text-warning border border-warning/30" data-type="suggestion">
                            <i class="fa fa-lightbulb-o mr-1"></i>建议
                        </button>
                        <button type="button" class="comment-type-btn px-3 py-1 rounded-full text-xs bg-info/20 text-info border border-info/30" data-type="question">
                            <i class="fa fa-question-circle mr-1"></i>疑问
                        </button>
                        <button type="button" class="comment-type-btn px-3 py-1 rounded-full text-xs bg-primary/20 text-primary border border-primary/30" data-type="info">
                            <i class="fa fa-info-circle mr-1"></i>信息
                        </button>
                    </div>
                </div>

                <!-- 批注内容 -->
                <div class="mb-3">
                    <label class="block text-sm text-muted mb-2">批注内容</label>
                    <textarea id="comment-content" rows="3" class="w-full border border-line rounded-lg p-2 text-sm resize-none" placeholder="请输入您的批注..."></textarea>
                </div>

                <!-- 建议编辑模式 -->
                <div class="mb-3">
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="checkbox" id="suggest-edit-mode" class="w-4 h-4 text-primary">
                        <span class="text-sm">建议编辑</span>
                    </label>
                    <div id="edit-suggestion-container" class="hidden mt-2">
                        <textarea id="edit-suggestion" rows="3" class="w-full border border-line rounded-lg p-2 text-sm resize-none" placeholder="请输入您的建议编辑内容..."></textarea>
                    </div>
                </div>

                <!-- 操作按钮 -->
                <div class="flex justify-end gap-2">
                    <button type="button" class="px-4 py-2 text-sm border border-line rounded-lg hover:bg-mist" onclick="this.closest('.comment-form-container').remove()">
                        取消
                    </button>
                    <button type="button" class="px-4 py-2 text-sm bg-primary text-white rounded-lg hover:bg-primary/90" onclick="saveComment(${paragraphId})">
                        保存批注
                    </button>
                </div>
            `;

            // 添加到页面并定位
            document.body.appendChild(formContainer);
            const paragraphRect = paragraph.getBoundingClientRect();
            formContainer.style.left = `${paragraphRect.left + window.scrollX}px`;
            formContainer.style.top = `${paragraphRect.bottom + window.scrollY}px`;

            // 绑定批注类型选择事件
            const typeButtons = formContainer.querySelectorAll('.comment-type-btn');
            typeButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    typeButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                });
            });

            // 绑定建议编辑模式切换事件
            const suggestEditCheckbox = formContainer.querySelector('#suggest-edit-mode');
            const editSuggestionContainer = formContainer.querySelector('#edit-suggestion-container');
            suggestEditCheckbox.addEventListener('change', () => {
                if (suggestEditCheckbox.checked) {
                    editSuggestionContainer.classList.remove('hidden');
                } else {
                    editSuggestionContainer.classList.add('hidden');
                }
            });

            // 点击外部关闭
            document.addEventListener('click', function closeCommentForm(e) {
                if (!formContainer.contains(e.target) && !e.target.closest('[data-paragraph-id]')) {
                    formContainer.remove();
                    document.removeEventListener('click', closeCommentForm);
                }
            });
        }
        
        function mentionUser(paragraphId) {
            alert(`在段落 ${paragraphId} 中@提及用户`);
        }
        
        function openNewCommentForm() {
            alert('打开新批注表单');
        }
        
        function updateCommentStatus(btn, status) {
            const commentItem = btn.closest('.comment-item');
            const statusSpan = commentItem.querySelector('[data-status]');
            commentItem.dataset.status = status;
            
            // 更新状态显示
            const statusText = commentItem.querySelector('.flex.items-center.gap-1 span:last-child');
            const statusColors = {
                accepted: { bg: 'bg-success/20', text: 'text-success', label: '已采纳' },
                rejected: { bg: 'bg-danger/20', text: 'text-danger', label: '不采纳' },
                pending: { bg: 'bg-danger/20', text: 'text-danger', label: '待处理' },
                processing: { bg: 'bg-warning/20', text: 'text-warning', label: '处理中' }
            };
            
            const newStatus = statusColors[status];
            statusText.className = `px-2 py-1 rounded-full ${newStatus.bg} ${newStatus.text} text-[10px]`;
            statusText.textContent = newStatus.label;
            
            // 如果是已采纳或不采纳，隐藏操作按钮
            if (status === 'accepted' || status === 'rejected') {
                const actionButtons = commentItem.querySelectorAll('.mt-2.flex.gap-2 button');
                actionButtons.forEach(btn => {
                    if (btn.title === '采纳' || btn.title === '不采纳') {
                        btn.remove();
                    }
                });
            }
            
            alert(`批注状态已更新为：${newStatus.label}`);
        }

        function saveComment(paragraphId) {
            // 获取批注表单数据
            const formContainer = document.querySelector('.comment-form-container');
            if (!formContainer) return;

            const selectedTypeBtn = formContainer.querySelector('.comment-type-btn.active');
            const commentType = selectedTypeBtn ? selectedTypeBtn.dataset.type : 'suggestion';
            const commentContent = formContainer.querySelector('#comment-content').value.trim();
            const suggestEditMode = formContainer.querySelector('#suggest-edit-mode').checked;
            const editSuggestion = suggestEditMode ? formContainer.querySelector('#edit-suggestion').value.trim() : '';

            // 验证内容
            if (!commentContent) {
                alert('请输入批注内容');
                return;
            }

            // 模拟生成批注ID
            const commentId = 'comment_' + Date.now();

            // 创建新批注数据
            const newComment = {
                id: commentId,
                paragraphId: paragraphId,
                type: commentType,
                content: commentContent,
                editSuggestion: editSuggestion,
                status: 'pending',
                author: '当前用户',
                avatar: 'https://p3-doubao-search-sign.byteimg.com/pgc-image/6323b43dac9b41db978bffd8c580ac63~tplv-be4g95zd3a-image.jpeg?lk3s=feb11e32&x-expires=1783481830&x-signature=E%2BA4UNzvvjJgdRQb3RrhhengBCo%3D',
                createTime: new Date().toISOString(),
                likes: 0,
                replies: []
            };

            // 更新段落的批注标记
            updateCommentMarkers(paragraphId, commentType);

            // 添加到批注列表
            addCommentToList(newComment);

            // 关闭表单
            formContainer.remove();

            // 显示成功提示
            alert('批注添加成功');
        }

        function updateCommentMarkers(paragraphId, commentType) {
            const paragraph = document.querySelector(`[data-paragraph-id="${paragraphId}"]`);
            if (!paragraph) return;

            const markersContainer = paragraph.querySelector('.comment-markers');
            if (!markersContainer) return;

            // 添加新的批注标记
            const newMarker = document.createElement('span');
            newMarker.className = `w-2 h-2 rounded-full ${getCommentTypeColor(commentType)}`;
            newMarker.title = getCommentTypeLabel(commentType);
            markersContainer.appendChild(newMarker);
        }

        function addCommentToList(comment) {
            // 获取批注列表容器
            const commentsList = document.querySelector('.comments-list');
            if (!commentsList) return;

            // 创建批注项
            const commentItem = document.createElement('div');
            commentItem.className = `comment-item p-3 rounded-xl bg-white border border-line mb-2`;
            commentItem.dataset.type = comment.type;
            commentItem.dataset.status = comment.status;

            // 获取当前段落标题
            const paragraph = document.querySelector(`[data-paragraph-id="${comment.paragraphId}"]`);
            const paragraphTitle = paragraph ? paragraph.querySelector('h3')?.textContent || `段落 ${comment.paragraphId}` : `段落 ${comment.paragraphId}`;

            commentItem.innerHTML = `
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        <img src="${comment.avatar}" alt="用户头像" class="w-6 h-6 rounded-full">
                        <div>
                            <p class="font-medium">${comment.author}</p>
                            <p class="text-muted">${formatCommentTime(comment.createTime)}</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-1">
                        <span class="px-2 py-1 rounded-full ${getCommentTypeColor(comment.type, true)} ${getCommentTypeTextColor(comment.type)} text-[10px]">
                            ${getCommentTypeIcon(comment.type)} ${getCommentTypeLabel(comment.type)}
                        </span>
                        <span class="px-2 py-1 rounded-full bg-danger/20 text-danger text-[10px]">待处理</span>
                    </div>
                </div>
                <div class="mt-2 text-sm">
                    <p class="text-muted mb-1"><i class="fa fa-file-text-o mr-1"></i>${paragraphTitle}</p>
                    <p>${comment.content}</p>
                </div>
                ${comment.editSuggestion ? `
                <div class="mt-3 p-2 bg-mist rounded-lg border border-line">
                    <p class="text-xs text-muted mb-1"><i class="fa fa-pencil mr-1"></i>建议编辑：</p>
                    <p class="text-sm">${comment.editSuggestion}</p>
                    <button class="mt-2 text-xs text-primary hover:underline" onclick="applyEditSuggestion('${comment.id}', ${comment.paragraphId}, '${comment.editSuggestion.replace(/'/g, "\\'")}')">
                        采纳建议编辑
                    </button>
                </div>
                ` : ''}
                <div class="mt-2 flex gap-2">
                    <button class="px-3 py-1 text-xs bg-success/20 text-success rounded-full hover:bg-success/30 border border-success/30" title="采纳" onclick="updateCommentStatus(this, 'accepted')">
                        <i class="fa fa-check mr-1"></i>采纳
                    </button>
                    <button class="px-3 py-1 text-xs bg-danger/20 text-danger rounded-full hover:bg-danger/30 border border-danger/30" title="不采纳" onclick="updateCommentStatus(this, 'rejected')">
                        <i class="fa fa-times mr-1"></i>不采纳
                    </button>
                    <button class="px-3 py-1 text-xs bg-secondary/20 text-secondary rounded-full hover:bg-secondary/30 border border-secondary/30" title="回复" onclick="replyToComment('${comment.id}')">
                        <i class="fa fa-reply mr-1"></i>回复
                    </button>
                    <button class="px-3 py-1 text-xs bg-info/20 text-info rounded-full hover:bg-info/30 border border-info/30" title="点赞" onclick="likeComment('${comment.id}')">
                        <i class="fa fa-thumbs-up mr-1"></i>点赞
                    </button>
                </div>
            `;

            // 添加到批注列表
            commentsList.insertBefore(commentItem, commentsList.firstChild);
        }

        function getCommentTypeColor(type, isBg = false) {
            const colors = {
                error: isBg ? 'bg-danger/20' : 'bg-danger',
                suggestion: isBg ? 'bg-warning/20' : 'bg-warning',
                question: isBg ? 'bg-info/20' : 'bg-info',
                info: isBg ? 'bg-primary/20' : 'bg-primary'
            };
            return colors[type] || colors.suggestion;
        }

        function getCommentTypeTextColor(type) {
            const colors = {
                error: 'text-danger',
                suggestion: 'text-warning',
                question: 'text-info',
                info: 'text-primary'
            };
            return colors[type] || colors.suggestion;
        }

        function getCommentTypeIcon(type) {
            const icons = {
                error: '<i class="fa fa-times-circle"></i>',
                suggestion: '<i class="fa fa-lightbulb-o"></i>',
                question: '<i class="fa fa-question-circle"></i>',
                info: '<i class="fa fa-info-circle"></i>'
            };
            return icons[type] || icons.suggestion;
        }

        function getCommentTypeLabel(type) {
            const labels = {
                error: '错误',
                suggestion: '建议',
                question: '疑问',
                info: '信息'
            };
            return labels[type] || labels.suggestion;
        }

        function formatCommentTime(timestamp) {
            const now = new Date();
            const commentDate = new Date(timestamp);
            const diffMs = now - commentDate;
            const diffMins = Math.floor(diffMs / (1000 * 60));
            const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
            const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));

            if (diffMins < 1) return '刚刚';
            if (diffMins < 60) return `${diffMins}分钟前`;
            if (diffHours < 24) return `${diffHours}小时前`;
            if (diffDays < 7) return `${diffDays}天前`;
            
            return commentDate.toLocaleDateString();
        }

        function applyEditSuggestion(commentId, paragraphId, suggestion) {
            // 获取段落内容
            const paragraph = document.querySelector(`[data-paragraph-id="${paragraphId}"]`);
            if (!paragraph) return;

            const editableContent = paragraph.querySelector('.editable-content');
            if (!editableContent) return;

            // 应用建议编辑
            editableContent.innerHTML = suggestion;

            // 更新批注状态为已采纳
            const commentItem = document.querySelector(`.comment-item[data-comment-id="${commentId}"]`);
            if (commentItem) {
                const acceptBtn = commentItem.querySelector('button[title="采纳"]');
                if (acceptBtn) {
                    updateCommentStatus(acceptBtn, 'accepted');
                }
            }

            alert('已采纳建议编辑');
        }

        function replyToComment(commentId) {
            alert(`回复批注 ${commentId}`);
        }

        function likeComment(commentId) {
            const commentItem = document.querySelector(`[data-comment-id="${commentId}"]`);
            if (!commentItem) return;

            const likeBtn = commentItem.querySelector('button[title="点赞"]');
            const likeIcon = likeBtn.querySelector('i');
            const likeCount = likeBtn.querySelector('span:last-child');

            if (likeBtn.classList.contains('active')) {
                // 取消点赞
                likeBtn.classList.remove('active', 'bg-primary/20', 'text-primary');
                likeBtn.classList.add('bg-info/20', 'text-info');
                likeIcon.classList.remove('fa-thumbs-up');
                likeIcon.classList.add('fa-thumbs-o-up');
                if (likeCount) {
                    likeCount.textContent = Math.max(0, parseInt(likeCount.textContent) - 1);
                }
            } else {
                // 点赞
                likeBtn.classList.remove('bg-info/20', 'text-info');
                likeBtn.classList.add('active', 'bg-primary/20', 'text-primary');
                likeIcon.classList.remove('fa-thumbs-o-up');
                likeIcon.classList.add('fa-thumbs-up');
                if (likeCount) {
                    likeCount.textContent = parseInt(likeCount.textContent || '0') + 1;
                }
            }
        }
        
        function replyToComment(btn) {
            const commentItem = btn.closest('.comment-item');
            alert(`回复此批注`);
        }
        
        // 筛选批注
        document.addEventListener('DOMContentLoaded', function() {
            // 批注类型筛选
            const filterBtns = document.querySelectorAll('.filter-btn');
            filterBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    // 移除所有激活状态
                    filterBtns.forEach(b => b.classList.remove('active', 'bg-primary', 'text-white'));
                    filterBtns.forEach(b => b.classList.add('bg-white', 'border', 'border-line'));
                    
                    // 添加当前按钮的激活状态
                    this.classList.add('active', 'bg-primary', 'text-white');
                    this.classList.remove('bg-white', 'border', 'border-line');
                    
                    const filterType = this.dataset.type;
                    filterComments(filterType, null);
                });
            });
            
            // 批注状态筛选
            const statusBtns = document.querySelectorAll('.status-btn');
            statusBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    // 移除所有激活状态
                    statusBtns.forEach(b => b.classList.remove('active', 'bg-primary', 'text-white'));
                    statusBtns.forEach(b => b.classList.add('bg-white', 'border', 'border-line'));
                    
                    // 添加当前按钮的激活状态
                    this.classList.add('active', 'bg-primary', 'text-white');
                    this.classList.remove('bg-white', 'border', 'border-line');
                    
                    const filterStatus = this.dataset.status;
                    filterComments(null, filterStatus);
                });
            });
            
            // 显示所有批注按钮
            const showAllBtn = document.getElementById('show-all-comments');
            if (showAllBtn) {
                showAllBtn.addEventListener('click', function() {
                    toggleAllComments();
                });
            }
            
            // 运行AI质量检查按钮
            const qualityCheckBtn = document.getElementById('run-quality-check');
            if (qualityCheckBtn) {
                qualityCheckBtn.addEventListener('click', function() {
                    runQualityCheck();
                });
            }
        });
        
        function filterComments(type, status) {
            const commentItems = document.querySelectorAll('.comment-item');
            commentItems.forEach(item => {
                let show = true;
                
                // 按类型筛选
                if (type && item.dataset.type !== type) {
                    show = false;
                }
                
                // 按状态筛选
                if (status && item.dataset.status !== status) {
                    show = false;
                }
                
                item.style.display = show ? 'block' : 'none';
            });
        }
        
        function toggleAllComments() {
            alert('切换显示所有批注');
        }
        
        function runQualityCheck() {
            // 模拟AI检查过程
            const checkBtn = document.getElementById('run-quality-check');
            const originalText = checkBtn.textContent;
            checkBtn.innerHTML = '<i class="fa fa-spinner fa-spin mr-1"></i>检查中...';
            checkBtn.disabled = true;
            
            // 模拟1秒检查时间
            setTimeout(function() {
                // 生成随机质量得分（70-95之间）
                const qualityScore = Math.floor(Math.random() * 26) + 70;
                
                // 更新结果面板
                const resultsPanel = document.getElementById('ai-check-results');
                const aiQualityScore = document.getElementById('ai-quality-score');
                const qualityProgress = document.getElementById('quality-progress');
                const qualityScoreDisplay = document.getElementById('quality-score');
                const checkTime = document.getElementById('check-time');
                
                // 更新质量得分
                aiQualityScore.textContent = `${qualityScore} / 100`;
                qualityProgress.style.width = `${qualityScore}%`;
                qualityScoreDisplay.textContent = `${qualityScore} / 100`;
                
                // 更新检查时间
                const now = new Date();
                const timeStr = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
                checkTime.textContent = `${timeStr} 检查`;
                
                // 显示结果面板
                resultsPanel.style.display = 'block';
                
                // 恢复按钮状态
                checkBtn.textContent = originalText;
                checkBtn.disabled = false;
                
                alert(`AI智能预检完成！综合质量得分：${qualityScore} / 100`);
            }, 1000);
        }
        
        // 应用所有建议
        document.addEventListener('DOMContentLoaded', function() {
            // 应用所有建议
            const applyBtn = document.getElementById('apply-all-suggestions');
            if (applyBtn) {
                applyBtn.addEventListener('click', function() {
                    alert('已一键应用所有AI建议');
                });
            }
            
            // 关闭结果
            const dismissBtn = document.getElementById('dismiss-results');
            if (dismissBtn) {
                dismissBtn.addEventListener('click', function() {
                    document.getElementById('ai-check-results').style.display = 'none';
                });
            }
            
            // 发布设置面板
            const openPublishBtn = document.getElementById('open-publish');
            const closePublishBtn = document.getElementById('close-publish');
            const cancelPublishBtn = document.getElementById('cancel-publish');
            const publishSettings = document.getElementById('publish-settings');
            
            if (openPublishBtn) {
                openPublishBtn.addEventListener('click', function() {
                    publishSettings.style.display = 'block';
                });
            }
            
            if (closePublishBtn) {
                closePublishBtn.addEventListener('click', function() {
                    publishSettings.style.display = 'none';
                });
            }
            
            if (cancelPublishBtn) {
                cancelPublishBtn.addEventListener('click', function() {
                    publishSettings.style.display = 'none';
                });
            }
            
            // 保存发布设置
            const savePublishBtn = document.getElementById('save-publish-settings');
            if (savePublishBtn) {
                savePublishBtn.addEventListener('click', function() {
                    const selectedVisibility = document.querySelector('input[name="visibility"]:checked').value;
                    const visibilityLabels = {
                        personal: '仅我可见',
                        team: '团队空间',
                        department: '部门空间',
                        company: '全员空间',
                        external: '对外发布'
                    };
                    
                    // 更新可见范围显示
                    document.getElementById('visibility-scope').textContent = visibilityLabels[selectedVisibility];
                    
                    // 关闭面板
                    publishSettings.style.display = 'none';
                    
                    alert(`发布设置已保存！可见范围已更新为：${visibilityLabels[selectedVisibility]}`);
                });
            }
            
            // 可见范围选项变化
            const visibilityOptions = document.querySelectorAll('.visibility-option');
            visibilityOptions.forEach(option => {
                option.addEventListener('change', function() {
                    const selectedValue = this.value;
                    const publishBtn = document.getElementById('save-publish-settings');
                    
                    // 根据选择的可见范围，检查是否满足条件
                    if (selectedValue === 'company') {
                        // 检查AI质量得分是否≥80
                        const qualityScore = parseInt(document.getElementById('quality-score').textContent);
                        if (qualityScore < 80) {
                            publishBtn.disabled = true;
                            publishBtn.style.opacity = '0.5';
                            alert('发布到全员空间需要AI质量得分≥80分');
                            // 自动回退到团队空间
                            document.querySelector('input[name="visibility"][value="team"]').checked = true;
                        } else {
                            publishBtn.disabled = false;
                            publishBtn.style.opacity = '1';
                        }
                    } else if (selectedValue === 'external') {
                        publishBtn.disabled = true;
                        publishBtn.style.opacity = '0.5';
                        alert('对外发布需要通过合规审核流程');
                    } else {
                        publishBtn.disabled = false;
                        publishBtn.style.opacity = '1';
                    }
                });
            });
            
            // 模拟知识成熟度自动计算
            function updateMaturityLevel() {
                // 这里可以根据实际数据计算成熟度
                // 模拟根据批注解决率、质量得分等因素更新成熟度
                // 知识成熟度系统升级：完善自动评分、分层可见性和质量标准配置
                
                // 成熟度等级定义
                const maturityLevels = ['草稿', '初稿', '协作中', '成熟', '精品'];
                const maturityThresholds = [20, 40, 60, 80, 100]; // 对应各等级的阈值分数
                
                // 计算综合成熟度分数
                function calculateMaturityScore() {
                    // 获取各评分因子的分数
                    const aiQuality = parseInt(document.getElementById('quality-score').textContent) || 85;
                    const commentResolution = 70; // 批注解决率 (示例值)
                    const reviewerCount = 3; // 评审人数 (示例值)
                    const updateFrequency = 90; // 更新频率评分 (示例值)
                    const usageScore = 60; // 使用量和评分 (示例值)
                    
                    // 权重配置
                    const weights = {
                        aiQuality: 0.3,
                        commentResolution: 0.25,
                        reviewerCount: 0.2,
                        updateFrequency: 0.15,
                        usageScore: 0.1
                    };
                    
                    // 计算加权平均分
                    const totalScore = 
                        aiQuality * weights.aiQuality +
                        commentResolution * weights.commentResolution +
                        (Math.min(reviewerCount, 5) / 5 * 100) * weights.reviewerCount +
                        updateFrequency * weights.updateFrequency +
                        usageScore * weights.usageScore;
                    
                    return Math.round(totalScore);
                }
                
                // 根据分数确定成熟度等级
                function getMaturityLevel(score) {
                    for (let i = maturityThresholds.length - 1; i >= 0; i--) {
                        if (score >= maturityThresholds[i]) {
                            return maturityLevels[i];
                        }
                    }
                    return maturityLevels[0];
                }
                
                // 获取成熟度等级对应的颜色
                function getMaturityLevelColors(level) {
                    const levelColors = {
                        '草稿': { bg: 'bg-danger/20', text: 'text-danger' },
                        '初稿': { bg: 'bg-warning/20', text: 'text-warning' },
                        '协作中': { bg: 'bg-warning/20', text: 'text-warning' },
                        '成熟': { bg: 'bg-primary/20', text: 'text-primary' },
                        '精品': { bg: 'bg-success/20', text: 'text-success' }
                    };
                    return levelColors[level] || levelColors['草稿'];
                }
                
                // 更新成熟度显示
                function updateMaturityDisplay() {
                    const totalScore = calculateMaturityScore();
                    const newLevel = getMaturityLevel(totalScore);
                    const levelColors = getMaturityLevelColors(newLevel);
                    
                    // 更新成熟度信息
                    document.getElementById('maturity-level').textContent = newLevel;
                    document.getElementById('maturity-badge').textContent = newLevel;
                    document.getElementById('maturity-progress').style.width = `${totalScore}%`;
                    
                    // 更新成熟度徽章样式
                    const badge = document.getElementById('maturity-badge');
                    badge.className = `px-3 py-1 rounded-full ${levelColors.bg} ${levelColors.text} text-xs`;
                    
                    // 更新各评分因子的显示
                    updateScoreFactorsDisplay(totalScore);
                    
                    return totalScore;
                }
                
                // 更新评分因子显示
                function updateScoreFactorsDisplay(totalScore) {
                    // AI质量检查得分
                    const aiQuality = parseInt(document.getElementById('quality-score').textContent) || 85;
                    const aiQualityElement = document.querySelector('.space-y-3 > div:nth-child(1) .font-medium');
                    if (aiQualityElement) {
                        aiQualityElement.textContent = `${aiQuality}分 (30%)`;
                        aiQualityElement.parentElement.nextElementSibling.firstElementChild.style.width = `${aiQuality}%`;
                    }
                    
                    // 其他评分因子可根据实际数据更新
                    // ...
                }
                
                // 分层可见性控制
                function updateVisibilityByMaturity(score, level) {
                    const visibilityOptions = document.querySelectorAll('input[name="visibility"]');
                    const visibilityLabels = document.querySelectorAll('.visibility-options label');
                    
                    // 根据成熟度等级限制可见范围选项
                    visibilityOptions.forEach((option, index) => {
                        const visibilityLabel = visibilityLabels[index];
                        if (level === '草稿' || level === '初稿') {
                            // 草稿和初稿只能在个人空间可见
                            if (option.value !== 'personal') {
                                option.disabled = true;
                                visibilityLabel.classList.add('opacity-50', 'cursor-not-allowed');
                            } else {
                                option.disabled = false;
                                visibilityLabel.classList.remove('opacity-50', 'cursor-not-allowed');
                                option.checked = true;
                            }
                        } else if (level === '协作中') {
                            // 协作中可以在团队空间可见
                            if (['personal', 'team'].includes(option.value)) {
                                option.disabled = false;
                                visibilityLabel.classList.remove('opacity-50', 'cursor-not-allowed');
                            } else {
                                option.disabled = true;
                                visibilityLabel.classList.add('opacity-50', 'cursor-not-allowed');
                            }
                        } else {
                            // 成熟和精品可以在全空间可见
                            option.disabled = false;
                            visibilityLabel.classList.remove('opacity-50', 'cursor-not-allowed');
                        }
                    });
                    
                    // 更新可见范围显示
                    const selectedVisibility = document.querySelector('input[name="visibility"]:checked').value;
                    const visibilityText = {
                        personal: '个人空间',
                        team: '团队空间',
                        org: '组织空间',
                        all: '全员空间'
                    };
                    document.getElementById('visibility-scope').textContent = visibilityText[selectedVisibility] || '个人空间';
                }
                
                // 质量标准配置
                function openQualityStandardConfig() {
                    // 创建质量标准配置模态框
                    const modal = document.createElement('div');
                    modal.className = 'fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4';
                    modal.innerHTML = `
                        <div class="bg-white rounded-xl shadow-xl w-full max-w-md p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="font-medium">质量标准配置</h3>
                                <button class="p-1 text-muted hover:text-primary rounded" onclick="this.closest('.fixed').remove()">
                                    <i class="fa fa-times"></i>
                                </button>
                            </div>
                            
                            <div class="space-y-4">
                                <!-- AI质量检查权重 -->
                                <div>
                                    <div class="flex items-center justify-between mb-2">
                                        <label class="text-sm">AI质量检查</label>
                                        <span class="text-sm font-medium" id="ai-quality-weight">30%</span>
                                    </div>
                                    <input type="range" min="0" max="100" value="30" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" id="ai-quality-slider">
                                </div>
                                
                                <!-- 批注解决率权重 -->
                                <div>
                                    <div class="flex items-center justify-between mb-2">
                                        <label class="text-sm">批注解决率</label>
                                        <span class="text-sm font-medium" id="comment-resolution-weight">25%</span>
                                    </div>
                                    <input type="range" min="0" max="100" value="25" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" id="comment-resolution-slider">
                                </div>
                                
                                <!-- 评审人数权重 -->
                                <div>
                                    <div class="flex items-center justify-between mb-2">
                                        <label class="text-sm">评审人数</label>
                                        <span class="text-sm font-medium" id="reviewer-count-weight">20%</span>
                                    </div>
                                    <input type="range" min="0" max="100" value="20" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" id="reviewer-count-slider">
                                </div>
                                
                                <!-- 更新频率权重 -->
                                <div>
                                    <div class="flex items-center justify-between mb-2">
                                        <label class="text-sm">更新频率</label>
                                        <span class="text-sm font-medium" id="update-frequency-weight">15%</span>
                                    </div>
                                    <input type="range" min="0" max="100" value="15" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" id="update-frequency-slider">
                                </div>
                                
                                <!-- 使用量和评分权重 -->
                                <div>
                                    <div class="flex items-center justify-between mb-2">
                                        <label class="text-sm">使用量和评分</label>
                                        <span class="text-sm font-medium" id="usage-score-weight">10%</span>
                                    </div>
                                    <input type="range" min="0" max="100" value="10" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" id="usage-score-slider">
                                </div>
                            </div>
                            
                            <div class="flex justify-end gap-2 mt-6">
                                <button class="px-4 py-2 text-sm border border-line rounded-lg hover:bg-mist" onclick="this.closest('.fixed').remove()">
                                    取消
                                </button>
                                <button class="px-4 py-2 text-sm bg-primary text-white rounded-lg hover:bg-primary/90" onclick="saveQualityStandardConfig()">
                                    保存配置
                                </button>
                            </div>
                        </div>
                    `;
                    
                    document.body.appendChild(modal);
                    
                    // 绑定滑块事件
                    const sliders = modal.querySelectorAll('input[type="range"]');
                    sliders.forEach(slider => {
                        slider.addEventListener('input', function() {
                            const weightDisplay = document.getElementById(this.id.replace('-slider', '-weight'));
                            if (weightDisplay) {
                                weightDisplay.textContent = `${this.value}%`;
                            }
                        });
                    });
                }
                
                function saveQualityStandardConfig() {
                    // 获取配置值
                    const aiQualityWeight = document.getElementById('ai-quality-slider').value;
                    const commentResolutionWeight = document.getElementById('comment-resolution-slider').value;
                    const reviewerCountWeight = document.getElementById('reviewer-count-slider').value;
                    const updateFrequencyWeight = document.getElementById('update-frequency-slider').value;
                    const usageScoreWeight = document.getElementById('usage-score-slider').value;
                    
                    // 验证权重总和为100%
                    const totalWeight = parseInt(aiQualityWeight) + parseInt(commentResolutionWeight) + parseInt(reviewerCountWeight) + parseInt(updateFrequencyWeight) + parseInt(usageScoreWeight);
                    if (totalWeight !== 100) {
                        alert('所有权重之和必须为100%');
                        return;
                    }
                    
                    // 保存配置（模拟）
                    console.log('保存质量标准配置:', {
                        aiQualityWeight,
                        commentResolutionWeight,
                        reviewerCountWeight,
                        updateFrequencyWeight,
                        usageScoreWeight
                    });
                    
                    // 关闭模态框
                    document.querySelector('.fixed').remove();
                    
                    // 重新计算成熟度
                    updateMaturityDisplay();
                    alert('质量标准配置已保存');
                }
                
                // 运行成熟度更新
                const totalScore = updateMaturityDisplay();
                const currentLevel = getMaturityLevel(totalScore);
                
                // 更新可见性控制
                updateVisibilityByMaturity(totalScore, currentLevel);
                
                // 添加质量标准配置按钮
                const qualityStandardBtn = document.createElement('button');
                qualityStandardBtn.className = 'px-3 py-1 text-xs bg-secondary text-white rounded-lg hover:bg-secondary/90';
                qualityStandardBtn.innerHTML = '<i class="fa fa-cog mr-1"></i>配置标准';
                qualityStandardBtn.onclick = openQualityStandardConfig;
                
                const maturityConfigContainer = document.querySelector('.mt-4.p-4.rounded-xl.border.border-line.bg-white.text-sm .flex.items-center.justify-between');
                if (maturityConfigContainer) {
                    maturityConfigContainer.appendChild(qualityStandardBtn);
                }
            }
            
            // 每30秒模拟更新一次成熟度（实际项目中根据实际操作触发）
            // setInterval(updateMaturityLevel, 30000);
            
            // 版本历史功能
            // 查看版本历史按钮
            // 寻找包含特定文本的按钮
            const buttons = document.querySelectorAll('button');
            let viewVersionBtn;
            buttons.forEach(button => {
                if (button.textContent.includes('查看版本历史')) {
                    viewVersionBtn = button;
                }
            });
            
            if (viewVersionBtn) {
                viewVersionBtn.addEventListener('click', function() {
                    // 隐藏其他面板
                    document.getElementById('publish-settings').style.display = 'none';
                    document.getElementById('version-compare').style.display = 'none';
                    document.getElementById('ai-check-results').style.display = 'none';
                    
                    // 显示版本历史面板
                    document.getElementById('version-history').style.display = 'block';
                });
            }
            
            // 关闭版本历史面板
            const closeVersionBtn = document.getElementById('close-version');
            if (closeVersionBtn) {
                closeVersionBtn.addEventListener('click', function() {
                    document.getElementById('version-history').style.display = 'none';
                });
            }
            
            // 版本管理系统升级：完善自动版本记录、可视化对比和责任追溯
            
            // 版本数据结构
            let versionHistory = [];
            
            // 初始化版本历史
            function initVersionHistory() {
                // 从现有DOM中读取版本数据
                const versionItems = document.querySelectorAll('.version-item');
                versionItems.forEach(item => {
                    const version = item.dataset.version;
                    const isCurrent = item.querySelector('span.text-white') !== null;
                    const typeSpan = item.querySelector('span:not(.text-white)');
                    const type = typeSpan ? typeSpan.textContent : '';
                    const infoText = item.querySelector('.text-muted').textContent;
                    const author = infoText.split(' · ')[0];
                    const time = infoText.split(' · ')[1];
                    const description = item.querySelector('.mt-1.text-sm')?.textContent || '';
                    
                    versionHistory.push({
                        version,
                        isCurrent,
                        type,
                        author,
                        time,
                        description
                    });
                });
            }
            
            // 版本筛选功能
            function initVersionFilter() {
                const versionFilterBtns = document.querySelectorAll('.version-filter-btn');
                versionFilterBtns.forEach(btn => {
                    btn.addEventListener('click', function() {
                        // 更新按钮状态
                        versionFilterBtns.forEach(b => b.classList.remove('bg-primary', 'text-white'));
                        versionFilterBtns.forEach(b => b.classList.add('bg-white', 'border', 'border-line'));
                        this.classList.add('bg-primary', 'text-white');
                        this.classList.remove('bg-white', 'border', 'border-line');
                        
                        // 筛选版本
                        const filterType = this.dataset.type;
                        const versionItems = document.querySelectorAll('.version-item');
                        
                        versionItems.forEach(item => {
                            if (filterType === undefined) {
                                // 显示全部
                                item.style.display = 'flex';
                            } else {
                                const typeSpan = item.querySelector('span:not(.text-white)');
                                const itemType = typeSpan ? typeSpan.textContent : '';
                                
                                if (
                                    (filterType === 'publish' && itemType.includes('发布版本')) ||
                                    (filterType === 'save' && itemType.includes('自动保存')) ||
                                    (filterType === 'major' && itemType.includes('重大修订'))
                                ) {
                                    item.style.display = 'flex';
                                } else {
                                    item.style.display = 'none';
                                }
                            }
                        });
                    });
                });
            }
            
            // 版本选择和操作功能
            function initVersionActions() {
                const versionCheckboxes = document.querySelectorAll('.version-checkbox');
                const compareBtn = document.getElementById('compare-versions');
                const rollbackBtn = document.getElementById('rollback-version');
                
                // 更新操作按钮状态
                function updateActionButtons() {
                    const checkedCount = document.querySelectorAll('.version-checkbox:checked').length;
                    
                    // 回滚按钮：需要选择一个版本
                    if (checkedCount >= 1) {
                        rollbackBtn.disabled = false;
                        rollbackBtn.style.opacity = '1';
                    } else {
                        rollbackBtn.disabled = true;
                        rollbackBtn.style.opacity = '0.5';
                    }
                    
                    // 对比按钮：需要选择两个版本
                    if (checkedCount === 2) {
                        compareBtn.disabled = false;
                        compareBtn.style.opacity = '1';
                    } else {
                        compareBtn.disabled = true;
                        compareBtn.style.opacity = '0.5';
                    }
                }
                
                // 版本选择事件
                versionCheckboxes.forEach(checkbox => {
                    checkbox.addEventListener('change', updateActionButtons);
                });
                
                // 对比版本功能
                if (compareBtn) {
                    compareBtn.addEventListener('click', function() {
                        const checkedVersions = document.querySelectorAll('.version-checkbox:checked');
                        const versions = Array.from(checkedVersions).map(checkbox => {
                            return checkbox.closest('.version-item').dataset.version;
                        });
                        
                        if (versions.length === 2) {
                            // 隐藏版本历史面板
                            document.getElementById('version-history').style.display = 'none';
                            
                            // 显示版本对比面板
                            document.getElementById('version-compare').style.display = 'block';
                            
                            // 更新版本选择
                            document.getElementById('version-from').value = versions[0];
                            document.getElementById('version-to').value = versions[1];
                            
                            // 执行版本对比
                            compareVersions(versions[0], versions[1]);
                        }
                    });
                }
                
                // 回滚版本功能
                if (rollbackBtn) {
                    rollbackBtn.addEventListener('click', function() {
                        const checkedVersion = document.querySelector('.version-checkbox:checked');
                        if (checkedVersion) {
                            const versionItem = checkedVersion.closest('.version-item');
                            const version = versionItem.dataset.version;
                            const versionData = versionHistory.find(v => v.version === version);
                            
                            if (confirm(`确定要回滚到版本 V${version} 吗？\n\n修改者: ${versionData.author}\n时间: ${versionData.time}\n描述: ${versionData.description}\n\n此操作不可撤销。`)) {
                                // 执行回滚操作
                                rollbackToVersion(version);
                                alert(`已回滚到版本 V${version}`);
                            }
                        }
                    });
                }
            }
            
            // 版本对比功能
            function compareVersions(versionFrom, versionTo) {
                // 获取版本数据
                const fromVersion = versionHistory.find(v => v.version === versionFrom);
                const toVersion = versionHistory.find(v => v.version === versionTo);
                
                // 模拟AI变更摘要
                const aiSummary = `\n1. **新增内容**：添加了"智能协作批注"章节\n2. **修改内容**：优化了文档结构，将"核心功能"移至前面\n3. **删除内容**：移除了过时的"审批流程"说明\n4. **质量提升**：AI质量得分从80提升至85\n`;
                
                // 模拟差异对比
                const diffContent = `\n<div class="diff-container">\n  <div class="diff-item added">+ 智能协作批注系统支持多种批注类型和建议编辑模式</div>\n  <div class="diff-item modified">- 传统审批流程</div>\n  <div class="diff-item modified">+ 协作进化模式</div>\n  <div class="diff-item added">+ 知识成熟度自动评分机制</div>\n</div>`;
                
                // 更新对比面板
                const aiSummaryElement = document.querySelector('.p-3.rounded-lg.bg-primary/10 .mt-1.text-sm');
                if (aiSummaryElement) {
                    aiSummaryElement.textContent = aiSummary;
                }
                
                const diffElement = document.querySelector('.mt-4.p-4.rounded-xl.border.border-line.bg-white.text-sm .mt-1.text-sm');
                if (diffElement) {
                    diffElement.innerHTML = diffContent;
                }
            }
            
            // 回滚版本功能
            function rollbackToVersion(version) {
                // 更新版本历史
                versionHistory.forEach(v => v.isCurrent = false);
                const targetVersion = versionHistory.find(v => v.version === version);
                if (targetVersion) {
                    targetVersion.isCurrent = true;
                }
                
                // 更新DOM
                const versionItems = document.querySelectorAll('.version-item');
                versionItems.forEach(item => {
                    const itemVersion = item.dataset.version;
                    const isCurrent = itemVersion === version;
                    
                    // 更新当前版本标记
                    const currentTag = item.querySelector('span.text-white');
                    if (isCurrent) {
                        if (!currentTag) {
                            const versionInfo = item.querySelector('.flex.items-center.gap-2');
                            const newTag = document.createElement('span');
                            newTag.className = 'px-2 py-1 rounded-full bg-primary text-white text-xs';
                            newTag.textContent = '当前版本';
                            versionInfo.appendChild(newTag);
                        }
                        item.classList.remove('bg-white', 'border-line');
                        item.classList.add('bg-primary/10', 'border-primary');
                    } else {
                        if (currentTag) {
                            currentTag.remove();
                        }
                        item.classList.remove('bg-primary/10', 'border-primary');
                        item.classList.add('bg-white', 'border-line');
                    }
                });
            }
            
            // 自动版本记录功能
            function initAutoVersioning() {
                // 监听内容变化
                const editableContents = document.querySelectorAll('.editable-content');
                let autoSaveTimer = null;
                
                editableContents.forEach(content => {
                    content.addEventListener('input', function() {
                        // 清除之前的定时器
                        if (autoSaveTimer) {
                            clearTimeout(autoSaveTimer);
                        }
                        
                        // 设置新的定时器，30秒后自动保存
                        autoSaveTimer = setTimeout(() => {
                            autoSaveVersion();
                        }, 30000);
                    });
                });
            }
            
            // 自动保存版本
            function autoSaveVersion() {
                // 检查是否有未保存的更改
                const hasChanges = document.querySelectorAll('.editable-content').some(content => {
                    // 这里应该与原始内容比较，这里简化处理
                    return true;
                });
                
                if (hasChanges) {
                    // 生成自动保存版本
                    const currentVersion = versionHistory[0].version;
                    const newVersion = currentVersion + '-auto-' + Date.now();
                    
                    const autoSavedVersion = {
                        version: newVersion,
                        isCurrent: false,
                        type: '自动保存',
                        author: '系统',
                        time: '刚刚',
                        description: '自动保存版本'
                    };
                    
                    // 更新版本历史
                    versionHistory.push(autoSavedVersion);
                    
                    // 更新DOM
                    addVersionToHistory(autoSavedVersion);
                    
                    console.log('自动保存版本:', newVersion);
                }
            }
            
            // 将新版本添加到历史记录
            function addVersionToHistory(versionData) {
                const versionsContainer = document.querySelector('.space-y-3.max-h-[500px].overflow-y-auto.scrollbar-hide');
                if (!versionsContainer) return;
                
                // 创建新版本项
                const versionItem = document.createElement('div');
                versionItem.className = `version-item p-3 rounded-lg ${versionData.isCurrent ? 'bg-primary/10 border-primary' : 'bg-white border-line'} flex items-start gap-3`;
                versionItem.dataset.version = versionData.version;
                
                versionItem.innerHTML = `
                    <input type="checkbox" class="version-checkbox mt-1">
                    <div class="flex-1">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-2">
                                <p class="font-medium">V${versionData.version}</p>
                                ${versionData.isCurrent ? `<span class="px-2 py-1 rounded-full bg-primary text-white text-xs">当前版本</span>` : ''}
                                <span class="px-2 py-1 rounded-full bg-ocean text-primary text-xs">${versionData.type}</span>
                            </div>
                        </div>
                        <div class="flex items-center gap-2 text-xs text-muted">
                            <span>${versionData.author}</span>
                            <span>·</span>
                            <span>${versionData.time}</span>
                        </div>
                        <p class="mt-1 text-sm">${versionData.description}</p>
                        
                        <!-- 责任追溯信息 -->
                        <div class="mt-2 flex items-center gap-2 text-xs text-muted">
                            <i class="fa fa-history"></i>
                            <span>包含 ${Math.floor(Math.random() * 5) + 1} 处修改</span>
                            <span>·</span>
                            <i class="fa fa-users"></i>
                            <span>涉及 ${Math.floor(Math.random() * 3) + 1} 位协作者</span>
                        </div>
                    </div>
                `;
                
                // 添加到版本列表
                versionsContainer.appendChild(versionItem);
                
                // 重新绑定事件
                const newCheckbox = versionItem.querySelector('.version-checkbox');
                if (newCheckbox) {
                    newCheckbox.addEventListener('change', function() {
                        const checkedCount = document.querySelectorAll('.version-checkbox:checked').length;
                        const compareBtn = document.getElementById('compare-versions');
                        const rollbackBtn = document.getElementById('rollback-version');
                        
                        if (checkedCount >= 1) {
                            rollbackBtn.disabled = false;
                            rollbackBtn.style.opacity = '1';
                        } else {
                            rollbackBtn.disabled = true;
                            rollbackBtn.style.opacity = '0.5';
                        }
                        
                        if (checkedCount === 2) {
                            compareBtn.disabled = false;
                            compareBtn.style.opacity = '1';
                        } else {
                            compareBtn.disabled = true;
                            compareBtn.style.opacity = '0.5';
                        }
                    });
                }
            }
            
            // 初始化版本对比功能
            function initVersionCompare() {
                const startCompareBtn = document.getElementById('start-compare');
                if (startCompareBtn) {
                    startCompareBtn.addEventListener('click', function() {
                        const versionFrom = document.getElementById('version-from').value;
                        const versionTo = document.getElementById('version-to').value;
                        compareVersions(versionFrom, versionTo);
                    });
                }
            }
            
            // 初始化所有版本管理功能
            initVersionHistory();
            initVersionFilter();
            initVersionActions();
            initVersionCompare();
            initAutoVersioning();
            
            // 导出版本历史生成审计报告
            const exportVersionBtn = document.getElementById('export-version');
            if (exportVersionBtn) {
                exportVersionBtn.addEventListener('click', function() {
                    generateAuditReport();
                });
            }
            
            // 生成审计报告
            function generateAuditReport() {
                // 准备报告数据
                const reportData = {
                    documentName: '智能协作平台项目文档',
                    reportDate: new Date().toLocaleString(),
                    totalVersions: versionHistory.length,
                    versionHistory: versionHistory.map(version => ({
                        version: version.version,
                        type: version.type,
                        author: version.author,
                        time: version.time,
                        description: version.description,
                        isCurrent: version.isCurrent
                    })),
                    summary: {
                        totalChanges: versionHistory.length - 1,
                        majorRevisions: versionHistory.filter(v => v.type.includes('重大修订')).length,
                        publishVersions: versionHistory.filter(v => v.type.includes('发布版本')).length,
                        autoSaves: versionHistory.filter(v => v.type.includes('自动保存')).length
                    }
                };
                
                // 创建HTML报告
                const reportHTML = `
                    <!DOCTYPE html>
                    <html lang="zh-CN">
                    <head>
                        <meta charset="UTF-8">
                        <meta name="viewport" content="width=device-width, initial-scale=1.0">
                        <title>版本历史审计报告</title>
                        <style>
                            body {
                                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
                                line-height: 1.6;
                                color: #333;
                                max-width: 1200px;
                                margin: 0 auto;
                                padding: 20px;
                            }
                            h1 {
                                color: #2563eb;
                                border-bottom: 2px solid #e5e7eb;
                                padding-bottom: 10px;
                            }
                            h2 {
                                color: #1f2937;
                                margin-top: 30px;
                                border-bottom: 1px solid #e5e7eb;
                                padding-bottom: 8px;
                            }
                            .report-header {
                                background-color: #f3f4f6;
                                padding: 20px;
                                border-radius: 8px;
                                margin-bottom: 30px;
                            }
                            .summary-grid {
                                display: grid;
                                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                                gap: 20px;
                                margin-bottom: 30px;
                            }
                            .summary-card {
                                background-color: #f9fafb;
                                padding: 20px;
                                border-radius: 8px;
                                border-left: 4px solid #2563eb;
                            }
                            .summary-card h3 {
                                margin-top: 0;
                                color: #2563eb;
                            }
                            .version-table {
                                width: 100%;
                                border-collapse: collapse;
                                margin-bottom: 30px;
                            }
                            .version-table th,
                            .version-table td {
                                padding: 12px;
                                text-align: left;
                                border-bottom: 1px solid #e5e7eb;
                            }
                            .version-table th {
                                background-color: #f3f4f6;
                                font-weight: 600;
                            }
                            .current-version {
                                background-color: #dbeafe;
                                font-weight: 600;
                            }
                            .version-type {
                                display: inline-block;
                                padding: 4px 8px;
                                border-radius: 12px;
                                font-size: 12px;
                                font-weight: 500;
                            }
                            .type-publish {
                                background-color: #dbeafe;
                                color: #2563eb;
                            }
                            .type-major {
                                background-color: #fef3c7;
                                color: #d97706;
                            }
                            .type-save {
                                background-color: #d1fae5;
                                color: #059669;
                            }
                        </style>
                    </head>
                    <body>
                        <h1>版本历史审计报告</h1>
                        
                        <div class="report-header">
                            <p><strong>文档名称：</strong>${reportData.documentName}</p>
                            <p><strong>报告生成时间：</strong>${reportData.reportDate}</p>
                            <p><strong>总版本数：</strong>${reportData.totalVersions}</p>
                        </div>
                        
                        <h2>版本统计摘要</h2>
                        <div class="summary-grid">
                            <div class="summary-card">
                                <h3>总变更次数</h3>
                                <p>${reportData.summary.totalChanges}</p>
                            </div>
                            <div class="summary-card">
                                <h3>重大修订</h3>
                                <p>${reportData.summary.majorRevisions}</p>
                            </div>
                            <div class="summary-card">
                                <h3>发布版本</h3>
                                <p>${reportData.summary.publishVersions}</p>
                            </div>
                            <div class="summary-card">
                                <h3>自动保存</h3>
                                <p>${reportData.summary.autoSaves}</p>
                            </div>
                        </div>
                        
                        <h2>完整版本历史</h2>
                        <table class="version-table">
                            <thead>
                                <tr>
                                    <th>版本号</th>
                                    <th>版本类型</th>
                                    <th>修改者</th>
                                    <th>修改时间</th>
                                    <th>版本描述</th>
                                    <th>状态</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${reportData.versionHistory.map(version => `
                                    <tr class="${version.isCurrent ? 'current-version' : ''}">
                                        <td>V${version.version}</td>
                                        <td>
                                            <span class="version-type ${version.type.includes('发布版本') ? 'type-publish' : version.type.includes('重大修订') ? 'type-major' : 'type-save'}">
                                                ${version.type}
                                            </span>
                                        </td>
                                        <td>${version.author}</td>
                                        <td>${version.time}</td>
                                        <td>${version.description}</td>
                                        <td>${version.isCurrent ? '当前版本' : '历史版本'}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </body>
                    </html>
                `;
                
                // 创建下载链接
                const blob = new Blob([reportHTML], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `版本审计报告_${new Date().getTime()}.html`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                alert('审计报告已生成并下载');
            }
            
            // 版本对比功能
            // 关闭版本对比面板
            const closeCompareBtn = document.getElementById('close-compare');
            if (closeCompareBtn) {
                closeCompareBtn.addEventListener('click', function() {
                    document.getElementById('version-compare').style.display = 'none';
                });
            }
            
            // 开始对比
            const startCompareBtn = document.getElementById('start-compare');
            if (startCompareBtn) {
                startCompareBtn.addEventListener('click', function() {
                    const versionFrom = document.getElementById('version-from').value;
                    const versionTo = document.getElementById('version-to').value;
                    
                    // 模拟对比过程
                    startCompareBtn.innerHTML = '<i class="fa fa-spinner fa-spin mr-1"></i>对比中...';
                    startCompareBtn.disabled = true;
                    
                    setTimeout(function() {
                        // 更新AI变更摘要
                        const aiSummary = document.getElementById('ai-change-summary');
                        aiSummary.textContent = `V${versionTo}相比V${versionFrom}：进行了多处内容更新和优化，整体质量提升。`;
                        
                        startCompareBtn.innerHTML = '开始对比';
                        startCompareBtn.disabled = false;
                        
                        alert(`版本对比完成：V${versionFrom} → V${versionTo}`);
                    }, 1000);
                });
            }
            
            // 导出对比报告
            const exportCompareBtn = document.getElementById('export-compare');
            if (exportCompareBtn) {
                exportCompareBtn.addEventListener('click', function() {
                    alert('对比报告导出功能已触发');
                });
            }
            
            // 接受所有变更
            const acceptChangesBtn = document.getElementById('accept-changes');
            if (acceptChangesBtn) {
                acceptChangesBtn.addEventListener('click', function() {
                    alert('已接受所有变更');
                });
            }
            

            
            // 自动质量治理功能
            // 页面加载完成后初始化质量治理功能
            document.addEventListener('DOMContentLoaded', function() {
                initQualityGovernance();
            });
            
            // 初始化质量治理功能
            function initQualityGovernance() {
                // 立即更新按钮
                const updateBtn = document.getElementById('update-knowledge');
                if (updateBtn) {
                    updateBtn.addEventListener('click', function() {
                        // 触发质量更新
                        const updatedQuality = prompt('请输入更新后的质量分数（1-100）', '85');
                        if (updatedQuality && !isNaN(updatedQuality) && updatedQuality >= 1 && updatedQuality <= 100) {
                            // 更新质量显示
                            updateQualityDisplay(parseInt(updatedQuality));
                            alert('知识质量已更新');
                            
                            // 重新计算动态质量
                            calculateDynamicQuality();
                        } else {
                            alert('请输入有效的质量分数（1-100）');
                        }
                    });
                }
                
                // 延长有效期按钮
                const extendBtn = document.getElementById('extend-expiry');
                if (extendBtn) {
                    extendBtn.addEventListener('click', function() {
                        const newExpiryDate = prompt('请输入新的有效期（格式：YYYY-MM-DD）', '2024-12-31');
                        if (newExpiryDate) {
                            // 验证日期格式
                            if (isValidDate(newExpiryDate)) {
                                alert(`有效期已延长至 ${newExpiryDate}`);
                                
                                // 更新有效期
                                localStorage.setItem('knowledgeExpiryDate', newExpiryDate);
                            } else {
                                alert('日期格式错误，请使用YYYY-MM-DD格式');
                            }
                        }
                    });
                }
                
                // 低质量自动下架开关
                const autoRemoveCheckbox = document.getElementById('auto-remove');
                if (autoRemoveCheckbox) {
                    // 从配置加载状态
                    const governanceConfig = JSON.parse(localStorage.getItem('qualityGovernanceConfig')) || {};
                    autoRemoveCheckbox.checked = governanceConfig.autoRemove !== false;
                    
                    autoRemoveCheckbox.addEventListener('change', function() {
                        const isEnabled = this.checked;
                        
                        // 更新配置
                        updateGovernanceConfig({ autoRemove: isEnabled });
                        
                        alert(`低质量自动下架功能已${isEnabled ? '启用' : '禁用'}`);
                    });
                }
                
                // 申请精品认证按钮
                const applyCertBtn = document.getElementById('apply-certification');
                if (applyCertBtn) {
                    applyCertBtn.addEventListener('click', function() {
                        // 检查质量是否符合要求
                        const qualityAssessment = JSON.parse(localStorage.getItem('knowledgeQuality')) || {};
                        
                        if (qualityAssessment.qualityScore < 90) {
                            alert('精品认证要求质量分数达到90分以上，当前分数：' + qualityAssessment.qualityScore);
                            return;
                        }
                        
                        // 模拟精品认证申请过程
                        this.innerHTML = '<i class="fa fa-spinner fa-spin mr-1"></i>申请中...';
                        this.disabled = true;
                        
                        setTimeout(() => {
                            const result = confirm('精品认证申请成功！\n是否立即发布为精品知识？');
                            if (result) {
                                // 标记为精品知识
                                localStorage.setItem('knowledgeIsPremium', 'true');
                                alert('已发布为精品知识');
                            } else {
                                alert('已保存为草稿');
                            }
                            
                            // 恢复按钮状态
                            applyCertBtn.innerHTML = '申请精品认证';
                            applyCertBtn.disabled = false;
                        }, 1500);
                    });
                }
                
                // 质量标准配置按钮
                const configBtn = document.getElementById('quality-config');
                if (configBtn) {
                    configBtn.addEventListener('click', function() {
                        openQualityConfigPanel();
                    });
                }
                
                // 质量统计按钮
                const statsBtn = document.getElementById('quality-stats');
                if (statsBtn) {
                    statsBtn.addEventListener('click', function() {
                        showQualityStatistics();
                    });
                }
                
                // 初始计算质量
                calculateDynamicQuality();
            }
            
            // 更新质量治理配置
            function updateGovernanceConfig(newConfig) {
                const currentConfig = JSON.parse(localStorage.getItem('qualityGovernanceConfig')) || {};
                const updatedConfig = { ...currentConfig, ...newConfig };
                
                localStorage.setItem('qualityGovernanceConfig', JSON.stringify(updatedConfig));
                
                console.log('质量治理配置已更新:', updatedConfig);
            }
            
            // 打开质量标准配置面板
            function openQualityConfigPanel() {
                const config = JSON.parse(localStorage.getItem('qualityGovernanceConfig')) || {
                    autoRemove: true,
                    lowQualityThreshold: 40,
                    warningThreshold: 60,
                    qualityInspection: true
                };
                
                const panel = document.createElement('div');
                panel.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                panel.innerHTML = `
                    <div class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-md">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-medium">质量标准配置</h3>
                            <button id="close-config" class="text-muted"><i class="fa fa-times"></i></button>
                        </div>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="flex items-center gap-2 cursor-pointer">
                                    <input type="checkbox" id="config-auto-remove" ${config.autoRemove ? 'checked' : ''} class="rounded border-line">
                                    <span class="text-sm">低质量自动下架</span>
                                </label>
                            </div>
                            
                            <div>
                                <label class="block text-sm mb-1">低质量阈值 (1-100)</label>
                                <input type="number" id="config-low-threshold" value="${config.lowQualityThreshold}" 
                                       class="w-full border border-line rounded-lg px-3 py-2 text-sm" min="1" max="100">
                            </div>
                            
                            <div>
                                <label class="block text-sm mb-1">警告阈值 (1-100)</label>
                                <input type="number" id="config-warning-threshold" value="${config.warningThreshold}" 
                                       class="w-full border border-line rounded-lg px-3 py-2 text-sm" min="1" max="100">
                            </div>
                            
                            <div>
                                <label class="flex items-center gap-2 cursor-pointer">
                                    <input type="checkbox" id="config-quality-inspection" ${config.qualityInspection ? 'checked' : ''} class="rounded border-line">
                                    <span class="text-sm">质量检查提醒</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="flex gap-3 mt-6">
                            <button id="cancel-config" class="flex-1 px-4 py-2 rounded-lg border border-line text-sm">取消</button>
                            <button id="save-config" class="flex-1 px-4 py-2 rounded-lg bg-primary text-white text-sm">保存配置</button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(panel);
                
                // 关闭按钮
                const closeBtn = panel.querySelector('#close-config');
                const cancelBtn = panel.querySelector('#cancel-config');
                const saveBtn = panel.querySelector('#save-config');
                
                function closePanel() {
                    document.body.removeChild(panel);
                }
                
                closeBtn.addEventListener('click', closePanel);
                cancelBtn.addEventListener('click', closePanel);
                
                // 保存配置
                saveBtn.addEventListener('click', function() {
                    const autoRemove = panel.querySelector('#config-auto-remove').checked;
                    const lowThreshold = parseInt(panel.querySelector('#config-low-threshold').value);
                    const warningThreshold = parseInt(panel.querySelector('#config-warning-threshold').value);
                    const qualityInspection = panel.querySelector('#config-quality-inspection').checked;
                    
                    // 验证阈值
                    if (lowThreshold >= warningThreshold) {
                        alert('低质量阈值必须小于警告阈值');
                        return;
                    }
                    
                    // 更新配置
                    updateGovernanceConfig({
                        autoRemove: autoRemove,
                        lowQualityThreshold: lowThreshold,
                        warningThreshold: warningThreshold,
                        qualityInspection: qualityInspection
                    });
                    
                    alert('质量标准配置已保存');
                    closePanel();
                });
            }
            
            // 显示质量统计信息
            function showQualityStatistics() {
                const feedbacks = JSON.parse(localStorage.getItem('knowledgeFeedbacks')) || {};
                const knowledgeFeedbacks = feedbacks['current-knowledge'] || [];
                const quality = JSON.parse(localStorage.getItem('knowledgeQuality')) || {};
                
                const stats = {
                    totalFeedback: knowledgeFeedbacks.length,
                    averageRating: quality.averageRating || 0,
                    qualityScore: quality.qualityScore || 0,
                    positiveFeedbacks: knowledgeFeedbacks.filter(f => f.rating >= 4).length,
                    neutralFeedbacks: knowledgeFeedbacks.filter(f => f.rating === 3).length,
                    negativeFeedbacks: knowledgeFeedbacks.filter(f => f.rating <= 2).length
                };
                
                // 创建统计面板
                const panel = document.createElement('div');
                panel.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                panel.innerHTML = `
                    <div class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-md">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-medium">质量统计信息</h3>
                            <button id="close-stats" class="text-muted"><i class="fa fa-times"></i></button>
                        </div>
                        
                        <div class="space-y-4">
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-muted">总反馈数</span>
                                <span class="text-lg font-medium">${stats.totalFeedback}</span>
                            </div>
                            
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-muted">平均评分</span>
                                <span class="text-lg font-medium">${stats.averageRating.toFixed(1)}</span>
                            </div>
                            
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-muted">质量分数</span>
                                <span class="text-lg font-medium ${getQualityColorClass(stats.qualityScore)}">${stats.qualityScore}</span>
                            </div>
                            
                            <div class="mt-4">
                                <h4 class="text-sm font-medium mb-2">反馈分布</h4>
                                <div class="space-y-2">
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-success">正面反馈</span>
                                        <span class="text-sm">${stats.positiveFeedbacks} (${Math.round((stats.positiveFeedbacks / stats.totalFeedback || 0) * 100)}%)</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-warning">中性反馈</span>
                                        <span class="text-sm">${stats.neutralFeedbacks} (${Math.round((stats.neutralFeedbacks / stats.totalFeedback || 0) * 100)}%)</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-danger">负面反馈</span>
                                        <span class="text-sm">${stats.negativeFeedbacks} (${Math.round((stats.negativeFeedbacks / stats.totalFeedback || 0) * 100)}%)</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <button id="close-stats-btn" class="w-full mt-6 px-4 py-2 rounded-lg bg-primary text-white text-sm">关闭</button>
                    </div>
                `;
                
                document.body.appendChild(panel);
                
                // 关闭按钮
                const closeBtn = panel.querySelector('#close-stats');
                const closeStatsBtn = panel.querySelector('#close-stats-btn');
                
                function closePanel() {
                    document.body.removeChild(panel);
                }
                
                closeBtn.addEventListener('click', closePanel);
                closeStatsBtn.addEventListener('click', closePanel);
            }
            
            // 获取质量颜色类
            function getQualityColorClass(score) {
                if (score >= 80) return 'text-success';
                if (score >= 60) return 'text-primary';
                if (score >= 40) return 'text-warning';
                return 'text-danger';
            }
            
            // 日期格式验证函数
            function isValidDate(dateString) {
                const regEx = /^\d{4}-\d{2}-\d{2}$/;
                if (!dateString.match(regEx)) return false;
                const d = new Date(dateString);
                const dNum = d.getTime();
                if (!dNum && dNum !== 0) return false;
                return d.toISOString().slice(0, 10) === dateString;
            }
            
            // 协同编辑功能
            // 页面加载完成后初始化协同编辑功能
            document.addEventListener('DOMContentLoaded', function() {
                initCollaborativeEditing();
            });
            
            // 初始化协同编辑功能
            function initCollaborativeEditing() {
                // 为所有可编辑内容添加事件监听
                const editableContents = document.querySelectorAll('.editable-content');
                editableContents.forEach(content => {
                    content.addEventListener('focus', handleContentFocus);
                    content.addEventListener('blur', handleContentBlur);
                    content.addEventListener('input', function(e) {
                        const paragraphId = parseInt(this.closest('.document-paragraph').dataset.paragraphId);
                        handleContentChange(this, paragraphId);
                    });
                });
            }
            
            // 内容获得焦点时的处理
            function handleContentFocus(e) {
                const paragraph = this.closest('.document-paragraph');
                paragraph.dataset.editing = 'true';
                paragraph.classList.add('bg-primary/5');
                
                // 显示编辑指示器
                const editIndicator = paragraph.querySelector('.edit-indicator');
                if (editIndicator) {
                    editIndicator.style.opacity = '1';
                }
            }
            
            // 内容失去焦点时的处理
            function handleContentBlur(e) {
                const paragraph = this.closest('.document-paragraph');
                paragraph.dataset.editing = 'false';
                paragraph.classList.remove('bg-primary/5');
                
                // 隐藏编辑指示器
                const editIndicator = paragraph.querySelector('.edit-indicator');
                if (editIndicator) {
                    editIndicator.style.opacity = '0';
                }
            }
            
            // 内容变更处理
            function handleContentChange(element, paragraphId) {
                const content = element.innerHTML;
                const paragraph = element.closest('.document-paragraph');
                
                // 模拟内容变更通知服务器
                simulateServerNotification(paragraphId, content);
                
                // 检查冲突
                checkForConflicts(paragraphId, content);
            }
            
            // 模拟服务器通知
            function simulateServerNotification(paragraphId, content) {
                // 这里可以添加实际的WebSocket通信逻辑
                console.log(`段落 ${paragraphId} 内容已变更:`, content);
                
                // 模拟其他用户看到的更新
                setTimeout(() => {
                    // 这里可以添加其他用户界面更新逻辑
                }, 100);
            }
            
            // 冲突检测
            function checkForConflicts(paragraphId, content) {
                // 模拟冲突检测逻辑
                // 在实际应用中，这里会与服务器进行版本比对
                const hasConflict = Math.random() < 0.05; // 5%的概率模拟冲突
                
                if (hasConflict) {
                    showConflictWarning(paragraphId);
                }
            }
            
            // 显示冲突警告
            function showConflictWarning(paragraphId) {
                const paragraph = document.querySelector(`[data-paragraph-id="${paragraphId}"]`);
                if (!paragraph) return;
                
                // 检查是否已存在冲突警告
                let conflictWarning = paragraph.querySelector('.conflict-warning');
                if (conflictWarning) {
                    return;
                }
                
                // 创建冲突警告元素
                conflictWarning = document.createElement('div');
                conflictWarning.className = 'conflict-warning absolute top-full left-0 right-0 bg-danger/10 text-danger text-xs px-3 py-2 rounded-b-lg border-l border-r border-b border-danger';
                conflictWarning.innerHTML = `
                    <div class="flex items-center gap-2">
                        <i class="fa fa-exclamation-triangle"></i>
                        <span>检测到冲突！其他用户也在编辑此段落</span>
                        <button onclick="resolveConflict(${paragraphId})" class="ml-auto px-2 py-1 bg-danger text-white rounded text-xs">解决冲突</button>
                    </div>
                `;
                
                paragraph.appendChild(conflictWarning);
                paragraph.classList.add('border-danger');
            }
            
            // 解决冲突
            function resolveConflict(paragraphId) {
                const paragraph = document.querySelector(`[data-paragraph-id="${paragraphId}"]`);
                if (!paragraph) return;
                
                // 这里可以添加实际的冲突解决逻辑
                // 例如，显示冲突的两个版本，让用户选择
                const currentContent = paragraph.querySelector('.editable-content').innerHTML;
                const serverContent = "服务器上的版本内容...";
                
                const userChoice = confirm(`检测到内容冲突！\n\n您的版本：${currentContent.substring(0, 50)}...\n\n服务器版本：${serverContent.substring(0, 50)}...\n\n是否保留您的修改？`);
                
                if (userChoice) {
                    // 保留用户的修改
                    alert('您的修改已保存');
                } else {
                    // 使用服务器版本
                    alert('已使用服务器版本');
                    // 这里可以添加实际的服务器版本同步逻辑
                }
                
                // 移除冲突警告
                const conflictWarning = paragraph.querySelector('.conflict-warning');
                if (conflictWarning) {
                    conflictWarning.remove();
                }
                
                paragraph.classList.remove('border-danger');
            }
            
            // 合规审核功能
            // 页面加载完成后初始化合规审核功能
            document.addEventListener('DOMContentLoaded', function() {
                initComplianceCheck();
            });
            
            // 初始化合规审核功能
            function initComplianceCheck() {
                // 在运行AI预检时同时运行合规审核
                const runQualityCheckBtn = document.getElementById('run-quality-check');
                if (runQualityCheckBtn) {
                    runQualityCheckBtn.addEventListener('click', function() {
                        runComplianceCheck();
                    });
                }
                
                // 关闭合规审核结果
                const dismissComplianceBtn = document.getElementById('dismiss-compliance-results');
                if (dismissComplianceBtn) {
                    dismissComplianceBtn.addEventListener('click', function() {
                        const resultsPanel = document.getElementById('compliance-check-results');
                        if (resultsPanel) {
                            resultsPanel.style.display = 'none';
                        }
                    });
                }
                
                // 查看详细报告
                const viewReportBtn = document.getElementById('view-compliance-report');
                if (viewReportBtn) {
                    viewReportBtn.addEventListener('click', function() {
                        // 生成合规审计报告
                        generateComplianceReport();
                    });
                }
            }
            
            // 运行合规审核
            function runComplianceCheck() {
                // 显示加载状态
                const runQualityCheckBtn = document.getElementById('run-quality-check');
                if (runQualityCheckBtn) {
                    runQualityCheckBtn.innerHTML = '<i class="fa fa-spinner fa-spin mr-1"></i>运行中...';
                    runQualityCheckBtn.disabled = true;
                }
                
                // 执行AI风险扫描
                const riskResults = performAIRiskScan();
                
                // 模拟合规审核过程
                setTimeout(function() {
                    // 显示合规审核结果
                    const resultsPanel = document.getElementById('compliance-check-results');
                    if (resultsPanel) {
                        resultsPanel.style.display = 'block';
                        
                        // 更新风险等级
                        updateRiskLevelDisplay(riskResults);
                        
                        // 更新风险列表
                        updateRiskListDisplay(riskResults);
                    }
                    
                    // 更新检查时间
                    const checkTimeEl = document.getElementById('compliance-check-time');
                    if (checkTimeEl) {
                        checkTimeEl.textContent = '刚刚检查';
                    }
                    
                    // 保存审核结果
                    saveComplianceResults(riskResults);
                    
                    // 恢复按钮状态
                    if (runQualityCheckBtn) {
                        runQualityCheckBtn.innerHTML = '运行AI预检';
                        runQualityCheckBtn.disabled = false;
                    }
                }, 1500);
            }
            
            // 执行AI风险扫描
            function performAIRiskScan() {
                // 获取文档内容
                const documentContent = document.querySelector('#annotatable-document')?.textContent || '';
                
                // 模拟AI风险扫描
                const riskTypes = [
                    { id: 1, type: '敏感词', text: '敏感信息泄露风险', severity: 'high', category: '合规风险' },
                    { id: 2, type: '数据隐私', text: '个人数据处理不规范', severity: 'medium', category: '数据合规' },
                    { id: 3, type: '知识产权', text: '可能存在版权问题', severity: 'medium', category: '知识产权' },
                    { id: 4, type: '内容合规', text: '内容可能违反平台规范', severity: 'low', category: '内容合规' }
                ];
                
                // 根据内容生成风险结果
                const detectedRisks = [];
                
                // 模拟检测到的风险
                if (documentContent.length > 0) {
                    // 随机选择2-3个风险
                    const riskCount = Math.floor(Math.random() * 2) + 2;
                    for (let i = 0; i < riskCount; i++) {
                        detectedRisks.push(riskTypes[Math.floor(Math.random() * riskTypes.length)]);
                    }
                }
                
                // 计算综合风险等级
                const highRiskCount = detectedRisks.filter(r => r.severity === 'high').length;
                const mediumRiskCount = detectedRisks.filter(r => r.severity === 'medium').length;
                
                let overallRisk = 'low';
                if (highRiskCount > 0) {
                    overallRisk = 'high';
                } else if (mediumRiskCount > 0) {
                    overallRisk = 'medium';
                }
                
                return {
                    timestamp: new Date().toISOString(),
                    overallRisk: overallRisk,
                    totalRisks: detectedRisks.length,
                    risks: detectedRisks,
                    scanDetails: {
                        documentLength: documentContent.length,
                        scanTime: new Date().toLocaleString(),
                        aiModel: '智核AI合规检测模型 v1.0'
                    }
                };
            }
            
            // 更新风险等级显示
            function updateRiskLevelDisplay(results) {
                const riskLevelEl = document.getElementById('compliance-risk-level');
                if (!riskLevelEl) return;
                
                // 设置风险等级文本和样式
                const riskLevels = {
                    high: { text: '高风险', class: 'bg-danger/20 text-danger' },
                    medium: { text: '中风险', class: 'bg-warning/20 text-warning' },
                    low: { text: '低风险', class: 'bg-success/20 text-success' }
                };
                
                const level = riskLevels[results.overallRisk] || riskLevels.low;
                riskLevelEl.textContent = level.text;
                riskLevelEl.className = `px-3 py-1 rounded-full text-xs ${level.class}`;
            }
            
            // 更新风险列表显示
            function updateRiskListDisplay(results) {
                const riskListEl = document.querySelector('#compliance-check-results .space-y-3');
                if (!riskListEl) return;
                
                // 找到风险识别结果部分
                let riskItemsSection = riskListEl.querySelector('.space-y-2');
                if (!riskItemsSection) {
                    // 如果不存在，创建一个
                    riskItemsSection = document.createElement('div');
                    riskItemsSection.className = 'space-y-2';
                    riskListEl.appendChild(riskItemsSection);
                }
                
                // 清空现有风险列表
                riskItemsSection.innerHTML = '';
                
                // 添加新的风险列表
                results.risks.forEach(risk => {
                    const riskItem = document.createElement('div');
                    riskItem.className = `p-2 bg-white rounded border-l-4 ${getSeverityBorderClass(risk.severity)}`;
                    
                    const severityText = {
                        high: '高风险',
                        medium: '中风险',
                        low: '低风险'
                    }[risk.severity] || '低风险';
                    
                    riskItem.innerHTML = `
                        <div class="flex items-start justify-between">
                            <div>
                                <strong>${risk.category}</strong><span>: ${risk.text}</span>
                                <span class="ml-2 text-xs ${getSeverityTextClass(risk.severity)}">${severityText}</span>
                            </div>
                            <div class="flex gap-1">
                                <button class="text-xs px-2 py-1 rounded bg-primary text-white">立即修改</button>
                                <button class="text-xs px-2 py-1 rounded bg-white border border-line">标记为已处理</button>
                            </div>
                        </div>
                    `;
                    
                    riskItemsSection.appendChild(riskItem);
                });
                
                // 如果没有风险，显示无风险信息
                if (results.risks.length === 0) {
                    const noRiskItem = document.createElement('div');
                    noRiskItem.className = 'p-3 rounded bg-white text-center text-success';
                    noRiskItem.textContent = '未检测到合规风险';
                    riskItemsSection.appendChild(noRiskItem);
                }
            }
            
            // 获取风险等级样式类
            function getSeverityBorderClass(severity) {
                const classes = {
                    high: 'border-danger',
                    medium: 'border-warning',
                    low: 'border-success'
                };
                return classes[severity] || 'border-success';
            }
            
            // 获取风险等级文本样式类
            function getSeverityTextClass(severity) {
                const classes = {
                    high: 'text-danger',
                    medium: 'text-warning',
                    low: 'text-success'
                };
                return classes[severity] || 'text-success';
            }
            
            // 保存合规审核结果
            function saveComplianceResults(results) {
                // 获取现有审核记录
                let complianceHistory = JSON.parse(localStorage.getItem('complianceHistory')) || [];
                
                // 添加新的审核记录
                complianceHistory.push({
                    ...results,
                    id: Date.now()
                });
                
                // 只保留最近10条记录
                if (complianceHistory.length > 10) {
                    complianceHistory = complianceHistory.slice(-10);
                }
                
                // 保存到localStorage
                localStorage.setItem('complianceHistory', JSON.stringify(complianceHistory));
                localStorage.setItem('lastComplianceCheck', JSON.stringify(results));
                
                console.log('合规审核结果已保存:', results);
            }
            
            // 生成合规审计报告
            function generateComplianceReport() {
                // 获取最新的合规审核结果
                const lastComplianceCheck = JSON.parse(localStorage.getItem('lastComplianceCheck'));
                const complianceHistory = JSON.parse(localStorage.getItem('complianceHistory')) || [];
                
                if (!lastComplianceCheck) {
                    alert('请先运行合规审核');
                    return;
                }
                
                // 准备报告数据
                const reportData = {
                    reportTitle: '合规审计报告',
                    documentName: '智能协作平台项目文档',
                    reportDate: new Date().toLocaleString(),
                    scanTime: new Date(lastComplianceCheck.timestamp).toLocaleString(),
                    aiModel: lastComplianceCheck.scanDetails.aiModel,
                    overallRisk: lastComplianceCheck.overallRisk,
                    totalRisks: lastComplianceCheck.totalRisks,
                    risks: lastComplianceCheck.risks,
                    history: complianceHistory.slice(-5) // 显示最近5次审核记录
                };
                
                // 风险等级文本映射
                const riskLevelText = {
                    high: '高风险',
                    medium: '中风险',
                    low: '低风险'
                };
                
                // 风险严重程度文本映射
                const severityText = {
                    high: '高',
                    medium: '中',
                    low: '低'
                };
                
                // 创建HTML报告
                const reportHTML = `
                    <!DOCTYPE html>
                    <html lang="zh-CN">
                    <head>
                        <meta charset="UTF-8">
                        <meta name="viewport" content="width=device-width, initial-scale=1.0">
                        <title>${reportData.reportTitle}</title>
                        <style>
                            body {
                                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
                                line-height: 1.6;
                                color: #333;
                                max-width: 1200px;
                                margin: 0 auto;
                                padding: 20px;
                            }
                            h1 {
                                color: #111827;
                                border-bottom: 2px solid #e5e7eb;
                                padding-bottom: 10px;
                                margin-bottom: 20px;
                            }
                            h2 {
                                color: #1f2937;
                                margin-top: 30px;
                                border-bottom: 1px solid #e5e7eb;
                                padding-bottom: 8px;
                            }
                            .report-header {
                                background-color: #f3f4f6;
                                padding: 20px;
                                border-radius: 8px;
                                margin-bottom: 30px;
                            }
                            .report-meta {
                                display: grid;
                                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                                gap: 15px;
                                margin-bottom: 20px;
                            }
                            .meta-item {
                                display: flex;
                                justify-content: space-between;
                                align-items: center;
                            }
                            .meta-label {
                                font-weight: 500;
                                color: #6b7280;
                            }
                            .risk-badge {
                                display: inline-block;
                                padding: 4px 12px;
                                border-radius: 12px;
                                font-size: 14px;
                                font-weight: 500;
                            }
                            .risk-high {
                                background-color: #fee2e2;
                                color: #dc2626;
                            }
                            .risk-medium {
                                background-color: #fef3c7;
                                color: #d97706;
                            }
                            .risk-low {
                                background-color: #d1fae5;
                                color: #059669;
                            }
                            .risk-list {
                                list-style: none;
                                padding: 0;
                                margin: 0;
                            }
                            .risk-item {
                                background-color: #ffffff;
                                border: 1px solid #e5e7eb;
                                border-radius: 8px;
                                padding: 16px;
                                margin-bottom: 12px;
                                border-left: 4px solid #dc2626;
                            }
                            .risk-item.medium {
                                border-left-color: #d97706;
                            }
                            .risk-item.low {
                                border-left-color: #059669;
                            }
                            .risk-header {
                                display: flex;
                                justify-content: space-between;
                                align-items: center;
                                margin-bottom: 8px;
                            }
                            .risk-category {
                                font-weight: 600;
                                color: #1f2937;
                            }
                            .history-table {
                                width: 100%;
                                border-collapse: collapse;
                                margin-top: 20px;
                            }
                            .history-table th,
                            .history-table td {
                                padding: 12px;
                                text-align: left;
                                border-bottom: 1px solid #e5e7eb;
                            }
                            .history-table th {
                                background-color: #f3f4f6;
                                font-weight: 600;
                            }
                            .suggestions {
                                background-color: #eff6ff;
                                border: 1px solid #bfdbfe;
                                border-radius: 8px;
                                padding: 16px;
                                margin-top: 20px;
                            }
                            .suggestions h3 {
                                color: #2563eb;
                                margin-top: 0;
                                margin-bottom: 12px;
                            }
                        </style>
                    </head>
                    <body>
                        <h1>${reportData.reportTitle}</h1>
                        
                        <div class="report-header">
                            <div class="report-meta">
                                <div class="meta-item">
                                    <span class="meta-label">文档名称:</span>
                                    <span>${reportData.documentName}</span>
                                </div>
                                <div class="meta-item">
                                    <span class="meta-label">报告生成时间:</span>
                                    <span>${reportData.reportDate}</span>
                                </div>
                                <div class="meta-item">
                                    <span class="meta-label">最后审核时间:</span>
                                    <span>${reportData.scanTime}</span>
                                </div>
                                <div class="meta-item">
                                    <span class="meta-label">AI模型:</span>
                                    <span>${reportData.aiModel}</span>
                                </div>
                                <div class="meta-item">
                                    <span class="meta-label">综合风险等级:</span>
                                    <span class="risk-badge risk-${reportData.overallRisk}">${riskLevelText[reportData.overallRisk]}</span>
                                </div>
                                <div class="meta-item">
                                    <span class="meta-label">风险总数:</span>
                                    <span>${reportData.totalRisks}</span>
                                </div>
                            </div>
                        </div>
                        
                        <h2>详细风险列表</h2>
                        <ul class="risk-list">
                            ${reportData.risks.map(risk => `
                                <li class="risk-item ${risk.severity}">
                                    <div class="risk-header">
                                        <span class="risk-category">${risk.category}</span>
                                        <span class="risk-badge risk-${risk.severity}">${severityText[risk.severity]}风险</span>
                                    </div>
                                    <div class="risk-description">${risk.text}</div>
                                    <div class="risk-type">风险类型: ${risk.type}</div>
                                </li>
                            `).join('')}
                        </ul>
                        
                        <h2>历史审核记录</h2>
                        <table class="history-table">
                            <thead>
                                <tr>
                                    <th>审核时间</th>
                                    <th>风险等级</th>
                                    <th>风险数量</th>
                                    <th>AI模型</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${reportData.history.map(record => `
                                    <tr>
                                        <td>${new Date(record.timestamp).toLocaleString()}</td>
                                        <td><span class="risk-badge risk-${record.overallRisk}">${riskLevelText[record.overallRisk]}</span></td>
                                        <td>${record.totalRisks}</td>
                                        <td>${record.scanDetails.aiModel}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                        
                        <div class="suggestions">
                            <h3>合规建议</h3>
                            <ul>
                                <li>定期进行合规审核，建议每周至少一次</li>
                                <li>对高风险问题立即进行整改</li>
                                <li>建立合规问题跟踪机制，确保所有问题得到处理</li>
                                <li>定期更新合规检查规则，适应新的法规要求</li>
                                <li>对团队成员进行合规培训，提高合规意识</li>
                            </ul>
                        </div>
                    </body>
                    </html>
                `;
                
                // 创建下载链接
                const blob = new Blob([reportHTML], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `合规审计报告_${new Date().getTime()}.html`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                alert('合规审计报告已生成并下载');
            }
            
            // 处理立即修改按钮点击
            document.addEventListener('click', function(e) {
                if (e.target && e.target.textContent === '立即修改') {
                    const riskItem = e.target.closest('.p-2.bg-white.rounded.border-l-4.border-danger');
                    if (riskItem) {
                        const riskText = riskItem.querySelector('strong').nextSibling.textContent.trim();
                        alert(`正在处理：${riskText}`);
                        // 这里可以添加实际的修改逻辑
                    }
                }
            });
            
            // 处理标记为已处理按钮点击
            document.addEventListener('click', function(e) {
                if (e.target && e.target.textContent === '标记为已处理') {
                    const riskItem = e.target.closest('.p-2.bg-white.rounded.border-l-4.border-danger');
                    if (riskItem) {
                        riskItem.classList.remove('border-danger');
                        riskItem.classList.add('border-success');
                        e.target.textContent = '已处理';
                        e.target.disabled = true;
                        e.target.classList.add('opacity-50');
                        alert('该风险已标记为已处理');
                        // 这里可以添加实际的标记处理逻辑
                    }
                }
            });
        });
        
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        ink: '#111827',
                        primary: '#3b82f6',
                        secondary: '#8b5cf6',
                        accent: '#f59e0b',
                        success: '#10b981',
                        warning: '#f59e0b',
                        danger: '#ef4444',
                        card: '#ffffff',
                        'purple-light': '#ede9fe',
                        'blue-light': '#dbeafe',
                        'pink-light': '#fce7f3',
                        dark: '#1f2937',
                        paper: '#ffffff',
                        surface: '#f8fafc',
                        muted: '#6b7280',
                        line: '#e5e7eb',
                        mist: '#f3f4f6',
                        ocean: '#dbeafe',
                        coral: '#fde68a'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                        display: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    boxShadow: {
                        card: '0 2px 4px rgba(0, 0, 0, 0.05), 0 1px 2px rgba(0, 0, 0, 0.1)',
                        soft: '0 4px 8px rgba(0, 0, 0, 0.08)',
                        float: '0 8px 20px rgba(0, 0, 0, 0.12)'
                    },
                    animation: {
                        float: 'float 5s ease-in-out infinite',
                        fadeUp: 'fadeUp 0.6s ease forwards',
                        pulseSoft: 'pulse 3s ease-in-out infinite'
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0px)' },
                            '50%': { transform: 'translateY(-6px)' }
                        },
                        fadeUp: {
                            '0%': { opacity: 0, transform: 'translateY(18px)' },
                            '100%': { opacity: 1, transform: 'translateY(0)' }
                        }
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        :root {
            color-scheme: light;
        }
        @layer utilities {
            .scrollbar-hide::-webkit-scrollbar { display: none; }
            .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
            .glass { background: rgba(255, 255, 255, 0.9); border: 1px solid #e5e7eb; }
            .bg-horizon {
                background-color: #f8fafc;
                background-image:
                    linear-gradient(rgba(59, 130, 246, 0.05) 1px, transparent 1px),
                    linear-gradient(90deg, rgba(59, 130, 246, 0.05) 1px, transparent 1px);
                background-size: 20px 20px;
            }
            /* 修复页面显示问题 */
            .page { 
                display: none; 
                min-height: calc(100vh - 120px);
                height: calc(100vh - 120px);
                overflow: auto;
            }
            .page.active { 
                display: flex;
            }
            .tab-panel { display: none; }
            .tab-panel.active { display: block; }
            .view-panel { display: none; }
            .view-panel.active { display: block; }
            .section-panel { display: none; }
            .section-panel.active { display: block; }
            
            /* 动画效果样式 */
            /* 加载动画 */
            .loading-spinner {
                border: 3px solid rgba(255, 255, 255, 0.3);
                border-radius: 50%;
                border-top: 3px solid #007bff;
                width: 20px;
                height: 20px;
                animation: spin 1s linear infinite;
                margin: 10px auto;
            }
            
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
            
            /* 页面过渡动画 */
            .page, .tab-panel {
                transition: opacity 0.3s ease, transform 0.3s ease;
            }
            
            /* 按钮悬停效果 */
            button, .tab-btn, .ai-suggestion-item, .queue-item-checkbox, .term-btn {
                transition: all 0.2s ease;
            }
            
            button:hover, .tab-btn:hover, .ai-suggestion-item:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            }
            
            /* 卡片和面板的阴影效果 */
            .card, .tab-panel, #capture-drawer {
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                transition: box-shadow 0.3s ease;
            }
            
            .card:hover, .tab-panel:hover, #capture-drawer:hover {
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            }
            
            /* 术语样式 */
            .term-highlight {
                background-color: #fff3cd;
                border-bottom: 1px dashed #ffc107;
                cursor: pointer;
                padding: 0 2px;
                transition: all 0.2s ease;
            }
            
            .term-highlight:hover {
                background-color: #ffeeba;
                box-shadow: 0 1px 2px rgba(255, 193, 7, 0.3);
            }
            
            /* 术语气泡样式 */
            .term-bubble {
                max-width: 300px;
                z-index: 1000;
            }
            
            /* 动画效果 */
            @keyframes slideIn {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            
            @keyframes slideOut {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }
            
            .animate-slide-in {
                animation: slideIn 0.3s ease forwards;
            }
            
            .animate-slide-out {
                animation: slideOut 0.3s ease forwards;
            }
            
            /* 通知样式 */
            .notification {
                max-width: 350px;
                z-index: 1000;
            }
            
            /* 快速操作按钮样式 */
            .quick-action-btn {
                margin-right: 8px;
                margin-bottom: 8px;
            }
            
            /* 保存和搜索按钮样式 */
            .save-btn, .search-btn {
                margin-right: 8px;
            }
            
            /* 输入框和表单元素样式 */
            input, textarea, select {
                transition: all 0.2s ease;
            }
            
            /* 列表项样式 */
            .queue-item, .transcript-line, .note-item, .clip-item {
                transition: all 0.2s ease;
            }
            
            .queue-item:hover, .transcript-line:hover, .note-item:hover, .clip-item:hover {
                background-color: rgba(0, 123, 255, 0.05);
            }
            
            /* 进度条样式 */
            .progress-bar {
                transition: width 0.8s ease;
            }
            
            /* 模态框样式 */
            .modal {
                transition: opacity 0.3s ease, transform 0.3s ease;
            }
        }
    </style>
</head>
<body class="bg-horizon font-sans text-ink min-h-screen flex flex-col overflow-y-auto">
    <div class="fixed inset-0 pointer-events-none">
        <div class="absolute -top-24 -left-20 w-72 h-72 rounded-full bg-secondary/20 blur-3xl animate-float"></div>
        <div class="absolute bottom-10 right-6 w-64 h-64 rounded-full bg-accent/20 blur-3xl animate-float"></div>
    </div>

    <header class="relative z-20 flex items-center justify-between px-5 py-3 border-b border-line glass">
        <div class="flex items-center space-x-3">
            <div class="w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center">
                <div style="width: 20px; height: 20px; background-color: white !important; border-radius: 4px;"></div>
            </div>
            <div>
                <h1 class="text-lg font-display font-semibold tracking-wide">智核</h1>
                <p class="text-xs text-muted">智能工作台 · 知识协作入口</p>
            </div>
        </div>
        <div class="flex-1 mx-6 max-w-3xl">
            <div class="relative">
                <input id="global-search" type="text" placeholder="搜索知识、任务、智能体…" class="w-full px-10 py-2.5 rounded-full border border-line bg-paper focus:outline-none focus:ring-2 focus:ring-secondary/40">
                <span class="absolute left-4 top-2.5 text-muted"><i class="fa fa-search"></i></span>
                <span class="absolute right-4 top-2.5 text-xs text-muted">Ctrl/Cmd + K</span>
            </div>
            <div id="search-suggestions" class="hidden absolute mt-2 w-full bg-white rounded-2xl shadow-card border border-line p-4 text-sm z-30">
                <div class="mb-3">
                    <p class="text-xs text-muted uppercase tracking-wide">最近搜索</p>
                    <ul class="mt-2 space-y-2">
                        <li class="flex items-center gap-2 cursor-pointer hover:text-secondary"><i class="fa fa-history text-muted"></i>Q3销售报告</li>
                        <li class="flex items-center gap-2 cursor-pointer hover:text-secondary"><i class="fa fa-history text-muted"></i>新员工入职流程</li>
                    </ul>
                </div>
                <div>
                    <p class="text-xs text-muted uppercase tracking-wide">热门搜索</p>
                    <div class="mt-2 flex flex-wrap gap-2 text-xs">
                        <span class="px-3 py-1 rounded-full bg-mist cursor-pointer">年度预算</span>
                        <span class="px-3 py-1 rounded-full bg-mist cursor-pointer">产品roadmap</span>
                        <span class="px-3 py-1 rounded-full bg-mist cursor-pointer">客户满意度</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="flex items-center space-x-3">
            <button id="open-capture" class="px-3 py-2 rounded-full bg-primary text-white text-sm shadow-soft hover:bg-secondary transition">快速捕获</button>
            <button class="p-2 rounded-full hover:bg-white/60"><i class="fa fa-bell-o text-muted"></i></button>
            <button class="p-2 rounded-full hover:bg-white/60"><i class="fa fa-cog text-muted"></i></button>
            <div class="flex items-center space-x-2 cursor-pointer">
                <img src="https://p3-doubao-search-sign.byteimg.com/pgc-image/6323b43dac9b41db978bffd8c580ac63~tplv-be4g95zd3a-image.jpeg?lk3s=feb11e32&x-expires=1783481830&x-signature=E%2BA4UNzvvjJgdRQb3RrhhengBCo%3D" alt="用户头像" class="w-9 h-9 rounded-full border border-white shadow">
                <div class="hidden md:block">
                    <p class="text-sm font-medium">张明</p>
                    <p class="text-xs text-muted">产品经理</p>
                </div>
            </div>
        </div>
    </header>

    <main class="relative flex-1 flex overflow-auto">
        <aside class="w-64 border-r border-line glass px-3 py-4 flex flex-col gap-4">

            <nav class="flex-1 space-y-4 overflow-y-auto scrollbar-hide">
                <div class="px-3">
                    <p class="text-xs text-muted uppercase tracking-wider">核心功能</p>
                </div>
                <div class="space-y-2">
                    <button class="nav-btn w-full flex items-center px-4 py-3 rounded-xl text-sm font-medium bg-primary/10 text-primary" data-page="workbench" onclick="showPage('workbench');">
                        <i class="fa fa-dashboard w-5 h-5 mr-3 text-primary"></i>智能工作台
                    </button>
                    <button class="nav-btn w-full flex items-center px-4 py-3 rounded-xl text-sm text-muted hover:bg-white/70" data-page="knowledge" onclick="showPage('knowledge');">
                        <i class="fa fa-database w-5 h-5 mr-3 text-gray-500"></i>智能知识库
                    </button>
                    <button class="nav-btn w-full flex items-center px-4 py-3 rounded-xl text-sm text-muted hover:bg-white/70" data-page="capture" onclick="showPage('capture');">
                        <i class="fa fa-lightbulb-o w-5 h-5 mr-3 text-gray-500"></i>轻量生产工具
                    </button>
                    <button class="nav-btn w-full flex items-center px-4 py-3 rounded-xl text-sm text-muted hover:bg-white/70" data-page="context" onclick="showPage('context');">
                        <i class="fa fa-sitemap w-5 h-5 mr-3 text-gray-500"></i>情境知识面板
                    </button>
                </div>
                
                <div class="px-3">
                    <p class="text-xs text-muted uppercase tracking-wider">协作与市场</p>
                </div>
                <div class="space-y-2">
                    <button class="nav-btn w-full flex items-center px-4 py-3 rounded-xl text-sm text-muted hover:bg-white/70" data-page="team" onclick="showPage('team');">
                        <i class="fa fa-users w-5 h-5 mr-3 text-gray-500"></i>团队空间
                    </button>
                    <button class="nav-btn w-full flex items-center px-4 py-3 rounded-xl text-sm text-muted hover:bg-white/70" data-page="agent" onclick="showPage('agent');">
                        <i class="fa fa-android w-5 h-5 mr-3 text-gray-500"></i>智能体市场
                    </button>
                    <button class="nav-btn w-full flex items-center px-4 py-3 rounded-xl text-sm text-muted hover:bg-white/70" data-page="collab" onclick="showPage('collab');">
                        <i class="fa fa-gavel w-5 h-5 mr-3 text-gray-500"></i>协作与质量
                    </button>
                </div>
                
                <div class="px-3">
                    <p class="text-xs text-muted uppercase tracking-wider">个人设置</p>
                </div>
                <div class="space-y-2">
                    <button class="nav-btn w-full flex items-center px-4 py-3 rounded-xl text-sm text-muted hover:bg-white/70" data-page="settings" onclick="showPage('settings');">
                        <i class="fa fa-cog w-5 h-5 mr-3 text-gray-500"></i>个人与设置
                    </button>
                </div>
            </nav>
            <div class="px-4 py-3 rounded-xl bg-ocean text-sm">
                <p class="font-medium">智核提示</p>
                <p class="text-xs text-muted mt-1">所有智能能力均来自「灵枢」。服务异常时自动降级为关键词检索。</p>
            </div>
        </aside>

        <section class="flex-1 overflow-y-auto px-6 py-6 space-y-6">
            <div id="page-workbench" class="page active flex flex-col gap-6 h-[calc(100vh-120px)] overflow-hidden">
                <div class="flex flex-1 overflow-hidden min-h-0">
                    <aside class="w-64 bg-card border border-line rounded-2xl shadow-card flex flex-col mr-4">
                        <nav class="p-4 flex-1 overflow-y-auto scrollbar-hide flex flex-col">
                            <div>
                                <h3 class="text-xs uppercase text-muted font-semibold mb-2">最近会话</h3>
                                <ul class="space-y-2 text-sm">
                                    <li>
                                        <button class="w-full text-left p-3 rounded-lg bg-purple-light">Q3销售数据分析</button>
                                    </li>
                                    <li>
                                        <button class="w-full text-left p-3 rounded-lg bg-purple-light">产品需求文档模板</button>
                                    </li>
                                    <li>
                                        <button class="w-full text-left p-3 rounded-lg bg-purple-light">新员工入职流程</button>
                                    </li>
                                </ul>
                            </div>
                            <div class="mt-auto pt-6">
                                <h3 class="text-xs uppercase text-muted font-semibold mb-2">快捷访问</h3>
                                <div class="grid grid-cols-2 sm:grid-cols-4 gap-2 text-xs text-center">
                                    <button class="p-2 rounded-lg bg-purple-light">文档</button>
                                    <button class="p-2 rounded-lg bg-purple-light">日程</button>
                                    <button class="p-2 rounded-lg bg-purple-light">会议</button>
                                    <button class="p-2 rounded-lg bg-purple-light">更多</button>
                                </div>
                            </div>
                        </nav>
                    </aside>

                    <section class="flex-1 flex flex-col bg-transparent overflow-hidden min-h-0">
                        <div id="summary-card" class="bg-card border border-line rounded-2xl p-4 mb-4">
                            <div class="flex items-center justify-between mb-3">
                                <h2 class="text-lg font-semibold flex items-center">
                                    <i class="fa fa-lightbulb-o text-warning mr-2"></i>
                                    每日智能摘要
                                </h2>
                                <button id="toggle-summary" class="text-muted"><i class="fa fa-chevron-up"></i></button>
                            </div>
                            <div id="summary-content" class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                <div class="bg-purple-light rounded-lg p-3">
                                    <div class="flex items-center justify-between mb-2">
                                        <h3 class="font-medium text-sm">今日待办</h3>
                                        <button class="open-task-board text-xs px-2 py-0.5 rounded-full bg-danger text-white">3项</button>
                                    </div>
                                    <ul class="space-y-2 text-sm">
                                        <li class="flex items-center"><input type="checkbox" class="mr-2">审核产品需求文档</li>
                                        <li class="flex items-center"><input type="checkbox" class="mr-2">参加周例会</li>
                                        <li class="flex items-center"><input type="checkbox" class="mr-2">完成Q3销售数据分析</li>
                                    </ul>
                                </div>
                                <div class="bg-purple-light rounded-lg p-3">
                                    <div class="flex items-center justify-between mb-2">
                                        <h3 class="font-medium text-sm">关注更新</h3>
                                        <span class="text-xs px-2 py-0.5 rounded-full bg-primary text-white">2项</span>
                                    </div>
                                    <ul class="space-y-2 text-sm">
                                        <li>产品roadmap更新 · 李明 · 10分钟前</li>
                                        <li>市场调研报告完成 · 张华 · 2小时前</li>
                                    </ul>
                                </div>
                                <div class="bg-blue-light rounded-lg p-3">
                                    <div class="flex items-center justify-between mb-2">
                                        <h3 class="font-medium text-sm">知识推荐</h3>
                                        <button class="text-xs text-secondary">查看更多</button>
                                    </div>
                                    <ul class="space-y-2 text-sm">
                                        <li>产品经理工作指南 · 角色匹配</li>
                                        <li>数据分析最佳实践 · 活动相关</li>
                                    </ul>
                                </div>
                                <div class="bg-pink-light rounded-lg p-3">
                                    <div class="flex items-center justify-between mb-2">
                                        <h3 class="font-medium text-sm">异常预警</h3>
                                        <span class="text-xs px-2 py-0.5 rounded-full bg-warning text-white">1项</span>
                                    </div>
                                    <div class="bg-warning/10 border border-warning/20 rounded p-2 text-xs">
                                        <div class="flex items-center">
                                            <i class="fa fa-exclamation-triangle text-warning mr-2"></i>
                                            <span class="font-medium">项目进度预警</span>
                                        </div>
                                        <p class="text-muted mt-1">A产品开发进度落后计划7天，请关注</p>
                                        <button class="text-secondary mt-2">查看详情</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="flex-1 flex flex-col overflow-hidden min-h-0">
                            <div id="chat-history" class="flex-1 overflow-y-auto p-4 space-y-6 bg-white rounded-2xl border border-line min-h-0">
                                <div class="flex items-start">
                                    <div class="w-8 h-8 rounded-full bg-primary flex items-center justify-center text-white mr-3"><i class="fa fa-robot"></i></div>
                                    <div class="max-w-3xl">
                                        <div class="bg-card rounded-lg p-4 shadow-card">
                                            <div class="flex items-center mb-2">
                                                <span class="font-medium">智核助手</span>
                                                <span class="ml-2 px-2 py-0.5 bg-primary/10 text-primary text-xs rounded-full">官方</span>
                                            </div>
                                            <p class="text-gray-700">您好，张明！欢迎回到智核。今天有什么我可以帮助您的吗？</p>
                                            <div class="mt-3 flex flex-wrap gap-2 text-xs">
                                                <button class="fill-message px-3 py-1 bg-gray-100 rounded-full">查看今日待办</button>
                                                <button class="fill-message px-3 py-1 bg-gray-100 rounded-full">Q3销售数据分析</button>
                                                <button class="fill-message px-3 py-1 bg-gray-100 rounded-full">查找产品文档</button>
                                            </div>
                                        </div>
                                        <p class="text-xs text-muted mt-1">09:30</p>
                                    </div>
                                </div>

                                <div class="flex items-start justify-end">
                                    <div class="max-w-3xl">
                                        <div class="bg-primary/10 rounded-lg p-4">
                                            <p class="text-gray-700">帮我为下周的华东区销售会议准备一份市场趋势分析</p>
                                        </div>
                                        <p class="text-xs text-muted mt-1 text-right">09:32</p>
                                    </div>
                                    <div class="w-8 h-8 rounded-full bg-gray-300 ml-3 overflow-hidden">
                                        <img src="https://p3-doubao-search-sign.byteimg.com/pgc-image/6323b43dac9b41db978bffd8c580ac63~tplv-be4g95zd3a-image.jpeg?lk3s=feb11e32&x-expires=1783481830&x-signature=E%2BA4UNzvvjJgdRQb3RrhhengBCo%3D" alt="用户头像" class="w-full h-full object-cover">
                                    </div>
                                </div>

                                <div class="flex items-start">
                                    <div class="w-8 h-8 rounded-full bg-primary flex items-center justify-center text-white mr-3"><i class="fa fa-robot"></i></div>
                                    <div class="max-w-3xl">
                                        <div class="bg-card rounded-lg p-4 shadow-card">
                                            <div class="flex items-center mb-2">
                                                <span class="font-medium">智核助手</span>
                                                <span class="ml-2 px-2 py-0.5 bg-primary/10 text-primary text-xs rounded-full">官方</span>
                                            </div>
                                            <p class="text-gray-700">我正在为您准备华东区销售会议的市场趋势分析，请稍候...</p>
                                            <div class="mt-3 space-y-2 text-xs">
                                                <div>
                                                    <div class="flex justify-between mb-1">
                                                        <span>查询华东区近期销售数据</span>
                                                        <span class="text-success">已完成</span>
                                                    </div>
                                                    <div class="w-full bg-gray-200 rounded-full h-1.5">
                                                        <div class="bg-success h-1.5 rounded-full" style="width: 100%"></div>
                                                    </div>
                                                </div>
                                                <div>
                                                    <div class="flex justify-between mb-1">
                                                        <span>检索市场行业报告与竞品动态</span>
                                                        <span class="text-success">已完成</span>
                                                    </div>
                                                    <div class="w-full bg-gray-200 rounded-full h-1.5">
                                                        <div class="bg-success h-1.5 rounded-full" style="width: 100%"></div>
                                                    </div>
                                                </div>
                                                <div>
                                                    <div class="flex justify-between mb-1">
                                                        <span>分析趋势并生成结构化报告</span>
                                                        <span class="text-primary">进行中</span>
                                                    </div>
                                                    <div class="w-full bg-gray-200 rounded-full h-1.5">
                                                        <div class="bg-primary h-1.5 rounded-full" style="width: 75%"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <p class="text-xs text-muted mt-1">09:33</p>
                                    </div>
                                </div>

                                <div class="flex items-start">
                                    <div class="w-8 h-8 rounded-full bg-primary flex items-center justify-center text-white mr-3"><i class="fa fa-robot"></i></div>
                                    <div class="max-w-3xl">
                                        <div class="bg-card rounded-lg p-4 shadow-card">
                                            <div class="flex items-center mb-2">
                                                <span class="font-medium">智核助手</span>
                                                <span class="ml-2 px-2 py-0.5 bg-primary/10 text-primary text-xs rounded-full">官方</span>
                                            </div>
                                            <p class="text-gray-700">已为您准备好华东区销售会议的市场趋势分析报告。以下是核心发现：</p>
                                            <div class="mt-3 bg-purple-light rounded-lg p-3 border border-line">
                                                <h3 class="font-medium mb-2">核心发现</h3>
                                                <ol class="list-decimal list-inside space-y-1 text-sm">
                                                    <li>华东区Q2销售额同比增长15.3%，高于全国平均水平</li>
                                                    <li>上海地区贡献了60%的区域销售额，增长率达18.7%</li>
                                                    <li>竞品A在华东区市场份额下降3.2个百分点，我们的产品填补了空缺</li>
                                                    <li>线上渠道销售同比增长32.5%，建议加大投入</li>
                                                    <li>客户对新产品功能满意度达87%</li>
                                                </ol>
                                            </div>
                                            <div class="mt-3 bg-card rounded-lg p-3 border border-line">
                                                <h3 class="font-medium mb-2">销售趋势图表</h3>
                                                <div class="h-48">
                                                    <canvas id="salesChart" class="w-full h-full"></canvas>
                                                </div>
                                            </div>
                                            <div class="mt-3 flex flex-wrap gap-2 text-xs">
                                                <button class="px-3 py-1 bg-primary text-white rounded-full">下载完整报告</button>
                                                <button class="px-3 py-1 bg-gray-100 rounded-full">分享</button>
                                                <button class="px-3 py-1 bg-gray-100 rounded-full">收藏</button>
                                            </div>
                                            <div class="mt-3 text-xs text-muted">
                                                <p>数据来源：华东区销售数据库、市场研究报告、客户满意度调查</p>
                                                <p>最后更新：2023年7月20日</p>
                                            </div>
                                        </div>
                                        <p class="text-xs text-muted mt-1">09:35</p>
                                    </div>
                                </div>
                            </div>

                            <div class="border-t border-line p-4 bg-card rounded-2xl mt-4">
                                <div class="flex items-end">
                                    <div class="flex-1 bg-gray-50 rounded-lg border border-line focus-within:border-primary focus-within:ring-1 focus-within:ring-primary transition-all duration-300">
                                        <div class="px-4 py-2 border-b border-line flex items-center justify-between">
                                            <div class="flex space-x-2">
                                                <button class="quick-command text-xs px-2 py-1 bg-gray-100 rounded-full" data-command="/搜索">/搜索</button>
                                                <button class="quick-command text-xs px-2 py-1 bg-gray-100 rounded-full" data-command="/分析">/分析</button>
                                                <button class="quick-command text-xs px-2 py-1 bg-gray-100 rounded-full" data-command="/总结">/总结</button>
                                            </div>
                                            <div class="text-xs text-muted">按 Enter 发送，Shift + Enter 换行</div>
                                        </div>
                                        <div class="p-3">
                                            <textarea id="message-input" rows="1" placeholder="输入您的问题或指令..." class="w-full resize-none focus:outline-none bg-transparent"></textarea>
                                        </div>
                                        <div class="px-4 py-2 flex items-center justify-between border-t border-line">
                                            <div class="flex space-x-2">
                                                <button class="p-1.5 text-muted hover:text-primary"><i class="fa fa-paperclip"></i></button>
                                                <button class="p-1.5 text-muted hover:text-primary"><i class="fa fa-picture-o"></i></button>
                                                <button class="p-1.5 text-muted hover:text-primary"><i class="fa fa-microphone"></i></button>
                                            </div>
                                            <button id="send-message" class="px-4 py-1.5 bg-primary text-white rounded-lg">发送</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-2 text-xs text-muted flex items-center">
                                    <i class="fa fa-lightbulb-o text-warning mr-1"></i>
                                    <span>试试这些问题：</span>
                                    <button class="fill-message ml-1 text-secondary hover:underline">我的团队KPI完成情况如何？</button>
                                    <span class="mx-1">·</span>
                                    <button class="fill-message text-secondary hover:underline">查找关于产品定价的文档</button>
                                </div>
                            </div>
                        </div>
                    </section>

                    <aside class="w-64 bg-card border border-line rounded-2xl shadow-card flex flex-col ml-4 overflow-y-auto">
                        <div class="p-4 border-b border-line">
                            <h2 class="text-lg font-semibold">工作情境</h2>
                            <p class="text-sm text-muted">基于您当前的工作内容</p>
                        </div>
                        <div class="p-4 border-b border-line">
                            <h3 class="font-medium text-sm mb-3">关联知识</h3>
                            <ul class="space-y-3 text-sm">
                                <li class="bg-purple-light rounded-lg p-3">华东区市场策略</li>
                                <li class="bg-purple-light rounded-lg p-3">销售会议指南</li>
                                <li class="bg-purple-light rounded-lg p-3">市场趋势分析方法</li>
                            </ul>
                            <button class="w-full text-center text-secondary text-sm mt-3 hover:underline">查看更多</button>
                        </div>
                        <div class="p-4 border-b border-line">
                            <h3 class="font-medium text-sm mb-3">关联人员</h3>
                            <ul class="space-y-3 text-sm">
                                <li class="flex items-center justify-between bg-purple-light p-2 rounded-lg">
                                    <div class="flex items-center gap-2">
                                        <img src="https://p26-doubao-search-sign.byteimg.com/tos-cn-i-be4g95zd3a/915302335932530804~tplv-be4g95zd3a-image.jpeg?lk3s=feb11e32&x-expires=1783481830&x-signature=JyYZRLlBDe3i3%2BTpop49sMGhR8g%3D" alt="李强" class="w-7 h-7 rounded-full object-cover">
                                        <span>李强 · 华东区销售总监</span>
                                    </div>
                                    <button class="text-secondary text-xs">联系</button>
                                </li>
                                <li class="flex items-center justify-between bg-purple-light p-2 rounded-lg">
                                    <div class="flex items-center gap-2">
                                        <img src="https://p3-doubao-search-sign.byteimg.com/tos-cn-i-be4g95zd3a/917290012437381132~tplv-be4g95zd3a-image.jpeg?lk3s=feb11e32&x-expires=1783481830&x-signature=eE%2BzXl7cx1IbWn6x2FmQTE6dhr8%3D" alt="王晓华" class="w-7 h-7 rounded-full object-cover">
                                        <span>王晓华 · 市场分析师</span>
                                    </div>
                                    <button class="text-secondary text-xs">联系</button>
                                </li>
                            </ul>
                            <button class="w-full text-center text-secondary text-sm mt-3 hover:underline">查看更多</button>
                        </div>
                        <div class="p-4">
                            <h3 class="font-medium text-sm mb-3">快捷操作</h3>
                            <div class="grid grid-cols-2 gap-2 text-xs text-center">
                                <button class="p-3 bg-purple-light rounded-lg">安排会议</button>
                                <button class="p-3 bg-purple-light rounded-lg">发送邮件</button>
                                <button class="p-3 bg-purple-light rounded-lg">创建文档</button>
                                <button class="p-3 bg-purple-light rounded-lg">创建任务</button>
                            </div>
                            <div class="mt-4 space-y-3 text-xs">
                                <div class="p-3 rounded-xl bg-white border border-line">
                                    <p class="font-medium">建议参考</p>
                                    <p class="text-muted mt-1">《华东区渠道策略》已更新，请纳入报告引用。</p>
                                </div>
                                <div class="p-3 rounded-xl bg-white border border-line">
                                    <p class="font-medium">推荐专家</p>
                                    <p class="text-muted mt-1">王晓华 · 市场分析师 · 可协助趋势判断</p>
                                </div>
                                <div class="p-3 rounded-xl bg-white border border-line">
                                    <p class="font-medium">风险提示</p>
                                    <p class="text-muted mt-1">竞品B即将发布新产品，建议补充对比分析。</p>
                                </div>
                                <div class="p-3 rounded-xl bg-mist">
                                    <p class="font-medium">对话沉淀</p>
                                    <div class="flex items-center justify-between mt-2">
                                        <span class="text-sm">自动生成FAQ草稿</span>
                                        <button class="text-xs text-secondary">查看</button>
                                    </div>
                                </div>
                            </div>
                            <div class="pt-3 border-t border-line mt-4">
                                <p class="text-xs text-muted">灵枢连接</p>
                                <div class="flex items-center gap-2 text-xs">
                                    <span class="w-2 h-2 bg-success rounded-full"></span>服务正常
                                </div>
                            </div>
                        </div>
                    </aside>
                </div>
            </div>

            <div id="page-knowledge" class="page flex flex-col gap-6 h-[calc(100vh-120px)] overflow-auto">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-2xl font-display font-semibold">智能知识库</h2>
                        <p class="text-sm text-muted">AI驱动的知识生产、关联与治理中枢</p>
                    </div>
                    <div class="flex gap-2">
                        <button id="open-version-compare" class="px-3 py-2 rounded-full bg-white border border-line text-sm">版本对比</button>
                        <button class="px-3 py-2 rounded-full bg-primary text-white text-sm">新建文档</button>
                    </div>
                </div>
                <div class="bg-surface rounded-2xl border border-line shadow-card p-4">
                    <div class="flex flex-wrap items-center justify-between gap-3 mb-4">
                        <div class="flex flex-wrap gap-2">
                            <button class="section-btn px-3 py-2 rounded-full text-sm bg-primary text-white" data-section="browse">多视图浏览</button>
                            <button class="section-btn px-3 py-2 rounded-full text-sm bg-white border border-line" data-section="ai">AI创作空间</button>
                            <button class="section-btn px-3 py-2 rounded-full text-sm bg-white border border-line" data-section="review">版本与评审</button>
                            <button class="section-btn px-3 py-2 rounded-full text-sm bg-white border border-line" data-section="quality">质量保障</button>
                            <button class="section-btn px-3 py-2 rounded-full text-sm bg-white border border-line" data-section="lifecycle">生命周期</button>
                            <button class="section-btn px-3 py-2 rounded-full text-sm bg-white border border-line" data-section="integration">集成接口</button>
                            <button class="section-btn px-3 py-2 rounded-full text-sm bg-white border border-line" data-section="nonfunctional">非功能保障</button>
                        </div>
                        <div class="flex flex-wrap gap-2 text-xs">
                            <span class="px-3 py-1 rounded-full bg-primary/10 text-primary">当前状态：评审中</span>
                            <span class="px-3 py-1 rounded-full bg-mist">质量评分 82</span>
                            <span class="px-3 py-1 rounded-full bg-mist">生效范围：技术部门</span>
                        </div>
                    </div>
                    <div id="knowledge-browse" class="section-panel active">
                        <div class="flex flex-wrap gap-2 mb-4">
                            <button class="view-btn px-3 py-2 rounded-full text-sm bg-primary text-white" data-view="tree">文档树视图</button>
                            <button class="view-btn px-3 py-2 rounded-full text-sm bg-white border border-line" data-view="graph">知识图谱视图</button>
                            <button class="view-btn px-3 py-2 rounded-full text-sm bg-white border border-line" data-view="topic">主题视图</button>
                            <button class="view-btn px-3 py-2 rounded-full text-sm bg-white border border-line" data-view="timeline">时间轴视图</button>
                        </div>
                        <div id="knowledge-tree" class="view-panel active">
                            <div class="grid grid-cols-1 xl:grid-cols-3 gap-4">
                                <div class="bg-white rounded-xl border border-line p-3">
                                    <div class="flex items-center justify-between mb-3">
                                        <p class="text-sm font-medium">文档目录</p>
                                        <button id="toggle-select-mode" class="text-xs px-2 py-1 rounded-full bg-mist hover:bg-primary hover:text-white transition">批量选择</button>
                                    </div>
                                    <div class="space-y-2 text-xs">
                                        <div class="relative">
                                            <input id="tree-search-input" type="text" class="w-full border border-line rounded-lg px-2 py-1 pl-6" placeholder="树内搜索...">
                                            <i class="fa fa-search absolute left-2 top-2 text-muted"></i>
                                        </div>
                                        <div class="flex items-center gap-1 p-2 rounded-lg bg-mist">
                                            <i class="fa fa-home text-muted"></i>
                                            <span>首页</span>
                                            <span class="text-muted">/</span>
                                            <span class="text-primary">市场分析</span>
                                            <button class="ml-auto text-warning"><i class="fa fa-star-o"></i></button>
                                        </div>
                                    </div>
                                    <div class="mt-3 space-y-1 text-xs">
                                        <div class="p-2 rounded-lg bg-ocean flex items-center gap-2">
                                            <i class="fa fa-star text-warning"></i>
                                            <span class="font-medium">收藏的文件夹</span>
                                        </div>
                                        <div class="pl-4 space-y-1">
                                            <div class="p-2 rounded-lg hover:bg-mist cursor-pointer flex items-center justify-between">
                                                <div class="flex items-center gap-2">
                                                    <i class="fa fa-folder text-primary"></i>
                                                    <span>重点项目文档</span>
                                                </div>
                                                <i class="fa fa-angle-right text-muted"></i>
                                            </div>
                                            <div class="p-2 rounded-lg hover:bg-mist cursor-pointer flex items-center justify-between">
                                                <div class="flex items-center gap-2">
                                                    <i class="fa fa-folder text-primary"></i>
                                                    <span>常用模板</span>
                                                </div>
                                                <i class="fa fa-angle-right text-muted"></i>
                                            </div>
                                        </div>
                                    </div>
                                    <ul id="doc-tree-list" class="mt-3 space-y-1 text-xs">
                                        <li class="folder-item p-2 rounded-lg hover:bg-mist cursor-pointer" draggable="true">
                                            <div class="flex items-center justify-between">
                                                <div class="flex items-center gap-2">
                                                    <input type="checkbox" class="doc-checkbox hidden">
                                                    <i class="fa fa-angle-right folder-toggle"></i>
                                                    <i class="fa fa-folder text-primary"></i>
                                                    <span>📊 市场分析</span>
                                                </div>
                                                <div class="flex items-center gap-1">
                                                    <button class="p-1 hover:bg-white rounded" title="收藏"><i class="fa fa-star-o text-muted"></i></button>
                                                    <button class="folder-menu p-1 hover:bg-white rounded" title="更多"><i class="fa fa-ellipsis-h text-muted"></i></button>
                                                </div>
                                            </div>
                                            <ul class="folder-children ml-6 mt-1 space-y-1 hidden">
                                                <li class="p-1 hover:bg-mist rounded flex items-center justify-between">
                                                    <div class="flex items-center gap-2">
                                                        <input type="checkbox" class="doc-checkbox hidden">
                                                        <i class="fa fa-file-text-o text-muted"></i>
                                                        <span>华东区市场趋势分析.docx</span>
                                                    </div>
                                                    <span class="text-muted">2024/07/12</span>
                                                </li>
                                                <li class="p-1 hover:bg-mist rounded flex items-center justify-between">
                                                    <div class="flex items-center gap-2">
                                                        <input type="checkbox" class="doc-checkbox hidden">
                                                        <i class="fa fa-file-text-o text-muted"></i>
                                                        <span>竞品对比报告.pdf</span>
                                                    </div>
                                                    <span class="text-muted">2024/07/10</span>
                                                </li>
                                            </ul>
                                        </li>
                                        <li class="folder-item p-2 rounded-lg hover:bg-mist cursor-pointer" draggable="true">
                                            <div class="flex items-center justify-between">
                                                <div class="flex items-center gap-2">
                                                    <input type="checkbox" class="doc-checkbox hidden">
                                                    <i class="fa fa-angle-right folder-toggle"></i>
                                                    <i class="fa fa-folder text-primary"></i>
                                                    <span>🎯 产品规划</span>
                                                </div>
                                                <div class="flex items-center gap-1">
                                                    <button class="p-1 hover:bg-white rounded" title="收藏"><i class="fa fa-star-o text-muted"></i></button>
                                                    <button class="folder-menu p-1 hover:bg-white rounded" title="更多"><i class="fa fa-ellipsis-h text-muted"></i></button>
                                                </div>
                                            </div>
                                            <ul class="folder-children ml-6 mt-1 space-y-1 hidden">
                                                <li class="p-1 hover:bg-mist rounded flex items-center justify-between">
                                                    <div class="flex items-center gap-2">
                                                        <input type="checkbox" class="doc-checkbox hidden">
                                                        <i class="fa fa-file-text-o text-muted"></i>
                                                        <span>Q4产品路线图.xlsx</span>
                                                    </div>
                                                    <span class="text-muted">2024/07/08</span>
                                                </li>
                                            </ul>
                                        </li>
                                        <li class="folder-item p-2 rounded-lg hover:bg-mist cursor-pointer" draggable="true">
                                            <div class="flex items-center justify-between">
                                                <div class="flex items-center gap-2">
                                                    <input type="checkbox" class="doc-checkbox hidden">
                                                    <i class="fa fa-angle-right folder-toggle"></i>
                                                    <i class="fa fa-folder text-primary"></i>
                                                    <span>👥 团队协作</span>
                                                </div>
                                                <div class="flex items-center gap-1">
                                                    <button class="p-1 hover:bg-white rounded" title="收藏"><i class="fa fa-star-o text-muted"></i></button>
                                                    <button class="folder-menu p-1 hover:bg-white rounded" title="更多"><i class="fa fa-ellipsis-h text-muted"></i></button>
                                                </div>
                                            </div>
                                        </li>
                                        <li class="folder-item p-2 rounded-lg hover:bg-mist cursor-pointer" draggable="true">
                                            <div class="flex items-center justify-between">
                                                <div class="flex items-center gap-2">
                                                    <input type="checkbox" class="doc-checkbox hidden">
                                                    <i class="fa fa-angle-right folder-toggle"></i>
                                                    <i class="fa fa-folder text-primary"></i>
                                                    <span>💼 客户案例</span>
                                                </div>
                                                <div class="flex items-center gap-1">
                                                    <button class="p-1 hover:bg-white rounded" title="收藏"><i class="fa fa-star-o text-muted"></i></button>
                                                    <button class="folder-menu p-1 hover:bg-white rounded" title="更多"><i class="fa fa-ellipsis-h text-muted"></i></button>
                                                </div>
                                            </div>
                                        </li>
                                    </ul>
                                    <div id="batch-actions" class="mt-3 p-2 rounded-lg bg-ocean hidden">
                                        <p class="text-xs font-medium mb-2">已选择 <span id="selected-count">0</span> 项</p>
                                        <div class="flex flex-wrap gap-2 text-xs">
                                            <button class="action-btn px-2 py-1 rounded-full bg-white border border-line hover:bg-primary hover:text-white transition" data-action="批量移动操作已启动">移动</button>
                                            <button class="action-btn px-2 py-1 rounded-full bg-white border border-line hover:bg-primary hover:text-white transition" data-action="权限设置面板已打开">设置权限</button>
                                            <button class="action-btn px-2 py-1 rounded-full bg-white border border-line hover:bg-primary hover:text-white transition" data-action="批量导出任务已创建">导出</button>
                                            <button class="action-btn px-2 py-1 rounded-full bg-danger text-white" data-action="批量删除已确认">删除</button>
                                        </div>
                                    </div>
                                    <div class="mt-3 p-2 rounded-lg bg-mist text-xs">
                                        <p class="font-medium mb-1">拖拽提示</p>
                                        <p class="text-muted">拖拽文件或文件夹可快速调整组织结构</p>
                                    </div>
                                </div>
                                <div class="xl:col-span-2 bg-white rounded-xl border border-line p-4">
                                    <div class="flex items-center justify-between mb-3">
                                        <p class="font-medium">智能编辑器</p>
                                        <div class="flex gap-2 text-xs">
                                            <button class="action-btn px-2 py-1 rounded-full bg-mist hover:bg-secondary hover:text-white transition" data-action="正在生成文档大纲...">生成大纲</button>
                                            <button class="action-btn px-2 py-1 rounded-full bg-mist hover:bg-secondary hover:text-white transition" data-action="术语规范检查已完成">术语检查</button>
                                            <button class="action-btn px-2 py-1 rounded-full bg-mist hover:bg-secondary hover:text-white transition" data-action="智能摘要已生成">生成摘要</button>
                                            <button id="toggle-ai-panel" class="px-2 py-1 rounded-full bg-primary text-white">AI助手</button>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-2 text-xs mb-3">
                                        <span class="px-2 py-1 rounded-full bg-ocean"><i class="fa fa-check-circle text-success"></i> 所见即所得</span>
                                        <span class="px-2 py-1 rounded-full bg-ocean"><i class="fa fa-markdown text-primary"></i> Markdown语法</span>
                                        <span class="px-2 py-1 rounded-full bg-coral"><i class="fa fa-image text-warning"></i> 多媒体嵌入</span>
                                        <span class="px-2 py-1 rounded-full bg-coral"><i class="fa fa-sitemap"></i> 思维导图</span>
                                        <div class="ml-auto flex items-center gap-2 text-success">
                                            <div class="flex -space-x-2">
                                                <div class="w-6 h-6 rounded-full bg-primary text-white text-xs flex items-center justify-center border-2 border-white">张</div>
                                                <div class="w-6 h-6 rounded-full bg-secondary text-white text-xs flex items-center justify-center border-2 border-white">李</div>
                                                <div class="w-6 h-6 rounded-full bg-accent text-white text-xs flex items-center justify-center border-2 border-white">王</div>
                                            </div>
                                            <span>3人在线</span>
                                        </div>
                                    </div>
                                    <div class="p-3 border border-line rounded-lg text-sm bg-mist/50">
                                        <div class="flex items-center justify-between mb-2">
                                            <p class="font-medium text-ink">《华东区市场趋势分析》</p>
                                            <div class="flex items-center gap-2 text-xs">
                                                <span class="px-2 py-1 rounded-full bg-white">草稿</span>
                                                <span class="text-muted">自动保存于 2分钟前</span>
                                            </div>
                                        </div>
                                        <div class="space-y-2 text-sm">
                                            <div class="p-2 bg-white rounded border-l-4 border-primary">
                                                <p class="font-medium">一、背景与目标</p>
                                                <p class="text-muted mt-1">本报告聚焦2024年华东区重点行业的增长趋势、渠道变化与竞品动向...</p>
                                            </div>
                                            <div class="p-2 bg-white rounded border-l-4 border-secondary relative">
                                                <p class="font-medium">二、市场现状分析</p>
                                                <p class="text-muted mt-1">华东区Q2销售额同比增长15.3%，其中上海地区...</p>
                                                <div class="absolute right-2 top-2 flex gap-1">
                                                    <button class="p-1 bg-primary text-white rounded text-xs" title="AI续写"><i class="fa fa-magic"></i></button>
                                                    <button class="p-1 bg-secondary text-white rounded text-xs" title="AI改写"><i class="fa fa-refresh"></i></button>
                                                    <button class="p-1 bg-mist text-ink rounded text-xs" title="添加评论"><i class="fa fa-comment"></i></button>
                                                </div>
                                                <div class="mt-2 p-2 bg-warning/10 border border-warning/30 rounded text-xs">
                                                    <i class="fa fa-lightbulb-o text-warning"></i> AI建议：检测到术语"K8S"，建议替换为标准术语"Kubernetes"
                                                    <button class="ml-2 text-primary">应用</button>
                                                </div>
                                            </div>
                                            <div class="p-2 bg-white rounded border-l-4 border-accent">
                                                <p class="font-medium text-accent">三、竞品对比</p>
                                                <p class="text-muted mt-1 italic">[待补充] - AI提示：建议添加"竞品价格变动"分析</p>
                                            </div>
                                        </div>
                                        <div class="mt-3 flex flex-wrap gap-2 text-xs">
                                            <button class="px-2 py-1 bg-white border border-line rounded hover:bg-primary hover:text-white transition"><i class="fa fa-bold"></i></button>
                                            <button class="px-2 py-1 bg-white border border-line rounded hover:bg-primary hover:text-white transition"><i class="fa fa-italic"></i></button>
                                            <button class="px-2 py-1 bg-white border border-line rounded hover:bg-primary hover:text-white transition"><i class="fa fa-list-ul"></i></button>
                                            <button class="px-2 py-1 bg-white border border-line rounded hover:bg-primary hover:text-white transition"><i class="fa fa-table"></i></button>
                                            <button class="px-2 py-1 bg-white border border-line rounded hover:bg-primary hover:text-white transition"><i class="fa fa-code"></i></button>
                                            <button class="px-2 py-1 bg-white border border-line rounded hover:bg-primary hover:text-white transition"><i class="fa fa-link"></i> [[链接]]</button>
                                            <button class="px-2 py-1 bg-white border border-line rounded hover:bg-primary hover:text-white transition"><i class="fa fa-image"></i> 插入</button>
                                        </div>
                                        <div class="mt-2 p-2 bg-ocean/30 rounded text-xs">
                                            <p><i class="fa fa-keyboard-o"></i> <strong>Markdown快捷键：</strong> # 标题 | - 列表 | ``` 代码块 | [[ 智能链接</p>
                                        </div>
                                    </div>
                                    <div class="mt-3 grid grid-cols-1 md:grid-cols-3 gap-3 text-xs">
                                        <div class="p-3 rounded-xl bg-ocean">
                                            <p class="font-medium">相关案例</p>
                                            <p class="mt-1 text-muted">2023华北区渠道调整复盘</p>
                                        </div>
                                        <div class="p-3 rounded-xl bg-coral">
                                            <p class="font-medium">引用推荐</p>
                                            <p class="mt-1 text-muted">竞品B季度发布会纪要</p>
                                        </div>
                                        <div class="p-3 rounded-xl bg-mist">
                                            <p class="font-medium">专家建议</p>
                                            <p class="mt-1 text-muted">@王晓华参与审阅</p>
                                        </div>
                                    </div>
                                    <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-3 text-xs">
                                        <div class="p-3 rounded-xl border border-line">
                                            <p class="font-medium">智能链接插入</p>
                                            <p class="text-muted mt-1">输入 [[ 触发内部文档链接</p>
                                        </div>
                                        <div class="p-3 rounded-xl border border-line">
                                            <p class="font-medium">术语规范提示</p>
                                            <p class="text-muted mt-1">“K8S”建议替换为“Kubernetes”</p>
                                        </div>
                                        <div class="p-3 rounded-xl border border-line">
                                            <p class="font-medium">实体识别</p>
                                            <p class="text-muted mt-1">自动标注项目/技术术语</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="knowledge-graph" class="view-panel">
                            <div class="grid grid-cols-1 xl:grid-cols-4 gap-4">
                                <div class="xl:col-span-3 bg-white rounded-xl border border-line p-4">
                                    <div class="flex items-center justify-between mb-3">
                                        <p class="text-sm font-medium">交互式知识图谱</p>
                                        <div class="flex gap-2 text-xs">
                                            <select id="graph-layout" class="border border-line rounded px-2 py-1">
                                                <option value="force">力导向布局</option>
                                                <option value="hierarchical">层次布局</option>
                                                <option value="circular">环形布局</option>
                                                <option value="radial">辐射布局</option>
                                            </select>
                                            <button id="graph-fullscreen" class="px-2 py-1 rounded-full bg-mist hover:bg-primary hover:text-white transition"><i class="fa fa-expand"></i></button>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-2 mb-3 text-xs">
                                        <span class="px-2 py-1 rounded-full bg-ocean">
                                            <i class="fa fa-circle text-primary"></i> 文档 <span class="font-medium">12</span>
                                        </span>
                                        <span class="px-2 py-1 rounded-full bg-coral">
                                            <i class="fa fa-circle text-secondary"></i> 项目 <span class="font-medium">5</span>
                                        </span>
                                        <span class="px-2 py-1 rounded-full bg-mist">
                                            <i class="fa fa-circle text-accent"></i> 人员 <span class="font-medium">8</span>
                                        </span>
                                        <span class="px-2 py-1 rounded-full bg-mist">
                                            <i class="fa fa-circle text-success"></i> 任务 <span class="font-medium">15</span>
                                        </span>
                                    </div>
                                    <div class="relative bg-mist/30 rounded-lg border border-line" style="height: 480px;">
                                        <svg id="knowledge-graph-svg" class="w-full h-full" viewBox="0 0 800 480">
                                            <!-- 连接线 - 引用关系 -->
                                            <g id="edges">
                                                <line x1="150" y1="240" x2="300" y2="140" stroke="#3b82f6" stroke-opacity="0.4" stroke-width="2" class="graph-edge" data-type="引用"/>
                                                <line x1="150" y1="240" x2="300" y2="340" stroke="#3b82f6" stroke-opacity="0.4" stroke-width="2" class="graph-edge" data-type="引用"/>
                                                <line x1="300" y1="140" x2="500" y2="180" stroke="#8b5cf6" stroke-opacity="0.4" stroke-width="2" class="graph-edge" data-type="依赖"/>
                                                <line x1="300" y1="340" x2="500" y2="300" stroke="#8b5cf6" stroke-opacity="0.4" stroke-width="2" class="graph-edge" data-type="依赖"/>
                                                <line x1="500" y1="180" x2="650" y2="200" stroke="#10b981" stroke-opacity="0.4" stroke-width="2" class="graph-edge" data-type="作者"/>
                                                <line x1="500" y1="300" x2="650" y2="280" stroke="#f59e0b" stroke-opacity="0.4" stroke-width="2" class="graph-edge" data-type="相关"/>
                                                <line x1="300" y1="140" x2="450" y2="80" stroke="#3b82f6" stroke-opacity="0.4" stroke-width="2" class="graph-edge" data-type="引用"/>
                                            </g>
                                            <!-- 节点 -->
                                            <g id="nodes">
                                                <!-- 中心节点 -->
                                                <g class="graph-node" data-id="1" data-type="项目">
                                                    <circle cx="150" cy="240" r="35" fill="#1e40af" opacity="0.9" class="node-circle"/>
                                                    <text x="150" y="245" fill="#fff" font-size="13" text-anchor="middle">项目A</text>
                                                </g>
                                                <!-- 一度关联 -->
                                                <g class="graph-node" data-id="2" data-type="文档">
                                                    <circle cx="300" cy="140" r="28" fill="#3b82f6" opacity="0.85" class="node-circle"/>
                                                    <text x="300" y="145" fill="#fff" font-size="11" text-anchor="middle">市场报告</text>
                                                </g>
                                                <g class="graph-node" data-id="3" data-type="文档">
                                                    <circle cx="300" cy="340" r="28" fill="#3b82f6" opacity="0.85" class="node-circle"/>
                                                    <text x="300" y="345" fill="#fff" font-size="11" text-anchor="middle">竞品分析</text>
                                                </g>
                                                <!-- 二度关联 -->
                                                <g class="graph-node" data-id="4" data-type="项目">
                                                    <circle cx="500" cy="180" r="24" fill="#8b5cf6" opacity="0.8" class="node-circle"/>
                                                    <text x="500" y="185" fill="#fff" font-size="10" text-anchor="middle">项目B</text>
                                                </g>
                                                <g class="graph-node" data-id="5" data-type="文档">
                                                    <circle cx="500" cy="300" r="24" fill="#f59e0b" opacity="0.8" class="node-circle"/>
                                                    <text x="500" y="305" fill="#fff" font-size="10" text-anchor="middle">技术方案</text>
                                                </g>
                                                <g class="graph-node" data-id="6" data-type="人员">
                                                    <circle cx="650" cy="200" r="22" fill="#10b981" opacity="0.8" class="node-circle"/>
                                                    <text x="650" y="205" fill="#fff" font-size="9" text-anchor="middle">李强</text>
                                                </g>
                                                <g class="graph-node" data-id="7" data-type="任务">
                                                    <circle cx="650" cy="280" r="22" fill="#ef4444" opacity="0.75" class="node-circle"/>
                                                    <text x="650" y="285" fill="#fff" font-size="9" text-anchor="middle">任务1</text>
                                                </g>
                                                <g class="graph-node" data-id="8" data-type="文档">
                                                    <circle cx="450" cy="80" r="22" fill="#3b82f6" opacity="0.75" class="node-circle"/>
                                                    <text x="450" y="85" fill="#fff" font-size="9" text-anchor="middle">需求文档</text>
                                                </g>
                                            </g>
                                        </svg>
                                        <div id="graph-tooltip" class="absolute hidden bg-white border border-line rounded-lg p-3 shadow-float text-xs max-w-xs z-10">
                                            <p class="font-medium text-sm">节点标题</p>
                                            <p class="text-muted mt-1">摘要信息...</p>
                                            <div class="mt-2 flex gap-2">
                                                <span class="px-2 py-1 bg-mist rounded">类型: 文档</span>
                                                <span class="px-2 py-1 bg-mist rounded">关联: 5</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mt-3 flex flex-wrap gap-2 text-xs">
                                        <button class="action-btn px-2 py-1 rounded-full bg-white border border-line hover:bg-primary hover:text-white transition" data-action="图谱布局已切换为层次布局">切换布局</button>
                                        <button id="expand-one-hop" class="action-btn px-2 py-1 rounded-full bg-white border border-line hover:bg-primary hover:text-white transition" data-action="已展开1度关联节点">展开1度</button>
                                        <button id="expand-two-hop" class="action-btn px-2 py-1 rounded-full bg-white border border-line hover:bg-primary hover:text-white transition" data-action="已展开2度关联节点">展开2度</button>
                                        <button id="show-path" class="action-btn px-2 py-1 rounded-full bg-white border border-line hover:bg-primary hover:text-white transition" data-action="已高亮最短路径">最短路径</button>
                                        <button id="filter-relation" class="action-btn px-2 py-1 rounded-full bg-white border border-line hover:bg-primary hover:text-white transition" data-action="关系筛选器已打开">筛选关系</button>
                                        <button class="action-btn px-2 py-1 rounded-full bg-secondary text-white" data-action="图谱已重置">重置</button>
                                    </div>
                                </div>
                                <div class="bg-white rounded-xl border border-line p-4 space-y-3 text-xs">
                                    <p class="font-medium text-sm">图谱控制</p>
                                    <div class="space-y-2">
                                        <div class="p-2 rounded-lg bg-mist">
                                            <p class="font-medium">关系类型筛选</p>
                                            <div class="mt-2 space-y-1">
                                                <label class="flex items-center gap-2">
                                                    <input type="checkbox" checked class="relation-filter" data-type="引用">
                                                    <span class="text-primary">━</span> 引用
                                                </label>
                                                <label class="flex items-center gap-2">
                                                    <input type="checkbox" checked class="relation-filter" data-type="依赖">
                                                    <span class="text-secondary">━</span> 依赖
                                                </label>
                                                <label class="flex items-center gap-2">
                                                    <input type="checkbox" checked class="relation-filter" data-type="作者">
                                                    <span class="text-success">━</span> 作者
                                                </label>
                                                <label class="flex items-center gap-2">
                                                    <input type="checkbox" checked class="relation-filter" data-type="相关">
                                                    <span class="text-accent">━</span> 相关
                                                </label>
                                            </div>
                                        </div>
                                        <div class="p-2 rounded-lg bg-ocean">
                                            <p class="font-medium">选中节点信息</p>
                                            <div id="selected-node-info" class="mt-2 text-muted">点击节点查看详情</div>
                                        </div>
                                        <div class="p-2 rounded-lg bg-coral">
                                            <p class="font-medium">路径分析</p>
                                            <select class="w-full mt-2 border border-line rounded px-2 py-1">
                                                <option>选择起点...</option>
                                                <option>项目A</option>
                                                <option>市场报告</option>
                                            </select>
                                            <select class="w-full mt-1 border border-line rounded px-2 py-1">
                                                <option>选择终点...</option>
                                                <option>李强</option>
                                                <option>任务1</option>
                                            </select>
                                            <button class="w-full mt-2 px-2 py-1 rounded-full bg-primary text-white">分析路径</button>
                                        </div>
                                        <div class="p-2 rounded-lg border border-line">
                                            <p class="font-medium">图例</p>
                                            <div class="mt-2 space-y-1">
                                                <div class="flex items-center gap-2"><div class="w-3 h-3 rounded-full bg-primary"></div>文档</div>
                                                <div class="flex items-center gap-2"><div class="w-3 h-3 rounded-full bg-secondary"></div>项目</div>
                                                <div class="flex items-center gap-2"><div class="w-3 h-3 rounded-full bg-success"></div>人员</div>
                                                <div class="flex items-center gap-2"><div class="w-3 h-3 rounded-full bg-danger"></div>任务</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="knowledge-topic" class="view-panel">
                            <div class="mb-4 flex items-center justify-between">
                                <div class="flex items-center gap-2">
                                    <input type="text" class="border border-line rounded-full px-3 py-1 text-sm" placeholder="搜索主题...">
                                    <select class="border border-line rounded-full px-3 py-1 text-xs">
                                        <option>全部领域</option>
                                        <option>产品</option>
                                        <option>技术</option>
                                        <option>市场</option>
                                    </select>
                                </div>
                                <button class="px-3 py-1 rounded-full bg-primary text-white text-xs">创建主题空间</button>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div class="bg-white rounded-xl border border-line p-4 hover:shadow-soft transition cursor-pointer">
                                    <div class="flex items-center justify-between mb-2">
                                        <p class="font-medium">📈 产品增长</p>
                                        <button class="px-2 py-1 rounded-full bg-primary text-white text-xs">已关注</button>
                                    </div>
                                    <div class="flex items-center gap-3 text-xs text-muted mt-2">
                                        <span><i class="fa fa-file-text-o"></i> 22篇</span>
                                        <span><i class="fa fa-user"></i> 5位专家</span>
                                        <span><i class="fa fa-clock-o"></i> 今日更新2</span>
                                    </div>
                                    <div class="mt-3 p-2 rounded-lg bg-ocean text-xs">
                                        <p class="font-medium">核心文档</p>
                                        <p class="text-muted mt-1">《增长策略2024》《用户增长实践》</p>
                                    </div>
                                    <div class="mt-2 flex items-center gap-1 text-xs">
                                        <span class="px-2 py-1 bg-mist rounded">覆盖度 85%</span>
                                        <span class="px-2 py-1 bg-coral rounded">活跃度 高</span>
                                    </div>
                                </div>
                                <div class="bg-white rounded-xl border border-line p-4 hover:shadow-soft transition cursor-pointer">
                                    <div class="flex items-center justify-between mb-2">
                                        <p class="font-medium">💼 客户运营</p>
                                        <button class="px-2 py-1 rounded-full bg-white border border-line text-xs">关注</button>
                                    </div>
                                    <div class="flex items-center gap-3 text-xs text-muted mt-2">
                                        <span><i class="fa fa-file-text-o"></i> 18篇</span>
                                        <span><i class="fa fa-user"></i> 4位专家</span>
                                        <span><i class="fa fa-clock-o"></i> 3天前更新</span>
                                    </div>
                                    <div class="mt-3 p-2 rounded-lg bg-ocean text-xs">
                                        <p class="font-medium">核心文档</p>
                                        <p class="text-muted mt-1">《客户成功手册》《续约策略指南》</p>
                                    </div>
                                    <div class="mt-2 flex items-center gap-1 text-xs">
                                        <span class="px-2 py-1 bg-mist rounded">覆盖度 78%</span>
                                        <span class="px-2 py-1 bg-coral rounded">活跃度 中</span>
                                    </div>
                                </div>
                                <div class="bg-white rounded-xl border border-line p-4 hover:shadow-soft transition cursor-pointer">
                                    <div class="flex items-center justify-between mb-2">
                                        <p class="font-medium">🤖 智能体应用</p>
                                        <button class="px-2 py-1 rounded-full bg-white border border-line text-xs">关注</button>
                                    </div>
                                    <div class="flex items-center gap-3 text-xs text-muted mt-2">
                                        <span><i class="fa fa-file-text-o"></i> 12篇</span>
                                        <span><i class="fa fa-user"></i> 3位专家</span>
                                        <span><i class="fa fa-clock-o"></i> 昨日更新</span>
                                    </div>
                                    <div class="mt-3 p-2 rounded-lg bg-ocean text-xs">
                                        <p class="font-medium">核心文档</p>
                                        <p class="text-muted mt-1">《智能体设计规范》《应用案例库》</p>
                                    </div>
                                    <div class="mt-2 flex items-center gap-1 text-xs">
                                        <span class="px-2 py-1 bg-mist rounded">覆盖度 65%</span>
                                        <span class="px-2 py-1 bg-mist rounded">新兴主题</span>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-4 bg-white rounded-xl border border-line p-4">
                                <p class="font-medium mb-3">主题空间详情 - 产品增长</p>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-xs">
                                    <div class="p-3 rounded-xl bg-ocean">
                                        <p class="font-medium">知识地图</p>
                                        <div class="mt-2 space-y-1">
                                            <div class="flex justify-between"><span>获客策略</span><span class="text-success">✓ 完整</span></div>
                                            <div class="flex justify-between"><span>留存优化</span><span class="text-success">✓ 完整</span></div>
                                            <div class="flex justify-between"><span>变现模式</span><span class="text-warning">△ 待补充</span></div>
                                            <div class="flex justify-between"><span>增长实验</span><span class="text-danger">✗ 缺失</span></div>
                                        </div>
                                        <p class="mt-2 text-muted">覆盖度 82% · 关键缺口 3</p>
                                    </div>
                                    <div class="p-3 rounded-xl bg-coral">
                                        <p class="font-medium">核心文档(高频访问)</p>
                                        <ul class="mt-2 space-y-1 text-muted">
                                            <li><i class="fa fa-fire text-danger"></i> 《增长策略2024》 访问 328次</li>
                                            <li><i class="fa fa-fire text-danger"></i> 《用户增长实践》 访问 256次</li>
                                            <li><i class="fa fa-fire text-warning"></i> 《A/B测试指南》 访问 198次</li>
                                            <li>《产品数据分析》 访问 145次</li>
                                        </ul>
                                    </div>
                                    <div class="p-3 rounded-xl bg-mist">
                                        <p class="font-medium">活跃动态(近7天)</p>
                                        <ul class="mt-2 space-y-1 text-muted">
                                            <li>📝 新增文档 5篇</li>
                                            <li>✏️ 更新文档 8篇</li>
                                            <li>💬 评论讨论 23条</li>
                                            <li>⭐ 收藏推荐 15次</li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="mt-4 p-3 rounded-xl border border-line">
                                    <p class="font-medium">关键人物</p>
                                    <div class="mt-2 flex flex-wrap gap-2 text-xs">
                                        <div class="px-3 py-2 rounded-full bg-ocean flex items-center gap-2">
                                            <div class="w-6 h-6 rounded-full bg-primary text-white flex items-center justify-center">李</div>
                                            <span>李强 · 产品专家 · 贡献12篇</span>
                                        </div>
                                        <div class="px-3 py-2 rounded-full bg-coral flex items-center gap-2">
                                            <div class="w-6 h-6 rounded-full bg-secondary text-white flex items-center justify-center">王</div>
                                            <span>王晓华 · 数据专家 · 贡献8篇</span>
                                        </div>
                                        <div class="px-3 py-2 rounded-full bg-mist flex items-center gap-2">
                                            <div class="w-6 h-6 rounded-full bg-accent text-white flex items-center justify-center">张</div>
                                            <span>张三 · 增长负责人 · 贡献6篇</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="knowledge-timeline" class="view-panel">
                            <div class="mb-4 flex items-center justify-between">
                                <div class="flex items-center gap-2">
                                    <select class="border border-line rounded-full px-3 py-1 text-sm">
                                        <option>产品增长主题</option>
                                        <option>客户运营主题</option>
                                        <option>项目A</option>
                                        <option>全部知识</option>
                                    </select>
                                    <input type="date" class="border border-line rounded-full px-3 py-1 text-xs" value="2024-01-01">
                                    <span class="text-xs text-muted">至</span>
                                    <input type="date" class="border border-line rounded-full px-3 py-1 text-xs" value="2024-07-31">
                                </div>
                                <div class="flex gap-2">
                                    <button class="action-btn px-3 py-1 rounded-full bg-white border border-line text-xs hover:bg-primary hover:text-white transition" data-action="里程碑标注已启用">标注里程碑</button>
                                    <button id="timeline-compare" class="action-btn px-3 py-1 rounded-full bg-secondary text-white text-xs" data-action="时间点对比面板已打开">时间点对比</button>
                                </div>
                            </div>
                            <div class="bg-white rounded-xl border border-line p-4">
                                <p class="font-medium mb-4">知识演进时间轴 - 产品增长主题</p>
                                <div class="relative">
                                    <!-- 时间轴主线 -->
                                    <div class="absolute left-8 top-0 bottom-0 w-0.5 bg-line"></div>
                                    <div class="space-y-6 text-xs">
                                        <!-- 里程碑事件 -->
                                        <div class="relative pl-16">
                                            <div class="absolute left-6 top-1 w-5 h-5 rounded-full bg-primary flex items-center justify-center text-white">
                                                <i class="fa fa-flag" style="font-size: 10px;"></i>
                                            </div>
                                            <div class="p-3 rounded-lg bg-primary/10 border border-primary/30">
                                                <div class="flex items-center justify-between mb-1">
                                                    <p class="font-medium text-sm">🎯 V2.0产品增长策略发布</p>
                                                    <span class="text-muted">2024/07/15</span>
                                                </div>
                                                <p class="text-muted">里程碑：完成年度增长策略规划，新增4个核心增长模型，建立12个实验框架</p>
                                                <div class="mt-2 flex items-center gap-2">
                                                    <span class="px-2 py-1 bg-white rounded">新增文档 4篇</span>
                                                    <span class="px-2 py-1 bg-white rounded">关联实体 8个</span>
                                                    <span class="px-2 py-1 bg-white rounded">参与专家 3位</span>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- 普通更新 -->
                                        <div class="relative pl-16">
                                            <div class="absolute left-7 top-2 w-3 h-3 rounded-full bg-secondary"></div>
                                            <div class="p-3 rounded-lg bg-white border border-line">
                                                <div class="flex items-center justify-between mb-1">
                                                    <p class="font-medium">发布《华东区市场趋势分析》</p>
                                                    <span class="text-muted">2024/07/12</span>
                                                </div>
                                                <p class="text-muted">补充华东区域数据，新增竞品对比章节，版本V2.0</p>
                                                <div class="mt-2 flex items-center gap-2">
                                                    <span class="px-2 py-1 bg-mist rounded">更新文档 1篇</span>
                                                    <span class="px-2 py-1 bg-mist rounded">新增关联 4个</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="relative pl-16">
                                            <div class="absolute left-7 top-2 w-3 h-3 rounded-full bg-accent"></div>
                                            <div class="p-3 rounded-lg bg-white border border-line">
                                                <div class="flex items-center justify-between mb-1">
                                                    <p class="font-medium">更新《竞品B策略分析》</p>
                                                    <span class="text-muted">2024/06/30</span>
                                                </div>
                                                <p class="text-muted">补充价格变动数据、渠道策略变化，修复术语不一致问题</p>
                                                <div class="mt-2 flex items-center gap-2">
                                                    <span class="px-2 py-1 bg-mist rounded">修订文档 1篇</span>
                                                    <span class="px-2 py-1 bg-mist rounded">修复问题 3处</span>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- 里程碑事件 -->
                                        <div class="relative pl-16">
                                            <div class="absolute left-6 top-1 w-5 h-5 rounded-full bg-success flex items-center justify-center text-white">
                                                <i class="fa fa-check" style="font-size: 10px;"></i>
                                            </div>
                                            <div class="p-3 rounded-lg bg-success/10 border border-success/30">
                                                <div class="flex items-center justify-between mb-1">
                                                    <p class="font-medium text-sm">🎉 Q2季度总结完成</p>
                                                    <span class="text-muted">2024/06/25</span>
                                                </div>
                                                <p class="text-muted">里程碑：完成Q2回顾，沉淀3个关键决策，识别5个核心任务，产出2份复盘文档</p>
                                                <div class="mt-2 flex items-center gap-2">
                                                    <span class="px-2 py-1 bg-white rounded">会议纪要 2份</span>
                                                    <span class="px-2 py-1 bg-white rounded">决策记录 3项</span>
                                                    <span class="px-2 py-1 bg-white rounded">任务派发 5个</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="relative pl-16">
                                            <div class="absolute left-7 top-2 w-3 h-3 rounded-full bg-secondary"></div>
                                            <div class="p-3 rounded-lg bg-white border border-line">
                                                <div class="flex items-center justify-between mb-1">
                                                    <p class="font-medium">沉淀会议纪要《增长策略讨论会》</p>
                                                    <span class="text-muted">2024/06/05</span>
                                                </div>
                                                <p class="text-muted">自动识别3项决策、5个待办任务，关联项目A与产品增长主题</p>
                                                <div class="mt-2 flex items-center gap-2">
                                                    <span class="px-2 py-1 bg-mist rounded">会议纪要 1份</span>
                                                    <span class="px-2 py-1 bg-mist rounded">决策提取 3项</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-6 flex items-center justify-center">
                                    <button class="px-4 py-2 rounded-full bg-mist text-sm hover:bg-primary hover:text-white transition">加载更早记录</button>
                                </div>
                            </div>
                            <div id="timeline-comparison" class="mt-4 bg-white rounded-xl border border-line p-4 hidden">
                                <p class="font-medium mb-3">时间点对比分析</p>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-xs">
                                    <div class="p-3 rounded-lg border border-line">
                                        <p class="font-medium">时间点A: 2024/06/30</p>
                                        <ul class="mt-2 space-y-1 text-muted">
                                            <li>• 文档总数: 15篇</li>
                                            <li>• 核心文档: 8篇</li>
                                            <li>• 专家人数: 4位</li>
                                            <li>• 知识覆盖度: 72%</li>
                                        </ul>
                                    </div>
                                    <div class="p-3 rounded-lg border border-line">
                                        <p class="font-medium">时间点B: 2024/07/15</p>
                                        <ul class="mt-2 space-y-1 text-muted">
                                            <li>• 文档总数: 22篇 <span class="text-success">(+7)</span></li>
                                            <li>• 核心文档: 12篇 <span class="text-success">(+4)</span></li>
                                            <li>• 专家人数: 5位 <span class="text-success">(+1)</span></li>
                                            <li>• 知识覆盖度: 85% <span class="text-success">(+13%)</span></li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="mt-3 p-3 rounded-lg bg-ocean text-xs">
                                    <p class="font-medium">变化分析</p>
                                    <p class="text-muted mt-1">在此期间，知识体系显著扩充，新增增长实验框架和数据分析模型，覆盖度提升13个百分点，团队协作更活跃。</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="knowledge-ai" class="section-panel">
                        <div class="grid grid-cols-1 xl:grid-cols-3 gap-4">
                            <div class="xl:col-span-2 bg-white rounded-xl border border-line p-4 space-y-4">
                                <div class="flex items-center justify-between">
                                    <p class="font-medium">AI写作助手</p>
                                    <div class="flex gap-2 text-xs">
                                        <button class="action-btn px-2 py-1 rounded-full bg-mist hover:bg-primary hover:text-white transition" data-action="AI正在续写段落...">续写</button>
                                        <button class="action-btn px-2 py-1 rounded-full bg-mist hover:bg-secondary hover:text-white transition" data-action="AI改写建议已生成">改写</button>
                                        <button class="action-btn px-2 py-1 rounded-full bg-mist hover:bg-accent hover:text-white transition" data-action="多粒度摘要已生成">生成摘要</button>
                                    </div>
                                </div>
                                <div class="p-3 rounded-lg bg-gradient-to-r from-primary/10 to-secondary/10 border border-primary/20 text-sm">
                                    <div class="flex items-center gap-2 mb-2">
                                        <i class="fa fa-magic text-primary"></i>
                                        <p class="font-medium">智能大纲生成</p>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2 text-xs">
                                        <input type="text" class="border border-line rounded px-2 py-1" placeholder="输入文档标题..." value="华东区增长策略2024">
                                        <select class="border border-line rounded px-2 py-1">
                                            <option>技术方案</option>
                                            <option selected>市场分析</option>
                                            <option>项目复盘</option>
                                            <option>产品需求</option>
                                            <option>会议纪要</option>
                                        </select>
                                    </div>
                                    <button class="generate-outline-btn mt-2 px-3 py-1 rounded-full bg-primary text-white text-xs hover:bg-secondary transition">生成结构化大纲</button>
                                </div>
                                <div class="p-3 rounded-lg bg-white border border-line text-xs">
                                    <p class="font-medium mb-2">AI生成的大纲预览</p>
                                    <div class="outline-preview-container space-y-1 pl-3">
                                        <div class="flex items-center justify-between p-2 hover:bg-mist rounded cursor-pointer">
                                            <span><i class="fa fa-angle-right text-muted"></i> 一、背景与目标</span>
                                            <button class="text-primary text-xs">编辑</button>
                                        </div>
                                        <div class="flex items-center justify-between p-2 hover:bg-mist rounded cursor-pointer">
                                            <span><i class="fa fa-angle-right text-muted"></i> 二、市场现状分析</span>
                                            <button class="text-primary text-xs">编辑</button>
                                        </div>
                                        <div class="pl-4 space-y-1">
                                            <div class="flex items-center justify-between p-1 hover:bg-mist rounded text-muted">
                                                <span>2.1 整体市场规模与增速</span>
                                                <i class="fa fa-check-circle text-success"></i>
                                            </div>
                                            <div class="flex items-center justify-between p-1 hover:bg-mist rounded text-muted">
                                                <span>2.2 区域分布与特征</span>
                                                <i class="fa fa-check-circle text-success"></i>
                                            </div>
                                        </div>
                                        <div class="flex items-center justify-between p-2 hover:bg-mist rounded cursor-pointer">
                                            <span><i class="fa fa-angle-right text-muted"></i> 三、竞品对比分析</span>
                                            <button class="text-warning text-xs">待补充</button>
                                        </div>
                                        <div class="flex items-center justify-between p-2 hover:bg-mist rounded cursor-pointer">
                                            <span><i class="fa fa-angle-right text-muted"></i> 四、增长策略建议</span>
                                            <button class="text-primary text-xs">编辑</button>
                                        </div>
                                        <div class="flex items-center justify-between p-2 hover:bg-mist rounded cursor-pointer">
                                            <span><i class="fa fa-angle-right text-muted"></i> 五、风险评估与应对</span>
                                            <button class="text-primary text-xs">编辑</button>
                                        </div>
                                    </div>
                                    <button class="apply-outline-btn mt-3 w-full px-3 py-2 rounded-full bg-secondary text-white text-xs">应用大纲到编辑器</button>
                                </div>
                                <div class="p-3 rounded-lg border border-line text-xs">
                                    <p class="font-medium mb-2">段落AI改写建议</p>
                                    <div class="space-y-2">
                                        <div class="p-2 rounded bg-mist">
                                            <p class="text-muted">原文：华东区市场增长快速，特别是上海地区表现突出。</p>
                                        </div>
                                        <div class="space-y-1">
                                            <div class="p-2 rounded bg-ocean cursor-pointer hover:bg-primary/20">
                                                <div class="flex items-center justify-between">
                                                    <span class="text-xs text-muted">更专业</span>
                                                    <button class="text-primary">应用</button>
                                                </div>
                                                <p class="mt-1">华东区市场呈现加速增长态势，其中上海地区销售额同比增长18.7%，贡献了区域60%的市场份额。</p>
                                            </div>
                                            <div class="p-2 rounded bg-coral cursor-pointer hover:bg-secondary/20">
                                                <div class="flex items-center justify-between">
                                                    <span class="text-xs text-muted">更简洁</span>
                                                    <button class="text-secondary">应用</button>
                                                </div>
                                                <p class="mt-1">华东区高速增长，上海领跑。</p>
                                            </div>
                                            <div class="p-2 rounded bg-mist cursor-pointer hover:bg-accent/20">
                                                <div class="flex items-center justify-between">
                                                    <span class="text-xs text-muted">更通俗</span>
                                                    <button class="text-accent">应用</button>
                                                </div>
                                                <p class="mt-1">华东区市场发展很快，上海的业绩特别好。</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="p-3 rounded-lg border border-line text-xs">
                                    <p class="font-medium mb-2">自动生成摘要(多粒度)</p>
                                    <div class="space-y-2">
                                        <div class="p-2 rounded bg-primary/10 border border-primary/30">
                                            <p class="font-medium">一句话摘要</p>
                                            <p class="text-muted mt-1">华东区2024年销售额同比增长15.3%，上海地区表现突出，建议加大线上渠道投入。</p>
                                        </div>
                                        <div class="p-2 rounded bg-secondary/10 border border-secondary/30">
                                            <p class="font-medium">三要点摘要</p>
                                            <ul class="text-muted mt-1 space-y-1 list-disc list-inside">
                                                <li>华东区Q2销售额同比增长15.3%，高于全国平均水平</li>
                                                <li>上海地区贡献60%区域销售额，增长率达18.7%</li>
                                                <li>线上渠道销售同比增长32.5%，建议加大投入</li>
                                            </ul>
                                        </div>
                                        <div class="p-2 rounded bg-accent/10 border border-accent/30">
                                            <p class="font-medium">200字摘要</p>
                                            <p class="text-muted mt-1 text-xs leading-relaxed">本报告分析2024年华东区市场趋势。数据显示，华东区Q2销售额同比增长15.3%，高于全国平均水平。上海地区贡献了60%的区域销售额，增长率达18.7%。竞品A市场份额下降3.2个百分点，我们的产品填补了市场空缺。线上渠道销售同比增长32.5%，表现突出。客户对新产品功能满意度达87%。建议：1)加大线上渠道投入；2)加强上海地区市场覆盖；3)持续优化产品功能。</p>
                                        </div>
                                    </div>
                                    <button class="mt-2 w-full px-3 py-2 rounded-full bg-accent text-white text-xs">保存摘要到文档</button>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-3 text-xs">
                                    <div class="p-3 rounded-xl bg-ocean">
                                        <p class="font-medium">相关案例</p>
                                        <p class="mt-1 text-muted">“渠道整合”复盘报告</p>
                                    </div>
                                    <div class="p-3 rounded-xl bg-coral">
                                        <p class="font-medium">引用推荐</p>
                                        <p class="mt-1 text-muted">Q2行业趋势研究</p>
                                    </div>
                                    <div class="p-3 rounded-xl bg-mist">
                                        <p class="font-medium">专家推荐</p>
                                        <p class="mt-1 text-muted">@李强参与评审</p>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-3 text-xs">
                                    <div class="p-3 rounded-xl border border-line">
                                        <p class="font-medium">多粒度摘要</p>
                                        <p class="text-muted mt-1">一句话 · 三要点 · 200字</p>
                                    </div>
                                    <div class="p-3 rounded-xl border border-line">
                                        <p class="font-medium">段落改写</p>
                                        <p class="text-muted mt-1">专业/简洁/通俗</p>
                                    </div>
                                    <div class="p-3 rounded-xl border border-line">
                                        <p class="font-medium">协作建议</p>
                                        <p class="text-muted mt-1">@专家审阅 · 相关文档引用</p>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-white rounded-xl border border-line p-4 space-y-3 text-xs">
                                <p class="font-medium text-sm">模板与组件库</p>
                                <div class="p-3 rounded-lg bg-mist">技术方案模板 · 可生成风险评估章节</div>
                                <div class="p-3 rounded-lg bg-mist">项目复盘模板 · 自动生成时间线</div>
                                <div class="p-3 rounded-lg bg-mist">审批流程组件 · 一键插入</div>
                                <button class="w-full px-3 py-2 rounded-full bg-primary text-white text-xs">打开模板库</button>
                            </div>
                        </div>
                        <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="bg-white rounded-xl border border-line p-4 text-xs">
                                <p class="font-medium">智能关联与标注</p>
                                <p class="text-muted mt-2">自动识别项目、术语、人员实体，统一术语并关联知识图谱。</p>
                                <div class="mt-3 flex flex-wrap gap-2">
                                    <span class="px-2 py-1 rounded-full bg-mist">[[智能链接]]</span>
                                    <span class="px-2 py-1 rounded-full bg-mist">术语规范检查</span>
                                    <span class="px-2 py-1 rounded-full bg-mist">本体定义预览</span>
                                </div>
                            </div>
                            <div class="bg-white rounded-xl border border-line p-4 text-xs">
                                <p class="font-medium">多模态编辑器</p>
                                <p class="text-muted mt-2">支持图表、视频、流程图与思维导图一键插入并自动同步结构。</p>
                                <div class="mt-3 flex flex-wrap gap-2">
                                    <span class="px-2 py-1 rounded-full bg-mist">流程图</span>
                                    <span class="px-2 py-1 rounded-full bg-mist">泳道图</span>
                                    <span class="px-2 py-1 rounded-full bg-mist">图表</span>
                                </div>
                            </div>
                            <div class="bg-white rounded-xl border border-line p-4 text-xs">
                                <p class="font-medium">协作编辑</p>
                                <p class="text-muted mt-2">多人实时协作，标注光标与选区，支持评论与@提及。</p>
                                <div class="mt-3 flex items-center gap-2">
                                    <span class="w-2 h-2 rounded-full bg-success"></span>
                                    <span>3人在线协作中</span>
                                </div>
                            </div>
                        </div>
                        <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-4 text-xs">
                            <div class="bg-white rounded-xl border border-line p-4">
                                <p class="font-medium">术语规范检查</p>
                                <p class="text-muted mt-2">检测同义词与未定义术语并给出替换建议。</p>
                                <div class="mt-2 p-2 rounded-lg bg-mist">“K8S” → “Kubernetes”</div>
                            </div>
                            <div class="bg-white rounded-xl border border-line p-4">
                                <p class="font-medium">实体卡片预览</p>
                                <p class="text-muted mt-2">悬停实体查看定义、关系与来源。</p>
                                <div class="mt-2 p-2 rounded-lg bg-mist">实体：微服务架构 · 关系 12</div>
                            </div>
                            <div class="bg-white rounded-xl border border-line p-4">
                                <p class="font-medium">图谱直接编辑</p>
                                <p class="text-muted mt-2">拖拽添加关联关系，自动同步到图谱。</p>
                                <div class="mt-2 p-2 rounded-lg bg-mist">关系：此文档依赖项目A</div>
                            </div>
                        </div>
                    </div>
                    <div id="knowledge-review" class="section-panel">
                        <div class="grid grid-cols-1 xl:grid-cols-3 gap-4">
                            <div class="xl:col-span-2 bg-white rounded-xl border border-line p-4 space-y-4">
                                <div class="flex items-center justify-between">
                                    <p class="font-medium">版本管理</p>
                                    <button class="action-btn px-3 py-1 rounded-full bg-mist text-xs" data-action="版本里程碑已创建">创建里程碑</button>
                                </div>
                                <div class="space-y-3 text-xs">
                                    <div class="p-3 rounded-lg border border-line flex items-center justify-between">
                                        <div>
                                            <p class="font-medium">V2.0 · 评审中</p>
                                            <p class="text-muted mt-1">补充“竞品价格变动”章节</p>
                                        </div>
                                        <button class="text-secondary">对比</button>
                                    </div>
                                    <div class="p-3 rounded-lg border border-line flex items-center justify-between">
                                        <div>
                                            <p class="font-medium">V1.2 · 已发布</p>
                                            <p class="text-muted mt-1">新增案例与引用</p>
                                        </div>
                                        <button class="text-secondary">预览</button>
                                    </div>
                                    <div class="p-3 rounded-lg border border-line flex items-center justify-between">
                                        <div>
                                            <p class="font-medium">V1.0 · 初版</p>
                                            <p class="text-muted mt-1">结构化大纲生成</p>
                                        </div>
                                        <button class="text-secondary">回滚</button>
                                    </div>
                                </div>
                                <div class="p-3 rounded-lg border border-line text-xs text-muted">
                                    差异摘要：新增“竞品对比”章节，更新12处数据，修复术语不一致问题。
                                </div>
                            </div>
                            <div class="bg-white rounded-xl border border-line p-4 text-xs space-y-3">
                                <p class="font-medium text-sm">评审工作流</p>
                                <div class="p-3 rounded-lg bg-mist">提交评审 → 指定专家 → 评论处理 → 通过发布</div>
                                <div class="space-y-2">
                                    <div class="p-3 rounded-lg border border-line">
                                        <p class="font-medium">待处理评论</p>
                                        <p class="text-muted mt-1">缓存策略需补充详细说明</p>
                                    </div>
                                    <div class="p-3 rounded-lg border border-line">
                                        <p class="font-medium">已解决评论</p>
                                        <p class="text-muted mt-1">术语统一为“购买方”</p>
                                    </div>
                                </div>
                                <div class="p-3 rounded-lg border border-line">
                                    <p class="font-medium">讨论沉淀</p>
                                    <p class="text-muted mt-1">将评审结论一键提取为FAQ或正文段落</p>
                                </div>
                                <div class="p-3 rounded-lg border border-line">
                                    <p class="font-medium">评审人建议</p>
                                    <p class="text-muted mt-1">@李强 · @王晓华</p>
                                </div>
                                <button class="action-btn w-full px-3 py-2 rounded-full bg-primary text-white text-xs" data-action="已进入评审模式">进入评审模式</button>
                            </div>
                        </div>
                    </div>
                    <div id="knowledge-quality" class="section-panel">
                        <div class="grid grid-cols-1 xl:grid-cols-3 gap-4">
                            <div class="xl:col-span-2 bg-white rounded-xl border border-line p-4 space-y-4 text-xs">
                                <div class="flex items-center justify-between">
                                    <p class="font-medium text-sm">质量自动检测</p>
                                    <button class="action-btn px-3 py-1 rounded-full bg-secondary text-white" data-action="质量检测已完成">运行检测</button>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                    <div class="p-3 rounded-lg border border-line">
                                        <p class="font-medium">完整性检查</p>
                                        <p class="text-muted mt-1">缺少“风险评估”章节</p>
                                    </div>
                                    <div class="p-3 rounded-lg border border-line">
                                        <p class="font-medium">一致性检查</p>
                                        <p class="text-muted mt-1">术语“K8S”建议替换为“Kubernetes”</p>
                                    </div>
                                    <div class="p-3 rounded-lg border border-line">
                                        <p class="font-medium">时效性检查</p>
                                        <p class="text-muted mt-1">外部链接1条失效</p>
                                    </div>
                                    <div class="p-3 rounded-lg border border-line">
                                        <p class="font-medium">可读性评估</p>
                                        <p class="text-muted mt-1">复杂段落 2 处</p>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                    <div class="p-3 rounded-lg border border-line">
                                        <p class="font-medium">重复与相似</p>
                                        <p class="text-muted mt-1">相似文档 2 篇</p>
                                    </div>
                                    <div class="p-3 rounded-lg border border-line">
                                        <p class="font-medium">冲突提示</p>
                                        <p class="text-muted mt-1">竞品B价格描述冲突</p>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-white rounded-xl border border-line p-4 space-y-3 text-xs">
                                <p class="font-medium text-sm">相似与冲突提示</p>
                                <div class="p-3 rounded-lg bg-mist">发现相似文档：《华北区市场趋势分析》</div>
                                <div class="p-3 rounded-lg bg-mist">冲突提示：竞品B价格策略描述不一致</div>
                                <p class="font-medium text-sm mt-2">质量评分</p>
                                <div class="p-3 rounded-lg border border-line">
                                    <p class="text-muted">内容质量 86 · 受欢迎度 78 · 权威性 90</p>
                                </div>
                                <div class="p-3 rounded-lg border border-line">
                                    <p class="font-medium">评分影响</p>
                                    <p class="text-muted mt-1">影响搜索排序与推荐曝光</p>
                                </div>
                                <button class="w-full px-3 py-2 rounded-full bg-primary text-white text-xs">查看质量报告</button>
                            </div>
                        </div>
                    </div>
                    <div id="knowledge-lifecycle" class="section-panel">
                        <div class="grid grid-cols-1 xl:grid-cols-3 gap-4">
                            <div class="xl:col-span-2 bg-white rounded-xl border border-line p-4 space-y-4 text-xs">
                                <p class="font-medium text-sm">状态流转</p>
                                <div class="grid grid-cols-2 md:grid-cols-5 gap-2">
                                    <div class="p-2 rounded-lg bg-mist text-center">草稿</div>
                                    <div class="p-2 rounded-lg bg-mist text-center">评审中</div>
                                    <div class="p-2 rounded-lg bg-primary text-white text-center">已发布</div>
                                    <div class="p-2 rounded-lg bg-mist text-center">已归档</div>
                                    <div class="p-2 rounded-lg bg-mist text-center">已废止</div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                    <div class="p-3 rounded-lg border border-line">
                                        <p class="font-medium">生效范围</p>
                                        <p class="text-muted mt-1">技术部门 · 项目A · 2025 Q1</p>
                                    </div>
                                    <div class="p-3 rounded-lg border border-line">
                                        <p class="font-medium">权限控制</p>
                                        <p class="text-muted mt-1">查看/评论/编辑/管理可继承目录权限</p>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                    <div class="p-3 rounded-lg border border-line">
                                        <p class="font-medium">有效期设置</p>
                                        <p class="text-muted mt-1">到期自动提醒复审</p>
                                    </div>
                                    <div class="p-3 rounded-lg border border-line">
                                        <p class="font-medium">归档与废止</p>
                                        <p class="text-muted mt-1">状态记录可追溯</p>
                                    </div>
                                </div>
                                <div class="p-3 rounded-lg border border-line">
                                    <p class="font-medium">权限矩阵</p>
                                    <p class="text-muted mt-1">查看/评论/编辑/管理按角色配置</p>
                                </div>
                            </div>
                            <div class="bg-white rounded-xl border border-line p-4 text-xs space-y-3">
                                <p class="font-medium text-sm">发布与归档策略</p>
                                <div class="p-3 rounded-lg bg-mist">到期提醒：2025/03/31</div>
                                <div class="p-3 rounded-lg bg-mist">归档条件：连续180天无更新</div>
                                <button class="action-btn w-full px-3 py-2 rounded-full bg-secondary text-white text-xs" data-action="生效策略设置已保存">设置生效策略</button>
                            </div>
                        </div>
                    </div>
                    <div id="knowledge-integration" class="section-panel">
                        <div class="bg-white rounded-xl border border-line p-4">
                            <div class="flex items-center justify-between">
                                <p class="font-medium">与“灵枢”集成接口</p>
                                <button class="action-btn px-3 py-1 rounded-full bg-mist text-xs" data-action="API状态已刷新">查看API状态</button>
                            </div>
                            <div class="mt-3 grid grid-cols-1 md:grid-cols-3 gap-3 text-xs">
                                <div class="p-3 rounded-lg border border-line">
                                    <p class="font-medium">服务健康</p>
                                    <p class="text-muted mt-1">正常 · P95 280ms</p>
                                </div>
                                <div class="p-3 rounded-lg border border-line">
                                    <p class="font-medium">降级策略</p>
                                    <p class="text-muted mt-1">自动切换关键词检索</p>
                                </div>
                                <div class="p-3 rounded-lg border border-line">
                                    <p class="font-medium">权限审计</p>
                                    <p class="text-muted mt-1">调用记录可追溯</p>
                                </div>
                            </div>
                            <div class="mt-4 overflow-hidden rounded-xl border border-line">
                                <table class="w-full text-xs">
                                    <thead class="bg-mist text-left">
                                        <tr>
                                            <th class="py-2 px-3">集成点</th>
                                            <th class="py-2 px-3">调用能力</th>
                                            <th class="py-2 px-3">数据流向</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr class="border-t border-line">
                                            <td class="py-2 px-3">知识图谱视图</td>
                                            <td class="py-2 px-3">动态知识图谱查询与可视化</td>
                                            <td class="py-2 px-3">智能知识库 → 灵枢</td>
                                        </tr>
                                        <tr class="border-t border-line">
                                            <td class="py-2 px-3">实体识别与术语检查</td>
                                            <td class="py-2 px-3">本体论工厂模型</td>
                                            <td class="py-2 px-3">智能知识库 → 灵枢</td>
                                        </tr>
                                        <tr class="border-t border-line">
                                            <td class="py-2 px-3">AI写作助手</td>
                                            <td class="py-2 px-3">智能体工厂生成技能</td>
                                            <td class="py-2 px-3">智能知识库 → 灵枢</td>
                                        </tr>
                                        <tr class="border-t border-line">
                                            <td class="py-2 px-3">知识关联推荐</td>
                                            <td class="py-2 px-3">语义检索</td>
                                            <td class="py-2 px-3">智能知识库 → 灵枢</td>
                                        </tr>
                                        <tr class="border-t border-line">
                                            <td class="py-2 px-3">文档内容入库</td>
                                            <td class="py-2 px-3">知识熔炉流水线</td>
                                            <td class="py-2 px-3">智能知识库 → 灵枢</td>
                                        </tr>
                                        <tr class="border-t border-line">
                                            <td class="py-2 px-3">质量评分计算</td>
                                            <td class="py-2 px-3">度量服务</td>
                                            <td class="py-2 px-3">智能知识库 ↔ 灵枢</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div id="knowledge-nonfunctional" class="section-panel">
                        <div class="grid grid-cols-1 xl:grid-cols-3 gap-4 text-xs">
                            <div class="bg-white rounded-xl border border-line p-4 space-y-2">
                                <p class="font-medium text-sm">性能指标</p>
                                <div class="p-2 rounded-lg bg-mist">文档打开 < 1s（10万字内）</div>
                                <div class="p-2 rounded-lg bg-mist">编辑响应 < 100ms</div>
                                <div class="p-2 rounded-lg bg-mist">图谱交互 ≥ 30fps</div>
                                <div class="p-2 rounded-lg bg-mist">AI响应 < 3s</div>
                            </div>
                            <div class="bg-white rounded-xl border border-line p-4 space-y-2">
                                <p class="font-medium text-sm">可靠性</p>
                                <div class="p-2 rounded-lg bg-mist">自动保存 · 每30秒/关键操作</div>
                                <div class="p-2 rounded-lg bg-mist">断网暂存 · 恢复自动同步</div>
                                <div class="p-2 rounded-lg bg-mist">版本数据异地备份</div>
                            </div>
                            <div class="bg-white rounded-xl border border-line p-4 space-y-2">
                                <p class="font-medium text-sm">体验与兼容</p>
                                <div class="p-2 rounded-lg bg-mist">骨架屏 + 即时反馈</div>
                                <div class="p-2 rounded-lg bg-mist">导入Word/Markdown/PDF</div>
                                <div class="p-2 rounded-lg bg-mist">导出Word/PDF/Markdown/HTML</div>
                                <div class="p-2 rounded-lg bg-mist">适配主流浏览器与屏幕</div>
                            </div>
                        </div>
                        <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-4 text-xs">
                            <div class="bg-white rounded-xl border border-line p-4">
                                <p class="font-medium">可用性监控</p>
                                <p class="text-muted mt-1">异常自动提示与降级</p>
                            </div>
                            <div class="bg-white rounded-xl border border-line p-4">
                                <p class="font-medium">数据安全</p>
                                <p class="text-muted mt-1">权限校验 · 审计日志</p>
                            </div>
                            <div class="bg-white rounded-xl border border-line p-4">
                                <p class="font-medium">体验反馈</p>
                                <p class="text-muted mt-1">质量评分影响推荐</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="page-capture" class="page flex flex-col gap-6 h-[calc(100vh-120px)] overflow-auto">
                <div>
                    <h2 class="text-2xl font-display font-semibold">轻量生产工具</h2>
                    <p class="text-sm text-muted">无摩擦知识捕获系统，让知识生产随时随地、随手可得</p>
                </div>
                <div class="bg-surface rounded-2xl border border-line shadow-card p-4">
                    <div class="flex flex-wrap gap-2 mb-4">
                        <button class="tab-btn px-3 py-2 rounded-full text-sm bg-primary text-white transition-all duration-300" data-tab="quick-note">
                            <i class="fa fa-edit mr-2"></i>速记
                        </button>
                        <button class="tab-btn px-3 py-2 rounded-full text-sm bg-white border border-line hover:bg-primary/10 transition-all duration-300" data-tab="record">
                            <i class="fa fa-microphone mr-2"></i>录音
                        </button>
                        <button class="tab-btn px-3 py-2 rounded-full text-sm bg-white border border-line hover:bg-primary/10 transition-all duration-300" data-tab="clip">
                            <i class="fa fa-scissors mr-2"></i>剪藏
                        </button>
                        <button class="tab-btn px-3 py-2 rounded-full text-sm bg-white border border-line hover:bg-primary/10 transition-all duration-300" data-tab="queue">
                            <i class="fa fa-tasks mr-2"></i>待处理队列
                        </button>
                        <button class="tab-btn px-3 py-2 rounded-full text-sm bg-white border border-line hover:bg-primary/10 transition-all duration-300" data-tab="desktop">
                            <i class="fa fa-desktop mr-2"></i>桌面工具
                        </button>
                    </div>
                    <div id="tab-quick-note" class="tab-panel active">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                            <div class="bg-white rounded-xl border border-line shadow-card p-4 transition-all duration-300 hover:shadow-soft">
                                <div class="flex items-center justify-between mb-3">
                                    <div class="flex items-center gap-2">
                                        <div class="w-8 h-8 bg-primary/10 rounded-lg flex items-center justify-center">
                                            <i class="fa fa-pencil text-primary"></i>
                                        </div>
                                        <div>
                                            <p class="font-medium text-lg">极速速记</p>
                                            <p class="text-xs text-muted">无摩擦知识捕获</p>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <span class="text-xs px-2 py-0.5 rounded-full bg-primary/10 text-primary">AI增强</span>
                                        <button id="quick-note-settings" class="p-1.5 rounded-full hover:bg-mist transition-colors">
                                            <i class="fa fa-cog text-muted"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="space-y-3">
                                    <input type="text" id="quick-note-title" class="w-full border border-line rounded-lg p-3 text-sm placeholder:text-muted focus:outline-none focus:ring-2 focus:ring-primary/30 transition-all shadow-sm" placeholder="添加标题（可选，AI自动生成）">
                                    <textarea id="quick-note-input" class="w-full border border-line rounded-lg p-3 text-sm resize-none focus:outline-none focus:ring-2 focus:ring-primary/30 transition-all min-h-[180px] shadow-sm" placeholder="记录灵感、会议要点或待办…"></textarea>
                                    <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                                        <button id="voice-input-btn" class="flex items-center justify-center gap-1.5 px-3 py-2 rounded-lg bg-primary/10 hover:bg-primary/20 text-primary text-sm transition-all hover:shadow-sm">
                                            <i class="fa fa-microphone"></i>
                                            <span>语音输入</span>
                                        </button>
                                        <button id="photo-ocr-btn" class="flex items-center justify-center gap-1.5 px-3 py-2 rounded-lg bg-primary/10 hover:bg-primary/20 text-primary text-sm transition-all hover:shadow-sm">
                                            <i class="fa fa-camera"></i>
                                            <span>拍照OCR</span>
                                        </button>
                                        <button id="scan-doc-btn" class="flex items-center justify-center gap-1.5 px-3 py-2 rounded-lg bg-primary/10 hover:bg-primary/20 text-primary text-sm transition-all hover:shadow-sm">
                                            <i class="fa fa-file-text-o"></i>
                                            <span>扫描文档</span>
                                        </button>
                                        <button id="set-reminder-btn" class="flex items-center justify-center gap-1.5 px-3 py-2 rounded-lg bg-primary/10 hover:bg-primary/20 text-primary text-sm transition-all hover:shadow-sm">
                                            <i class="fa fa-bell-o"></i>
                                            <span>设置提醒</span>
                                        </button>
                                    </div>
                                    <div class="flex flex-wrap items-center justify-between gap-3 pt-2 border-t border-line">
                                        <div class="flex flex-wrap items-center gap-3 text-xs">
                                            <label class="flex items-center gap-1.5">
                                                <input type="checkbox" id="auto-title" class="rounded border-line text-primary focus:ring-primary">
                                                <span>AI自动生成标题</span>
                                            </label>
                                            <label class="flex items-center gap-1.5">
                                                <input type="checkbox" id="auto-tag" class="rounded border-line text-primary focus:ring-primary">
                                                <span>智能标签</span>
                                            </label>
                                            <label class="flex items-center gap-1.5">
                                                <input type="checkbox" id="auto-save" class="rounded border-line text-primary focus:ring-primary">
                                                <span>自动保存</span>
                                            </label>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <button id="share-quick-note" class="px-3 py-2 rounded-full bg-white border border-line text-sm hover:bg-primary/10 transition-all">
                                                <i class="fa fa-share mr-1.5"></i>
                                                <span>分享</span>
                                            </button>
                                            <button id="save-quick-note" class="px-4 py-2 rounded-full bg-primary text-white text-sm hover:bg-primary/90 transition-all shadow-sm hover:shadow">
                                                <i class="fa fa-save mr-1.5"></i>
                                                <span>保存至待处理</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="space-y-4">
                                <div class="bg-white rounded-xl border border-line shadow-card p-4 transition-all duration-300 hover:shadow-soft">
                                    <div class="flex items-center justify-between mb-3">
                                        <div class="flex items-center gap-2">
                                            <div class="w-6 h-6 bg-primary/10 rounded flex items-center justify-center">
                                                <i class="fa fa-clock-o text-primary"></i>
                                            </div>
                                            <p class="font-medium text-sm">最新速记</p>
                                        </div>
                                        <button id="refresh-quick-notes" class="px-3 py-1.5 rounded-full bg-primary/10 text-primary text-sm flex items-center gap-1.5 hover:bg-primary/20 transition-all">
                                            <i class="fa fa-refresh"></i>
                                            <span>刷新</span>
                                        </button>
                                    </div>
                                    <ul id="quick-note-list" class="space-y-3 max-h-[300px] overflow-y-auto scrollbar-hide">
                                        <li class="p-3 rounded-lg bg-ocean/30 border border-primary/10 transition-all hover:shadow-sm cursor-pointer">
                                            <div class="flex items-center justify-between mb-1">
                                                <span class="font-medium">跟进客户A合同审批</span>
                                                <span class="text-xs text-muted">2分钟前</span>
                                            </div>
                                            <p class="text-sm text-muted line-clamp-2">明早提醒我处理客户A的合同审批，需要在本周内完成</p>
                                            <div class="mt-2 flex items-center gap-2">
                                                <span class="px-2 py-0.5 rounded-full bg-primary/10 text-primary text-xs">待办</span>
                                                <button class="text-xs text-secondary hover:text-primary">编辑</button>
                                            </div>
                                        </li>
                                        <li class="p-3 rounded-lg bg-coral/30 border border-secondary/10 transition-all hover:shadow-sm cursor-pointer">
                                            <div class="flex items-center justify-between mb-1">
                                                <span class="font-medium">Q3渠道预算调整</span>
                                                <span class="text-xs text-muted">1小时前</span>
                                            </div>
                                            <p class="text-sm text-muted line-clamp-2">会议要点：Q3渠道预算需要上调15%，重点支持线上推广</p>
                                            <div class="mt-2 flex items-center gap-2">
                                                <span class="px-2 py-0.5 rounded-full bg-secondary/10 text-secondary text-xs">会议</span>
                                                <button class="text-xs text-secondary hover:text-primary">编辑</button>
                                            </div>
                                        </li>
                                        <li class="p-3 rounded-lg bg-purple-light/50 border border-accent/10 transition-all hover:shadow-sm cursor-pointer">
                                            <div class="flex items-center justify-between mb-1">
                                                <span class="font-medium">新产品创意</span>
                                                <span class="text-xs text-muted">2小时前</span>
                                            </div>
                                            <p class="text-sm text-muted line-clamp-2">考虑开发移动应用版本的轻量捕获工具，支持离线使用</p>
                                            <div class="mt-2 flex items-center gap-2">
                                                <span class="px-2 py-0.5 rounded-full bg-accent/10 text-accent text-xs">灵感</span>
                                                <button class="text-xs text-secondary hover:text-primary">编辑</button>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                                <div class="bg-white rounded-xl border border-line shadow-card p-4 transition-all duration-300 hover:shadow-soft">
                                    <div class="flex items-center justify-between mb-3">
                                        <div class="flex items-center gap-2">
                                            <div class="w-6 h-6 bg-primary/10 rounded flex items-center justify-center">
                                                <i class="fa fa-lightbulb-o text-primary"></i>
                                            </div>
                                            <p class="font-medium text-sm">智能建议</p>
                                        </div>
                                    </div>
                                    <div class="space-y-2">
                                        <div class="p-3 rounded-lg bg-primary/5 border border-primary/10 cursor-pointer hover:bg-primary/10 transition-colors">
                                            <div class="flex items-center gap-2">
                                                <i class="fa fa-file-text-o text-primary mt-0.5"></i>
                                                <div>
                                                    <p class="text-sm font-medium">关联至知识图谱</p>
                                                    <p class="text-xs text-muted">将此速记与企业知识网络连接</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="p-3 rounded-lg bg-secondary/5 border border-secondary/10 cursor-pointer hover:bg-secondary/10 transition-colors">
                                            <div class="flex items-center gap-2">
                                                <i class="fa fa-users text-secondary mt-0.5"></i>
                                                <div>
                                                    <p class="text-sm font-medium">分享给团队</p>
                                                    <p class="text-xs text-muted">自动推送给相关团队成员</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="tab-record" class="tab-panel">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                            <div class="bg-white rounded-xl border border-line shadow-card p-4 transition-all duration-300 hover:shadow-soft">
                                <div class="flex items-center justify-between mb-3">
                                    <div class="flex items-center gap-2">
                                        <div class="w-8 h-8 bg-danger/10 rounded-lg flex items-center justify-center">
                                            <i class="fa fa-microphone text-danger"></i>
                                        </div>
                                        <div>
                                            <p class="font-medium text-lg">会议录音与转写</p>
                                            <p class="text-xs text-muted">实时转写与智能处理</p>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <span class="text-xs px-2 py-0.5 rounded-full bg-primary/10 text-primary">AI增强</span>
                                        <button id="record-settings" class="p-1.5 rounded-full hover:bg-mist transition-colors">
                                            <i class="fa fa-cog text-muted"></i>
                                        </button>
                                    </div>
                                </div>
                                <p class="text-sm text-muted mb-4">支持最长2小时录音，实时转写与说话人分离</p>
                                
                                <div class="mb-4">
                                    <div class="flex flex-col items-center justify-center gap-4 mb-3">
                                        <div class="flex items-center justify-center gap-6">
                                            <div class="w-16 h-16 rounded-full bg-danger text-white flex items-center justify-center text-2xl shadow-lg hover:bg-danger/90 transition-all duration-300">
                                                <button id="record-toggle" class="w-full h-full rounded-full flex items-center justify-center">
                                                    <i class="fa fa-microphone"></i>
                                                </button>
                                            </div>
                                            <div class="text-center">
                                                <span id="record-timer" class="text-2xl font-medium">00:00</span>
                                                <p class="text-xs text-muted">录音时长</p>
                                            </div>
                                        </div>
                                        <div class="flex items-center justify-center gap-3 w-full">
                                            <button id="record-pause" class="flex-1 px-4 py-2 rounded-full bg-primary/10 text-primary text-sm flex items-center justify-center gap-1.5 opacity-50 cursor-not-allowed">
                                                <i class="fa fa-pause"></i>
                                                <span>暂停</span>
                                            </button>
                                            <button id="record-mark" class="flex-1 px-4 py-2 rounded-full bg-accent/10 text-accent text-sm flex items-center justify-center gap-1.5 opacity-50 cursor-not-allowed">
                                                <i class="fa fa-flag"></i>
                                                <span>标记关键</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="bg-surface rounded-lg border border-line p-4">
                                    <div class="flex items-center justify-between mb-2">
                                        <div class="flex items-center gap-2">
                                            <span class="px-2 py-0.5 rounded-full bg-primary/10 text-primary text-xs">实时转写</span>
                                            <span class="text-sm font-medium">会议内容</span>
                                        </div>
                                        <div class="flex items-center gap-2 text-xs">
                                            <span class="text-muted">说话人分离</span>
                                            <i class="fa fa-check-circle text-success"></i>
                                        </div>
                                    </div>
                                    <div id="transcript-display" class="text-sm min-h-[200px] space-y-3 overflow-y-auto scrollbar-hide">
                                        <div class="flex items-start gap-2 p-2 rounded bg-white border border-line">
                                            <span class="w-6 h-6 rounded-full bg-primary text-white text-xs flex items-center justify-center mt-0.5">张</span>
                                            <div class="flex-1">
                                                <span class="font-medium">张三：</span>
                                                <span>大家好，今天我们来讨论Q3的产品规划，主要关注用户增长和留存策略。</span>
                                                <div class="text-xs text-muted mt-1">00:01:23</div>
                                            </div>
                                        </div>
                                        <div class="flex items-start gap-2 p-2 rounded bg-white border border-line">
                                            <span class="w-6 h-6 rounded-full bg-secondary text-white text-xs flex items-center justify-center mt-0.5">李</span>
                                            <div class="flex-1">
                                                <span class="font-medium">李四：</span>
                                                <span>我认为我们需要重点优化注册流程，减少用户流失。</span>
                                                <div class="text-xs text-muted mt-1">00:01:45</div>
                                            </div>
                                        </div>
                                        <div class="flex items-start gap-2 p-2 rounded bg-white border border-line">
                                            <span class="w-6 h-6 rounded-full bg-accent text-white text-xs flex items-center justify-center mt-0.5">王</span>
                                            <div class="flex-1">
                                                <span class="font-medium">王五：</span>
                                                <span>同意，我们还应该增加用户引导和教育内容。</span>
                                                <div class="text-xs text-muted mt-1">00:02:10</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mt-4 flex items-center justify-between text-xs">
                                    <div class="flex items-center gap-2 text-muted">
                                        <span>录音质量：<i class="fa fa-signal text-success"></i> 良好</span>
                                        <span>说话人：已识别3人</span>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <button class="px-3 py-1 rounded-full bg-primary/10 text-primary text-xs">
                                            <i class="fa fa-download mr-1"></i>下载
                                        </button>
                                        <button class="px-3 py-1 rounded-full bg-primary/10 text-primary text-xs">
                                            <i class="fa fa-share mr-1"></i>分享
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="space-y-4">
                                <div class="bg-white rounded-xl border border-line shadow-card p-4 transition-all duration-300 hover:shadow-soft">
                                    <div class="flex items-center justify-between mb-3">
                                        <div class="flex items-center gap-2">
                                            <div class="w-6 h-6 bg-secondary/10 rounded flex items-center justify-center">
                                                <i class="fa fa-microphone text-secondary"></i>
                                            </div>
                                            <p class="font-medium text-sm">快速语音备忘</p>
                                        </div>
                                    </div>
                                    <div class="space-y-2 max-h-[200px] overflow-y-auto scrollbar-hide">
                                        <div class="p-3 rounded-lg bg-coral/30 border border-secondary/10 hover:shadow-sm cursor-pointer">
                                            <div class="flex items-center justify-between mb-1">
                                                <span class="font-medium">下周一跟进供应商报价</span>
                                                <span class="text-xs text-muted">30秒</span>
                                            </div>
                                            <p class="text-xs text-muted">今天 14:30 · 已转写</p>
                                            <div class="mt-1 flex items-center gap-2 text-xs">
                                                <span class="px-1.5 py-0.5 rounded-full bg-secondary/10 text-secondary">待办</span>
                                                <span class="text-muted">已设置提醒</span>
                                            </div>
                                        </div>
                                        <div class="p-3 rounded-lg bg-coral/30 border border-secondary/10 hover:shadow-sm cursor-pointer">
                                            <div class="flex items-center justify-between mb-1">
                                                <span class="font-medium">提醒市场部整理竞品新闻</span>
                                                <span class="text-xs text-muted">25秒</span>
                                            </div>
                                            <p class="text-xs text-muted">今天 13:15 · 已转写</p>
                                            <div class="mt-1 flex items-center gap-2 text-xs">
                                                <span class="px-1.5 py-0.5 rounded-full bg-secondary/10 text-secondary">任务</span>
                                            </div>
                                        </div>
                                    </div>
                                    <button id="quick-voice-note" class="mt-3 w-full px-4 py-2 rounded-full bg-secondary text-white text-sm flex items-center justify-center gap-1.5">
                                        <i class="fa fa-plus"></i>
                                        <span>新建语音备忘</span>
                                    </button>
                                </div>
                                
                                <div class="bg-white rounded-xl border border-line shadow-card p-4 transition-all duration-300 hover:shadow-soft">
                                    <div class="flex items-center justify-between mb-3">
                                        <div class="flex items-center gap-2">
                                            <div class="w-6 h-6 bg-primary/10 rounded flex items-center justify-center">
                                                <i class="fa fa-history text-primary"></i>
                                            </div>
                                            <p class="font-medium text-sm">录音历史</p>
                                        </div>
                                        <button class="text-xs text-secondary hover:text-primary">查看全部</button>
                                    </div>
                                    <div class="space-y-2 max-h-[150px] overflow-y-auto scrollbar-hide">
                                        <div class="p-3 rounded-lg bg-ocean/30 border border-primary/10 hover:shadow-sm cursor-pointer">
                                            <div class="flex items-center justify-between mb-1">
                                                <span class="text-sm font-medium">产品规划会议</span>
                                                <span class="text-xs text-muted">45分钟</span>
                                            </div>
                                            <p class="text-xs text-muted">今天 10:30 · 已转写</p>
                                            <div class="mt-1 flex items-center gap-2 text-xs">
                                                <span class="px-1.5 py-0.5 rounded-full bg-primary/10 text-primary">已完成</span>
                                            </div>
                                        </div>
                                        <div class="p-3 rounded-lg bg-ocean/30 border border-primary/10 hover:shadow-sm cursor-pointer">
                                            <div class="flex items-center justify-between mb-1">
                                                <span class="text-sm font-medium">客户访谈 - 张总</span>
                                                <span class="text-xs text-muted">32分钟</span>
                                            </div>
                                            <p class="text-xs text-muted">昨天 16:20 · 处理中</p>
                                            <div class="mt-1 flex items-center gap-2 text-xs">
                                                <span class="px-1.5 py-0.5 rounded-full bg-secondary/10 text-secondary">进行中</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="tab-clip" class="tab-panel">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                            <div class="bg-white rounded-xl border border-line shadow-card p-4 transition-all duration-300 hover:shadow-soft">
                                <div class="flex items-center justify-between mb-3">
                                    <div class="flex items-center gap-2">
                                        <div class="w-8 h-8 bg-secondary/10 rounded-lg flex items-center justify-center">
                                            <i class="fa fa-link text-secondary"></i>
                                        </div>
                                        <div>
                                            <p class="font-medium text-lg">网页剪藏</p>
                                            <p class="text-xs text-muted">智能内容解析与保存</p>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <span class="text-xs px-2 py-0.5 rounded-full bg-primary/10 text-primary">AI增强</span>
                                    </div>
                                </div>
                                
                                <div class="space-y-3">
                                    <div class="relative">
                                        <input id="clip-url" type="text" placeholder="粘贴链接或选择区域" class="w-full border border-line rounded-lg p-3 text-sm pl-10 focus:outline-none focus:ring-2 focus:ring-primary/30 transition-all shadow-sm">
                                        <i class="fa fa-link absolute left-3 top-3 text-muted"></i>
                                        <button id="paste-url" class="absolute right-3 top-2.5 text-xs text-primary hover:text-primary/80 transition-colors">
                                            粘贴
                                        </button>
                                    </div>
                                    
                                    <div class="grid grid-cols-3 gap-2">
                                        <button id="clip-full-page" class="p-3 rounded-lg bg-primary/10 text-primary text-sm flex flex-col items-center gap-1.5 hover:bg-primary/20 transition-all hover:shadow-sm">
                                            <i class="fa fa-file-text-o text-lg"></i>
                                            <span>保存整页</span>
                                        </button>
                                        <button id="clip-selection" class="p-3 rounded-lg bg-primary/10 text-primary text-sm flex flex-col items-center gap-1.5 hover:bg-primary/20 transition-all hover:shadow-sm">
                                            <i class="fa fa-mouse-pointer text-lg"></i>
                                            <span>选择区域</span>
                                        </button>
                                        <button id="clip-screenshot" class="p-3 rounded-lg bg-primary/10 text-primary text-sm flex flex-col items-center gap-1.5 hover:bg-primary/20 transition-all hover:shadow-sm">
                                            <i class="fa fa-camera text-lg"></i>
                                            <span>截图标注</span>
                                        </button>
                                    </div>
                                    
                                    <div class="p-3 rounded-lg bg-surface border border-line">
                                        <div class="flex items-center justify-between mb-2">
                                            <span class="text-sm font-medium">智能剪藏方式</span>
                                            <span class="text-xs text-muted">AI推荐最佳方式</span>
                                        </div>
                                        <div class="flex flex-col gap-2">
                                            <label class="flex items-center gap-2 text-sm cursor-pointer hover:bg-primary/5 p-2 rounded-lg transition-colors">
                                                <input type="radio" name="clip-mode" value="read" checked class="rounded-full text-primary focus:ring-primary">
                                                <div class="flex-1">
                                                    <span class="font-medium">阅读模式</span>
                                                    <p class="text-xs text-muted">去广告，专注阅读内容</p>
                                                </div>
                                            </label>
                                            <label class="flex items-center gap-2 text-sm cursor-pointer hover:bg-primary/5 p-2 rounded-lg transition-colors">
                                                <input type="radio" name="clip-mode" value="full" class="rounded-full text-primary focus:ring-primary">
                                                <div class="flex-1">
                                                    <span class="font-medium">完整页面</span>
                                                    <p class="text-xs text-muted">保留完整格式和图片</p>
                                                </div>
                                            </label>
                                            <label class="flex items-center gap-2 text-sm cursor-pointer hover:bg-primary/5 p-2 rounded-lg transition-colors">
                                                <input type="radio" name="clip-mode" value="pdf" class="rounded-full text-primary focus:ring-primary">
                                                <div class="flex-1">
                                                    <span class="font-medium">PDF快照</span>
                                                    <p class="text-xs text-muted">渲染为PDF，保留原始外观</p>
                                                </div>
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <div class="p-3 rounded-lg bg-primary/5 border border-primary/10">
                                        <div class="flex items-center gap-2">
                                            <i class="fa fa-lightbulb-o text-primary mt-0.5"></i>
                                            <div>
                                                <p class="text-sm font-medium">AI智能建议</p>
                                                <p class="text-xs text-muted">已检测到页面类型：技术博客，推荐使用阅读模式</p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="flex items-center justify-between pt-2 border-t border-line">
                                        <div class="flex items-center gap-2 text-xs">
                                            <label class="flex items-center gap-1.5">
                                                <input type="checkbox" id="clip-auto-tag" class="rounded border-line text-primary focus:ring-primary">
                                                <span>自动分类与标签</span>
                                            </label>
                                            <label class="flex items-center gap-1.5">
                                                <input type="checkbox" id="clip-extract-info" class="rounded border-line text-primary focus:ring-primary">
                                                <span>智能提取关键信息</span>
                                            </label>
                                        </div>
                                        <button id="save-clip" class="px-4 py-2 rounded-full bg-primary text-white text-sm hover:bg-primary/90 transition-all shadow-sm hover:shadow">
                                            <i class="fa fa-save mr-1.5"></i>
                                            <span>保存到队列</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="space-y-4">
                                <div class="bg-white rounded-xl border border-line shadow-card p-4 transition-all duration-300 hover:shadow-soft">
                                    <div class="flex items-center justify-between mb-3">
                                        <div class="flex items-center gap-2">
                                            <div class="w-6 h-6 bg-primary/10 rounded flex items-center justify-center">
                                                <i class="fa fa-book text-primary"></i>
                                            </div>
                                            <p class="font-medium text-sm">稍后阅读</p>
                                        </div>
                                        <button id="add-to-read-later" class="px-3 py-1.5 rounded-full bg-primary/10 text-primary text-sm flex items-center gap-1.5 hover:bg-primary/20 transition-all">
                                            <i class="fa fa-plus"></i>
                                            <span>添加</span>
                                        </button>
                                    </div>
                                    <ul id="clip-list" class="space-y-3 max-h-[200px] overflow-y-auto scrollbar-hide">
                                        <li class="p-3 rounded-lg bg-ocean/30 border border-primary/10 hover:shadow-sm cursor-pointer transition-all">
                                            <div class="flex items-center justify-between mb-1">
                                                <span class="font-medium text-sm">竞品B发布会解读</span>
                                                <span class="text-xs text-muted">10分钟前</span>
                                            </div>
                                            <p class="text-xs text-muted line-clamp-1">来源：technews.com</p>
                                            <div class="mt-1 flex items-center gap-2 text-xs">
                                                <span class="px-2 py-0.5 rounded-full bg-primary/10 text-primary">阅读模式</span>
                                                <button class="text-xs text-secondary hover:text-primary">编辑</button>
                                            </div>
                                        </li>
                                        <li class="p-3 rounded-lg bg-ocean/30 border border-primary/10 hover:shadow-sm cursor-pointer transition-all">
                                            <div class="flex items-center justify-between mb-1">
                                                <span class="font-medium text-sm">2024年市场趋势简报</span>
                                                <span class="text-xs text-muted">25分钟前</span>
                                            </div>
                                            <p class="text-xs text-muted line-clamp-1">来源：marketreport.com</p>
                                            <div class="mt-1 flex items-center gap-2 text-xs">
                                                <span class="px-2 py-0.5 rounded-full bg-primary/10 text-primary">PDF快照</span>
                                                <button class="text-xs text-secondary hover:text-primary">编辑</button>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                                
                                <div class="bg-white rounded-xl border border-line shadow-card p-4 transition-all duration-300 hover:shadow-soft">
                                    <div class="flex items-center justify-between mb-3">
                                        <div class="flex items-center gap-2">
                                            <div class="w-6 h-6 bg-secondary/10 rounded flex items-center justify-center">
                                                <i class="fa fa-pencil text-secondary"></i>
                                            </div>
                                            <p class="font-medium text-sm">划词速记</p>
                                        </div>
                                    </div>
                                    <div class="space-y-2 max-h-[150px] overflow-y-auto scrollbar-hide">
                                        <div class="p-3 rounded-lg bg-coral/30 border border-secondary/10 hover:shadow-sm cursor-pointer transition-all">
                                            <div class="flex items-center justify-between mb-1">
                                                <span class="text-sm font-medium">AI驱动的知识管理</span>
                                                <span class="text-xs text-muted">5分钟前</span>
                                            </div>
                                            <p class="text-xs text-muted line-clamp-1">来源：《智能企业白皮书》</p>
                                            <div class="mt-1 flex items-center gap-2 text-xs">
                                                <span class="px-2 py-0.5 rounded-full bg-secondary/10 text-secondary">已保存</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="bg-white rounded-xl border border-line shadow-card p-4 transition-all duration-300 hover:shadow-soft">
                                    <div class="flex items-center justify-between mb-3">
                                        <div class="flex items-center gap-2">
                                            <div class="w-6 h-6 bg-primary/10 rounded flex items-center justify-center">
                                                <i class="fa fa-bar-chart text-primary"></i>
                                            </div>
                                            <p class="font-medium text-sm">剪藏统计</p>
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-2 gap-3">
                                        <div class="p-3 rounded-lg bg-primary/5 border border-primary/10">
                                            <p class="text-2xl font-medium text-primary">24</p>
                                            <p class="text-xs text-muted">本月剪藏</p>
                                        </div>
                                        <div class="p-3 rounded-lg bg-secondary/5 border border-secondary/10">
                                            <p class="text-2xl font-medium text-secondary">86</p>
                                            <p class="text-xs text-muted">待处理</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="tab-queue" class="tab-panel">
                        <div class="bg-white rounded-xl border border-line shadow-card p-4 transition-all duration-300 hover:shadow-soft">
                            <div class="flex items-center justify-between mb-3">
                                <div class="flex items-center gap-2">
                                    <div class="w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center">
                                        <i class="fa fa-tasks text-primary"></i>
                                    </div>
                                    <div>
                                        <p class="font-medium text-lg">待处理队列</p>
                                        <p class="text-xs text-muted">智能分类、批量处理</p>
                                    </div>
                                </div>
                                <div class="flex items-center gap-3">
                                    <div class="text-center">
                                        <span class="text-2xl font-medium">12</span>
                                        <p class="text-xs text-muted">总项数</p>
                                    </div>
                                    <div class="h-8 w-px bg-line"></div>
                                    <button id="queue-refresh" class="p-2 rounded-full hover:bg-primary/5 transition-colors">
                                        <i class="fa fa-refresh text-muted"></i>
                                    </button>
                                    <button id="queue-settings" class="p-2 rounded-full hover:bg-primary/5 transition-colors">
                                        <i class="fa fa-cog text-muted"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="flex flex-wrap items-center justify-between gap-3 mb-4">
                                <div class="flex items-center gap-2">
                                    <select id="queue-filter" class="border border-line rounded-lg px-3 py-1.5 text-sm focus:outline-none focus:ring-2 focus:ring-primary/30 shadow-sm">
                                        <option>全部类型</option>
                                        <option>速记</option>
                                        <option>剪藏</option>
                                        <option>录音</option>
                                    </select>
                                    <select id="queue-sort" class="border border-line rounded-lg px-3 py-1.5 text-sm focus:outline-none focus:ring-2 focus:ring-primary/30 shadow-sm">
                                        <option>按时间排序</option>
                                        <option>按类型排序</option>
                                        <option>按状态排序</option>
                                    </select>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="text-sm text-muted">批量操作：</span>
                                    <div class="space-x-1">
                                        <button class="px-3 py-1.5 rounded-lg bg-primary/10 text-primary text-sm hover:bg-primary/20 transition-colors shadow-sm">
                                            <i class="fa fa-file-text-o mr-1"></i>
                                            <span>合并</span>
                                        </button>
                                        <button class="px-3 py-1.5 rounded-lg bg-primary/10 text-primary text-sm hover:bg-primary/20 transition-colors shadow-sm">
                                            <i class="fa fa-share mr-1"></i>
                                            <span>分享</span>
                                        </button>
                                        <button class="px-3 py-1.5 rounded-lg bg-danger/10 text-danger text-sm hover:bg-danger/20 transition-colors shadow-sm">
                                            <i class="fa fa-trash mr-1"></i>
                                            <span>删除</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="space-y-3 max-h-[500px] overflow-y-auto scrollbar-hide">
                                <div class="p-4 rounded-lg border border-line bg-white shadow-sm hover:shadow-md transition-all">
                                    <div class="flex items-start justify-between">
                                        <div class="flex items-center gap-2">
                                            <input type="checkbox" class="queue-item-checkbox rounded border-line text-primary focus:ring-primary mt-0.5">
                                            <div class="w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center">
                                                <i class="fa fa-file-audio-o text-primary"></i>
                                            </div>
                                            <div>
                                                <p class="font-medium">产品规划会议录音</p>
                                                <p class="text-xs text-muted">已录制45分钟，AI转写中</p>
                                            </div>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <span class="px-2 py-0.5 rounded-full bg-secondary/10 text-secondary text-xs">处理中</span>
                                            <button class="p-2 rounded-full hover:bg-primary/5 transition-colors">
                                                <i class="fa fa-ellipsis-h text-muted"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="mt-3 grid grid-cols-2 gap-3 text-xs">
                                        <div class="flex items-center gap-2">
                                            <i class="fa fa-clock-o text-muted"></i>
                                            <span class="text-muted">45分钟前</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <i class="fa fa-user-o text-muted"></i>
                                            <span class="text-muted">张三</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <i class="fa fa-tags text-muted"></i>
                                            <span class="text-muted">会议、产品规划</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <i class="fa fa-check-circle text-success"></i>
                                            <span class="text-success">已提取2个任务</span>
                                        </div>
                                    </div>
                                    <div class="mt-3 pt-3 border-t border-line flex items-center justify-between">
                                        <button class="px-3 py-1.5 rounded-lg bg-primary/10 text-primary text-xs hover:bg-primary/20 transition-colors">
                                            <i class="fa fa-file-text-o mr-1"></i>
                                            <span>查看转写</span>
                                        </button>
                                        <button class="px-3 py-1.5 rounded-lg bg-primary/10 text-primary text-xs hover:bg-primary/20 transition-colors">
                                            <i class="fa fa-share mr-1"></i>
                                            <span>分享</span>
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="p-4 rounded-lg border border-line bg-white shadow-sm hover:shadow-md transition-all">
                                    <div class="flex items-start justify-between">
                                        <div class="flex items-center gap-2">
                                            <input type="checkbox" class="queue-item-checkbox rounded border-line text-primary focus:ring-primary mt-0.5">
                                            <div class="w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center">
                                                <i class="fa fa-link text-primary"></i>
                                            </div>
                                            <div>
                                                <p class="font-medium">竞品B发布会解读</p>
                                                <p class="text-xs text-muted">网页剪藏，来源：technews.com</p>
                                            </div>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <span class="px-2 py-0.5 rounded-full bg-success/10 text-success text-xs">已入库</span>
                                            <button class="p-2 rounded-full hover:bg-primary/5 transition-colors">
                                                <i class="fa fa-ellipsis-h text-muted"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="mt-3 grid grid-cols-2 gap-3 text-xs">
                                        <div class="flex items-center gap-2">
                                            <i class="fa fa-clock-o text-muted"></i>
                                            <span class="text-muted">1小时前</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <i class="fa fa-user-o text-muted"></i>
                                            <span class="text-muted">张三</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <i class="fa fa-tags text-muted"></i>
                                            <span class="text-muted">竞品分析、市场</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <i class="fa fa-check-circle text-success"></i>
                                            <span class="text-success">已关联知识库</span>
                                        </div>
                                    </div>
                                    <div class="mt-3 pt-3 border-t border-line flex items-center justify-between">
                                        <button class="px-3 py-1.5 rounded-lg bg-primary/10 text-primary text-xs hover:bg-primary/20 transition-colors">
                                            <i class="fa fa-eye mr-1"></i>
                                            <span>查看详情</span>
                                        </button>
                                        <button class="px-3 py-1.5 rounded-lg bg-primary/10 text-primary text-xs hover:bg-primary/20 transition-colors">
                                            <i class="fa fa-share mr-1"></i>
                                            <span>分享</span>
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="p-4 rounded-lg border border-line bg-white shadow-sm hover:shadow-md transition-all">
                                    <div class="flex items-start justify-between">
                                        <div class="flex items-center gap-2">
                                            <input type="checkbox" class="queue-item-checkbox rounded border-line text-primary focus:ring-primary mt-0.5">
                                            <div class="w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center">
                                                <i class="fa fa-pencil text-primary"></i>
                                            </div>
                                            <div>
                                                <p class="font-medium">客户访谈笔记</p>
                                                <p class="text-xs text-muted">张总客户访谈要点</p>
                                            </div>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <span class="px-2 py-0.5 rounded-full bg-warning/10 text-warning text-xs">待确认</span>
                                            <button class="p-2 rounded-full hover:bg-primary/5 transition-colors">
                                                <i class="fa fa-ellipsis-h text-muted"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="mt-3 grid grid-cols-2 gap-3 text-xs">
                                        <div class="flex items-center gap-2">
                                            <i class="fa fa-clock-o text-muted"></i>
                                            <span class="text-muted">2小时前</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <i class="fa fa-user-o text-muted"></i>
                                            <span class="text-muted">张三</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <i class="fa fa-tags text-muted"></i>
                                            <span class="text-muted">客户、访谈</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <i class="fa fa-check-circle text-success"></i>
                                            <span class="text-success">AI已生成摘要</span>
                                        </div>
                                    </div>
                                    <div class="mt-3 pt-3 border-t border-line flex items-center justify-between">
                                        <button class="px-3 py-1.5 rounded-lg bg-primary/10 text-primary text-xs hover:bg-primary/20 transition-colors">
                                            <i class="fa fa-edit mr-1"></i>
                                            <span>编辑</span>
                                        </button>
                                        <button class="px-3 py-1.5 rounded-lg bg-primary/10 text-primary text-xs hover:bg-primary/20 transition-colors">
                                            <i class="fa fa-share mr-1"></i>
                                            <span>分享</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-4 pt-4 border-t border-line">
                                <button id="load-more-queue" class="w-full py-2.5 rounded-lg bg-primary/5 border border-primary/20 text-primary text-sm hover:bg-primary/10 transition-colors">
                                    <i class="fa fa-chevron-down mr-1"></i>
                                    加载更多（12/24）
                                </button>
                            </div>
                        </div>
                    </div>
                    <div id="tab-desktop" class="tab-panel">
                        <div class="mb-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h2 class="text-xl font-medium">桌面工具</h2>
                                    <p class="text-xs text-muted">提升桌面工作效率的实用工具</p>
                                </div>
                                <div class="flex items-center gap-3">
                                    <div class="text-center">
                                        <span class="text-2xl font-medium">3</span>
                                        <p class="text-xs text-muted">可用工具</p>
                                    </div>
                                    <button class="p-2 rounded-full hover:bg-primary/5 transition-colors">
                                        <i class="fa fa-refresh text-muted"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-5">
                            <div class="bg-white rounded-xl border border-line shadow-card p-5 transition-all duration-300 hover:shadow-lg hover:-translate-y-1">
                                <div class="flex flex-col h-full">
                                    <div class="flex items-start justify-between mb-4">
                                        <div class="w-12 h-12 rounded-lg bg-primary/10 flex items-center justify-center">
                                            <i class="fa fa-camera text-primary text-2xl"></i>
                                        </div>
                                        <span class="px-2 py-0.5 rounded-full bg-success/10 text-success text-xs">已安装</span>
                                    </div>
                                    <h3 class="font-medium mb-2">智能截图工具</h3>
                                    <p class="text-sm text-muted mb-4">快速截取屏幕内容，支持AI识别、标注和一键分享</p>
                                    
                                    <div class="space-y-2 mb-4">
                                        <div class="flex items-center gap-2">
                                            <i class="fa fa-check text-success"></i>
                                            <span class="text-xs">屏幕区域自由截图</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <i class="fa fa-check text-success"></i>
                                            <span class="text-xs">AI自动内容识别与标注</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <i class="fa fa-check text-success"></i>
                                            <span class="text-xs">一键分享至知识库</span>
                                        </div>
                                    </div>
                                    
                                    <div class="mt-auto">
                                        <button id="start-screenshot" class="w-full px-4 py-2 rounded-lg bg-primary text-white text-sm hover:bg-primary-dark transition-colors shadow-sm">
                                            <i class="fa fa-play mr-1"></i>
                                            <span>启动截图</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white rounded-xl border border-line shadow-card p-5 transition-all duration-300 hover:shadow-lg hover:-translate-y-1">
                                <div class="flex flex-col h-full">
                                    <div class="flex items-start justify-between mb-4">
                                        <div class="w-12 h-12 rounded-lg bg-secondary/10 flex items-center justify-center">
                                            <i class="fa fa-video-camera text-secondary text-2xl"></i>
                                        </div>
                                        <span class="px-2 py-0.5 rounded-full bg-success/10 text-success text-xs">已安装</span>
                                    </div>
                                    <h3 class="font-medium mb-2">录屏与标注工具</h3>
                                    <p class="text-sm text-muted mb-4">支持实时标注与封面生成，提升视频内容创作效率</p>
                                    
                                    <div class="space-y-2 mb-4">
                                        <div class="flex items-center gap-2">
                                            <i class="fa fa-check text-success"></i>
                                            <span class="text-xs">实时标注功能</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <i class="fa fa-check text-success"></i>
                                            <span class="text-xs">系统声音录制</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <i class="fa fa-check text-success"></i>
                                            <span class="text-xs">AI视频摘要生成</span>
                                        </div>
                                    </div>
                                    
                                    <div class="mt-auto">
                                        <button id="start-screen-recording" class="w-full px-4 py-2 rounded-lg bg-secondary text-white text-sm hover:bg-secondary-dark transition-colors shadow-sm">
                                            <i class="fa fa-play mr-1"></i>
                                            <span>开始录屏</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white rounded-xl border border-line shadow-card p-5 transition-all duration-300 hover:shadow-lg hover:-translate-y-1">
                                <div class="flex flex-col h-full">
                                    <div class="flex items-start justify-between mb-4">
                                        <div class="w-12 h-12 rounded-lg bg-accent/10 flex items-center justify-center">
                                            <i class="fa fa-clipboard text-accent text-2xl"></i>
                                        </div>
                                        <span class="px-2 py-0.5 rounded-full bg-success/10 text-success text-xs">已安装</span>
                                    </div>
                                    <h3 class="font-medium mb-2">剪贴板管理器</h3>
                                    <p class="text-sm text-muted mb-4">统一管理历史剪贴内容，支持快速搜索和分类</p>
                                    
                                    <div class="space-y-2 mb-4">
                                        <div class="flex items-center gap-2">
                                            <i class="fa fa-check text-success"></i>
                                            <span class="text-xs">历史剪贴内容永久保存</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <i class="fa fa-check text-success"></i>
                                            <span class="text-xs">按类型智能分类（文本、图片、链接）</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <i class="fa fa-check text-success"></i>
                                            <span class="text-xs">快速搜索和一键粘贴</span>
                                        </div>
                                    </div>
                                    
                                    <div class="mt-auto">
                                        <button id="view-clipboard-history" class="w-full px-4 py-2 rounded-lg bg-accent text-white text-sm hover:bg-accent-dark transition-colors shadow-sm">
                                            <i class="fa fa-eye mr-1"></i>
                                            <span>查看历史</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="page-context" class="page flex flex-col gap-6 h-[calc(100vh-120px)] overflow-auto">
                <div>
                    <h2 class="text-2xl font-display font-semibold">情境知识面板</h2>
                    <p class="text-sm text-muted">无处不在的智能认知助手，将企业知识能力嵌入用户工作的每一个场景</p>
                </div>

                <!-- 浏览器扩展插件 -->
                <div class="bg-surface rounded-2xl border border-line shadow-card p-6">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <h3 class="text-lg font-semibold flex items-center"><i class="fa fa-globe text-primary mr-2"></i>浏览器扩展插件</h3>
                            <p class="text-xs text-muted">将智能知识能力注入用户的Web工作场景</p>
                        </div>
                        <button class="px-3 py-1.5 rounded-full bg-primary text-white text-sm">安装插件</button>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
                        <!-- 划词取义与知识查询 -->
                        <div class="col-span-1 lg:col-span-2">
                            <h4 class="font-medium mb-3 text-sm">划词取义与知识查询</h4>
                            <div class="bg-white rounded-xl border border-line p-4">
                                <div class="flex items-center gap-2 text-xs text-muted mb-3">
                                    <span><i class="fa fa-search"></i> 当前页面：CRM · 客户详情</span>
                                    <span class="px-2 py-0.5 rounded-full bg-primary/10 text-primary">情境识别中</span>
                                </div>
                                <div class="text-sm mb-4">
                                    客户：<strong>XX科技公司</strong> · 合同金额 <strong>¥3,200,000</strong> · 行业：智能制造
                                </div>
                                <div class="flex flex-wrap gap-2 mb-4">
                                    <span class="term-highlight px-2 py-1 rounded bg-primary/10 cursor-pointer">客户续约率</span>
                                    <span class="term-highlight px-2 py-1 rounded bg-primary/10 cursor-pointer">风险等级</span>
                                    <span class="term-highlight px-2 py-1 rounded bg-primary/10 cursor-pointer">项目里程碑</span>
                                    <span class="term-highlight px-2 py-1 rounded bg-primary/10 cursor-pointer">投诉处理</span>
                                </div>
                                <div class="flex gap-2">
                                    <button class="explain-btn px-3 py-1.5 rounded-lg bg-primary text-white text-sm flex items-center gap-1"><i class="fa fa-book"></i> 解释</button>
                                    <button class="search-btn px-3 py-1.5 rounded-lg bg-white border border-line text-sm flex items-center gap-1"><i class="fa fa-search"></i> 搜索</button>
                                    <button class="save-btn px-3 py-1.5 rounded-lg bg-white border border-line text-sm flex items-center gap-1"><i class="fa fa-save"></i> 保存</button>
                                </div>
                            </div>
                        </div>

                        <!-- 情境智能伴读面板 -->
                        <div>
                            <h4 class="font-medium mb-3 text-sm">情境智能伴读面板</h4>
                            <div class="bg-white rounded-xl border border-line p-4 space-y-3">
                                <div class="text-xs text-muted flex items-center justify-between">
                                    <span>智能情境面板</span>
                                    <button class="text-primary"><i class="fa fa-cog"></i></button>
                                </div>
                                
                                <!-- 客户摘要 -->
                                <div class="p-3 rounded-lg bg-purple-light">
                                    <h5 class="font-medium text-sm mb-1">客户摘要</h5>
                                    <p class="text-xs text-muted">行业：智能制造 · 合作年限：3年</p>
                                    <p class="text-xs text-muted">负责人：李强 · 销售总监</p>
                                </div>
                                
                                <!-- 关联知识 -->
                                <div>
                                    <h5 class="font-medium text-sm mb-2">关联知识</h5>
                                    <ul class="space-y-2 text-xs">
                                        <li class="flex items-center gap-2 text-muted hover:text-primary cursor-pointer"><i class="fa fa-file-text-o"></i> 客户投诉处理方案</li>
                                        <li class="flex items-center gap-2 text-muted hover:text-primary cursor-pointer"><i class="fa fa-file-text-o"></i> 续约策略模板</li>
                                        <li class="flex items-center gap-2 text-muted hover:text-primary cursor-pointer"><i class="fa fa-file-text-o"></i> 竞争对手动态</li>
                                    </ul>
                                </div>
                                
                                <!-- 快速操作 -->
                                <div class="pt-2 border-t border-line">
                                    <div class="grid grid-cols-2 gap-2">
                                        <button class="px-3 py-2 rounded-lg bg-primary text-white text-xs flex items-center justify-center gap-1"><i class="fa fa-calendar"></i> 发起会议</button>
                                        <button class="px-3 py-2 rounded-lg bg-secondary text-white text-xs flex items-center justify-center gap-1"><i class="fa fa-envelope"></i> 发送邮件</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 桌面悬浮窗与快速入口 -->
                <div class="bg-surface rounded-2xl border border-line shadow-card p-6">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <h3 class="text-lg font-semibold flex items-center"><i class="fa fa-desktop text-secondary mr-2"></i>桌面悬浮窗与快速入口</h3>
                            <p class="text-xs text-muted">在用户使用本地应用(IDE、Office等)时，提供轻量级的知识接入能力</p>
                        </div>
                        <button class="px-3 py-1.5 rounded-full bg-secondary text-white text-sm">下载桌面客户端</button>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
                        <!-- 桌面悬浮球 -->
                        <div>
                            <h4 class="font-medium mb-3 text-sm">桌面悬浮球</h4>
                            <div class="bg-white rounded-xl border border-line p-4 text-center">
                                <div class="w-16 h-16 bg-primary rounded-full flex items-center justify-center text-white mx-auto mb-3 animate-float">
                                    <i class="fa fa-search text-lg"></i>
                                </div>
                                <p class="text-xs text-muted mb-3">全局快速搜索入口</p>
                                <div class="flex flex-wrap justify-center gap-2 text-xs">
                                    <span class="px-2 py-1 rounded bg-secondary/10">快速搜索</span>
                                    <span class="px-2 py-1 rounded bg-secondary/10">新建笔记</span>
                                    <span class="px-2 py-1 rounded bg-secondary/10">查看摘要</span>
                                </div>
                            </div>
                        </div>

                        <!-- IDE集成插件 -->
                        <div>
                            <h4 class="font-medium mb-3 text-sm">IDE集成插件</h4>
                            <div class="bg-white rounded-xl border border-line p-4">
                                <div class="flex items-center justify-between text-xs text-muted mb-3">
                                    <span><i class="fa fa-code"></i> VS Code 集成</span>
                                    <span class="px-2 py-0.5 rounded-full bg-success/10 text-success">已安装</span>
                                </div>
                                <div class="text-xs mb-3">
                                    当前文件：<strong>user_service.py</strong>
                                </div>
                                <div class="bg-mist rounded p-2 text-xs mb-3">
                                    <p class="font-medium mb-1">代码情境感知</p>
                                    <p class="text-muted">关联技术文档：<a href="#" class="text-primary hover:underline">用户认证API文档</a></p>
                                </div>
                                <button class="w-full px-3 py-1.5 rounded-lg bg-secondary text-white text-xs">配置IDE插件</button>
                            </div>
                        </div>

                        <!-- Office套件插件 -->
                        <div>
                            <h4 class="font-medium mb-3 text-sm">Office套件插件</h4>
                            <div class="bg-white rounded-xl border border-line p-4">
                                <div class="flex items-center justify-between text-xs text-muted mb-3">
                                    <span><i class="fa fa-file-word-o"></i> Word 集成</span>
                                    <span class="px-2 py-0.5 rounded-full bg-success/10 text-success">已安装</span>
                                </div>
                                <div class="text-xs mb-3">
                                    当前文档：<strong>Q3销售报告.docx</strong>
                                </div>
                                <div class="bg-mist rounded p-2 text-xs mb-3">
                                    <p class="font-medium mb-1">智能引用</p>
                                    <p class="text-muted">自动插入知识卡片引用</p>
                                </div>
                                <button class="w-full px-3 py-1.5 rounded-lg bg-secondary text-white text-xs">配置Office插件</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 智能提醒与主动推送 -->
                <div class="bg-surface rounded-2xl border border-line shadow-card p-6">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <h3 class="text-lg font-semibold flex items-center"><i class="fa fa-bell-o text-accent mr-2"></i>智能提醒与主动推送</h3>
                            <p class="text-xs text-muted">将被动的知识查询，转变为主动的情境感知推送</p>
                        </div>
                        <button class="px-3 py-1.5 rounded-full bg-accent text-white text-sm">设置提醒</button>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                        <!-- 情境触发推送 -->
                        <div>
                            <h4 class="font-medium mb-3 text-sm">情境触发推送</h4>
                            <div class="bg-white rounded-xl border border-line p-4 space-y-3">
                                <div class="flex items-start gap-3 p-3 rounded-lg bg-accent/10">
                                    <div class="w-6 h-6 rounded-full bg-accent flex items-center justify-center text-white text-xs"><i class="fa fa-exclamation-circle"></i></div>
                                    <div class="flex-1">
                                        <p class="text-sm font-medium">客户风险提示</p>
                                        <p class="text-xs text-muted mt-1">该客户近期有投诉记录，建议查看处理方案</p>
                                        <div class="mt-2 flex gap-2">
                                            <button class="px-2 py-1 rounded bg-accent text-white text-xs">查看详情</button>
                                            <button class="px-2 py-1 rounded bg-white border border-line text-xs">稍后提醒</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex items-start gap-3 p-3 rounded-lg bg-primary/10">
                                    <div class="w-6 h-6 rounded-full bg-primary flex items-center justify-center text-white text-xs"><i class="fa fa-calendar"></i></div>
                                    <div class="flex-1">
                                        <p class="text-sm font-medium">会议资料提醒</p>
                                        <p class="text-xs text-muted mt-1">XX科技公司会议前15分钟，推送相关背景资料</p>
                                        <div class="mt-2 flex gap-2">
                                            <button class="px-2 py-1 rounded bg-primary text-white text-xs">查看资料</button>
                                            <button class="px-2 py-1 rounded bg-white border border-line text-xs">忽略</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 智能提醒气泡 -->
                        <div>
                            <h4 class="font-medium mb-3 text-sm">提醒管理</h4>
                            <div class="bg-white rounded-xl border border-line p-4">
                                <div class="flex items-center justify-between text-sm mb-3">
                                    <span class="font-medium">提醒设置</span>
                                    <button class="text-xs text-primary">管理规则</button>
                                </div>
                                <div class="space-y-3 text-sm">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center gap-2">
                                            <input type="checkbox" id="toggle-context-reminder" class="rounded border-line">
                                            <label for="toggle-context-reminder" class="text-sm">情境触发提醒</label>
                                        </div>
                                        <span class="text-xs text-muted">已启用</span>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center gap-2">
                                            <input type="checkbox" id="toggle-time-reminder" class="rounded border-line">
                                            <label for="toggle-time-reminder" class="text-sm">时间触发提醒</label>
                                        </div>
                                        <span class="text-xs text-muted">已启用</span>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center gap-2">
                                            <input type="checkbox" id="toggle-mute" class="rounded border-line">
                                            <label for="toggle-mute" class="text-sm">勿扰模式(18:00-08:00)</label>
                                        </div>
                                        <span class="text-xs text-muted">已启用</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="page-team" class="page flex flex-col gap-6 h-[calc(100vh-120px)] overflow-auto">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-2xl font-display font-semibold">团队空间</h2>
                        <p class="text-sm text-muted">项目协作与知识沉淀一体化</p>
                    </div>
                    <div class="flex items-center space-x-3">
                        <button id="create-space" class="px-4 py-2 rounded-full bg-primary text-white text-sm">创建空间</button>
                        <button id="open-discussion" class="px-4 py-2 rounded-full bg-white border border-line text-sm">发起讨论</button>
                    </div>
                </div>
                
                <!-- 空间切换与选择 -->
                <div class="bg-surface rounded-2xl border border-line shadow-card p-4">
                    <div class="flex items-center justify-between">
                        <p class="font-medium">我的空间</p>
                        <select id="space-selector" class="px-3 py-2 rounded-lg border border-line text-sm">
                            <option value="project-space">Q1新产品开发 (项目空间)</option>
                            <option value="team-space">研发中心 (团队空间)</option>
                            <option value="theme-space">技术创新小组 (主题空间)</option>
                        </select>
                    </div>
                    <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-3 text-xs">
                        <div class="p-3 rounded-xl bg-ocean">
                            <p class="font-medium">项目空间</p>
                            <p class="text-muted mt-1">3个活跃项目</p>
                        </div>
                        <div class="p-3 rounded-xl bg-coral">
                            <p class="font-medium">团队空间</p>
                            <p class="text-muted mt-1">2个部门团队</p>
                        </div>
                        <div class="p-3 rounded-xl bg-mist">
                            <p class="font-medium">主题空间</p>
                            <p class="text-muted mt-1">5个跨部门主题</p>
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 xl:grid-cols-3 gap-4">
                    <div class="xl:col-span-2 bg-surface rounded-2xl border border-line shadow-card p-4">
                        <div class="flex items-center justify-between">
                            <p class="font-medium">空间概览 · Q1新产品开发</p>
                            <button id="space-settings" class="text-xs text-secondary">空间设置</button>
                        </div>
                        <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-3 text-xs">
                            <div class="p-3 rounded-xl bg-ocean">
                                <p class="font-medium">OKR进度</p>
                                <p class="text-muted mt-1">完成度 68%</p>
                            </div>
                            <div class="p-3 rounded-xl bg-coral">
                                <p class="font-medium">最新动态</p>
                                <p class="text-muted mt-1">3条文档更新 · 2个决策</p>
                            </div>
                            <div class="p-3 rounded-xl bg-mist">
                                <p class="font-medium">待办事项</p>
                                <p class="text-muted mt-1">4项分配给你</p>
                            </div>
                        </div>
                        <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="bg-white rounded-xl border border-line p-3">
                                <p class="font-medium text-sm">讨论区</p>
                                <ul class="mt-2 text-xs space-y-2">
                                    <li class="p-2 rounded-lg bg-mist">需求优先级讨论 · 12条回复</li>
                                    <li class="p-2 rounded-lg bg-mist">技术方案评审 · 8条回复</li>
                                    <li class="p-2 rounded-lg bg-mist">上线风险与预案 · 4条回复</li>
                                </ul>
                            </div>
                            <div class="bg-white rounded-xl border border-line p-3">
                                <p class="font-medium text-sm">会议纪要</p>
                                <ul class="mt-2 text-xs space-y-2">
                                    <li class="p-2 rounded-lg bg-mist">技术方案评审会 · 决策3项</li>
                                    <li class="p-2 rounded-lg bg-mist">周例会 · 任务5项</li>
                                    <li class="p-2 rounded-lg bg-mist">设计评审 · 风险2项</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="bg-surface rounded-2xl border border-line shadow-card p-4 space-y-3">
                        <div>
                            <p class="font-medium">团队成员</p>
                            <p class="text-xs text-muted">自动识别隐性专家</p>
                        </div>
                        <div class="space-y-2 text-xs">
                            <div class="flex items-center justify-between p-2 rounded-lg bg-white border border-line">
                                <span>张三 · 架构专家</span>
                                <span class="text-secondary">贡献指数 92</span>
                            </div>
                            <div class="flex items-center justify-between p-2 rounded-lg bg-white border border-line">
                                <span>李四 · 需求分析</span>
                                <span class="text-secondary">贡献指数 88</span>
                            </div>
                            <div class="flex items-center justify-between p-2 rounded-lg bg-white border border-line">
                                <span>王晓华 · 市场分析</span>
                                <span class="text-secondary">贡献指数 85</span>
                            </div>
                        </div>
                        <div class="p-3 rounded-xl bg-mist text-xs">
                            <p class="font-medium">空间健康度</p>
                            <p class="mt-1 text-muted">评分 82 · 建议补充测试文档</p>
                        </div>
                        <button class="px-3 py-2 rounded-full bg-secondary text-white text-sm">查看任务看板</button>
                    </div>
                </div>
            </div>

            <div id="page-agent" class="page flex flex-col gap-6 h-[calc(100vh-120px)] overflow-auto">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-2xl font-display font-semibold">智能体市场</h2>
                        <p class="text-sm text-muted">发现、订阅并配置你的AI助手团队</p>
                    </div>
                    <button class="px-4 py-2 rounded-full bg-primary text-white text-sm">我的智能体</button>
                </div>
                <div class="bg-surface rounded-2xl border border-line shadow-card p-4">
                    <div class="flex flex-wrap items-center gap-3">
                        <input class="flex-1 border border-line rounded-full px-4 py-2 text-sm" placeholder="搜索智能体名称或场景">
                        <select class="border border-line rounded-full px-3 py-2 text-sm">
                            <option>全部场景</option>
                            <option>销售</option>
                            <option>研发</option>
                            <option>法务</option>
                        </select>
                        <button class="px-4 py-2 rounded-full bg-secondary text-white text-sm">筛选</button>
                    </div>
                    <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="agent-card bg-white rounded-xl border border-line p-4" data-agent="合同审查官">
                            <div class="flex items-center justify-between">
                                <p class="font-medium">合同审查官</p>
                                <span class="text-xs px-2 py-0.5 rounded-full bg-secondary text-white">官方</span>
                            </div>
                            <p class="text-xs text-muted mt-2">识别合同风险条款并生成摘要</p>
                            <div class="mt-3 text-xs text-muted">订阅 1,280 · 评分 4.8</div>
                        </div>
                        <div class="agent-card bg-white rounded-xl border border-line p-4" data-agent="销售话术教练">
                            <div class="flex items-center justify-between">
                                <p class="font-medium">销售话术教练</p>
                                <span class="text-xs px-2 py-0.5 rounded-full bg-accent text-white">热门</span>
                            </div>
                            <p class="text-xs text-muted mt-2">基于客户画像生成跟进话术</p>
                            <div class="mt-3 text-xs text-muted">订阅 980 · 评分 4.6</div>
                        </div>
                        <div class="agent-card bg-white rounded-xl border border-line p-4" data-agent="数据分析师">
                            <div class="flex items-center justify-between">
                                <p class="font-medium">数据分析师</p>
                                <span class="text-xs px-2 py-0.5 rounded-full bg-primary text-white">新上架</span>
                            </div>
                            <p class="text-xs text-muted mt-2">自动生成结构化数据报告</p>
                            <div class="mt-3 text-xs text-muted">订阅 620 · 评分 4.7</div>
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-1 xl:grid-cols-3 gap-4">
                    <div class="xl:col-span-2 bg-surface rounded-2xl border border-line shadow-card p-4">
                        <p class="font-medium">我的智能体</p>
                        <div id="my-agent-list" class="mt-3 space-y-3 text-sm">
                            <div class="p-3 rounded-xl bg-white border border-line flex items-center justify-between">
                                <span>智能邮件助手</span>
                                <button class="config-agent text-xs text-secondary">配置</button>
                            </div>
                            <div class="p-3 rounded-xl bg-white border border-line flex items-center justify-between">
                                <span>代码评审助手</span>
                                <button class="config-agent text-xs text-secondary">配置</button>
                            </div>
                        </div>
                    </div>
                    <div class="bg-surface rounded-2xl border border-line shadow-card p-4">
                        <p class="font-medium">协同工作流</p>
                        <ol id="agent-flow" class="mt-3 text-xs space-y-2">
                            <li class="p-2 rounded-lg bg-mist">数据提取助手</li>
                            <li class="p-2 rounded-lg bg-mist">分析师助手</li>
                            <li class="p-2 rounded-lg bg-mist">报告生成助手</li>
                        </ol>
                        <button id="add-flow-step" class="mt-3 px-3 py-2 rounded-full bg-secondary text-white text-xs">添加步骤</button>
                    </div>
                </div>
            </div>

            <div id="page-collab" class="page flex flex-col gap-6 h-[calc(100vh-120px)] overflow-auto">
                <div>
                    <h2 class="text-2xl font-display font-semibold">协作与质量保障</h2>
                    <p class="text-sm text-muted">协作演进 + AI质量助手 + 分层发布</p>
                </div>
                <div class="grid grid-cols-1 xl:grid-cols-4 gap-4">
                    <div class="xl:col-span-3 bg-surface rounded-2xl border border-line shadow-card p-4">
                        <div class="flex items-center justify-between">
                            <p class="font-medium">文档协作区</p>
                            <div class="flex gap-2">
                                <button id="run-quality-check" class="px-3 py-2 rounded-full bg-secondary text-white text-xs">运行AI预检</button>
                                <button id="show-all-comments" class="px-3 py-2 rounded-full bg-white border border-line text-xs">显示所有批注</button>
                            </div>
                        </div>
                        <div class="mt-4 p-4 rounded-xl border border-line bg-white text-sm">
                            <div class="flex items-center justify-between">
                                <p class="font-medium">《产品需求文档 V1.2》</p>
                                <div class="flex gap-2 text-xs">
                                    <span class="px-2 py-1 rounded-full bg-mist">V1.2</span>
                                    <span class="px-2 py-1 rounded-full bg-ocean">2024-07-20</span>
                                    <span class="px-2 py-1 rounded-full bg-success/20 text-success">编辑中</span>
                                </div>
                            </div>
                            <div class="mt-2 grid grid-cols-1 md:grid-cols-3 gap-3 text-xs">
                                <p class="text-muted">批注：<span class="text-danger">2条未解决</span> · <span class="text-warning">3条待确认</span></p>
                                <p class="text-muted">作者：张明 · 产品经理</p>
                                <p class="text-muted">上次更新：2分钟前</p>
                            </div>
                            
                            <!-- 在线用户列表 -->
                            <div class="mt-3 flex items-center gap-1 text-xs">
                                <span class="text-muted">当前在线：</span>
                                <div class="flex items-center gap-1">
                                    <div class="w-5 h-5 rounded-full bg-primary flex items-center justify-center text-white text-[10px] relative">
                                        <span>张</span>
                                        <span class="absolute -top-0.5 -right-0.5 w-2 h-2 rounded-full bg-success border-2 border-white"></span>
                                    </div>
                                    <div class="w-5 h-5 rounded-full bg-secondary flex items-center justify-center text-white text-[10px] relative">
                                        <span>李</span>
                                        <span class="absolute -top-0.5 -right-0.5 w-2 h-2 rounded-full bg-success border-2 border-white"></span>
                                    </div>
                                    <div class="w-5 h-5 rounded-full bg-accent flex items-center justify-center text-white text-[10px] relative">
                                        <span>王</span>
                                        <span class="absolute -top-0.5 -right-0.5 w-2 h-2 rounded-full bg-success border-2 border-white"></span>
                                    </div>
                                    <span class="text-primary font-medium">+2</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 可批注的文档内容区域 -->
                        <div class="mt-4 p-4 rounded-xl border border-line bg-white text-sm" id="annotatable-document">
                            <div class="document-paragraph relative p-3 hover:bg-mist cursor-pointer" data-paragraph-id="1" data-editing="false">
                                <h3 class="text-lg font-medium mb-2">1. 项目概述</h3>
                                <p contenteditable="true" class="editable-content" oninput="handleContentChange(this, 1)">
                                    本项目旨在构建一个智能协作平台，通过AI辅助提升团队知识生产和共享效率。平台将整合文档协作、知识管理和AI智能助手功能，满足企业级用户的需求。
                                </p>
                                <div class="paragraph-actions absolute top-2 right-2 flex gap-1 opacity-0 hover:opacity-100 transition-opacity">
                                    <button class="p-1 bg-primary text-white rounded text-xs" title="添加批注" onclick="openCommentForm(1)"><i class="fa fa-comment"></i></button>
                                    <button class="p-1 bg-secondary text-white rounded text-xs" title="@提及" onclick="mentionUser(1)"><i class="fa fa-at"></i></button>
                                </div>
                                <!-- 批注标记 -->
                                <div class="comment-markers absolute left-0 top-0 flex flex-col gap-1 mt-3">
                                    <span class="w-2 h-2 rounded-full bg-danger" title="未解决的错误批注"></span>
                                </div>
                                <!-- 编辑状态指示 -->
                                <div class="edit-indicator absolute top-2 left-2 flex items-center gap-1 bg-primary/10 text-primary text-xs px-2 py-1 rounded-full opacity-0 hover:opacity-100 transition-opacity">
                                    <i class="fa fa-pencil"></i>
                                    <span>可编辑</span>
                                </div>
                            </div>
                            
                            <div class="document-paragraph relative p-3 hover:bg-mist cursor-pointer" data-paragraph-id="2" data-editing="false">
                                <h3 class="text-lg font-medium mb-2">2. 核心功能</h3>
                                <p contenteditable="true" class="editable-content" oninput="handleContentChange(this, 2)">
                                    平台的核心功能包括：智能协作批注系统、知识成熟度管理、AI质量助手、版本控制与历史追踪、社区驱动的质量监督以及必要的合规审核流程。
                                </p>
                                <div class="paragraph-actions absolute top-2 right-2 flex gap-1 opacity-0 hover:opacity-100 transition-opacity">
                                    <button class="p-1 bg-primary text-white rounded text-xs" title="添加批注" onclick="openCommentForm(2)"><i class="fa fa-comment"></i></button>
                                    <button class="p-1 bg-secondary text-white rounded text-xs" title="@提及" onclick="mentionUser(2)"><i class="fa fa-at"></i></button>
                                </div>
                                <div class="comment-markers absolute left-0 top-0 flex flex-col gap-1 mt-3">
                                    <span class="w-2 h-2 rounded-full bg-warning" title="待确认的建议批注"></span>
                                    <span class="w-2 h-2 rounded-full bg-success" title="已采纳的建议批注"></span>
                                </div>
                                <!-- 其他用户编辑状态 -->
                                <div class="other-user-edit absolute bottom-2 right-2 flex items-center gap-1 bg-secondary/10 text-secondary text-xs px-2 py-1 rounded-full">
                                    <div class="w-4 h-4 rounded-full bg-secondary flex items-center justify-center text-white text-[8px]">李</div>
                                    <span>正在编辑</span>
                                </div>
                            </div>
                            
                            <div class="document-paragraph relative p-3 hover:bg-mist cursor-pointer" data-paragraph-id="3" data-editing="false">
                                <h3 class="text-lg font-medium mb-2">3. 用户旅程</h3>
                                <p contenteditable="true" class="editable-content" oninput="handleContentChange(this, 3)">
                                    用户旅程包括知识创建、协作编辑、AI质量检查、发布与共享、社区反馈与持续改进等阶段。平台通过简化流程和智能辅助，降低用户使用门槛，提高知识生产效率。
                                </p>
                                <div class="paragraph-actions absolute top-2 right-2 flex gap-1 opacity-0 hover:opacity-100 transition-opacity">
                                    <button class="p-1 bg-primary text-white rounded text-xs" title="添加批注" onclick="openCommentForm(3)"><i class="fa fa-comment"></i></button>
                                    <button class="p-1 bg-secondary text-white rounded text-xs" title="@提及" onclick="mentionUser(3)"><i class="fa fa-at"></i></button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- AI预检结果面板 -->
                        <div class="mt-4 p-4 rounded-xl border border-line bg-white text-sm" id="ai-check-results" style="display: none;">
                            <div class="flex items-center justify-between mb-3">
                                <p class="font-medium flex items-center">
                                    <i class="fa fa-robot text-secondary mr-2"></i>
                                    AI智能预检结果
                                </p>
                                <span id="check-time" class="text-xs text-muted">刚刚检查</span>
                            </div>
                            
                            <!-- 质量得分 -->
                            <div class="mb-4">
                                <div class="flex items-center justify-between">
                                    <p class="font-medium">综合质量得分</p>
                                    <p id="ai-quality-score" class="text-xl font-bold text-primary">85 / 100</p>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                    <div id="quality-progress" class="bg-primary h-2 rounded-full" style="width: 85%"></div>
                                </div>
                                <div class="flex justify-between mt-1 text-xs text-muted">
                                    <span>需改进</span>
                                    <span>良好</span>
                                    <span>优秀</span>
                                </div>
                            </div>
                            
                            <!-- 检查结果分类 -->
                            <div class="space-y-3">
                                <!-- 术语规范问题 -->
                                <div class="p-3 rounded-lg bg-mist">
                                    <div class="flex items-center justify-between mb-2">
                                        <p class="font-medium text-primary">术语规范问题</p>
                                        <span class="px-2 py-1 rounded-full bg-primary/20 text-primary text-xs">3个问题</span>
                                    </div>
                                    <div class="space-y-2 text-xs">
                                        <div class="p-2 bg-white rounded border-l-4 border-primary">
                                            <p><strong>问题：</strong>使用了非标准术语"K8S"</p>
                                            <p><strong>建议：</strong>替换为标准术语"Kubernetes"</p>
                                            <p class="text-muted mt-1">位置：段落 2，第 1 行</p>
                                        </div>
                                        <div class="p-2 bg-white rounded border-l-4 border-primary">
                                            <p><strong>问题：</strong>使用了非标准术语"客户"</p>
                                            <p><strong>建议：</strong>替换为标准术语"购买方"</p>
                                            <p class="text-muted mt-1">位置：段落 1，第 2 行</p>
                                        </div>
                                        <div class="p-2 bg-white rounded border-l-4 border-primary">
                                            <p><strong>问题：</strong>使用了非标准术语"用户"</p>
                                            <p><strong>建议：</strong>替换为标准术语"最终用户"</p>
                                            <p class="text-muted mt-1">位置：段落 3，第 1 行</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 格式一致性问题 -->
                                <div class="p-3 rounded-lg bg-mist">
                                    <div class="flex items-center justify-between mb-2">
                                        <p class="font-medium text-warning">格式一致性问题</p>
                                        <span class="px-2 py-1 rounded-full bg-warning/20 text-warning text-xs">2个问题</span>
                                    </div>
                                    <div class="space-y-2 text-xs">
                                        <div class="p-2 bg-white rounded border-l-4 border-warning">
                                            <p><strong>问题：</strong>标题层级不一致</p>
                                            <p><strong>建议：</strong>确保所有标题使用统一的层级结构</p>
                                            <p class="text-muted mt-1">位置：整个文档</p>
                                        </div>
                                        <div class="p-2 bg-white rounded border-l-4 border-warning">
                                            <p><strong>问题：</strong>段落过长</p>
                                            <p><strong>建议：</strong>将超过500字的段落拆分为多个小段落</p>
                                            <p class="text-muted mt-1">位置：段落 1</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 完整性检查 -->
                                <div class="p-3 rounded-lg bg-mist">
                                    <div class="flex items-center justify-between mb-2">
                                        <p class="font-medium text-success">完整性检查</p>
                                        <span class="px-2 py-1 rounded-full bg-success/20 text-success text-xs">通过</span>
                                    </div>
                                    <p class="text-xs text-muted">文档结构完整，包含所有必要章节</p>
                                </div>
                            </div>
                            
                            <!-- 操作按钮 -->
                            <div class="mt-3 flex gap-2">
                                <button id="apply-all-suggestions" class="px-3 py-2 rounded-full bg-primary text-white text-xs">一键应用所有建议</button>
                                <button id="dismiss-results" class="px-3 py-2 rounded-full bg-white border border-line text-xs">关闭结果</button>
                            </div>
                        </div>
                        
                        <!-- 合规审核结果 -->
                        <div class="mt-4 p-4 rounded-xl border border-line bg-white text-sm" id="compliance-check-results" style="display: none;">
                            <div class="flex items-center justify-between mb-3">
                                <p class="font-medium flex items-center">
                                    <i class="fa fa-shield text-danger mr-2"></i>
                                    合规审核结果
                                </p>
                                <span id="compliance-check-time" class="text-xs text-muted">刚刚检查</span>
                            </div>
                            
                            <!-- 合规风险等级 -->
                            <div class="mb-4">
                                <div class="flex items-center justify-between">
                                    <p class="font-medium">综合风险等级</p>
                                    <span id="compliance-risk-level" class="px-3 py-1 rounded-full bg-warning/20 text-warning text-xs">低风险</span>
                                </div>
                            </div>
                            
                            <!-- 风险识别结果 -->
                            <div class="space-y-3">
                                <!-- 合规风险 -->
                                <div class="p-3 rounded-lg bg-mist">
                                    <div class="flex items-center justify-between mb-2">
                                        <p class="font-medium text-danger">合规风险识别</p>
                                        <span class="px-2 py-1 rounded-full bg-danger/20 text-danger text-xs">1个风险</span>
                                    </div>
                                    <div class="space-y-2 text-xs">
                                        <div class="p-2 bg-white rounded border-l-4 border-danger">
                                            <p><strong>风险：</strong>包含敏感术语</p>
                                            <p><strong>建议：</strong>替换为合规术语或添加免责声明</p>
                                            <p class="text-muted mt-1">位置：段落 2，第 1 行</p>
                                            <div class="mt-2 flex gap-2">
                                                <button class="px-2 py-1 bg-danger text-white rounded text-xs">立即修改</button>
                                                <button class="px-2 py-1 bg-white border border-line rounded text-xs">标记为已处理</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 高风险内容 -->
                                <div class="p-3 rounded-lg bg-mist">
                                    <div class="flex items-center justify-between mb-2">
                                        <p class="font-medium text-warning">高风险内容审核</p>
                                        <span class="px-2 py-1 rounded-full bg-warning/20 text-warning text-xs">通过</span>
                                    </div>
                                    <div class="space-y-2 text-xs">
                                        <div class="p-2 bg-white rounded border-l-4 border-success">
                                            <p><strong>结果：</strong>未检测到高风险内容</p>
                                            <p><strong>说明：</strong>文档内容符合公司合规政策要求</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 合规建议 -->
                                <div class="p-3 rounded-lg bg-mist">
                                    <div class="flex items-center justify-between mb-2">
                                        <p class="font-medium text-success">合规建议</p>
                                    </div>
                                    <div class="space-y-2 text-xs">
                                        <div class="p-2 bg-white rounded border-l-4 border-success">
                                            <p><strong>建议：</strong>定期进行合规审核</p>
                                            <p><strong>说明：</strong>建议每季度对文档进行一次全面合规检查</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 操作按钮 -->
                            <div class="mt-3 flex gap-2">
                                <button id="view-compliance-report" class="px-3 py-2 rounded-full bg-primary text-white text-xs">查看详细报告</button>
                                <button id="dismiss-compliance-results" class="px-3 py-2 rounded-full bg-white border border-line text-xs">关闭结果</button>
                            </div>
                        </div>
                        
                        <!-- 成熟度和质量指标 -->
                        <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-3 text-xs">
                            <div class="p-3 rounded-xl bg-mist">
                                <p class="font-medium">成熟度</p>
                                <p id="maturity-level" class="mt-1 text-primary font-medium">协作中</p>
                            </div>
                            <div class="p-3 rounded-xl bg-coral">
                                <p class="font-medium">AI质量得分</p>
                                <p id="quality-score" class="mt-1 text-muted">85 / 100</p>
                            </div>
                            <div class="p-3 rounded-xl bg-ocean">
                                <p class="font-medium">可见范围</p>
                                <p id="visibility-scope" class="mt-1 text-muted">团队空间</p>
                            </div>
                        </div>
                        
                        <!-- 知识成熟度评分面板 -->
                        <div class="mt-4 p-4 rounded-xl border border-line bg-white text-sm">
                            <div class="flex items-center justify-between mb-3">
                                <p class="font-medium">知识成熟度评分</p>
                                <span class="text-xs text-muted">自动计算</span>
                            </div>
                            
                            <!-- 成熟度等级 -->
                            <div class="mb-4">
                                <div class="flex items-center justify-between">
                                    <p class="font-medium">当前成熟度</p>
                                    <div class="flex items-center gap-1">
                                        <span id="maturity-badge" class="px-3 py-1 rounded-full bg-warning/20 text-warning text-xs">协作中</span>
                                    </div>
                                </div>
                                
                                <!-- 成熟度进度条 -->
                                <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                    <div id="maturity-progress" class="bg-primary h-2 rounded-full" style="width: 60%"></div>
                                </div>
                                
                                <!-- 成熟度等级标记 -->
                                <div class="flex justify-between mt-1 text-xs text-muted">
                                    <span>草稿</span>
                                    <span>初稿</span>
                                    <span>协作中</span>
                                    <span>成熟</span>
                                    <span>精品</span>
                                </div>
                            </div>
                            
                            <!-- 评分因子 -->
                            <div class="space-y-3">
                                <div>
                                    <div class="flex items-center justify-between mb-1">
                                        <p class="text-xs">AI质量检查得分</p>
                                        <p class="text-xs font-medium">85分 (30%)</p>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-1.5">
                                        <div class="bg-primary h-1.5 rounded-full" style="width: 85%"></div>
                                    </div>
                                </div>
                                
                                <div>
                                    <div class="flex items-center justify-between mb-1">
                                        <p class="text-xs">批注解决率</p>
                                        <p class="text-xs font-medium">70% (25%)</p>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-1.5">
                                        <div class="bg-secondary h-1.5 rounded-full" style="width: 70%"></div>
                                    </div>
                                </div>
                                
                                <div>
                                    <div class="flex items-center justify-between mb-1">
                                        <p class="text-xs">参与评审人数</p>
                                        <p class="text-xs font-medium">3人 (20%)</p>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-1.5">
                                        <div class="bg-accent h-1.5 rounded-full" style="width: 60%"></div>
                                    </div>
                                </div>
                                
                                <div>
                                    <div class="flex items-center justify-between mb-1">
                                        <p class="text-xs">更新频率</p>
                                        <p class="text-xs font-medium">活跃 (15%)</p>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-1.5">
                                        <div class="bg-success h-1.5 rounded-full" style="width: 90%"></div>
                                    </div>
                                </div>
                                
                                <div>
                                    <div class="flex items-center justify-between mb-1">
                                        <p class="text-xs">使用量和评分</p>
                                        <p class="text-xs font-medium">中等 (10%)</p>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-1.5">
                                        <div class="bg-warning h-1.5 rounded-full" style="width: 50%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 自动质量治理功能 -->
                        <div class="mt-4 p-4 rounded-xl border border-line bg-white text-sm">
                            <div class="flex items-center justify-between mb-3">
                                <p class="font-medium">自动质量治理</p>
                                <span class="text-xs text-muted">智能监控与管理</span>
                            </div>
                            
                            <!-- 过期提醒 -->
                            <div class="mb-4">
                                <div class="flex items-center justify-between mb-2">
                                    <p class="font-medium text-sm">过期提醒</p>
                                    <span class="px-2 py-1 rounded-full bg-warning/20 text-warning text-xs">30天后过期</span>
                                </div>
                                <div class="bg-mist p-3 rounded-lg text-xs">
                                    <p>当前知识文档将于<span class="font-medium">2024-08-20</span>过期，建议提前更新内容以保持时效性。</p>
                                    <div class="mt-2 flex gap-2">
                                        <button id="update-knowledge" class="px-3 py-1 rounded-full bg-primary text-white text-xs">立即更新</button>
                                        <button id="extend-expiry" class="px-3 py-1 rounded-full bg-white border border-line text-xs">延长有效期</button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 质量监控 -->
                            <div class="mb-4">
                                <div class="flex items-center justify-between mb-2">
                                    <p class="font-medium text-sm">质量监控</p>
                                    <span class="px-2 py-1 rounded-full bg-success/20 text-success text-xs">正常</span>
                                </div>
                                <div class="space-y-2">
                                    <div class="flex items-center justify-between text-xs">
                                        <span>AI质量得分阈值</span>
                                        <span class="font-medium">70分</span>
                                    </div>
                                    <div class="flex items-center justify-between text-xs">
                                        <span>低质量自动下架</span>
                                        <label class="flex items-center gap-1">
                                            <input type="checkbox" id="auto-remove" checked>
                                            <span>已启用</span>
                                        </label>
                                    </div>
                                    <div class="flex items-center justify-between text-xs">
                                        <span>质量检查频率</span>
                                        <span>每周自动检查</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 精品认证 -->
                            <div class="mb-4">
                                <div class="flex items-center justify-between mb-2">
                                    <p class="font-medium text-sm">精品认证</p>
                                    <span class="px-2 py-1 rounded-full bg-gray-200 text-muted text-xs">未认证</span>
                                </div>
                                <div class="bg-mist p-3 rounded-lg text-xs">
                                    <p>当前文档满足以下条件即可申请精品认证：</p>
                                    <ul class="list-disc list-inside mt-1 space-y-1">
                                        <li>AI质量得分≥90分</li>
                                        <li>批注解决率100%</li>
                                        <li>使用量≥50次</li>
                                        <li>用户评分≥4.5星</li>
                                    </ul>
                                    <button id="apply-certification" class="mt-2 px-3 py-1 rounded-full bg-primary text-white text-xs">申请精品认证</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 发布设置按钮 -->
                        <div class="mt-4 flex gap-2 text-xs">
                            <button id="open-publish" class="px-3 py-2 rounded-full bg-primary text-white">发布设置</button>
                            <button class="px-3 py-2 rounded-full bg-white border border-line">查看版本历史</button>
                        </div>
                        
                        <!-- 发布设置面板 -->
                        <div class="mt-4 p-4 rounded-xl border border-line bg-white text-sm" id="publish-settings" style="display: none;">
                            <div class="flex items-center justify-between mb-3">
                                <p class="font-medium">发布设置</p>
                                <button id="close-publish" class="text-muted"><i class="fa fa-times"></i></button>
                            </div>
                            
                            <!-- 可见范围设置 -->
                            <div class="mb-4">
                                <p class="font-medium mb-2">可见范围</p>
                                <div class="space-y-2">
                                    <label class="flex items-center gap-2">
                                        <input type="radio" name="visibility" value="personal" class="visibility-option" disabled>
                                        <div class="flex-1">
                                            <p class="text-sm">仅我可见</p>
                                            <p class="text-xs text-muted">仅创作者本人可见</p>
                                        </div>
                                    </label>
                                    
                                    <label class="flex items-center gap-2">
                                        <input type="radio" name="visibility" value="team" class="visibility-option" checked>
                                        <div class="flex-1">
                                            <p class="text-sm">团队空间</p>
                                            <p class="text-xs text-muted">团队成员可见可编辑</p>
                                        </div>
                                    </label>
                                    
                                    <label class="flex items-center gap-2">
                                        <input type="radio" name="visibility" value="department" class="visibility-option">
                                        <div class="flex-1">
                                            <p class="text-sm">部门空间</p>
                                            <p class="text-xs text-muted">部门内所有成员可见</p>
                                        </div>
                                    </label>
                                    
                                    <label class="flex items-center gap-2">
                                        <input type="radio" name="visibility" value="company" class="visibility-option">
                                        <div class="flex-1">
                                            <p class="text-sm">全员空间</p>
                                            <p class="text-xs text-muted">全公司可见（需AI质量得分≥80）</p>
                                        </div>
                                    </label>
                                    
                                    <label class="flex items-center gap-2">
                                        <input type="radio" name="visibility" value="external" class="visibility-option">
                                        <div class="flex-1">
                                            <p class="text-sm">对外发布</p>
                                            <p class="text-xs text-muted">面向客户/公众（需合规审核）</p>
                                        </div>
                                    </label>
                                </div>
                            </div>
                            
                            <!-- 发布说明 -->
                            <div class="mb-4 p-3 rounded-lg bg-mist">
                                <p class="font-medium text-sm">发布说明</p>
                                <div class="mt-2 text-xs space-y-1">
                                    <p><i class="fa fa-info-circle text-primary mr-1"></i> 当前文档成熟度为"协作中"，建议先解决所有批注后再发布到更大范围</p>
                                    <p><i class="fa fa-info-circle text-primary mr-1"></i> 发布到全员空间需要AI质量得分≥80分</p>
                                    <p><i class="fa fa-info-circle text-primary mr-1"></i> 对外发布需要通过合规审核</p>
                                </div>
                            </div>
                            
                            <!-- 操作按钮 -->
                            <div class="flex gap-2">
                                <button id="save-publish-settings" class="px-3 py-2 rounded-full bg-primary text-white text-xs">保存发布设置</button>
                                <button id="cancel-publish" class="px-3 py-2 rounded-full bg-white border border-line text-xs">取消</button>
                            </div>
                        </div>
                        
                        <!-- 版本历史面板 -->
                        <div class="mt-4 p-4 rounded-xl border border-line bg-white text-sm" id="version-history" style="display: none;">
                            <div class="flex items-center justify-between mb-3">
                                <p class="font-medium">版本历史</p>
                                <button id="close-version" class="text-muted"><i class="fa fa-times"></i></button>
                            </div>
                            
                            <!-- 版本筛选 -->
                            <div class="mb-4">
                                <div class="flex items-center justify-between mb-2">
                                    <p class="font-medium">版本筛选</p>
                                    <div class="flex gap-2">
                                        <button class="version-filter-btn px-3 py-1 rounded-full bg-primary text-white text-xs">全部</button>
                                        <button class="version-filter-btn px-3 py-1 rounded-full bg-white border border-line text-xs" data-type="publish">发布版本</button>
                                        <button class="version-filter-btn px-3 py-1 rounded-full bg-white border border-line text-xs" data-type="save">自动保存</button>
                                        <button class="version-filter-btn px-3 py-1 rounded-full bg-white border border-line text-xs" data-type="major">重大修订</button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 版本列表 -->
                            <div class="space-y-3 max-h-[500px] overflow-y-auto scrollbar-hide">
                                <!-- 当前版本 -->
                                <div class="version-item p-3 rounded-lg bg-primary/10 border border-primary flex items-start gap-3" data-version="1.2">
                                    <input type="checkbox" class="version-checkbox mt-1">
                                    <div class="flex-1">
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center gap-2">
                                                <p class="font-medium">V1.2</p>
                                                <span class="px-2 py-1 rounded-full bg-primary text-white text-xs">当前版本</span>
                                                <span class="px-2 py-1 rounded-full bg-ocean text-primary text-xs">发布版本</span>
                                            </div>
                                            <p class="text-xs text-muted">2024-07-20 14:30</p>
                                        </div>
                                        <div class="mt-2">
                                            <p class="font-medium">更新内容</p>
                                            <ul class="list-disc list-inside mt-1 text-xs space-y-1">
                                                <li>完善用户旅程与风险评估章节</li>
                                                <li>补充竞品对比数据</li>
                                                <li>修复术语规范问题</li>
                                            </ul>
                                        </div>
                                        <div class="mt-2 flex items-center gap-2">
                                            <img src="https://p3-doubao-search-sign.byteimg.com/pgc-image/6323b43dac9b41db978bffd8c580ac63~tplv-be4g95zd3a-image.jpeg?lk3s=feb11e32&x-expires=1783481830&x-signature=E%2BA4UNzvvjJgdRQb3RrhhengBCo%3D" alt="用户头像" class="w-5 h-5 rounded-full">
                                            <p class="text-xs">张明 · 产品经理</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 版本 1.1 -->
                                <div class="version-item p-3 rounded-lg bg-white border border-line flex items-start gap-3" data-version="1.1">
                                    <input type="checkbox" class="version-checkbox mt-1">
                                    <div class="flex-1">
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center gap-2">
                                                <p class="font-medium">V1.1</p>
                                                <span class="px-2 py-1 rounded-full bg-ocean text-primary text-xs">发布版本</span>
                                            </div>
                                            <p class="text-xs text-muted">2024-07-19 16:45</p>
                                        </div>
                                        <div class="mt-2">
                                            <p class="font-medium">更新内容</p>
                                            <ul class="list-disc list-inside mt-1 text-xs space-y-1">
                                                <li>新增核心功能章节</li>
                                                <li>添加项目背景与目标</li>
                                                <li>优化文档结构</li>
                                            </ul>
                                        </div>
                                        <div class="mt-2 flex items-center gap-2">
                                            <img src="https://p3-doubao-search-sign.byteimg.com/pgc-image/6323b43dac9b41db978bffd8c580ac63~tplv-be4g95zd3a-image.jpeg?lk3s=feb11e32&x-expires=1783481830&x-signature=E%2BA4UNzvvjJgdRQb3RrhhengBCo%3D" alt="用户头像" class="w-5 h-5 rounded-full">
                                            <p class="text-xs">张明 · 产品经理</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 自动保存版本 -->
                                <div class="version-item p-3 rounded-lg bg-white border border-line flex items-start gap-3" data-version="1.1.1">
                                    <input type="checkbox" class="version-checkbox mt-1">
                                    <div class="flex-1">
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center gap-2">
                                                <p class="font-medium">V1.1.1</p>
                                                <span class="px-2 py-1 rounded-full bg-mist text-muted text-xs">自动保存</span>
                                            </div>
                                            <p class="text-xs text-muted">2024-07-19 16:30</p>
                                        </div>
                                        <div class="mt-2">
                                            <p class="font-medium">更新内容</p>
                                            <p class="text-xs text-muted">自动保存：修改了核心功能描述</p>
                                        </div>
                                        <div class="mt-2 flex items-center gap-2">
                                            <img src="https://p3-doubao-search-sign.byteimg.com/pgc-image/6323b43dac9b41db978bffd8c580ac63~tplv-be4g95zd3a-image.jpeg?lk3s=feb11e32&x-expires=1783481830&x-signature=E%2BA4UNzvvjJgdRQb3RrhhengBCo%3D" alt="用户头像" class="w-5 h-5 rounded-full">
                                            <p class="text-xs">张明 · 产品经理</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 版本 1.0 -->
                                <div class="version-item p-3 rounded-lg bg-white border border-line flex items-start gap-3" data-version="1.0">
                                    <input type="checkbox" class="version-checkbox mt-1">
                                    <div class="flex-1">
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center gap-2">
                                                <p class="font-medium">V1.0</p>
                                                <span class="px-2 py-1 rounded-full bg-ocean text-primary text-xs">发布版本</span>
                                                <span class="px-2 py-1 rounded-full bg-success text-white text-xs">重大修订</span>
                                            </div>
                                            <p class="text-xs text-muted">2024-07-18 10:00</p>
                                        </div>
                                        <div class="mt-2">
                                            <p class="font-medium">更新内容</p>
                                            <ul class="list-disc list-inside mt-1 text-xs space-y-1">
                                                <li>初始版本</li>
                                                <li>创建产品需求文档</li>
                                                <li>完成基本框架</li>
                                            </ul>
                                        </div>
                                        <div class="mt-2 flex items-center gap-2">
                                            <img src="https://p3-doubao-search-sign.byteimg.com/pgc-image/6323b43dac9b41db978bffd8c580ac63~tplv-be4g95zd3a-image.jpeg?lk3s=feb11e32&x-expires=1783481830&x-signature=E%2BA4UNzvvjJgdRQb3RrhhengBCo%3D" alt="用户头像" class="w-5 h-5 rounded-full">
                                            <p class="text-xs">张明 · 产品经理</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 版本操作按钮 -->
                            <div class="mt-4 flex flex-wrap gap-2">
                                <button id="compare-versions" class="px-3 py-2 rounded-full bg-primary text-white text-xs" disabled>对比选中版本</button>
                                <button id="rollback-version" class="px-3 py-2 rounded-full bg-white border border-line text-xs" disabled>回滚到选中版本</button>
                                <button id="export-version" class="px-3 py-2 rounded-full bg-white border border-line text-xs">导出版本历史</button>
                            </div>
                        </div>
                        
                        <!-- 版本对比面板 -->
                        <div class="mt-4 p-4 rounded-xl border border-line bg-white text-sm" id="version-compare" style="display: none;">
                            <div class="flex items-center justify-between mb-3">
                                <p class="font-medium">版本对比</p>
                                <button id="close-compare" class="text-muted"><i class="fa fa-times"></i></button>
                            </div>
                            
                            <!-- 版本选择 -->
                            <div class="mb-4">
                                <div class="flex items-center justify-between mb-2">
                                    <p class="font-medium">选择对比版本</p>
                                    <div class="flex gap-2">
                                        <select id="version-from" class="border border-line rounded-lg px-3 py-2 text-xs">
                                            <option value="1.1">V1.1</option>
                                            <option value="1.0">V1.0</option>
                                        </select>
                                        <span class="text-muted">→</span>
                                        <select id="version-to" class="border border-line rounded-lg px-3 py-2 text-xs">
                                            <option value="1.2" selected>V1.2</option>
                                            <option value="1.1">V1.1</option>
                                        </select>
                                        <button id="start-compare" class="px-3 py-2 rounded-full bg-primary text-white text-xs">开始对比</button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- AI变更摘要 -->
                            <div class="mb-4 p-3 rounded-lg bg-primary/10">
                                <div class="flex items-center gap-2 mb-2">
                                    <i class="fa fa-robot text-primary"></i>
                                    <p class="font-medium">AI变更摘要</p>
                                </div>
                                <p class="text-xs" id="ai-change-summary">V1.2相比V1.1：新增了用户旅程与风险评估章节，补充了竞品对比数据，修复了3处术语规范问题，整体结构更清晰。</p>
                            </div>
                            
                            <!-- 版本对比内容 -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <!-- 旧版本 -->
                                <div class="version-content p-3 rounded-lg border border-line">
                                    <div class="flex items-center justify-between mb-2">
                                        <p class="font-medium">V1.1</p>
                                        <p class="text-xs text-muted">2024-07-19</p>
                                    </div>
                                    <div class="text-xs space-y-2">
                                        <div class="p-2 bg-white rounded">
                                            <p class="font-medium">一、项目概述</p>
                                            <p>本项目旨在构建一个智能协作平台，通过AI辅助提升团队知识生产和共享效率。</p>
                                        </div>
                                        <div class="p-2 bg-white rounded">
                                            <p class="font-medium">二、核心功能</p>
                                            <p>平台的核心功能包括：文档协作、知识管理和AI智能助手功能。</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 新版本 -->
                                <div class="version-content p-3 rounded-lg border border-line">
                                    <div class="flex items-center justify-between mb-2">
                                        <p class="font-medium">V1.2</p>
                                        <p class="text-xs text-muted">2024-07-20</p>
                                    </div>
                                    <div class="text-xs space-y-2">
                                        <div class="p-2 bg-white rounded">
                                            <p class="font-medium">一、项目概述</p>
                                            <p>本项目旨在构建一个智能协作平台，通过AI辅助提升团队知识生产和共享效率。平台将整合文档协作、知识管理和AI智能助手功能，满足企业级用户的需求。</p>
                                        </div>
                                        <div class="p-2 bg-white rounded">
                                            <p class="font-medium">二、核心功能</p>
                                            <p>平台的核心功能包括：智能协作批注系统、知识成熟度管理、AI质量助手、版本控制与历史追踪、社区驱动的质量监督以及必要的合规审核流程。</p>
                                        </div>
                                        <div class="p-2 bg-white rounded border-l-4 border-primary">
                                            <p class="font-medium">三、用户旅程</p>
                                            <p>用户旅程包括知识创建、协作编辑、AI质量检查、发布与共享、社区反馈与持续改进等阶段。</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 对比操作按钮 -->
                            <div class="mt-4 flex gap-2">
                                <button id="export-compare" class="px-3 py-2 rounded-full bg-primary text-white text-xs">导出对比报告</button>
                                <button id="accept-changes" class="px-3 py-2 rounded-full bg-white border border-line text-xs">接受所有变更</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 批注面板 -->
                    <div class="bg-surface rounded-2xl border border-line shadow-card p-4 space-y-3">
                        <div class="flex items-center justify-between">
                            <p class="font-medium">批注列表</p>
                            <span class="text-xs text-muted">共5条批注</span>
                        </div>
                        
                        <!-- 批注类型筛选 -->
                        <div class="p-2 rounded-lg bg-mist text-xs">
                            <p class="font-medium mb-2">筛选批注</p>
                            <div class="flex flex-wrap gap-2">
                                <button class="filter-btn px-2 py-1 rounded-full bg-white border border-line active">全部</button>
                                <button class="filter-btn px-2 py-1 rounded-full bg-white border border-line" data-type="question">疑问</button>
                                <button class="filter-btn px-2 py-1 rounded-full bg-white border border-line" data-type="suggestion">建议</button>
                                <button class="filter-btn px-2 py-1 rounded-full bg-white border border-line" data-type="error">错误</button>
                                <button class="filter-btn px-2 py-1 rounded-full bg-white border border-line" data-type="praise">赞赏</button>
                            </div>
                        </div>
                        
                        <!-- 批注状态筛选 -->
                        <div class="p-2 rounded-lg bg-mist text-xs">
                            <p class="font-medium mb-2">状态筛选</p>
                            <div class="flex flex-wrap gap-2">
                                <button class="status-btn px-2 py-1 rounded-full bg-white border border-line active">全部</button>
                                <button class="status-btn px-2 py-1 rounded-full bg-white border border-line" data-status="pending">待处理</button>
                                <button class="status-btn px-2 py-1 rounded-full bg-white border border-line" data-status="processing">处理中</button>
                                <button class="status-btn px-2 py-1 rounded-full bg-white border border-line" data-status="accepted">已采纳</button>
                                <button class="status-btn px-2 py-1 rounded-full bg-white border border-line" data-status="rejected">不采纳</button>
                            </div>
                        </div>
                        
                        <!-- 批注列表 -->
                        <div class="space-y-3 text-xs max-h-[500px] overflow-y-auto scrollbar-hide">
                            <!-- 错误批注 -->
                            <div class="comment-item p-3 rounded-xl bg-white border border-line" data-type="error" data-status="pending">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-2">
                                        <img src="https://p3-doubao-search-sign.byteimg.com/pgc-image/6323b43dac9b41db978bffd8c580ac63~tplv-be4g95zd3a-image.jpeg?lk3s=feb11e32&x-expires=1783481830&x-signature=E%2BA4UNzvvjJgdRQb3RrhhengBCo%3D" alt="用户头像" class="w-6 h-6 rounded-full">
                                        <div>
                                            <p class="font-medium">李强 · 技术总监</p>
                                            <p class="text-muted">3小时前</p>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-1">
                                        <span class="px-2 py-1 rounded-full bg-danger/20 text-danger text-[10px]">错误</span>
                                        <span class="px-2 py-1 rounded-full bg-danger/20 text-danger text-[10px]">待处理</span>
                                    </div>
                                </div>
                                <p class="mt-2">Q2数据未标注出处，请补充。</p>
                                <div class="mt-2">
                                    <p class="text-muted">段落 1：项目概述</p>
                                </div>
                                <div class="mt-2 flex gap-2">
                                    <button class="p-1 bg-primary text-white rounded text-xs" title="采纳" onclick="updateCommentStatus(this, 'accepted')"><i class="fa fa-check"></i></button>
                                    <button class="p-1 bg-danger text-white rounded text-xs" title="不采纳" onclick="updateCommentStatus(this, 'rejected')"><i class="fa fa-times"></i></button>
                                    <button class="p-1 bg-ocean text-primary rounded text-xs" title="回复" onclick="replyToComment(this)"><i class="fa fa-reply"></i></button>
                                </div>
                            </div>
                            
                            <!-- 建议批注 -->
                            <div class="comment-item p-3 rounded-xl bg-white border border-line" data-type="suggestion" data-status="pending">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-2">
                                        <img src="https://p26-doubao-search-sign.byteimg.com/tos-cn-i-be4g95zd3a/915302335932530804~tplv-be4g95zd3a-image.jpeg?lk3s=feb11e32&x-expires=1783481830&x-signature=JyYZRLlBDe3i3%2BTpop49sMGhR8g%3D" alt="用户头像" class="w-6 h-6 rounded-full">
                                        <div>
                                            <p class="font-medium">王晓华 · 市场分析师</p>
                                            <p class="text-muted">5小时前</p>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-1">
                                        <span class="px-2 py-1 rounded-full bg-warning/20 text-warning text-[10px]">建议</span>
                                        <span class="px-2 py-1 rounded-full bg-warning/20 text-warning text-[10px]">待确认</span>
                                    </div>
                                </div>
                                <p class="mt-2">建议新增“用户反馈”章节，收集用户使用体验数据。</p>
                                <div class="mt-2">
                                    <p class="text-muted">段落 2：核心功能</p>
                                </div>
                                <div class="mt-2 flex gap-2">
                                    <button class="p-1 bg-primary text-white rounded text-xs" title="采纳" onclick="updateCommentStatus(this, 'accepted')"><i class="fa fa-check"></i></button>
                                    <button class="p-1 bg-danger text-white rounded text-xs" title="不采纳" onclick="updateCommentStatus(this, 'rejected')"><i class="fa fa-times"></i></button>
                                    <button class="p-1 bg-ocean text-primary rounded text-xs" title="回复" onclick="replyToComment(this)"><i class="fa fa-reply"></i></button>
                                </div>
                            </div>
                            
                            <!-- 已采纳的建议 -->
                            <div class="comment-item p-3 rounded-xl bg-white border border-line" data-type="suggestion" data-status="accepted">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-2">
                                        <img src="https://p3-doubao-search-sign.byteimg.com/tos-cn-i-be4g95zd3a/917290012437381132~tplv-be4g95zd3a-image.jpeg?lk3s=feb11e32&x-expires=1783481830&x-signature=eE%2BzXl7cx1IbWn6x2FmQTE6dhr8%3D" alt="用户头像" class="w-6 h-6 rounded-full">
                                        <div>
                                            <p class="font-medium">赵静 · 设计师</p>
                                            <p class="text-muted">1天前</p>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-1">
                                        <span class="px-2 py-1 rounded-full bg-warning/20 text-warning text-[10px]">建议</span>
                                        <span class="px-2 py-1 rounded-full bg-success/20 text-success text-[10px]">已采纳</span>
                                    </div>
                                </div>
                                <p class="mt-2">建议优化文档结构，将“核心功能”章节移到前面。</p>
                                <div class="mt-2">
                                    <p class="text-muted">段落 2：核心功能</p>
                                </div>
                                <div class="mt-2 flex gap-2">
                                    <button class="p-1 bg-ocean text-primary rounded text-xs" title="回复" onclick="replyToComment(this)"><i class="fa fa-reply"></i></button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 添加批注按钮 -->
                        <button class="w-full px-3 py-2 rounded-full bg-secondary text-white text-xs" onclick="openNewCommentForm()">添加新批注</button>
                    </div>
                </div>
            </div>

            <!-- 用户反馈与评分功能 -->
            <div id="user-feedback" class="fixed bottom-6 right-6 bg-white rounded-2xl border border-line shadow-lg p-4 w-80">
                <div class="flex items-center justify-between mb-3">
                    <p class="font-medium">知识质量反馈</p>
                    <button id="close-feedback" class="text-muted"><i class="fa fa-times"></i></button>
                </div>
                
                <!-- 五星评分 -->
                <div class="mb-4">
                    <p class="text-sm mb-2">请为当前知识质量评分</p>
                    <div class="flex items-center gap-1" id="star-rating">
                        <span class="star" data-rating="1"><i class="fa fa-star-o text-muted text-lg cursor-pointer"></i></span>
                        <span class="star" data-rating="2"><i class="fa fa-star-o text-muted text-lg cursor-pointer"></i></span>
                        <span class="star" data-rating="3"><i class="fa fa-star-o text-muted text-lg cursor-pointer"></i></span>
                        <span class="star" data-rating="4"><i class="fa fa-star-o text-muted text-lg cursor-pointer"></i></span>
                        <span class="star" data-rating="5"><i class="fa fa-star-o text-muted text-lg cursor-pointer"></i></span>
                    </div>
                    <p id="rating-text" class="text-xs text-muted mt-1">请选择评分</p>
                </div>
                
                <!-- 快速反馈按钮 -->
                <div class="mb-4">
                    <p class="text-sm mb-2">快速反馈</p>
                    <div class="flex flex-wrap gap-2">
                        <button class="quick-feedback-btn px-3 py-1 rounded-full bg-success/20 text-success text-xs">内容很有帮助</button>
                        <button class="quick-feedback-btn px-3 py-1 rounded-full bg-danger/20 text-danger text-xs">内容有误</button>
                        <button class="quick-feedback-btn px-3 py-1 rounded-full bg-warning/20 text-warning text-xs">需要更新</button>
                        <button class="quick-feedback-btn px-3 py-1 rounded-full bg-primary/20 text-primary text-xs">格式混乱</button>
                        <button class="quick-feedback-btn px-3 py-1 rounded-full bg-secondary/20 text-secondary text-xs">术语不规范</button>
                    </div>
                </div>
                
                <!-- 详细反馈表单 -->
                <div class="mb-4">
                    <p class="text-sm mb-2">详细反馈</p>
                    <textarea id="feedback-content" class="w-full border border-line rounded-lg px-3 py-2 text-sm" rows="3" placeholder="请输入您的详细反馈和建议..."></textarea>
                </div>
                
                <!-- 提交按钮 -->
                <button id="submit-feedback" class="w-full px-3 py-2 rounded-full bg-primary text-white text-xs">提交反馈</button>
            </div>

            <!-- 快速反馈悬浮按钮 -->
            <button id="quick-feedback-btn" class="fixed bottom-6 right-6 bg-secondary text-white w-12 h-12 rounded-full shadow-lg flex items-center justify-center">
                <i class="fa fa-comment"></i>
            </button>

            <div id="page-settings" class="page flex flex-col gap-6 h-[calc(100vh-120px)] overflow-auto">
                <div>
                    <h2 class="text-2xl font-display font-semibold">系统设置与管理</h2>
                    <p class="text-sm text-muted">个性化体验与管理控制中心</p>
                </div>
                <div class="bg-surface rounded-2xl border border-line shadow-card p-4">
                    <div class="flex flex-wrap gap-2 mb-4">
                        <button class="tab-btn px-3 py-2 rounded-full text-sm bg-primary text-white" data-tab="profile">个人设置中心</button>
                        <button class="tab-btn px-3 py-2 rounded-full text-sm bg-white border border-line" data-tab="team-admin">团队管理中心</button>
                        <button class="tab-btn px-3 py-2 rounded-full text-sm bg-white border border-line" data-tab="system-admin">系统管理后台</button>
                        <button class="tab-btn px-3 py-2 rounded-full text-sm bg-white border border-line" data-tab="security">安全与合规中心</button>
                    </div>
                    <div id="tab-profile" class="tab-panel active">
                        <!-- 账户与个人资料管理 -->
                        <div class="bg-white rounded-xl border border-line p-4 mb-4">
                            <h3 class="font-medium text-lg mb-3">账户与个人资料管理</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block mt-3 text-xs text-muted">姓名</label>
                                    <input class="w-full border border-line rounded-lg px-3 py-2 text-sm" value="张明">
                                </div>
                                <div>
                                    <label class="block mt-3 text-xs text-muted">昵称</label>
                                    <input class="w-full border border-line rounded-lg px-3 py-2 text-sm" value="小明">
                                </div>
                                <div>
                                    <label class="block mt-3 text-xs text-muted">电子邮箱</label>
                                    <input class="w-full border border-line rounded-lg px-3 py-2 text-sm" value="zhangming@company.com" readonly>
                                </div>
                                <div>
                                    <label class="block mt-3 text-xs text-muted">职位</label>
                                    <input class="w-full border border-line rounded-lg px-3 py-2 text-sm" value="产品经理">
                                </div>
                                <div>
                                    <label class="block mt-3 text-xs text-muted">所属部门</label>
                                    <select class="w-full border border-line rounded-lg px-3 py-2 text-sm">
                                        <option>产品部</option>
                                        <option>研发部</option>
                                        <option>市场部</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block mt-3 text-xs text-muted">联系电话</label>
                                    <input class="w-full border border-line rounded-lg px-3 py-2 text-sm" value="13800138000">
                                </div>
                                <div class="md:col-span-2">
                                    <label class="block mt-3 text-xs text-muted">个人简介</label>
                                    <textarea class="w-full border border-line rounded-lg px-3 py-2 text-sm" rows="3">专注于用户体验设计与产品创新，拥有5年互联网产品经验。</textarea>
                                </div>
                                <div class="md:col-span-2">
                                    <label class="block mt-3 text-xs text-muted">头像</label>
                                    <div class="flex items-center gap-3 mt-2">
                                        <div class="w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center">
                                            <span class="text-primary">张</span>
                                        </div>
                                        <button class="px-3 py-1 rounded-lg bg-white border border-line text-sm">上传头像</button>
                                    </div>
                                </div>
                                <div class="md:col-span-2">
                                    <label class="block mt-3 text-xs text-muted">密码管理</label>
                                    <button class="mt-2 px-3 py-1 rounded-lg bg-white border border-line text-sm">修改密码</button>
                                    <button class="ml-2 px-3 py-1 rounded-lg bg-white border border-line text-sm">配置两步验证</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 界面与交互偏好 -->
                        <div class="bg-white rounded-xl border border-line p-4 mb-4">
                            <h3 class="font-medium text-lg mb-3">界面与交互偏好</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block mt-3 text-xs text-muted">主题模式</label>
                                    <select class="w-full border border-line rounded-lg px-3 py-2 text-sm">
                                        <option>浅色</option>
                                        <option>深色</option>
                                        <option>跟随系统</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block mt-3 text-xs text-muted">默认布局</label>
                                    <select class="w-full border border-line rounded-lg px-3 py-2 text-sm">
                                        <option>对话优先</option>
                                        <option>任务面板优先</option>
                                        <option>工作台视图</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block mt-3 text-xs text-muted">语言设置</label>
                                    <select class="w-full border border-line rounded-lg px-3 py-2 text-sm">
                                        <option>简体中文</option>
                                        <option>English</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block mt-3 text-xs text-muted">日期格式</label>
                                    <select class="w-full border border-line rounded-lg px-3 py-2 text-sm">
                                        <option>YYYY-MM-DD</option>
                                        <option>DD/MM/YYYY</option>
                                    </select>
                                </div>
                                <div class="md:col-span-2">
                                    <label class="block mt-3 text-xs text-muted">快捷操作面板</label>
                                    <div class="grid grid-cols-2 md:grid-cols-4 gap-2 mt-2">
                                        <label class="flex items-center gap-2 p-2 rounded-lg border border-line text-sm cursor-pointer">
                                            <input type="checkbox" checked> 新建文档
                                        </label>
                                        <label class="flex items-center gap-2 p-2 rounded-lg border border-line text-sm cursor-pointer">
                                            <input type="checkbox" checked> 新建会议
                                        </label>
                                        <label class="flex items-center gap-2 p-2 rounded-lg border border-line text-sm cursor-pointer">
                                            <input type="checkbox"> 发起讨论
                                        </label>
                                        <label class="flex items-center gap-2 p-2 rounded-lg border border-line text-sm cursor-pointer">
                                            <input type="checkbox"> 智能搜索
                                        </label>
                                    </div>
                                </div>
                                <div class="md:col-span-2">
                                    <label class="block mt-3 text-xs text-muted">界面元素大小</label>
                                    <div class="flex items-center gap-4 mt-2">
                                        <label class="flex items-center gap-1 text-sm cursor-pointer">
                                            <input type="radio" name="ui-size" checked> 标准
                                        </label>
                                        <label class="flex items-center gap-1 text-sm cursor-pointer">
                                            <input type="radio" name="ui-size"> 紧凑
                                        </label>
                                        <label class="flex items-center gap-1 text-sm cursor-pointer">
                                            <input type="radio" name="ui-size"> 宽松
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 通知与提醒配置 -->
                        <div class="bg-white rounded-xl border border-line p-4 mb-4">
                            <h3 class="font-medium text-lg mb-3">通知与提醒配置</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-xs text-muted mb-2">通知渠道</label>
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                                        <label class="flex items-center gap-2 p-3 rounded-lg border border-line text-sm cursor-pointer">
                                            <input type="checkbox" checked> 站内消息
                                        </label>
                                        <label class="flex items-center gap-2 p-3 rounded-lg border border-line text-sm cursor-pointer">
                                            <input type="checkbox" checked> 电子邮件
                                        </label>
                                        <label class="flex items-center gap-2 p-3 rounded-lg border border-line text-sm cursor-pointer">
                                            <input type="checkbox"> 短信提醒
                                        </label>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-xs text-muted mb-2">通知类型</label>
                                    <div class="space-y-2">
                                        <label class="flex items-center justify-between p-3 rounded-lg border border-line text-sm cursor-pointer">
                                            <span>任务分配与提醒</span>
                                            <input type="checkbox" checked>
                                        </label>
                                        <label class="flex items-center justify-between p-3 rounded-lg border border-line text-sm cursor-pointer">
                                            <span>文档更新与共享</span>
                                            <input type="checkbox" checked>
                                        </label>
                                        <label class="flex items-center justify-between p-3 rounded-lg border border-line text-sm cursor-pointer">
                                            <span>会议与日历提醒</span>
                                            <input type="checkbox" checked>
                                        </label>
                                        <label class="flex items-center justify-between p-3 rounded-lg border border-line text-sm cursor-pointer">
                                            <span>系统公告与更新</span>
                                            <input type="checkbox" checked>
                                        </label>
                                        <label class="flex items-center justify-between p-3 rounded-lg border border-line text-sm cursor-pointer">
                                            <span>智能助手建议</span>
                                            <input type="checkbox">
                                        </label>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-xs text-muted mb-2">提醒时间设置</label>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-xs text-muted mt-2">会议提醒</label>
                                            <select class="w-full border border-line rounded-lg px-3 py-2 text-sm">
                                                <option>会议开始前15分钟</option>
                                                <option>会议开始前30分钟</option>
                                                <option>会议开始前1小时</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-xs text-muted mt-2">任务截止提醒</label>
                                            <select class="w-full border border-line rounded-lg px-3 py-2 text-sm">
                                                <option>截止前24小时</option>
                                                <option>截止前48小时</option>
                                                <option>截止前72小时</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-xs text-muted mb-2">勿扰模式</label>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="flex items-center gap-2 text-sm cursor-pointer">
                                                <input type="checkbox" checked> 启用勿扰模式
                                            </label>
                                        </div>
                                        <div>
                                            <label class="block text-xs text-muted mt-2">勿扰时段</label>
                                            <div class="flex items-center gap-2">
                                                <input type="time" value="18:00" class="border border-line rounded-lg px-2 py-1 text-sm">
                                                <span>至</span>
                                                <input type="time" value="08:00" class="border border-line rounded-lg px-2 py-1 text-sm">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- AI助手个性化 -->
                        <div class="bg-white rounded-xl border border-line p-4 mb-4">
                            <h3 class="font-medium text-lg mb-3">AI助手个性化</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-xs text-muted mb-2">智能助手响应风格</label>
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                                        <label class="flex items-center gap-2 p-3 rounded-lg border border-line text-sm cursor-pointer">
                                            <input type="radio" name="ai-style" checked> 专业严谨
                                        </label>
                                        <label class="flex items-center gap-2 p-3 rounded-lg border border-line text-sm cursor-pointer">
                                            <input type="radio" name="ai-style"> 简明扼要
                                        </label>
                                        <label class="flex items-center gap-2 p-3 rounded-lg border border-line text-sm cursor-pointer">
                                            <input type="radio" name="ai-style"> 详细全面
                                        </label>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-xs text-muted mb-2">智能助手知识范围</label>
                                    <div class="space-y-2">
                                        <label class="flex items-center justify-between p-3 rounded-lg border border-line text-sm cursor-pointer">
                                            <span>产品管理知识库</span>
                                            <input type="checkbox" checked>
                                        </label>
                                        <label class="flex items-center justify-between p-3 rounded-lg border border-line text-sm cursor-pointer">
                                            <span>行业动态与趋势</span>
                                            <input type="checkbox" checked>
                                        </label>
                                        <label class="flex items-center justify-between p-3 rounded-lg border border-line text-sm cursor-pointer">
                                            <span>公司内部文档</span>
                                            <input type="checkbox" checked>
                                        </label>
                                        <label class="flex items-center justify-between p-3 rounded-lg border border-line text-sm cursor-pointer">
                                            <span>竞品分析资料</span>
                                            <input type="checkbox">
                                        </label>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-xs text-muted mb-2">智能助手权限</label>
                                    <div class="space-y-2">
                                        <label class="flex items-center gap-2 p-3 rounded-lg border border-line text-sm cursor-pointer">
                                            <input type="checkbox" checked> 访问我的文档
                                        </label>
                                        <label class="flex items-center gap-2 p-3 rounded-lg border border-line text-sm cursor-pointer">
                                            <input type="checkbox"> 访问我的日历
                                        </label>
                                        <label class="flex items-center gap-2 p-3 rounded-lg border border-line text-sm cursor-pointer">
                                            <input type="checkbox"> 访问我的联系人
                                        </label>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-xs text-muted mb-2">智能助手快捷指令</label>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                        <div>
                                            <label class="block text-xs text-muted mt-2">指令1</label>
                                            <input class="w-full border border-line rounded-lg px-3 py-2 text-sm" placeholder="输入快捷指令...">
                                        </div>
                                        <div>
                                            <label class="block text-xs text-muted mt-2">指令2</label>
                                            <input class="w-full border border-line rounded-lg px-3 py-2 text-sm" placeholder="输入快捷指令...">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 数据与隐私 -->
                        <div class="bg-white rounded-xl border border-line p-4">
                            <h3 class="font-medium text-lg mb-3">数据与隐私</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-xs text-muted mb-2">个人数据管理</label>
                                    <div class="space-y-2">
                                        <label class="flex items-center justify-between p-3 rounded-lg border border-line text-sm cursor-pointer">
                                            <span>允许系统分析我的使用习惯</span>
                                            <input type="checkbox" checked>
                                        </label>
                                        <label class="flex items-center justify-between p-3 rounded-lg border border-line text-sm cursor-pointer">
                                            <span>允许AI助手学习我的偏好</span>
                                            <input type="checkbox" checked>
                                        </label>
                                        <label class="flex items-center justify-between p-3 rounded-lg border border-line text-sm cursor-pointer">
                                            <span>分享使用数据用于产品改进</span>
                                            <input type="checkbox">
                                        </label>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-xs text-muted mb-2">隐私设置</label>
                                    <div class="space-y-2">
                                        <label class="flex items-center justify-between p-3 rounded-lg border border-line text-sm cursor-pointer">
                                            <span>允许他人查看我的在线状态</span>
                                            <input type="checkbox" checked>
                                        </label>
                                        <label class="flex items-center justify-between p-3 rounded-lg border border-line text-sm cursor-pointer">
                                            <span>允许他人查看我的个人资料</span>
                                            <input type="checkbox" checked>
                                        </label>
                                        <label class="flex items-center justify-between p-3 rounded-lg border border-line text-sm cursor-pointer">
                                            <span>允许他人邀请我加入团队</span>
                                            <input type="checkbox" checked>
                                        </label>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-xs text-muted mb-2">数据导出与删除</label>
                                    <div class="flex items-center gap-3 mt-2">
                                        <button class="px-3 py-1 rounded-lg bg-white border border-line text-sm">导出个人数据</button>
                                        <button class="px-3 py-1 rounded-lg bg-white border border-line text-sm">申请账户删除</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="tab-team-admin" class="tab-panel">
                        <!-- 团队成员管理 -->
                        <div class="bg-white rounded-xl border border-line p-4 mb-4">
                            <h3 class="font-medium text-lg mb-3">团队成员管理</h3>
                            <div class="flex flex-wrap items-center justify-between gap-3 mb-4">
                                <div class="flex-1 max-w-md">
                                    <input class="w-full border border-line rounded-lg px-3 py-2 text-sm" placeholder="搜索团队成员">
                                </div>
                                <button class="px-3 py-1 rounded-lg bg-primary text-white text-sm">邀请成员</button>
                                <button class="px-3 py-1 rounded-lg bg-white border border-line text-sm">批量导入</button>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm">
                                    <thead>
                                        <tr class="border-b border-line">
                                            <th class="text-left py-2 px-3 font-medium">姓名</th>
                                            <th class="text-left py-2 px-3 font-medium">职位</th>
                                            <th class="text-left py-2 px-3 font-medium">部门</th>
                                            <th class="text-left py-2 px-3 font-medium">角色</th>
                                            <th class="text-left py-2 px-3 font-medium">状态</th>
                                            <th class="text-left py-2 px-3 font-medium">操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr class="border-b border-line">
                                            <td class="py-2 px-3">李强</td>
                                            <td class="py-2 px-3">团队主管</td>
                                            <td class="py-2 px-3">产品部</td>
                                            <td class="py-2 px-3">Admin</td>
                                            <td class="py-2 px-3">
                                                <span class="inline-block w-2 h-2 rounded-full bg-success mr-1"></span>
                                                在线
                                            </td>
                                            <td class="py-2 px-3">
                                                <button class="text-xs text-secondary mr-2">调整权限</button>
                                                <button class="text-xs text-danger">移除</button>
                                            </td>
                                        </tr>
                                        <tr class="border-b border-line">
                                            <td class="py-2 px-3">王晓华</td>
                                            <td class="py-2 px-3">市场分析师</td>
                                            <td class="py-2 px-3">市场部</td>
                                            <td class="py-2 px-3">Editor</td>
                                            <td class="py-2 px-3">
                                                <span class="inline-block w-2 h-2 rounded-full bg-success mr-1"></span>
                                                在线
                                            </td>
                                            <td class="py-2 px-3">
                                                <button class="text-xs text-secondary mr-2">调整权限</button>
                                                <button class="text-xs text-danger">移除</button>
                                            </td>
                                        </tr>
                                        <tr class="border-b border-line">
                                            <td class="py-2 px-3">张明</td>
                                            <td class="py-2 px-3">产品经理</td>
                                            <td class="py-2 px-3">产品部</td>
                                            <td class="py-2 px-3">Editor</td>
                                            <td class="py-2 px-3">
                                                <span class="inline-block w-2 h-2 rounded-full bg-success mr-1"></span>
                                                在线
                                            </td>
                                            <td class="py-2 px-3">
                                                <button class="text-xs text-secondary mr-2">调整权限</button>
                                                <button class="text-xs text-danger">移除</button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="mt-4 text-xs text-muted text-center">共 3 名团队成员</div>
                        </div>
                        
                        <!-- 团队空间权限管理 -->
                        <div class="bg-white rounded-xl border border-line p-4 mb-4">
                            <h3 class="font-medium text-lg mb-3">团队空间权限管理</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs text-muted mb-2">团队空间</label>
                                    <select class="w-full border border-line rounded-lg px-3 py-2 text-sm">
                                        <option>产品部团队空间</option>
                                        <option>研发部团队空间</option>
                                        <option>市场部团队空间</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-xs text-muted mb-2">权限模板</label>
                                    <select class="w-full border border-line rounded-lg px-3 py-2 text-sm">
                                        <option>完全访问</option>
                                        <option>编辑权限</option>
                                        <option>只读权限</option>
                                    </select>
                                </div>
                            </div>
                            <div class="mt-4">
                                <label class="block text-xs text-muted mb-2">细粒度权限控制</label>
                                <div class="space-y-2">
                                    <label class="flex items-center justify-between p-3 rounded-lg border border-line text-sm cursor-pointer">
                                        <span>创建文档</span>
                                        <input type="checkbox" checked>
                                    </label>
                                    <label class="flex items-center justify-between p-3 rounded-lg border border-line text-sm cursor-pointer">
                                        <span>编辑文档</span>
                                        <input type="checkbox" checked>
                                    </label>
                                    <label class="flex items-center justify-between p-3 rounded-lg border border-line text-sm cursor-pointer">
                                        <span>删除文档</span>
                                        <input type="checkbox" checked>
                                    </label>
                                    <label class="flex items-center justify-between p-3 rounded-lg border border-line text-sm cursor-pointer">
                                        <span>分享文档</span>
                                        <input type="checkbox">
                                    </label>
                                    <label class="flex items-center justify-between p-3 rounded-lg border border-line text-sm cursor-pointer">
                                        <span>管理团队成员</span>
                                        <input type="checkbox">
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 团队工具与资源配置 -->
                        <div class="bg-white rounded-xl border border-line p-4 mb-4">
                            <h3 class="font-medium text-lg mb-3">团队工具与资源配置</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-xs text-muted mb-2">集成工具管理</label>
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                                        <div class="p-3 rounded-lg border border-line">
                                            <div class="flex items-center justify-between mb-2">
                                                <span class="text-sm">文档管理</span>
                                                <span class="text-xs px-1 py-0.5 rounded-full bg-success/20 text-success">已启用</span>
                                            </div>
                                            <button class="w-full px-2 py-1 rounded-lg bg-white border border-line text-xs">配置</button>
                                        </div>
                                        <div class="p-3 rounded-lg border border-line">
                                            <div class="flex items-center justify-between mb-2">
                                                <span class="text-sm">会议系统</span>
                                                <span class="text-xs px-1 py-0.5 rounded-full bg-success/20 text-success">已启用</span>
                                            </div>
                                            <button class="w-full px-2 py-1 rounded-lg bg-white border border-line text-xs">配置</button>
                                        </div>
                                        <div class="p-3 rounded-lg border border-line">
                                            <div class="flex items-center justify-between mb-2">
                                                <span class="text-sm">代码仓库</span>
                                                <span class="text-xs px-1 py-0.5 rounded-full bg-danger/20 text-danger">未启用</span>
                                            </div>
                                            <button class="w-full px-2 py-1 rounded-lg bg-white border border-line text-xs">启用</button>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-xs text-muted mb-2">资源分配</label>
                                    <div class="space-y-2">
                                        <div class="flex items-center justify-between p-3 rounded-lg border border-line">
                                            <span class="text-sm">存储空间</span>
                                            <div class="text-sm">
                                                <span class="text-primary">12.5GB</span> / 20GB
                                            </div>
                                        </div>
                                        <div class="flex items-center justify-between p-3 rounded-lg border border-line">
                                            <span class="text-sm">AI计算资源</span>
                                            <div class="text-sm">
                                                <span class="text-primary">3.2万次</span> / 5万次
                                            </div>
                                        </div>
                                        <div class="flex items-center justify-between p-3 rounded-lg border border-line">
                                            <span class="text-sm">团队智能体数量</span>
                                            <div class="text-sm">
                                                <span class="text-primary">8个</span> / 10个
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 团队数据看板 -->
                        <div class="bg-white rounded-xl border border-line p-4">
                            <h3 class="font-medium text-lg mb-3">团队数据看板</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-4">
                                <div class="p-3 rounded-lg bg-mist text-center">
                                    <p class="text-2xl font-medium text-primary">15</p>
                                    <p class="text-xs text-muted mt-1">团队成员数</p>
                                </div>
                                <div class="p-3 rounded-lg bg-mist text-center">
                                    <p class="text-2xl font-medium text-primary">42</p>
                                    <p class="text-xs text-muted mt-1">本月创建文档</p>
                                </div>
                                <div class="p-3 rounded-lg bg-mist text-center">
                                    <p class="text-2xl font-medium text-primary">89%</p>
                                    <p class="text-xs text-muted mt-1">任务完成率</p>
                                </div>
                            </div>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-xs text-muted mb-2">团队活跃度趋势</label>
                                    <div class="h-24 bg-mist rounded-lg flex items-end justify-around px-2">
                                        <div class="w-8 bg-primary rounded-t-md" style="height: 60%"></div>
                                        <div class="w-8 bg-primary rounded-t-md" style="height: 85%"></div>
                                        <div class="w-8 bg-primary rounded-t-md" style="height: 75%"></div>
                                        <div class="w-8 bg-primary rounded-t-md" style="height: 90%"></div>
                                        <div class="w-8 bg-primary rounded-t-md" style="height: 80%"></div>
                                        <div class="w-8 bg-primary rounded-t-md" style="height: 95%"></div>
                                        <div class="w-8 bg-primary rounded-t-md" style="height: 100%"></div>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-xs text-muted mb-2">成员贡献排行</label>
                                    <div class="space-y-2">
                                        <div class="flex items-center justify-between p-2 rounded-lg bg-mist text-sm">
                                            <span>李强</span>
                                            <span class="text-primary">28次贡献</span>
                                        </div>
                                        <div class="flex items-center justify-between p-2 rounded-lg bg-mist text-sm">
                                            <span>王晓华</span>
                                            <span class="text-primary">22次贡献</span>
                                        </div>
                                        <div class="flex items-center justify-between p-2 rounded-lg bg-mist text-sm">
                                            <span>张明</span>
                                            <span class="text-primary">18次贡献</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="tab-system-admin" class="tab-panel">
                        <!-- 系统监控与运维 -->
                        <div class="bg-white rounded-xl border border-line p-4 mb-4">
                            <h3 class="font-medium text-lg mb-3">系统监控与运维</h3>
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-3 mb-4">
                                <div class="p-3 rounded-lg bg-mist">
                                    <p class="text-xs text-muted">CPU使用率</p>
                                    <p class="text-xl font-medium text-primary">45%</p>
                                </div>
                                <div class="p-3 rounded-lg bg-mist">
                                    <p class="text-xs text-muted">内存使用率</p>
                                    <p class="text-xl font-medium text-primary">62%</p>
                                </div>
                                <div class="p-3 rounded-lg bg-mist">
                                    <p class="text-xs text-muted">API P95延迟</p>
                                    <p class="text-xl font-medium text-primary">320ms</p>
                                </div>
                                <div class="p-3 rounded-lg bg-mist">
                                    <p class="text-xs text-muted">并发用户数</p>
                                    <p class="text-xl font-medium text-primary">820</p>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs text-muted mb-2">系统状态</label>
                                    <div class="space-y-2">
                                        <div class="flex items-center justify-between p-2 rounded-lg bg-white border border-line text-sm">
                                            <span>API服务</span>
                                            <span class="text-xs px-1 py-0.5 rounded-full bg-success/20 text-success">正常</span>
                                        </div>
                                        <div class="flex items-center justify-between p-2 rounded-lg bg-white border border-line text-sm">
                                            <span>数据库</span>
                                            <span class="text-xs px-1 py-0.5 rounded-full bg-success/20 text-success">正常</span>
                                        </div>
                                        <div class="flex items-center justify-between p-2 rounded-lg bg-white border border-line text-sm">
                                            <span>AI计算引擎</span>
                                            <span class="text-xs px-1 py-0.5 rounded-full bg-warning/20 text-warning">负载高</span>
                                        </div>
                                        <div class="flex items-center justify-between p-2 rounded-lg bg-white border border-line text-sm">
                                            <span>存储服务</span>
                                            <span class="text-xs px-1 py-0.5 rounded-full bg-success/20 text-success">正常</span>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-xs text-muted mb-2">系统日志</label>
                                    <div class="h-32 bg-mist rounded-lg p-3 overflow-y-auto text-xs">
                                        <div class="mb-1">[2024-01-17 10:30:21] INFO: 用户登录 - 张明</div>
                                        <div class="mb-1">[2024-01-17 10:29:45] ERROR: API请求失败 - /api/docs/12345</div>
                                        <div class="mb-1">[2024-01-17 10:28:12] INFO: 系统备份完成</div>
                                        <div class="mb-1">[2024-01-17 10:27:33] WARNING: 存储空间使用率超过80%</div>
                                        <div class="mb-1">[2024-01-17 10:26:15] INFO: 智能体部署 - 合同审查官</div>
                                    </div>
                                    <button class="w-full mt-2 px-2 py-1 rounded-lg bg-white border border-line text-xs">查看完整日志</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 用户与组织管理 -->
                        <div class="bg-white rounded-xl border border-line p-4 mb-4">
                            <h3 class="font-medium text-lg mb-3">用户与组织管理</h3>
                            <div class="flex flex-wrap items-center justify-between gap-3 mb-4">
                                <div class="flex-1 max-w-md">
                                    <input class="w-full border border-line rounded-lg px-3 py-2 text-sm" placeholder="搜索用户或组织">
                                </div>
                                <button class="px-3 py-1 rounded-lg bg-primary text-white text-sm">创建用户</button>
                                <button class="px-3 py-1 rounded-lg bg-white border border-line text-sm">创建组织</button>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs text-muted mb-2">用户管理</label>
                                    <div class="h-32 bg-mist rounded-lg p-3 overflow-y-auto text-xs">
                                        <div class="flex items-center justify-between mb-2 p-1 rounded bg-white">
                                            <span>张明</span>
                                            <span class="text-xs text-secondary">产品部</span>
                                        </div>
                                        <div class="flex items-center justify-between mb-2 p-1 rounded bg-white">
                                            <span>李强</span>
                                            <span class="text-xs text-secondary">研发部</span>
                                        </div>
                                        <div class="flex items-center justify-between mb-2 p-1 rounded bg-white">
                                            <span>王晓华</span>
                                            <span class="text-xs text-secondary">市场部</span>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-xs text-muted mb-2">组织管理</label>
                                    <div class="h-32 bg-mist rounded-lg p-3 overflow-y-auto text-xs">
                                        <div class="flex items-center justify-between mb-2 p-1 rounded bg-white">
                                            <span>产品部</span>
                                            <span class="text-xs text-secondary">12人</span>
                                        </div>
                                        <div class="flex items-center justify-between mb-2 p-1 rounded bg-white">
                                            <span>研发部</span>
                                            <span class="text-xs text-secondary">25人</span>
                                        </div>
                                        <div class="flex items-center justify-between mb-2 p-1 rounded bg-white">
                                            <span>市场部</span>
                                            <span class="text-xs text-secondary">8人</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 全局权限与角色管理 -->
                        <div class="bg-white rounded-xl border border-line p-4 mb-4">
                            <h3 class="font-medium text-lg mb-3">全局权限与角色管理</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs text-muted mb-2">角色管理</label>
                                    <div class="space-y-2">
                                        <div class="flex items-center justify-between p-2 rounded-lg bg-mist text-sm">
                                            <span>系统管理员</span>
                                            <button class="text-xs text-secondary">编辑</button>
                                        </div>
                                        <div class="flex items-center justify-between p-2 rounded-lg bg-mist text-sm">
                                            <span>知识管理员</span>
                                            <button class="text-xs text-secondary">编辑</button>
                                        </div>
                                        <div class="flex items-center justify-between p-2 rounded-lg bg-mist text-sm">
                                            <span>团队Leader</span>
                                            <button class="text-xs text-secondary">编辑</button>
                                        </div>
                                        <div class="flex items-center justify-between p-2 rounded-lg bg-mist text-sm">
                                            <span>普通员工</span>
                                            <button class="text-xs text-secondary">编辑</button>
                                        </div>
                                    </div>
                                    <button class="w-full mt-2 px-2 py-1 rounded-lg bg-white border border-line text-xs">创建新角色</button>
                                </div>
                                <div>
                                    <label class="block text-xs text-muted mb-2">权限管理</label>
                                    <div class="space-y-2">
                                        <div class="p-2 rounded-lg bg-mist text-sm">
                                            <div class="font-medium mb-1">系统管理权限</div>
                                            <div class="text-xs text-muted">用户管理、系统配置、数据备份</div>
                                        </div>
                                        <div class="p-2 rounded-lg bg-mist text-sm">
                                            <div class="font-medium mb-1">知识库权限</div>
                                            <div class="text-xs text-muted">文档创建、编辑、删除、分享</div>
                                        </div>
                                        <div class="p-2 rounded-lg bg-mist text-sm">
                                            <div class="font-medium mb-1">智能体权限</div>
                                            <div class="text-xs text-muted">智能体创建、配置、调用</div>
                                        </div>
                                    </div>
                                    <button class="w-full mt-2 px-2 py-1 rounded-lg bg-white border border-line text-xs">管理权限</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 系统配置中心 -->
                        <div class="bg-white rounded-xl border border-line p-4 mb-4">
                            <h3 class="font-medium text-lg mb-3">系统配置中心</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs text-muted mb-2">基础配置</label>
                                    <div class="space-y-3">
                                        <div>
                                            <label class="block text-xs text-muted mb-1">系统名称</label>
                                            <input class="w-full border border-line rounded-lg px-3 py-2 text-sm" value="智核平台">
                                        </div>
                                        <div>
                                            <label class="block text-xs text-muted mb-1">系统版本</label>
                                            <input class="w-full border border-line rounded-lg px-3 py-2 text-sm" value="v1.2.0" readonly>
                                        </div>
                                        <div>
                                            <label class="block text-xs text-muted mb-1">默认语言</label>
                                            <select class="w-full border border-line rounded-lg px-3 py-2 text-sm">
                                                <option>简体中文</option>
                                                <option>English</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-xs text-muted mb-2">功能开关</label>
                                    <div class="space-y-2">
                                        <label class="flex items-center justify-between p-2 rounded-lg border border-line text-sm cursor-pointer">
                                            <span>智能助手功能</span>
                                            <input type="checkbox" checked>
                                        </label>
                                        <label class="flex items-center justify-between p-2 rounded-lg border border-line text-sm cursor-pointer">
                                            <span>团队协作功能</span>
                                            <input type="checkbox" checked>
                                        </label>
                                        <label class="flex items-center justify-between p-2 rounded-lg border border-line text-sm cursor-pointer">
                                            <span>数据分析功能</span>
                                            <input type="checkbox">
                                        </label>
                                        <label class="flex items-center justify-between p-2 rounded-lg border border-line text-sm cursor-pointer">
                                            <span>API开放功能</span>
                                            <input type="checkbox">
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 数据管理与备份 -->
                        <div class="bg-white rounded-xl border border-line p-4">
                            <h3 class="font-medium text-lg mb-3">数据管理与备份</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs text-muted mb-2">数据备份</label>
                                    <div class="space-y-3">
                                        <div>
                                            <label class="block text-xs text-muted mb-1">备份计划</label>
                                            <select class="w-full border border-line rounded-lg px-3 py-2 text-sm">
                                                <option>每天凌晨2点</option>
                                                <option>每周日凌晨2点</option>
                                                <option>手动备份</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-xs text-muted mb-1">备份保留策略</label>
                                            <select class="w-full border border-line rounded-lg px-3 py-2 text-sm">
                                                <option>保留最近30天</option>
                                                <option>保留最近90天</option>
                                                <option>永久保留</option>
                                            </select>
                                        </div>
                                        <button class="w-full px-3 py-1 rounded-lg bg-primary text-white text-sm">立即备份</button>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-xs text-muted mb-2">备份历史</label>
                                    <div class="h-32 bg-mist rounded-lg p-3 overflow-y-auto text-xs">
                                        <div class="flex items-center justify-between mb-2 p-1 rounded bg-white">
                                            <span>2024-01-17 02:00</span>
                                            <span class="text-xs text-success">成功</span>
                                        </div>
                                        <div class="flex items-center justify-between mb-2 p-1 rounded bg-white">
                                            <span>2024-01-16 02:00</span>
                                            <span class="text-xs text-success">成功</span>
                                        </div>
                                        <div class="flex items-center justify-between mb-2 p-1 rounded bg-white">
                                            <span>2024-01-15 02:00</span>
                                            <span class="text-xs text-danger">失败</span>
                                        </div>
                                    </div>
                                    <button class="w-full mt-2 px-2 py-1 rounded-lg bg-white border border-line text-xs">恢复数据</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="tab-security" class="tab-panel">
                        <!-- 安全策略配置 -->
                        <div class="bg-white rounded-xl border border-line p-4 mb-4">
                            <h3 class="font-medium text-lg mb-3">安全策略配置</h3>
                            <div class="space-y-3">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-xs text-muted mb-2">身份认证策略</label>
                                        <div class="space-y-2">
                                            <label class="flex items-center gap-2 p-2 rounded-lg border border-line text-sm cursor-pointer">
                                                <input type="checkbox" checked> 强制两步验证
                                            </label>
                                            <label class="flex items-center gap-2 p-2 rounded-lg border border-line text-sm cursor-pointer">
                                                <input type="checkbox"> 密码复杂度要求
                                            </label>
                                            <label class="flex items-center gap-2 p-2 rounded-lg border border-line text-sm cursor-pointer">
                                                <input type="checkbox"> 定期密码重置
                                            </label>
                                            <label class="flex items-center gap-2 p-2 rounded-lg border border-line text-sm cursor-pointer">
                                                <input type="checkbox"> 单点登录(SSO)
                                            </label>
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-xs text-muted mb-2">访问控制策略</label>
                                        <div class="space-y-2">
                                            <label class="flex items-center gap-2 p-2 rounded-lg border border-line text-sm cursor-pointer">
                                                <input type="checkbox"> 开启IP白名单
                                            </label>
                                            <label class="flex items-center gap-2 p-2 rounded-lg border border-line text-sm cursor-pointer">
                                                <input type="checkbox" checked> 设备指纹识别
                                            </label>
                                            <label class="flex items-center gap-2 p-2 rounded-lg border border-line text-sm cursor-pointer">
                                                <input type="checkbox"> 会话超时设置
                                            </label>
                                            <div>
                                                <label class="block text-xs text-muted mb-1">会话超时时间</label>
                                                <select class="w-full border border-line rounded-lg px-3 py-2 text-sm">
                                                    <option>30分钟</option>
                                                    <option selected>60分钟</option>
                                                    <option>120分钟</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-xs text-muted mb-2">数据安全策略</label>
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                                        <label class="flex items-center gap-2 p-2 rounded-lg border border-line text-sm cursor-pointer">
                                            <input type="checkbox" checked> 数据传输加密
                                        </label>
                                        <label class="flex items-center gap-2 p-2 rounded-lg border border-line text-sm cursor-pointer">
                                            <input type="checkbox" checked> 数据存储加密
                                        </label>
                                        <label class="flex items-center gap-2 p-2 rounded-lg border border-line text-sm cursor-pointer">
                                            <input type="checkbox"> 敏感数据脱敏
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 安全审计与监控 -->
                        <div class="bg-white rounded-xl border border-line p-4 mb-4">
                            <h3 class="font-medium text-lg mb-3">安全审计与监控</h3>
                            <div class="flex flex-wrap items-center justify-between gap-3 mb-4">
                                <div class="flex-1 max-w-md">
                                    <input class="w-full border border-line rounded-lg px-3 py-2 text-sm" placeholder="搜索审计日志">
                                </div>
                                <div class="flex gap-2">
                                    <select class="border border-line rounded-lg px-3 py-2 text-sm">
                                        <option>全部操作类型</option>
                                        <option>登录</option>
                                        <option>权限变更</option>
                                        <option>数据访问</option>
                                    </select>
                                    <button class="px-3 py-1 rounded-lg bg-primary text-white text-sm">查询</button>
                                </div>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm">
                                    <thead>
                                        <tr class="border-b border-line">
                                            <th class="text-left py-2 px-3 font-medium">时间</th>
                                            <th class="text-left py-2 px-3 font-medium">用户</th>
                                            <th class="text-left py-2 px-3 font-medium">操作类型</th>
                                            <th class="text-left py-2 px-3 font-medium">IP地址</th>
                                            <th class="text-left py-2 px-3 font-medium">结果</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr class="border-b border-line">
                                            <td class="py-2 px-3 text-xs text-muted">2024-01-17 10:30:21</td>
                                            <td class="py-2 px-3">张明</td>
                                            <td class="py-2 px-3">登录</td>
                                            <td class="py-2 px-3">192.168.1.100</td>
                                            <td class="py-2 px-3">
                                                <span class="text-xs px-1 py-0.5 rounded-full bg-success/20 text-success">成功</span>
                                            </td>
                                        </tr>
                                        <tr class="border-b border-line">
                                            <td class="py-2 px-3 text-xs text-muted">2024-01-17 10:29:15</td>
                                            <td class="py-2 px-3">李强</td>
                                            <td class="py-2 px-3">权限变更</td>
                                            <td class="py-2 px-3">192.168.1.101</td>
                                            <td class="py-2 px-3">
                                                <span class="text-xs px-1 py-0.5 rounded-full bg-success/20 text-success">成功</span>
                                            </td>
                                        </tr>
                                        <tr class="border-b border-line">
                                            <td class="py-2 px-3 text-xs text-muted">2024-01-17 10:28:45</td>
                                            <td class="py-2 px-3">未知用户</td>
                                            <td class="py-2 px-3">登录</td>
                                            <td class="py-2 px-3">10.0.0.1</td>
                                            <td class="py-2 px-3">
                                                <span class="text-xs px-1 py-0.5 rounded-full bg-danger/20 text-danger">失败</span>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="mt-4 text-xs text-muted text-center">共 125 条审计日志</div>
                        </div>
                        
                        <!-- 数据隐私管理 -->
                        <div class="bg-white rounded-xl border border-line p-4 mb-4">
                            <h3 class="font-medium text-lg mb-3">数据隐私管理</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs text-muted mb-2">数据分类与标记</label>
                                    <div class="space-y-2">
                                        <div class="p-2 rounded-lg bg-mist text-sm">
                                            <div class="font-medium">公开数据</div>
                                            <div class="text-xs text-muted">可自由访问的数据</div>
                                        </div>
                                        <div class="p-2 rounded-lg bg-mist text-sm">
                                            <div class="font-medium">内部数据</div>
                                            <div class="text-xs text-muted">仅限内部员工访问</div>
                                        </div>
                                        <div class="p-2 rounded-lg bg-mist text-sm">
                                            <div class="font-medium">敏感数据</div>
                                            <div class="text-xs text-muted">需要特殊权限访问</div>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-xs text-muted mb-2">隐私保护设置</label>
                                    <div class="space-y-2">
                                        <label class="flex items-center justify-between p-2 rounded-lg border border-line text-sm cursor-pointer">
                                            <span>数据匿名化处理</span>
                                            <input type="checkbox" checked>
                                        </label>
                                        <label class="flex items-center justify-between p-2 rounded-lg border border-line text-sm cursor-pointer">
                                            <span>用户数据访问审计</span>
                                            <input type="checkbox" checked>
                                        </label>
                                        <label class="flex items-center justify-between p-2 rounded-lg border border-line text-sm cursor-pointer">
                                            <span>数据最小化原则</span>
                                            <input type="checkbox">
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-4">
                                <label class="block text-xs text-muted mb-2">数据主体权利管理</label>
                                <div class="flex flex-wrap gap-2">
                                    <button class="px-3 py-1 rounded-lg bg-white border border-line text-sm">数据访问请求</button>
                                    <button class="px-3 py-1 rounded-lg bg-white border border-line text-sm">数据更正请求</button>
                                    <button class="px-3 py-1 rounded-lg bg-white border border-line text-sm">数据删除请求</button>
                                    <button class="px-3 py-1 rounded-lg bg-white border border-line text-sm">数据导出请求</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 合规报告生成 -->
                        <div class="bg-white rounded-xl border border-line p-4">
                            <h3 class="font-medium text-lg mb-3">合规报告生成</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs text-muted mb-2">报告类型</label>
                                    <div class="space-y-2">
                                        <label class="flex items-center gap-2 p-2 rounded-lg border border-line text-sm cursor-pointer">
                                            <input type="checkbox"> 安全审计报告
                                        </label>
                                        <label class="flex items-center gap-2 p-2 rounded-lg border border-line text-sm cursor-pointer">
                                            <input type="checkbox"> 数据隐私合规报告
                                        </label>
                                        <label class="flex items-center gap-2 p-2 rounded-lg border border-line text-sm cursor-pointer">
                                            <input type="checkbox"> 访问控制报告
                                        </label>
                                        <label class="flex items-center gap-2 p-2 rounded-lg border border-line text-sm cursor-pointer">
                                            <input type="checkbox"> 漏洞扫描报告
                                        </label>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-xs text-muted mb-2">报告配置</label>
                                    <div class="space-y-3">
                                        <div>
                                            <label class="block text-xs text-muted mb-1">报告周期</label>
                                            <select class="w-full border border-line rounded-lg px-3 py-2 text-sm">
                                                <option>每日</option>
                                                <option>每周</option>
                                                <option selected>每月</option>
                                                <option>每季度</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-xs text-muted mb-1">报告格式</label>
                                            <select class="w-full border border-line rounded-lg px-3 py-2 text-sm">
                                                <option selected>PDF</option>
                                                <option>Excel</option>
                                                <option>JSON</option>
                                            </select>
                                        </div>
                                        <button class="w-full px-3 py-1 rounded-lg bg-primary text-white text-sm">生成报告</button>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-4">
                                <label class="block text-xs text-muted mb-2">历史报告</label>
                                <div class="h-32 bg-mist rounded-lg p-3 overflow-y-auto text-xs">
                                    <div class="flex items-center justify-between mb-2 p-1 rounded bg-white">
                                        <span>2024-01安全审计报告.pdf</span>
                                        <button class="text-xs text-primary">下载</button>
                                    </div>
                                    <div class="flex items-center justify-between mb-2 p-1 rounded bg-white">
                                        <span>2023-12隐私合规报告.pdf</span>
                                        <button class="text-xs text-primary">下载</button>
                                    </div>
                                    <div class="flex items-center justify-between mb-2 p-1 rounded bg-white">
                                        <span>2023-11访问控制报告.pdf</span>
                                        <button class="text-xs text-primary">下载</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-4 flex justify-end">
                        <button id="save-settings" class="px-4 py-2 rounded-full bg-secondary text-white text-sm">保存设置</button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <div id="search-modal" class="fixed inset-0 bg-black/40 backdrop-blur-sm hidden items-center justify-center z-40">
        <div class="bg-white rounded-2xl w-full max-w-4xl p-5 shadow-float">
            <div class="flex items-center justify-between">
                <h3 class="font-display font-semibold">全局智能搜索</h3>
                <button id="close-search" class="text-muted"><i class="fa fa-times"></i></button>
            </div>
            <div class="mt-3">
                <input type="text" class="w-full border border-line rounded-full px-4 py-2" placeholder="输入关键词或问题">
            </div>
            <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-3 text-sm">
                <div class="md:col-span-2 bg-mist rounded-xl p-3">
                    <p class="font-medium">最佳答案</p>
                    <p class="text-xs text-muted mt-2">华东区Q2销售额同比增长15.3%，主要来自渠道优化与重点客户扩展。</p>
                </div>
                <div class="bg-mist rounded-xl p-3">
                    <p class="font-medium">相关专家</p>
                    <p class="text-xs text-muted mt-2">王晓华 · 市场分析师</p>
                </div>
                <div class="bg-white rounded-xl border border-line p-3">
                    <p class="font-medium">相关文档</p>
                    <ul class="mt-2 text-xs text-muted space-y-1">
                        <li>《华东区市场趋势分析》</li>
                        <li>《渠道策略调整复盘》</li>
                    </ul>
                </div>
                <div class="bg-white rounded-xl border border-line p-3">
                    <p class="font-medium">关联实体</p>
                    <ul class="mt-2 text-xs text-muted space-y-1">
                        <li>项目：A产品</li>
                        <li>客户：XX科技</li>
                    </ul>
                </div>
                <div class="bg-white rounded-xl border border-line p-3">
                    <p class="font-medium">历史讨论</p>
                    <ul class="mt-2 text-xs text-muted space-y-1">
                        <li>销售会议纪要 · 2024/07</li>
                        <li>市场策略讨论 · 2024/06</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div id="task-board-modal" class="fixed inset-0 bg-black/40 hidden items-center justify-center z-40">
        <div class="bg-white rounded-2xl w-full max-w-6xl max-h-[90vh] overflow-hidden flex flex-col">
            <div class="p-4 border-b border-line flex items-center justify-between">
                <h3 class="font-display font-semibold">项目任务看板</h3>
                <div class="flex items-center gap-3">
                    <button class="text-sm px-3 py-1 rounded-full bg-white border border-line flex items-center gap-2">
                        <i class="fa fa-filter"></i>筛选
                    </button>
                    <button class="text-sm px-3 py-1 rounded-full bg-white border border-line flex items-center gap-2">
                        <i class="fa fa-sort"></i>排序
                    </button>
                    <button id="close-task-board" class="text-muted"><i class="fa fa-times"></i></button>
                </div>
            </div>
            <div class="p-4 border-b border-line flex items-center gap-2 text-sm">
                <button id="list-view-btn" class="px-3 py-1 rounded-full bg-primary text-white">列表视图</button>
                <button id="board-view-btn" class="px-3 py-1 rounded-full bg-white border border-line">看板视图</button>
                <button id="calendar-view-btn" class="px-3 py-1 rounded-full bg-white border border-line">日历视图</button>
                <div class="flex-1"></div>
                <button id="create-task-btn" class="px-4 py-2 rounded-full bg-secondary text-white text-sm">
                    <i class="fa fa-plus mr-1"></i>新建任务
                </button>
            </div>
            
            <!-- 列表视图 -->
            <div id="list-view" class="flex-1 overflow-y-auto p-4">
                <table class="w-full text-sm">
                    <thead>
                        <tr class="text-left text-xs text-muted">
                            <th class="py-2">任务</th>
                            <th>负责人</th>
                            <th>截止日期</th>
                            <th>优先级</th>
                            <th>状态</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="task-list">
                        <!-- 任务列表将通过JavaScript动态生成 -->
                    </tbody>
                </table>
            </div>
            
            <!-- 看板视图 -->
            <div id="board-view" class="flex-1 overflow-y-auto p-4 hidden">
                <div class="flex gap-4 overflow-x-auto h-full pb-4">
                    <!-- 待办事项列 -->
                    <div class="bg-surface rounded-xl border border-line p-3 min-w-[280px] max-w-[280px] flex flex-col h-full">
                        <div class="flex items-center justify-between mb-3">
                            <h4 class="font-medium text-sm">待办事项</h4>
                            <span class="text-xs text-muted bg-ocean-light px-2 py-1 rounded-full">3项</span>
                        </div>
                        <div id="todo-column" class="space-y-3 flex-1 overflow-y-auto">
                            <!-- 任务卡片将通过JavaScript动态生成 -->
                        </div>
                    </div>
                    
                    <!-- 进行中列 -->
                    <div class="bg-surface rounded-xl border border-line p-3 min-w-[280px] max-w-[280px] flex flex-col h-full">
                        <div class="flex items-center justify-between mb-3">
                            <h4 class="font-medium text-sm">进行中</h4>
                            <span class="text-xs text-muted bg-coral-light px-2 py-1 rounded-full">2项</span>
                        </div>
                        <div id="in-progress-column" class="space-y-3 flex-1 overflow-y-auto">
                            <!-- 任务卡片将通过JavaScript动态生成 -->
                        </div>
                    </div>
                    
                    <!-- 已完成列 -->
                    <div class="bg-surface rounded-xl border border-line p-3 min-w-[280px] max-w-[280px] flex flex-col h-full">
                        <div class="flex items-center justify-between mb-3">
                            <h4 class="font-medium text-sm">已完成</h4>
                            <span class="text-xs text-muted bg-accent-light px-2 py-1 rounded-full">5项</span>
                        </div>
                        <div id="done-column" class="space-y-3 flex-1 overflow-y-auto">
                            <!-- 任务卡片将通过JavaScript动态生成 -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 日历视图 -->
            <div id="calendar-view" class="flex-1 overflow-y-auto p-4 hidden">
                <div class="text-center py-10 text-muted">
                    <i class="fa fa-calendar-o text-4xl mb-2"></i>
                    <p>日历视图功能开发中...</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 新建任务模态框 -->
    <div id="create-task-modal" class="fixed inset-0 bg-black/40 hidden items-center justify-center z-50">
        <div class="bg-white rounded-2xl w-full max-w-lg p-5">
            <div class="flex items-center justify-between mb-4">
                <h3 class="font-display font-semibold">新建任务</h3>
                <button id="close-create-task" class="text-muted"><i class="fa fa-times"></i></button>
            </div>
            <div class="space-y-4 text-sm">
                <div>
                    <label class="block text-xs text-muted mb-1">任务标题</label>
                    <input type="text" id="task-title" placeholder="请输入任务标题" class="w-full px-3 py-2 border border-line rounded-lg">
                </div>
                <div>
                    <label class="block text-xs text-muted mb-1">负责人</label>
                    <select id="task-assignee" class="w-full px-3 py-2 border border-line rounded-lg">
                        <option value="">请选择负责人</option>
                        <option value="张明">张明</option>
                        <option value="李华">李华</option>
                        <option value="王五">王五</option>
                    </select>
                </div>
                <div>
                    <label class="block text-xs text-muted mb-1">截止日期</label>
                    <input type="date" id="task-deadline" class="w-full px-3 py-2 border border-line rounded-lg">
                </div>
                <div>
                    <label class="block text-xs text-muted mb-1">优先级</label>
                    <select id="task-priority" class="w-full px-3 py-2 border border-line rounded-lg">
                        <option value="低">低</option>
                        <option value="中">中</option>
                        <option value="高" selected>高</option>
                    </select>
                </div>
                <div>
                    <label class="block text-xs text-muted mb-1">任务描述</label>
                    <textarea id="task-description" rows="3" placeholder="请输入任务描述" class="w-full px-3 py-2 border border-line rounded-lg"></textarea>
                </div>
            </div>
            <div class="mt-5 flex justify-end gap-3">
                <button id="cancel-task" class="px-4 py-2 rounded-full bg-white border border-line text-sm">取消</button>
                <button id="save-task" class="px-4 py-2 rounded-full bg-primary text-white text-sm">保存</button>
            </div>
        </div>
    </div>

    <div id="version-modal" class="fixed inset-0 bg-black/40 hidden items-center justify-center z-40">
        <div class="bg-white rounded-2xl w-full max-w-3xl p-5 shadow-float">
            <div class="flex items-center justify-between">
                <h3 class="font-display font-semibold">版本对比</h3>
                <button id="close-version" class="text-muted"><i class="fa fa-times"></i></button>
            </div>
            <div class="mt-4 grid grid-cols-2 gap-3 text-sm">
                <div class="p-3 rounded-xl bg-mist">V1.1 · 2024/06/20</div>
                <div class="p-3 rounded-xl bg-mist">V1.2 · 2024/07/12</div>
            </div>
            <div class="mt-4 p-3 rounded-xl border border-line text-xs text-muted">
                差异摘要：新增“竞品对比”章节，更新12处数据，修复术语不一致问题。
            </div>
        </div>
    </div>

    <div id="agent-modal" class="fixed inset-0 bg-black/40 hidden items-center justify-center z-40">
        <div class="bg-white rounded-2xl w-full max-w-2xl p-5 shadow-float">
            <div class="flex items-center justify-between">
                <h3 id="agent-title" class="font-display font-semibold">智能体详情</h3>
                <button id="close-agent" class="text-muted"><i class="fa fa-times"></i></button>
            </div>
            <div class="mt-4 text-sm">
                <p id="agent-desc" class="text-muted">智能体描述</p>
                <ul class="mt-3 text-xs text-muted space-y-1">
                    <li>能力：生成摘要、风险识别、结果交付</li>
                    <li>依赖：知识图谱 · 智能体工厂</li>
                    <li>评分：4.7 · 订阅 980</li>
                </ul>
            </div>
            <div class="mt-4 flex justify-end">
                <button id="subscribe-agent" class="px-4 py-2 rounded-full bg-secondary text-white text-sm">立即订阅</button>
            </div>
        </div>
    </div>

    <div id="discussion-modal" class="fixed inset-0 bg-black/40 hidden flex items-center justify-center z-40">
        <div class="bg-white rounded-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col shadow-float">
            <div class="flex items-center justify-between p-5 border-b border-line">
                <h3 class="font-display font-semibold">团队讨论区</h3>
                <div class="flex items-center gap-3">
                    <button id="create-discussion-btn" class="px-4 py-2 rounded-full bg-primary text-white text-sm">发起讨论</button>
                    <button id="close-discussion" class="text-muted"><i class="fa fa-times"></i></button>
                </div>
            </div>
            
            <!-- 讨论列表 -->
            <div id="discussion-list" class="flex-1 overflow-y-auto p-5 space-y-5">
                <!-- 讨论项将通过JavaScript动态生成 -->
            </div>
            
            <!-- 发起讨论表单 -->
            <div id="discussion-form" class="border-t border-line p-5 hidden">
                <div class="flex items-center justify-between mb-3">
                    <h4 class="font-medium">发起新讨论</h4>
                    <button id="cancel-discussion" class="text-muted hover:text-ink">取消</button>
                </div>
                <input id="discussion-title" class="w-full border border-line rounded-lg px-3 py-2 text-sm mb-3" placeholder="讨论主题">
                <textarea id="discussion-content" class="w-full border border-line rounded-lg px-3 py-2 text-sm" rows="3" placeholder="描述问题或背景"></textarea>
                <div class="mt-3 flex justify-end">
                    <button id="publish-discussion" class="px-4 py-2 rounded-full bg-primary text-white text-sm">发布</button>
                </div>
            </div>
        </div>
    </div>

    <div id="publish-modal" class="fixed inset-0 bg-black/40 hidden items-center justify-center z-40">
        <div class="bg-white rounded-2xl w-full max-w-xl p-5 shadow-float">
            <div class="flex items-center justify-between">
                <h3 class="font-display font-semibold">发布设置</h3>
                <button id="close-publish" class="text-muted"><i class="fa fa-times"></i></button>
            </div>
            <div class="mt-4 space-y-3 text-sm">
                <label class="flex items-center gap-2"><input type="checkbox" checked> 发布到团队空间</label>
                <label class="flex items-center gap-2"><input type="checkbox"> 推送到部门空间</label>
                <label class="flex items-center gap-2"><input type="checkbox"> 全员可见（需成熟度达标）</label>
            </div>
            <div class="mt-4 flex justify-end">
                <button class="px-4 py-2 rounded-full bg-secondary text-white text-sm">确认发布</button>
            </div>
        </div>
    </div>
    
    <!-- 创建空间模态框 -->
    <div id="create-space-modal" class="fixed inset-0 bg-black/40 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-2xl w-full max-w-2xl p-5 shadow-float">
            <div class="flex items-center justify-between">
                <h3 class="font-display font-semibold">创建新空间</h3>
                <button id="close-create-space" class="text-muted"><i class="fa fa-times"></i></button>
            </div>
            <div class="mt-4">
                <form id="create-space-form">
                    <div class="mb-4">
                        <label for="new-space-name" class="block text-sm font-medium mb-2">空间名称</label>
                        <input type="text" id="new-space-name" class="w-full px-3 py-2 rounded-lg border border-line text-sm" placeholder="请输入空间名称" required>
                    </div>
                    <div class="mb-4">
                        <label for="new-space-type" class="block text-sm font-medium mb-2">空间类型</label>
                        <select id="new-space-type" class="w-full px-3 py-2 rounded-lg border border-line text-sm" required>
                            <option value="项目空间">项目空间</option>
                            <option value="团队空间">团队空间</option>
                            <option value="主题空间">主题空间</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label for="new-space-description" class="block text-sm font-medium mb-2">空间描述</label>
                        <textarea id="new-space-description" class="w-full px-3 py-2 rounded-lg border border-line text-sm" rows="3" placeholder="请输入空间描述"></textarea>
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button type="button" id="cancel-create-space" class="px-4 py-2 rounded-full border border-line text-sm">取消</button>
                        <button type="submit" class="px-4 py-2 rounded-full bg-primary text-white text-sm">确认创建</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="capture-drawer" class="fixed bottom-6 right-6 bg-white rounded-2xl shadow-float p-4 w-72 hidden z-30">
        <div class="flex items-center justify-between">
            <p class="font-medium text-sm">快速捕获</p>
            <button id="close-capture" class="text-muted text-xs"><i class="fa fa-times"></i></button>
        </div>
        <textarea class="mt-3 w-full border border-line rounded-lg p-2 text-xs" rows="3" placeholder="写下灵感"></textarea>
        <button class="mt-3 w-full px-3 py-2 rounded-full bg-secondary text-white text-xs">保存</button>
    </div>

    <div id="toast" class="fixed top-6 right-6 bg-primary text-white text-sm px-4 py-2 rounded-full shadow-float hidden z-50">设置已保存</div>

    <script>
        const summaryToggle = document.getElementById('toggle-summary');
        const summaryContent = document.getElementById('summary-content');
        const sendMessageBtn = document.getElementById('send-message');
        const messageInput = document.getElementById('message-input');
        const chatHistory = document.getElementById('chat-history');
        const searchInput = document.getElementById('global-search');
        const searchModal = document.getElementById('search-modal');
        const searchSuggestions = document.getElementById('search-suggestions');
        const closeSearch = document.getElementById('close-search');
        const taskBoardModal = document.getElementById('task-board-modal');
        const closeTaskBoard = document.getElementById('close-task-board');
        const summaryTaskButtons = document.querySelectorAll('.open-task-board');
        const versionModal = document.getElementById('version-modal');
        const openVersion = document.getElementById('open-version-compare');
        const closeVersion = document.getElementById('close-version');
        // 创建空间模态框相关元素
        const createSpaceModal = document.getElementById('create-space-modal');
        const closeCreateSpace = document.getElementById('close-create-space');
        const cancelCreateSpace = document.getElementById('cancel-create-space');
        const createSpaceForm = document.getElementById('create-space-form');
        const newSpaceName = document.getElementById('new-space-name');
        const newSpaceType = document.getElementById('new-space-type');
        const newSpaceDescription = document.getElementById('new-space-description');
        const agentModal = document.getElementById('agent-modal');
        const closeAgent = document.getElementById('close-agent');
        const subscribeAgent = document.getElementById('subscribe-agent');
        const discussionModal = document.getElementById('discussion-modal');
        const openDiscussion = document.getElementById('open-discussion');
        const closeDiscussion = document.getElementById('close-discussion');
        const publishModal = document.getElementById('publish-modal');
        const openPublish = document.getElementById('open-publish');
        const closePublish = document.getElementById('close-publish');
        const captureDrawer = document.getElementById('capture-drawer');
        const openCapture = document.getElementById('open-capture');
        const closeCapture = document.getElementById('close-capture');
        const toast = document.getElementById('toast');
        const viewButtons = document.querySelectorAll('.view-btn');
        const viewPanels = document.querySelectorAll('.view-panel');
        const sectionButtons = document.querySelectorAll('.section-btn');
        const sectionPanels = document.querySelectorAll('.section-panel');
        const tabButtons = document.querySelectorAll('.tab-btn');
        const tabPanels = document.querySelectorAll('.tab-panel');
        const quickCommands = document.querySelectorAll('.quick-command');
        const fillMessages = document.querySelectorAll('.fill-message');
        const quickNoteInput = document.getElementById('quick-note-input');
        const quickNoteList = document.getElementById('quick-note-list');
        const saveQuickNote = document.getElementById('save-quick-note');
        const saveClip = document.getElementById('save-clip');
        const clipUrl = document.getElementById('clip-url');

        // 项目任务管理系统
        const projectTaskManager = {
            // 任务数据
            tasks: [
                {
                    id: 1,
                    title: '审核产品需求文档',
                    assignee: '张明',
                    deadline: '2024-01-18',
                    priority: '高',
                    status: '进行中',
                    description: '审核最新版本的PRD文档，重点关注功能完整性和用户体验'
                },
                {
                    id: 2,
                    title: '参加周例会',
                    assignee: '张明',
                    deadline: '2024-01-18T14:00',
                    priority: '中',
                    status: '待开始',
                    description: '项目团队每周进度汇报会议'
                },
                {
                    id: 3,
                    title: '前端开发实现',
                    assignee: '李华',
                    deadline: '2024-01-20',
                    priority: '高',
                    status: '待开始',
                    description: '完成项目首页的前端开发和交互实现'
                },
                {
                    id: 4,
                    title: '后端API接口开发',
                    assignee: '王五',
                    deadline: '2024-01-22',
                    priority: '高',
                    status: '待开始',
                    description: '开发项目所需的后端API接口'
                },
                {
                    id: 5,
                    title: '单元测试编写',
                    assignee: '李华',
                    deadline: '2024-01-24',
                    priority: '中',
                    status: '待开始',
                    description: '为前端代码编写单元测试用例'
                },
                {
                    id: 6,
                    title: '数据库设计',
                    assignee: '王五',
                    deadline: '2024-01-15',
                    priority: '高',
                    status: '已完成',
                    description: '完成项目数据库表结构设计'
                },
                {
                    id: 7,
                    title: 'UI设计稿评审',
                    assignee: '张明',
                    deadline: '2024-01-10',
                    priority: '中',
                    status: '已完成',
                    description: '评审UI设计师提供的设计稿'
                },
                {
                    id: 8,
                    title: '项目计划制定',
                    assignee: '张明',
                    deadline: '2024-01-05',
                    priority: '高',
                    status: '已完成',
                    description: '制定项目开发计划和里程碑'
                },
                {
                    id: 9,
                    title: '技术栈选型',
                    assignee: '王五',
                    deadline: '2024-01-03',
                    priority: '高',
                    status: '已完成',
                    description: '选择项目合适的技术栈'
                },
                {
                    id: 10,
                    title: '需求分析',
                    assignee: '张明',
                    deadline: '2024-01-08',
                    priority: '高',
                    status: '已完成',
                    description: '完成项目需求分析和文档编写'
                }
            ],
            
            // 添加新任务
            addTask: (taskData) => {
                const newTask = {
                    id: Date.now(),
                    ...taskData
                };
                projectTaskManager.tasks.push(newTask);
                projectTaskManager.renderTasks();
                return newTask;
            },
            
            // 更新任务状态
            updateTaskStatus: (taskId, newStatus) => {
                const task = projectTaskManager.tasks.find(t => t.id === taskId);
                if (task) {
                    task.status = newStatus;
                    projectTaskManager.renderTasks();
                    return true;
                }
                return false;
            },
            
            // 渲染任务列表视图
            renderTaskList: () => {
                const taskList = document.getElementById('task-list');
                if (!taskList) return;
                
                taskList.innerHTML = projectTaskManager.tasks.map(task => {
                    const deadlineClass = task.deadline < new Date().toISOString().split('T')[0] ? 'text-danger' : '';
                    const priorityClass = {
                        '高': 'text-danger',
                        '中': 'text-warning',
                        '低': 'text-muted'
                    }[task.priority] || 'text-muted';
                    
                    return `
                        <tr class="border-t border-line">
                            <td class="py-3">${task.title}</td>
                            <td>${task.assignee}</td>
                            <td class="${deadlineClass}">${task.deadline}</td>
                            <td class="${priorityClass}">${task.priority}</td>
                            <td>
                                <select class="task-status-select text-xs px-2 py-1 border border-line rounded-full bg-white" data-task-id="${task.id}">
                                    <option value="待开始" ${task.status === '待开始' ? 'selected' : ''}>待开始</option>
                                    <option value="进行中" ${task.status === '进行中' ? 'selected' : ''}>进行中</option>
                                    <option value="已完成" ${task.status === '已完成' ? 'selected' : ''}>已完成</option>
                                </select>
                            </td>
                            <td>
                                <button class="text-xs text-primary mr-2">编辑</button>
                                <button class="text-xs text-muted">删除</button>
                            </td>
                        </tr>
                    `;
                }).join('');
                
                // 添加状态变更事件
                document.querySelectorAll('.task-status-select').forEach(select => {
                    select.addEventListener('change', (e) => {
                        const taskId = parseInt(e.target.dataset.taskId);
                        const newStatus = e.target.value;
                        projectTaskManager.updateTaskStatus(taskId, newStatus);
                    });
                });
            },
            
            // 渲染看板视图
            renderTaskBoard: () => {
                const todoColumn = document.getElementById('todo-column');
                const inProgressColumn = document.getElementById('in-progress-column');
                const doneColumn = document.getElementById('done-column');
                
                if (!todoColumn || !inProgressColumn || !doneColumn) return;
                
                // 清空列
                todoColumn.innerHTML = '';
                inProgressColumn.innerHTML = '';
                doneColumn.innerHTML = '';
                
                // 分类任务
                const todoTasks = projectTaskManager.tasks.filter(t => t.status === '待开始');
                const inProgressTasks = projectTaskManager.tasks.filter(t => t.status === '进行中');
                const doneTasks = projectTaskManager.tasks.filter(t => t.status === '已完成');
                
                // 渲染任务卡片
                const renderTaskCard = (task) => {
                    const priorityColor = {
                        '高': 'bg-danger',
                        '中': 'bg-warning',
                        '低': 'bg-muted'
                    }[task.priority] || 'bg-muted';
                    
                    return `
                        <div class="bg-white rounded-xl border border-line shadow-sm p-3 cursor-move transition-shadow hover:shadow-md">
                            <div class="flex items-start justify-between mb-2">
                                <span class="${priorityColor} w-2 h-2 rounded-full"></span>
                                <div class="text-xs text-muted">ID: ${task.id}</div>
                            </div>
                            <h5 class="font-medium text-sm mb-2">${task.title}</h5>
                            <div class="flex items-center gap-2 text-xs mb-2">
                                <span class="bg-ocean-light text-ocean px-2 py-0.5 rounded-full">${task.assignee}</span>
                                <span class="text-muted">${task.deadline}</span>
                            </div>
                            <div class="text-xs text-muted line-clamp-2">${task.description}</div>
                            <div class="mt-3 flex justify-end gap-2">
                                <button class="text-xs text-primary">编辑</button>
                                <button class="text-xs text-muted">删除</button>
                            </div>
                        </div>
                    `;
                };
                
                // 添加任务到对应列
                todoTasks.forEach(task => {
                    todoColumn.innerHTML += renderTaskCard(task);
                });
                
                inProgressTasks.forEach(task => {
                    inProgressColumn.innerHTML += renderTaskCard(task);
                });
                
                doneTasks.forEach(task => {
                    doneColumn.innerHTML += renderTaskCard(task);
                });
                
                // 更新列计数
                document.querySelectorAll('.bg-ocean-light.px-2.py-1.rounded-full')[0].textContent = `${todoTasks.length}项`;
                document.querySelectorAll('.bg-coral-light.px-2.py-1.rounded-full')[0].textContent = `${inProgressTasks.length}项`;
                document.querySelectorAll('.bg-accent-light.px-2.py-1.rounded-full')[0].textContent = `${doneTasks.length}项`;
            },
            
            // 渲染所有视图
            renderTasks: () => {
                projectTaskManager.renderTaskList();
                projectTaskManager.renderTaskBoard();
            }
        };

        
        // 全局DOM元素引用
        let clipList = null;
        let recordToggle = null;
        let recordTimer = null;
        let termButtons = null;
        let termDefinition = null;
        let runQualityCheckBtn = null;
        let maturityLevel = null;
        let qualityScore = null;
        let saveSettings = null;
        let actionButtons = null;
        let agentCards = null;
        let agentTitle = null;
        let agentDesc = null;
        let addFlowStep = null;
        let agentFlow = null;
        let salesChartCanvas = null;
        
        // 初始化用户反馈功能
        function initUserFeedback() {
            console.log('开始初始化用户反馈功能');
            
            // 隐藏完整反馈面板，只显示悬浮按钮
            const feedbackPanel = document.getElementById('user-feedback');
            const quickFeedbackBtn = document.getElementById('quick-feedback-btn');
            
            console.log('反馈面板元素:', feedbackPanel);
            console.log('快速反馈按钮元素:', quickFeedbackBtn);
            
            if (feedbackPanel && quickFeedbackBtn) {
                feedbackPanel.style.display = 'none';
                quickFeedbackBtn.style.display = 'flex';
                console.log('已设置反馈面板初始状态');
                
                // 点击悬浮按钮显示反馈面板
                quickFeedbackBtn.addEventListener('click', function() {
                    console.log('点击了快速反馈按钮');
                    feedbackPanel.style.display = 'block';
                    quickFeedbackBtn.style.display = 'none';
                });
                
                // 关闭反馈面板
                const closeFeedbackBtn = document.getElementById('close-feedback');
                console.log('关闭反馈按钮元素:', closeFeedbackBtn);
                if (closeFeedbackBtn) {
                    closeFeedbackBtn.addEventListener('click', function() {
                        console.log('点击了关闭反馈按钮');
                        feedbackPanel.style.display = 'none';
                        quickFeedbackBtn.style.display = 'flex';
                    });
                }
            }
            
            // 初始化五星评分功能
            console.log('初始化五星评分功能');
            initStarRating();
            
            // 初始化快速反馈按钮
            console.log('初始化快速反馈按钮');
            initQuickFeedback();
            
            // 初始化提交按钮
            console.log('初始化提交按钮');
            initSubmitFeedback();
            
            console.log('用户反馈功能初始化完成');
        }

        document.addEventListener('DOMContentLoaded', () => {
            initUserFeedback();
        });
        
        // 初始化五星评分功能
        function initStarRating() {
            const stars = document.querySelectorAll('.star');
            const ratingText = document.getElementById('rating-text');
            
            stars.forEach(star => {
                star.addEventListener('click', function() {
                    const rating = parseInt(this.dataset.rating);
                    updateStarRating(rating);
                    updateRatingText(rating);
                });
                
                // 鼠标悬停效果
                star.addEventListener('mouseenter', function() {
                    const rating = parseInt(this.dataset.rating);
                    highlightStars(rating);
                });
                
                // 鼠标离开效果
                star.addEventListener('mouseleave', function() {
                    const selectedRating = document.querySelector('.star.active') ? 
                        parseInt(document.querySelector('.star.active').dataset.rating) : 0;
                    updateStarRating(selectedRating);
                });
            });
            
            // 更新星星显示
            function updateStarRating(rating) {
                stars.forEach(star => {
                    const starRating = parseInt(star.dataset.rating);
                    const starIcon = star.querySelector('i');
                    
                    if (starRating <= rating) {
                        star.classList.add('active');
                        starIcon.classList.remove('fa-star-o');
                        starIcon.classList.add('fa-star');
                        starIcon.classList.remove('text-muted');
                        starIcon.classList.add('text-warning');
                    } else {
                        star.classList.remove('active');
                        starIcon.classList.add('fa-star-o');
                        starIcon.classList.remove('fa-star');
                        starIcon.classList.add('text-muted');
                        starIcon.classList.remove('text-warning');
                    }
                });
            }
            
            // 高亮星星（鼠标悬停时）
            function highlightStars(rating) {
                stars.forEach(star => {
                    const starRating = parseInt(star.dataset.rating);
                    const starIcon = star.querySelector('i');
                    
                    if (starRating <= rating) {
                        starIcon.classList.remove('fa-star-o');
                        starIcon.classList.add('fa-star');
                        starIcon.classList.remove('text-muted');
                        starIcon.classList.add('text-warning');
                    } else if (!star.classList.contains('active')) {
                        starIcon.classList.add('fa-star-o');
                        starIcon.classList.remove('fa-star');
                        starIcon.classList.add('text-muted');
                        starIcon.classList.remove('text-warning');
                    }
                });
            }
            
            // 更新评分文本
            function updateRatingText(rating) {
                if (ratingText) {
                    const ratingTexts = [
                        '请选择评分',
                        '不满意',
                        '基本满意',
                        '满意',
                        '很满意',
                        '非常满意'
                    ];
                    ratingText.textContent = ratingTexts[rating];
                    
                    // 根据评分更新文本颜色
                    if (rating <= 2) {
                        ratingText.classList.remove('text-success', 'text-primary', 'text-warning');
                        ratingText.classList.add('text-danger');
                    } else if (rating <= 3) {
                        ratingText.classList.remove('text-success', 'text-primary', 'text-danger');
                        ratingText.classList.add('text-warning');
                    } else {
                        ratingText.classList.remove('text-warning', 'text-danger', 'text-primary');
                        ratingText.classList.add('text-success');
                    }
                }
            }
        }
        
        // 初始化快速反馈按钮
        function initQuickFeedback() {
            const quickFeedbackBtns = document.querySelectorAll('.quick-feedback-btn');
            
            quickFeedbackBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const feedbackType = this.textContent.trim();
                    const feedbackContent = this.dataset.content || feedbackType;
                    
                    // 这里可以添加实际的反馈提交逻辑
                    console.log('快速反馈:', feedbackContent);
                    alert(`已提交反馈：${feedbackType}`);
                    
                    // 提交后可以选择关闭反馈面板
                    const feedbackPanel = document.getElementById('user-feedback');
                    const quickFeedbackBtn = document.getElementById('quick-feedback-btn');
                    
                    if (feedbackPanel && quickFeedbackBtn) {
                        feedbackPanel.style.display = 'none';
                        quickFeedbackBtn.style.display = 'flex';
                    }
                });
            });
        }
        
        // 初始化提交按钮
        function initSubmitFeedback() {
            const submitBtn = document.getElementById('submit-feedback');
            
            if (submitBtn) {
                submitBtn.addEventListener('click', function() {
                    // 获取评分
                    const selectedStar = document.querySelector('.star.active');
                    const rating = selectedStar ? parseInt(selectedStar.dataset.rating) : 0;
                    
                    // 获取详细反馈内容
                    const feedbackContent = document.getElementById('feedback-content');
                    const content = feedbackContent ? feedbackContent.value.trim() : '';
                    
                    // 验证评分
                    if (rating === 0) {
                        alert('请先为知识质量评分');
                        return;
                    }
                    
                    // 提交反馈
                    const feedback = {
                        rating: rating,
                        content: content,
                        timestamp: new Date().toISOString(),
                        author: '当前用户',
                        knowledgeId: 'current-knowledge'
                    };
                    
                    // 保存反馈
                    saveFeedback(feedback);
                    
                    // 计算并更新质量动态评估
                    calculateDynamicQuality();
                    
                    alert(`感谢您的反馈！\n评分：${rating}星\n反馈内容：${content || '无'}`);
                    
                    // 重置表单
                    resetFeedbackForm();
                    
                    // 关闭反馈面板
                    const feedbackPanel = document.getElementById('user-feedback');
                    const quickFeedbackBtn = document.getElementById('quick-feedback-btn');
                    
                    if (feedbackPanel && quickFeedbackBtn) {
                        feedbackPanel.style.display = 'none';
                        quickFeedbackBtn.style.display = 'flex';
                    }
                });
            }
        }
        
        // 重置反馈表单
        function resetFeedbackForm() {
            // 重置星星评分
            const stars = document.querySelectorAll('.star');
            stars.forEach(star => {
                star.classList.remove('active');
                const starIcon = star.querySelector('i');
                starIcon.classList.add('fa-star-o');
                starIcon.classList.remove('fa-star');
                starIcon.classList.add('text-muted');
                starIcon.classList.remove('text-warning');
            });
            
            // 重置评分文本
            const ratingText = document.getElementById('rating-text');
            if (ratingText) {
                ratingText.textContent = '请选择评分';
                ratingText.classList.remove('text-success', 'text-warning', 'text-danger');
                ratingText.classList.add('text-muted');
            }
            
            // 重置详细反馈内容
            const feedbackContent = document.getElementById('feedback-content');
            if (feedbackContent) {
                feedbackContent.value = '';
            }
        }
        
        // 保存反馈数据
        function saveFeedback(feedback) {
            // 获取现有反馈
            let feedbacks = JSON.parse(localStorage.getItem('knowledgeFeedbacks')) || {};
            
            // 按知识ID分组
            if (!feedbacks[feedback.knowledgeId]) {
                feedbacks[feedback.knowledgeId] = [];
            }
            
            // 添加新反馈
            feedbacks[feedback.knowledgeId].push(feedback);
            
            // 保存到localStorage
            localStorage.setItem('knowledgeFeedbacks', JSON.stringify(feedbacks));
            
            console.log('反馈已保存:', feedback);
        }
        
        // 计算动态质量评分
        function calculateDynamicQuality() {
            // 获取所有反馈
            const feedbacks = JSON.parse(localStorage.getItem('knowledgeFeedbacks')) || {};
            const knowledgeFeedbacks = feedbacks['current-knowledge'] || [];
            
            if (knowledgeFeedbacks.length === 0) return;
            
            // 计算平均评分
            const totalRating = knowledgeFeedbacks.reduce((sum, feedback) => sum + feedback.rating, 0);
            const averageRating = totalRating / knowledgeFeedbacks.length;
            
            // 分类反馈
            const positiveFeedbacks = knowledgeFeedbacks.filter(f => f.rating >= 4).length;
            const neutralFeedbacks = knowledgeFeedbacks.filter(f => f.rating === 3).length;
            const negativeFeedbacks = knowledgeFeedbacks.filter(f => f.rating <= 2).length;
            
            // 计算质量分数（1-100）
            const qualityScore = Math.round(averageRating * 20);
            
            // 保存质量评估结果
            const qualityAssessment = {
                averageRating: averageRating,
                qualityScore: qualityScore,
                feedbackCount: knowledgeFeedbacks.length,
                positiveRatio: positiveFeedbacks / knowledgeFeedbacks.length,
                negativeRatio: negativeFeedbacks / knowledgeFeedbacks.length,
                lastUpdated: new Date().toISOString()
            };
            
            localStorage.setItem('knowledgeQuality', JSON.stringify(qualityAssessment));
            
            // 更新质量显示
            updateQualityDisplay(qualityScore);
            
            // 触发自动质量治理
            autoQualityGovernance(qualityAssessment);
            
            console.log('动态质量评估完成:', qualityAssessment);
        }
        
        // 更新质量显示
        function updateQualityDisplay(qualityScore) {
            // 查找质量显示元素
            const qualityElements = document.querySelectorAll('.quality-score, .maturity-score');
            
            qualityElements.forEach(element => {
                // 根据质量分数更新颜色
                let colorClass = '';
                if (qualityScore >= 80) {
                    colorClass = 'text-success';
                } else if (qualityScore >= 60) {
                    colorClass = 'text-primary';
                } else if (qualityScore >= 40) {
                    colorClass = 'text-warning';
                } else {
                    colorClass = 'text-danger';
                }
                
                // 更新分数显示
                element.textContent = qualityScore;
                
                // 更新颜色类
                element.classList.remove('text-success', 'text-primary', 'text-warning', 'text-danger');
                element.classList.add(colorClass);
            });
        }
        
        // 自动质量治理
        function autoQualityGovernance(assessment) {
            // 获取自动治理配置
            const governanceConfig = JSON.parse(localStorage.getItem('qualityGovernanceConfig')) || {
                autoRemove: true,
                lowQualityThreshold: 40,
                warningThreshold: 60,
                qualityInspection: true
            };
            
            // 低质量自动处理
            if (governanceConfig.autoRemove && assessment.qualityScore < governanceConfig.lowQualityThreshold) {
                // 这里可以添加实际的下架逻辑
                console.log('触发低质量自动处理');
                showQualityAlert('当前知识质量较低，已自动标记为待优化', 'warning');
            }
            
            // 质量警告
            if (assessment.qualityScore < governanceConfig.warningThreshold && assessment.qualityScore >= governanceConfig.lowQualityThreshold) {
                console.log('触发质量警告');
                showQualityAlert('当前知识质量需要提升', 'info');
            }
            
            // 高质量推荐
            if (assessment.qualityScore >= 90 && assessment.feedbackCount >= 10) {
                console.log('触发高质量推荐');
                showQualityAlert('当前知识质量优秀，建议申请精品认证', 'success');
            }
        }
        
        // 显示质量警报
        function showQualityAlert(message, type = 'info') {
            // 创建警报元素
            const alert = document.createElement('div');
            alert.className = `fixed top-6 right-6 px-4 py-3 rounded-lg shadow-lg z-50 text-sm ${getAlertClass(type)}`;
            alert.innerHTML = `
                <div class="flex items-center gap-2">
                    <i class="fa ${getAlertIcon(type)}"></i>
                    <span>${message}</span>
                </div>
            `;
            
            // 添加到页面
            document.body.appendChild(alert);
            
            // 3秒后自动消失
            setTimeout(() => {
                alert.remove();
            }, 3000);
        }
        
        // 获取警报样式类
        function getAlertClass(type) {
            const classes = {
                success: 'bg-success text-white',
                warning: 'bg-warning text-white',
                danger: 'bg-danger text-white',
                info: 'bg-primary text-white'
            };
            return classes[type] || classes.info;
        }
        
        // 获取警报图标
        function getAlertIcon(type) {
            const icons = {
                success: 'fa-check-circle',
                warning: 'fa-exclamation-triangle',
                danger: 'fa-times-circle',
                info: 'fa-info-circle'
            };
            return icons[type] || icons.info;
        }

        summaryToggle.addEventListener('click', () => {
            summaryContent.classList.toggle('hidden');
            summaryToggle.querySelector('i').classList.toggle('fa-chevron-up');
            summaryToggle.querySelector('i').classList.toggle('fa-chevron-down');
        });

        function getCurrentTime() {
            const now = new Date();
            return `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
        }

        function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;
            const userMessage = `
                <div class="flex items-start justify-end gap-3">
                    <div class="bg-primary/10 rounded-xl p-4 shadow-soft max-w-2xl">
                        <p class="text-sm">${message}</p>
                    </div>
                    <img src="https://p3-doubao-search-sign.byteimg.com/pgc-image/6323b43dac9b41db978bffd8c580ac63~tplv-be4g95zd3a-image.jpeg?lk3s=feb11e32&x-expires=1783481830&x-signature=E%2BA4UNzvvjJgdRQb3RrhhengBCo%3D" class="w-9 h-9 rounded-full" alt="用户">
                </div>
            `;
            chatHistory.insertAdjacentHTML('beforeend', userMessage);
            messageInput.value = '';
            messageInput.style.height = 'auto';
            chatHistory.scrollTop = chatHistory.scrollHeight;
            setTimeout(() => {
                const systemMessage = `
                    <div class="flex items-start gap-3">
                        <div class="w-9 h-9 rounded-full bg-primary text-white flex items-center justify-center"><i class="fa fa-robot"></i></div>
                        <div class="bg-white rounded-xl p-4 shadow-soft max-w-2xl">
                            <p class="text-sm">已接收“${message}”，正在调用智能体处理并生成初稿。</p>
                            <p class="text-xs text-muted mt-2">${getCurrentTime()}</p>
                        </div>
                    </div>
                `;
                chatHistory.insertAdjacentHTML('beforeend', systemMessage);
                chatHistory.scrollTop = chatHistory.scrollHeight;
            }, 600);
        }

        sendMessageBtn.addEventListener('click', sendMessage);
        messageInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        messageInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = `${this.scrollHeight}px`;
        });

        quickCommands.forEach(btn => {
            btn.addEventListener('click', () => {
                messageInput.value = `${btn.dataset.command} `;
                messageInput.focus();
            });
        });

        fillMessages.forEach(btn => {
            btn.addEventListener('click', () => {
                messageInput.value = btn.textContent.trim();
                messageInput.focus();
            });
        });

        searchInput.addEventListener('focus', () => {
            if (searchSuggestions) {
                searchSuggestions.classList.remove('hidden');
            }
        });
        searchInput.addEventListener('blur', () => {
            if (searchSuggestions) {
                setTimeout(() => searchSuggestions.classList.add('hidden'), 200);
            }
        });
        closeSearch.addEventListener('click', () => searchModal.classList.add('hidden'));
        if (searchSuggestions) {
            searchSuggestions.querySelectorAll('li, span').forEach(item => {
                item.addEventListener('click', () => {
                    searchInput.value = item.textContent.trim();
                    searchSuggestions.classList.add('hidden');
                });
            });
        }
        document.addEventListener('keydown', (e) => {
            if ((e.metaKey || e.ctrlKey) && e.key.toLowerCase() === 'k') {
                e.preventDefault();
                searchModal.classList.remove('hidden');
            }
            if (e.key === 'Escape') {
                searchModal.classList.add('hidden');
                taskBoardModal.classList.add('hidden');
                versionModal.classList.add('hidden');
                agentModal.classList.add('hidden');
                discussionModal.classList.add('hidden');
                publishModal.classList.add('hidden');
                captureDrawer.classList.add('hidden');
            }
        });


        // 初始化任务数据
        projectTaskManager.renderTasks();
        
        closeTaskBoard.addEventListener('click', () => taskBoardModal.classList.add('hidden'));
        taskBoardModal.addEventListener('click', (e) => {
            if (e.target === taskBoardModal) taskBoardModal.classList.add('hidden');
        });
        summaryTaskButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                taskBoardModal.classList.remove('hidden');
                // 每次打开任务看板时重新渲染任务数据
                projectTaskManager.renderTasks();
            });
        });
        
        // 视图切换按钮
        const listViewBtn = document.getElementById('list-view-btn');
        const boardViewBtn = document.getElementById('board-view-btn');
        const calendarViewBtn = document.getElementById('calendar-view-btn');
        
        // 视图容器
        const listView = document.getElementById('list-view');
        const boardView = document.getElementById('board-view');
        const calendarView = document.getElementById('calendar-view');
        
        // 视图切换功能
        const switchView = (viewName) => {
            // 隐藏所有视图
            listView.classList.add('hidden');
            boardView.classList.add('hidden');
            calendarView.classList.add('hidden');
            
            // 重置按钮状态
            listViewBtn.className = 'px-3 py-1 rounded-full bg-white border border-line';
            boardViewBtn.className = 'px-3 py-1 rounded-full bg-white border border-line';
            calendarViewBtn.className = 'px-3 py-1 rounded-full bg-white border border-line';
            
            // 显示选择的视图
            if (viewName === 'list') {
                listView.classList.remove('hidden');
                listViewBtn.className = 'px-3 py-1 rounded-full bg-primary text-white';
            } else if (viewName === 'board') {
                boardView.classList.remove('hidden');
                boardViewBtn.className = 'px-3 py-1 rounded-full bg-primary text-white';
            } else if (viewName === 'calendar') {
                calendarView.classList.remove('hidden');
                calendarViewBtn.className = 'px-3 py-1 rounded-full bg-primary text-white';
            }
        };
        
        // 视图切换事件
        if (listViewBtn) listViewBtn.addEventListener('click', () => switchView('list'));
        if (boardViewBtn) boardViewBtn.addEventListener('click', () => switchView('board'));
        if (calendarViewBtn) calendarViewBtn.addEventListener('click', () => switchView('calendar'));
        
        // 新建任务相关
        const createTaskModal = document.getElementById('create-task-modal');
        const createTaskBtn = document.getElementById('create-task-btn');
        const closeCreateTask = document.getElementById('close-create-task');
        const cancelTask = document.getElementById('cancel-task');
        const saveTask = document.getElementById('save-task');
        
        // 打开新建任务模态框
        if (createTaskBtn) createTaskBtn.addEventListener('click', () => {
            if (createTaskModal) createTaskModal.classList.remove('hidden');
        });
        
        // 关闭新建任务模态框
        const closeCreateTaskModal = () => {
            if (createTaskModal) createTaskModal.classList.add('hidden');
            // 清空表单
            const taskTitle = document.getElementById('task-title');
            const taskAssignee = document.getElementById('task-assignee');
            const taskDeadline = document.getElementById('task-deadline');
            const taskPriority = document.getElementById('task-priority');
            const taskDescription = document.getElementById('task-description');
            
            if (taskTitle) taskTitle.value = '';
            if (taskAssignee) taskAssignee.value = '';
            if (taskDeadline) taskDeadline.value = '';
            if (taskPriority) taskPriority.value = '高';
            if (taskDescription) taskDescription.value = '';
        };
        
        if (closeCreateTask) closeCreateTask.addEventListener('click', closeCreateTaskModal);
        if (cancelTask) cancelTask.addEventListener('click', closeCreateTaskModal);
        
        // 点击模态框外部关闭
        if (createTaskModal) {
            createTaskModal.addEventListener('click', (e) => {
                if (e.target === createTaskModal) {
                    closeCreateTaskModal();
                }
            });
        }
        
        // 保存新任务
        if (saveTask) saveTask.addEventListener('click', () => {
            const taskTitle = document.getElementById('task-title');
            const taskAssignee = document.getElementById('task-assignee');
            const taskDeadline = document.getElementById('task-deadline');
            const taskPriority = document.getElementById('task-priority');
            const taskDescription = document.getElementById('task-description');
            
            if (!taskTitle || !taskAssignee || !taskDeadline || !taskPriority || !taskDescription) {
                showToast('表单元素缺失', 'error');
                return;
            }
            
            const title = taskTitle.value.trim();
            const assignee = taskAssignee.value;
            const deadline = taskDeadline.value;
            const priority = taskPriority.value;
            const description = taskDescription.value.trim();
            
            if (!title) {
                showToast('请输入任务标题', 'error');
                return;
            }
            
            if (!assignee) {
                showToast('请选择负责人', 'error');
                return;
            }
            
            if (!deadline) {
                showToast('请选择截止日期', 'error');
                return;
            }
            
            const newTask = {
                title,
                assignee,
                deadline,
                priority,
                status: '待开始',
                description
            };
            
            projectTaskManager.addTask(newTask);
            closeCreateTaskModal();
            showToast('任务创建成功');
        });

        openVersion.addEventListener('click', () => versionModal.classList.remove('hidden'));
        closeVersion.addEventListener('click', () => versionModal.classList.add('hidden'));

        // 文档协作系统
        const documentCollaborationSystem = {
            // 文档数据
            documents: [
                {
                    id: 'doc-001',
                    title: '华东区市场趋势分析.docx',
                    path: '📊 市场分析/华东区市场趋势分析.docx',
                    type: 'document',
                    size: '2.4 MB',
                    lastModified: '2024-07-12',
                    lastModifier: '张明',
                    version: '2.1',
                    versions: [
                        { version: '2.1', date: '2024-07-12', author: '张明', description: '新增竞品分析章节' },
                        { version: '2.0', date: '2024-07-10', author: '李华', description: '更新2024年Q2数据' },
                        { version: '1.0', date: '2024-07-05', author: '王五', description: '初始版本' }
                    ],
                    permissions: [
                        { user: '张明', role: '编辑者' },
                        { user: '李华', role: '查看者' },
                        { user: '王五', role: '管理者' }
                    ],
                    status: '已发布'
                },
                {
                    id: 'doc-002',
                    title: '竞品对比报告.pdf',
                    path: '📊 市场分析/竞品对比报告.pdf',
                    type: 'document',
                    size: '1.8 MB',
                    lastModified: '2024-07-10',
                    lastModifier: '李华',
                    version: '1.0',
                    versions: [
                        { version: '1.0', date: '2024-07-10', author: '李华', description: '初始版本' }
                    ],
                    permissions: [
                        { user: '李华', role: '编辑者' },
                        { user: '张明', role: '查看者' },
                        { user: '王五', role: '管理者' }
                    ],
                    status: '已发布'
                },
                {
                    id: 'doc-003',
                    title: 'Q3销售计划.docx',
                    path: '💼 销售管理/Q3销售计划.docx',
                    type: 'document',
                    size: '3.2 MB',
                    lastModified: '2024-07-15',
                    lastModifier: '王五',
                    version: '1.2',
                    versions: [
                        { version: '1.2', date: '2024-07-15', author: '王五', description: '调整销售目标' },
                        { version: '1.1', date: '2024-07-12', author: '张明', description: '添加区域分配' },
                        { version: '1.0', date: '2024-07-10', author: '王五', description: '初始版本' }
                    ],
                    permissions: [
                        { user: '王五', role: '管理者' },
                        { user: '张明', role: '编辑者' },
                        { user: '李华', role: '查看者' }
                    ],
                    status: '进行中'
                }
            ],
            
            // 获取文档版本历史
            getDocumentVersions: (docId) => {
                const doc = documentCollaborationSystem.documents.find(d => d.id === docId);
                return doc ? doc.versions : [];
            },
            
            // 创建新版本
            createNewVersion: (docId, description, author = '当前用户') => {
                const doc = documentCollaborationSystem.documents.find(d => d.id === docId);
                if (doc) {
                    const versionParts = doc.version.split('.').map(Number);
                    versionParts[1] += 1;
                    const newVersion = versionParts.join('.');
                    
                    doc.versions.unshift({
                        version: newVersion,
                        date: new Date().toISOString().split('T')[0],
                        author,
                        description
                    });
                    
                    doc.version = newVersion;
                    doc.lastModified = new Date().toISOString().split('T')[0];
                    doc.lastModifier = author;
                    
                    showToast(`文档 ${doc.title} 已创建新版本 ${newVersion}`);
                    return newVersion;
                }
                return null;
            },
            
            // 共享文档
            shareDocument: (docId, user, role) => {
                const doc = documentCollaborationSystem.documents.find(d => d.id === docId);
                if (doc) {
                    const existingPermission = doc.permissions.find(p => p.user === user);
                    if (existingPermission) {
                        existingPermission.role = role;
                    } else {
                        doc.permissions.push({ user, role });
                    }
                    showToast(`文档 ${doc.title} 已共享给 ${user}（${role}）`);
                    return true;
                }
                return false;
            },
            
            // 设置文档权限
            setDocumentPermission: (docId, user, role) => {
                return documentCollaborationSystem.shareDocument(docId, user, role);
            },
            
            // 获取文档权限
            getDocumentPermissions: (docId) => {
                const doc = documentCollaborationSystem.documents.find(d => d.id === docId);
                return doc ? doc.permissions : [];
            },
            
            // 检查文档权限
            checkDocumentPermission: (docId, user, requiredRole) => {
                const permissions = documentCollaborationSystem.getDocumentPermissions(docId);
                const userPermission = permissions.find(p => p.user === user);
                
                if (!userPermission) return false;
                
                const roleHierarchy = { '查看者': 1, '编辑者': 2, '管理者': 3 };
                return roleHierarchy[userPermission.role] >= roleHierarchy[requiredRole];
            }
        };
        
        // 文档树交互
        const docTreeList = document.getElementById('doc-tree-list');
        if (docTreeList) {
            // 文件夹展开/折叠
            const folderToggles = docTreeList.querySelectorAll('.folder-toggle');
            folderToggles.forEach(toggle => {
                toggle.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const folderItem = toggle.closest('.folder-item');
                    const folderChildren = folderItem.querySelector('.folder-children');
                    
                    if (folderChildren) {
                        folderChildren.classList.toggle('hidden');
                        toggle.classList.toggle('fa-angle-right');
                        toggle.classList.toggle('fa-angle-down');
                    }
                });
            });
            
            // 文档项点击事件
            const docItems = docTreeList.querySelectorAll('li:not(.folder-item)');
            docItems.forEach(item => {
                item.addEventListener('click', (e) => {
                    e.stopPropagation();
                    // 移除其他选中状态
                    docTreeList.querySelectorAll('li').forEach(li => li.classList.remove('bg-mist'));
                    // 添加当前选中状态
                    item.classList.add('bg-mist');
                    
                    const docTitle = item.querySelector('span').textContent;
                    showToast(`正在打开文档: ${docTitle}`);
                });
            });
        }
        
        // 增强版本对比功能
        openVersion.addEventListener('click', () => {
            versionModal.classList.remove('hidden');
            // 这里可以添加版本对比的逻辑
            showToast('版本对比功能已打开');
        });
        
        // 增强版本对比模态框
        if (versionModal) {
            // 这里可以添加更多版本对比的功能
        }
        
        // 添加文档共享功能
        const shareButtons = document.querySelectorAll('[title="分享"], .fa-share');
        shareButtons.forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.stopPropagation();
                const shareBtn = e.target.closest('button');
                if (shareBtn) {
                    showToast('文档分享功能已打开');
                    // 这里可以打开文档分享模态框
                }
            });
        });

        if (agentCards) {
            agentCards.forEach(card => {
                card.addEventListener('click', () => {
                    if (agentTitle && agentDesc && agentModal) {
                        agentTitle.textContent = card.dataset.agent;
                        agentDesc.textContent = `${card.dataset.agent} 将根据企业知识图谱与智能体工厂能力提供专项服务。`;
                        agentModal.classList.remove('hidden');
                    }
                });
            });
        }
        if (closeAgent && agentModal) {
            closeAgent.addEventListener('click', () => agentModal.classList.add('hidden'));
        }
        subscribeAgent.addEventListener('click', () => {
            subscribeAgent.textContent = '已订阅';
            subscribeAgent.classList.add('bg-success');
        });

        // 沟通协作系统
        const communicationCollaborationSystem = {
            // 讨论数据
            discussions: [
                {
                    id: 'disc-001',
                    title: '关于Q3产品定价策略的讨论',
                    content: '大家好，我想和大家讨论一下Q3的产品定价策略。根据市场调研数据，我们的主要竞争对手已经调整了定价，我们需要考虑如何应对...',
                    author: '张明',
                    avatar: 'https://ui-avatars.com/api/?name=张明&background=random&color=fff',
                    createdAt: '2024-07-15T14:30:00',
                    likes: 8,
                    comments: [
                        {
                            id: 'com-001',
                            content: '我认为我们应该采用差异化定价策略，突出我们产品的独特价值...',
                            author: '李华',
                            avatar: 'https://ui-avatars.com/api/?name=李华&background=random&color=fff',
                            createdAt: '2024-07-15T14:45:00',
                            likes: 5
                        },
                        {
                            id: 'com-002',
                            content: '同意李华的观点，我们需要强调我们的服务优势和技术创新...',
                            author: '王五',
                            avatar: 'https://ui-avatars.com/api/?name=王五&background=random&color=fff',
                            createdAt: '2024-07-15T15:10:00',
                            likes: 3
                        }
                    ],
                    tags: ['定价', '市场', '策略'],
                    spaceId: 'project-space'
                },
                {
                    id: 'disc-002',
                    title: '华东区销售目标达成情况分析',
                    content: '各位同事，华东区Q2的销售目标完成率为85%，距离目标还有一定差距。我们需要分析原因并制定改进措施...',
                    author: '李华',
                    avatar: 'https://ui-avatars.com/api/?name=李华&background=random&color=fff',
                    createdAt: '2024-07-14T09:15:00',
                    likes: 12,
                    comments: [
                        {
                            id: 'com-003',
                            content: '主要问题是新客户开发不足，我们需要加强渠道建设...',
                            author: '张明',
                            avatar: 'https://ui-avatars.com/api/?name=张明&background=random&color=fff',
                            createdAt: '2024-07-14T10:30:00',
                            likes: 7
                        }
                    ],
                    tags: ['销售', '目标', '分析'],
                    spaceId: 'team-space'
                },
                {
                    id: 'disc-003',
                    title: '技术团队招聘需求讨论',
                    content: '随着业务的发展，我们需要扩大技术团队规模。目前计划招聘前端开发、后端开发和测试工程师各2名...',
                    author: '王五',
                    avatar: 'https://ui-avatars.com/api/?name=王五&background=random&color=fff',
                    createdAt: '2024-07-13T16:20:00',
                    likes: 5,
                    comments: [],
                    tags: ['招聘', '技术', '团队'],
                    spaceId: 'theme-space'
                }
            ],
            
            // 通知数据
            notifications: [
                {
                    id: 'notif-001',
                    type: 'discussion',
                    title: '您有新的讨论回复',
                    content: '李华回复了您的讨论"关于Q3产品定价策略的讨论"',
                    createdAt: '2024-07-15T14:45:00',
                    isRead: false,
                    link: '#disc-001'
                },
                {
                    id: 'notif-002',
                    type: 'task',
                    title: '新任务分配',
                    content: '张明分配给您一个新任务："竞品分析报告撰写"',
                    createdAt: '2024-07-15T10:00:00',
                    isRead: false,
                    link: '#task-001'
                },
                {
                    id: 'notif-003',
                    type: 'document',
                    title: '文档更新通知',
                    content: '王五更新了文档"华东区市场趋势分析.docx"',
                    createdAt: '2024-07-14T16:30:00',
                    isRead: true,
                    link: '#doc-001'
                }
            ],
            
            // 创建新讨论
            createDiscussion: (title, content, author = '当前用户') => {
                // 获取当前选中的空间
                const currentSpaceId = typeof teamSpaceManager !== 'undefined' ? teamSpaceManager.currentSpace : 'project-space';
                
                const newDiscussion = {
                    id: `disc-${Date.now()}`,
                    title,
                    content,
                    author,
                    avatar: `https://ui-avatars.com/api/?name=${author}&background=random&color=fff`,
                    createdAt: new Date().toISOString(),
                    likes: 0,
                    comments: [],
                    tags: [],
                    spaceId: currentSpaceId
                };
                
                communicationCollaborationSystem.discussions.unshift(newDiscussion);
                communicationCollaborationSystem.renderDiscussions();
                
                // 发送通知给相关人员
                communicationCollaborationSystem.sendNotification({
                    type: 'discussion',
                    title: '新讨论发起',
                    content: `${author}发起了新讨论：${title}`,
                    link: `#${newDiscussion.id}`
                });
                
                return newDiscussion;
            },
            
            // 回复讨论
            replyToDiscussion: (discussionId, content, author = '当前用户') => {
                const discussion = communicationCollaborationSystem.discussions.find(d => d.id === discussionId);
                if (discussion) {
                    const newComment = {
                        id: `com-${Date.now()}`,
                        content,
                        author,
                        avatar: `https://ui-avatars.com/api/?name=${author}&background=random&color=fff`,
                        createdAt: new Date().toISOString(),
                        likes: 0
                    };
                    
                    discussion.comments.push(newComment);
                    communicationCollaborationSystem.renderDiscussions();
                    
                    // 发送通知给讨论发起者
                    if (author !== discussion.author) {
                        communicationCollaborationSystem.sendNotification({
                            type: 'discussion',
                            title: '您的讨论有新回复',
                            content: `${author}回复了您的讨论：${discussion.title}`,
                            link: `#${discussion.id}`
                        });
                    }
                    
                    return newComment;
                }
                return null;
            },
            
            // 点赞讨论
            likeDiscussion: (discussionId) => {
                const discussion = communicationCollaborationSystem.discussions.find(d => d.id === discussionId);
                if (discussion) {
                    discussion.likes++;
                    communicationCollaborationSystem.renderDiscussions();
                    return true;
                }
                return false;
            },
            
            // 点赞评论
            likeComment: (discussionId, commentId) => {
                const discussion = communicationCollaborationSystem.discussions.find(d => d.id === discussionId);
                if (discussion) {
                    const comment = discussion.comments.find(c => c.id === commentId);
                    if (comment) {
                        comment.likes++;
                        communicationCollaborationSystem.renderDiscussions();
                        return true;
                    }
                }
                return false;
            },
            
            // 发送通知
            sendNotification: (notificationData) => {
                const newNotification = {
                    id: `notif-${Date.now()}`,
                    ...notificationData,
                    createdAt: new Date().toISOString(),
                    isRead: false
                };
                
                communicationCollaborationSystem.notifications.unshift(newNotification);
                
                // 显示通知
                communicationCollaborationSystem.showNotification(newNotification);
                
                return newNotification;
            },
            
            // 显示通知
            showNotification: (notification) => {
                const notificationEl = document.createElement('div');
                notificationEl.className = 'notification fixed top-4 right-4 bg-white border border-line rounded-lg shadow-lg p-4 flex items-start gap-3 z-50 animate-slide-in';
                
                const iconMap = {
                    'discussion': 'fa-comments',
                    'task': 'fa-tasks',
                    'document': 'fa-file-text-o',
                    'system': 'fa-bell'
                };
                
                notificationEl.innerHTML = `
                    <div class="p-2 rounded-full bg-primary/10 text-primary">
                        <i class="fa ${iconMap[notification.type] || 'fa-bell'}"></i>
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="font-medium text-sm">${notification.title}</p>
                        <p class="text-xs text-muted truncate">${notification.content}</p>
                    </div>
                    <button class="close-notification text-muted hover:text-ink">
                        <i class="fa fa-times"></i>
                    </button>
                `;
                
                document.body.appendChild(notificationEl);
                
                // 自动关闭通知
                setTimeout(() => {
                    if (notificationEl.parentNode) {
                        notificationEl.classList.add('animate-slide-out');
                        setTimeout(() => notificationEl.remove(), 300);
                    }
                }, 5000);
                
                // 关闭按钮事件
                const closeBtn = notificationEl.querySelector('.close-notification');
                closeBtn.addEventListener('click', () => notificationEl.remove());
            },
            
            // 渲染讨论列表
            renderDiscussions: () => {
                const discussionList = document.getElementById('discussion-list');
                if (!discussionList) return;
                
                // 获取当前选中的空间
                const currentSpaceId = typeof teamSpaceManager !== 'undefined' ? teamSpaceManager.currentSpace : 'project-space';
                
                // 过滤出当前空间的讨论
                const currentSpaceDiscussions = communicationCollaborationSystem.discussions.filter(discussion => discussion.spaceId === currentSpaceId);
                
                discussionList.innerHTML = currentSpaceDiscussions.map(discussion => {
                    const date = new Date(discussion.createdAt).toLocaleString('zh-CN');
                    
                    return `
                        <div class="discussion-item rounded-xl border border-line p-4" id="${discussion.id}">
                            <div class="flex items-start gap-3">
                                <img src="${discussion.avatar}" alt="${discussion.author}" class="w-8 h-8 rounded-full object-cover">
                                <div class="flex-1 min-w-0">
                                    <div class="flex items-center gap-2">
                                        <h4 class="font-medium text-sm">${discussion.title}</h4>
                                        <span class="text-xs text-muted">${date}</span>
                                    </div>
                                    <p class="text-sm mt-1 text-muted">${discussion.author}</p>
                                    <p class="text-sm mt-2">${discussion.content}</p>
                                    
                                    <!-- 标签 -->
                                    ${discussion.tags.length > 0 ? `
                                        <div class="flex gap-2 mt-2 flex-wrap">
                                            ${discussion.tags.map(tag => `<span class="text-xs px-2 py-0.5 bg-mist rounded-full">${tag}</span>`).join('')}
                                        </div>
                                    ` : ''}
                                    
                                    <!-- 互动按钮 -->
                                    <div class="flex items-center gap-4 mt-3 text-sm">
                                        <button class="like-discussion flex items-center gap-1 text-muted hover:text-primary" data-discussion-id="${discussion.id}">
                                            <i class="fa fa-thumbs-o-up"></i>
                                            <span>${discussion.likes}</span>
                                        </button>
                                        <button class="comment-discussion flex items-center gap-1 text-muted hover:text-primary" data-discussion-id="${discussion.id}">
                                            <i class="fa fa-comment-o"></i>
                                            <span>${discussion.comments.length}</span>
                                        </button>
                                        <button class="share-discussion flex items-center gap-1 text-muted hover:text-primary">
                                            <i class="fa fa-share"></i>
                                            <span>分享</span>
                                        </button>
                                    </div>
                                    
                                    <!-- 评论列表 -->
                                    ${discussion.comments.length > 0 ? `
                                        <div class="mt-4 space-y-3">
                                            ${discussion.comments.map(comment => {
                                                const commentDate = new Date(comment.createdAt).toLocaleString('zh-CN');
                                                return `
                                                    <div class="comment-item pl-4 border-l-2 border-line py-2">
                                                        <div class="flex items-start gap-2">
                                                            <img src="${comment.avatar}" alt="${comment.author}" class="w-6 h-6 rounded-full object-cover">
                                                            <div class="flex-1 min-w-0">
                                                                <div class="flex items-center gap-2">
                                                                    <p class="text-sm font-medium">${comment.author}</p>
                                                                    <span class="text-xs text-muted">${commentDate}</span>
                                                                </div>
                                                                <p class="text-sm mt-1">${comment.content}</p>
                                                                <div class="flex items-center gap-3 mt-2 text-xs">
                                                                    <button class="like-comment flex items-center gap-1 text-muted hover:text-primary" data-discussion-id="${discussion.id}" data-comment-id="${comment.id}">
                                                                        <i class="fa fa-thumbs-o-up"></i>
                                                                        <span>${comment.likes}</span>
                                                                    </button>
                                                                    <button class="reply-comment flex items-center gap-1 text-muted hover:text-primary">
                                                                        <i class="fa fa-reply"></i>
                                                                        <span>回复</span>
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                `;
                                            }).join('')}
                                        </div>
                                    ` : ''}
                                    
                                    <!-- 评论输入框 -->
                                    <div class="mt-3">
                                        <textarea class="w-full border border-line rounded-lg px-3 py-2 text-sm" rows="2" placeholder="写下你的回复..." data-discussion-id="${discussion.id}"></textarea>
                                        <div class="flex justify-end mt-2">
                                            <button class="send-comment px-3 py-1.5 bg-primary text-white rounded-lg text-sm" data-discussion-id="${discussion.id}">发送</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                // 绑定事件
                communicationCollaborationSystem.bindDiscussionEvents();
            },
            
            // 绑定讨论事件
            bindDiscussionEvents: () => {
                // 点赞讨论
                document.querySelectorAll('.like-discussion').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const discussionId = btn.dataset.discussionId;
                        communicationCollaborationSystem.likeDiscussion(discussionId);
                    });
                });
                
                // 点赞评论
                document.querySelectorAll('.like-comment').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const discussionId = btn.dataset.discussionId;
                        const commentId = btn.dataset.commentId;
                        communicationCollaborationSystem.likeComment(discussionId, commentId);
                    });
                });
                
                // 发送评论
                document.querySelectorAll('.send-comment').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const discussionId = btn.dataset.discussionId;
                        const textarea = btn.closest('.mt-3').querySelector('textarea');
                        const content = textarea.value.trim();
                        
                        if (content) {
                            communicationCollaborationSystem.replyToDiscussion(discussionId, content);
                            textarea.value = '';
                        }
                    });
                });
            }
        };
        
        // 讨论区相关元素
        const discussionList = document.getElementById('discussion-list');
        const discussionForm = document.getElementById('discussion-form');
        const createDiscussionBtn = document.getElementById('create-discussion-btn');
        const cancelDiscussion = document.getElementById('cancel-discussion');
        const publishDiscussion = document.getElementById('publish-discussion');
        const discussionTitle = document.getElementById('discussion-title');
        const discussionContent = document.getElementById('discussion-content');
        
        // 打开讨论区
        openDiscussion.addEventListener('click', () => {
            discussionModal.classList.remove('hidden');
            // 渲染讨论列表
            communicationCollaborationSystem.renderDiscussions();
            // 关闭表单
            discussionForm.classList.add('hidden');
        });
        
        // 关闭讨论区
        closeDiscussion.addEventListener('click', () => {
            discussionModal.classList.add('hidden');
        });
        
        // 点击模态框外部关闭
        discussionModal.addEventListener('click', (e) => {
            if (e.target === discussionModal) {
                discussionModal.classList.add('hidden');
            }
        });
        
        // 显示创建讨论表单
        createDiscussionBtn.addEventListener('click', () => {
            discussionForm.classList.toggle('hidden');
            if (!discussionForm.classList.contains('hidden')) {
                discussionTitle.focus();
            }
        });
        
        // 取消创建讨论
        cancelDiscussion.addEventListener('click', () => {
            discussionForm.classList.add('hidden');
            // 清空表单
            discussionTitle.value = '';
            discussionContent.value = '';
        });
        
        // 发布讨论
        publishDiscussion.addEventListener('click', () => {
            const title = discussionTitle.value.trim();
            const content = discussionContent.value.trim();
            
            if (!title) {
                showToast('请输入讨论主题', 'error');
                return;
            }
            
            if (!content) {
                showToast('请输入讨论内容', 'error');
                return;
            }
            
            communicationCollaborationSystem.createDiscussion(title, content);
            
            // 清空并关闭表单
            discussionTitle.value = '';
            discussionContent.value = '';
            discussionForm.classList.add('hidden');
            
            showToast('讨论发布成功');
        });

        openPublish.addEventListener('click', () => publishModal.classList.remove('hidden'));
        closePublish.addEventListener('click', () => publishModal.classList.add('hidden'));

        openCapture.addEventListener('click', () => captureDrawer.classList.remove('hidden'));
        closeCapture.addEventListener('click', () => captureDrawer.classList.add('hidden'));

        sectionButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                sectionButtons.forEach(b => b.classList.remove('bg-primary', 'text-white'));
                sectionButtons.forEach(b => b.classList.add('bg-white', 'border', 'border-line'));
                btn.classList.add('bg-primary', 'text-white');
                btn.classList.remove('bg-white', 'border', 'border-line');
                sectionPanels.forEach(panel => panel.classList.remove('active'));
                document.getElementById(`knowledge-${btn.dataset.section}`).classList.add('active');
            });
        });

        viewButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                viewButtons.forEach(b => b.classList.remove('bg-primary', 'text-white'));
                viewButtons.forEach(b => b.classList.add('bg-white', 'border', 'border-line'));
                btn.classList.add('bg-primary', 'text-white');
                btn.classList.remove('bg-white', 'border', 'border-line');
                viewPanels.forEach(panel => panel.classList.remove('active'));
                document.getElementById(`knowledge-${btn.dataset.view}`).classList.add('active');
            });
        });

        tabButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                // 获取所有同组的tab按钮和面板
                const buttons = btn.closest('[class*="bg-surface"]').querySelectorAll('.tab-btn');
                const panels = btn.closest('[class*="bg-surface"]').querySelectorAll('.tab-panel');
                
                // 移除所有按钮的活动状态
                buttons.forEach(b => {
                    b.classList.remove('bg-primary', 'text-white');
                    b.classList.add('bg-white', 'border', 'border-line');
                });
                
                // 移除所有面板的活动状态
                panels.forEach(panel => panel.classList.remove('active'));
                
                // 设置当前按钮和面板为活动状态
                btn.classList.add('bg-primary', 'text-white');
                btn.classList.remove('bg-white', 'border', 'border-line');
                
                const targetPanel = document.getElementById(`tab-${btn.dataset.tab}`);
                if (targetPanel) {
                    targetPanel.classList.add('active');
                }
            });
        });

        saveQuickNote.addEventListener('click', () => {
            const value = quickNoteInput.value.trim();
            if (!value) return;
            const item = document.createElement('li');
            item.className = 'p-3 rounded-lg bg-mist';
            item.textContent = value;
            quickNoteList.prepend(item);
            quickNoteInput.value = '';
        });

        if (saveClip && clipList && clipUrl) {
            saveClip.addEventListener('click', () => {
                const value = clipUrl.value.trim();
                if (!value) return;
                const item = document.createElement('li');
                item.className = 'p-3 rounded-lg bg-mist';
                item.textContent = value;
                clipList.prepend(item);
                clipUrl.value = '';
            });
        }

        let recordingInitial = false;
        let recordIntervalInitial = null;
        let recordSecondsInitial = 0;
        if (recordToggle) {
            recordToggle.addEventListener('click', () => {
                recordingInitial = !recordingInitial;
                if (recordingInitial) {
                    recordToggle.textContent = '暂停录音';
                    recordToggle.classList.remove('bg-danger');
                    recordToggle.classList.add('bg-secondary');
                    recordIntervalInitial = setInterval(() => {
                        recordSecondsInitial += 1;
                        const mins = String(Math.floor(recordSecondsInitial / 60)).padStart(2, '0');
                        const secs = String(recordSecondsInitial % 60).padStart(2, '0');
                        if (recordTimer) {
                            recordTimer.textContent = `${mins}:${secs}`;
                        }
                    }, 1000);
                } else {
                    recordToggle.textContent = '开始录音';
                    recordToggle.classList.remove('bg-secondary');
                    recordToggle.classList.add('bg-danger');
                    clearInterval(recordIntervalInitial);
                }
            });
        }

        // 术语定义数据
        const termDefinitions = {
            '客户续约率': {
                definition: '客户在合同到期后选择继续使用产品或服务的比例，是衡量客户忠诚度和产品价值的关键指标。',
                domain: '销售与客户关系管理',
                related: ['客户满意度', '流失率', '客户生命周期价值'],
                properties: ['月度续约率', '年度续约率', '合同金额加权续约率']
            },
            '风险等级': {
                definition: '基于客户行为、财务状况和合作历史评估的风险程度，用于指导销售和服务策略。',
                domain: '风险管理与客户关系管理',
                related: ['信用评级', '逾期率', '投诉记录'],
                properties: ['高风险', '中风险', '低风险', '无风险']
            },
            '项目里程碑': {
                definition: '项目执行过程中的关键节点，标志着特定阶段工作的完成，用于跟踪项目进度。',
                domain: '项目管理',
                related: ['项目计划', '进度跟踪', '交付物'],
                properties: ['启动阶段', '规划阶段', '执行阶段', '收尾阶段']
            },
            '投诉处理': {
                definition: '对客户投诉的接收、记录、调查、解决和跟踪的全过程管理，旨在提升客户满意度。',
                domain: '客户服务与质量管理',
                related: ['客户满意度', '问题解决率', '响应时间'],
                properties: ['投诉类型', '解决时间', '客户反馈']
            }
        };

        // 术语气泡卡片
        const createTermBubble = (term, x, y) => {
            const bubble = document.createElement('div');
            bubble.className = 'term-bubble fixed z-50 bg-white rounded-lg shadow-lg border border-line p-4 max-w-xs text-sm';
            bubble.style.left = `${x}px`;
            bubble.style.top = `${y}px`;
            
            const termData = termDefinitions[term] || {
                definition: '该术语在企业本体中尚未定义',
                domain: '未知',
                related: [],
                properties: []
            };
            
            bubble.innerHTML = `
                <div class="flex justify-between items-start mb-2">
                    <h4 class="font-semibold text-primary">${term}</h4>
                    <button class="close-bubble text-muted hover:text-ink"><i class="fa fa-times"></i></button>
                </div>
                <p class="text-xs mb-3">${termData.definition}</p>
                <div class="text-xs space-y-2">
                    <div>
                        <span class="font-medium">业务域：</span>
                        <span class="text-muted">${termData.domain}</span>
                    </div>
                    ${termData.properties.length > 0 ? `<div>
                        <span class="font-medium">属性：</span>
                        <span class="text-muted">${termData.properties.join(', ')}</span>
                    </div>` : ''}
                    ${termData.related.length > 0 ? `<div>
                        <span class="font-medium">关联术语：</span>
                        <span class="text-muted">${termData.related.join(', ')}</span>
                    </div>` : ''}
                </div>
                <div class="mt-3 flex gap-2">
                    <button class="px-2 py-1 rounded bg-primary/10 text-primary text-xs">查看更多</button>
                    <button class="px-2 py-1 rounded bg-primary/10 text-primary text-xs">添加到知识卡片</button>
                </div>
            `;
            
            return bubble;
        };

        // 术语按钮点击事件
        if (termButtons) {
            termButtons.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const term = btn.dataset.term;
                    const termData = termDefinitions[term];
                    if (termData && termDefinition) {
                        termDefinition.innerHTML = `
                            <p class="font-medium">${term}</p>
                            <p class="text-xs text-muted mt-1">${termData.definition}</p>
                            <p class="text-xs text-muted mt-1">业务域：${termData.domain}</p>
                        `;
                    }
                });
            });
        }

        // 术语高亮点击事件
        const termHighlights = document.querySelectorAll('.term-highlight');
        termHighlights.forEach(highlight => {
            highlight.addEventListener('click', (e) => {
                const term = highlight.textContent;
                const rect = highlight.getBoundingClientRect();
                
                // 移除现有气泡
                const existingBubble = document.querySelector('.term-bubble');
                if (existingBubble) {
                    existingBubble.remove();
                }
                
                // 创建新气泡
                const bubble = createTermBubble(term, rect.right + 10, rect.top);
                document.body.appendChild(bubble);
                
                // 点击关闭按钮
                const closeBtn = bubble.querySelector('.close-bubble');
                closeBtn.addEventListener('click', () => {
                    bubble.remove();
                });
                
                // 点击页面其他地方关闭气泡
                document.addEventListener('click', (e) => {
                    if (!bubble.contains(e.target) && e.target !== highlight) {
                        bubble.remove();
                    }
                });
            });
        });

        // 解释按钮点击事件
        const explainBtns = document.querySelectorAll('.explain-btn');
        explainBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                // 模拟解释所有高亮术语
                const firstHighlight = document.querySelector('.term-highlight');
                if (firstHighlight) {
                    firstHighlight.click();
                }
            });
        });

        // 情境智能伴读面板功能
        // 关联知识数据
        const contextKnowledge = {
            'XX科技公司': {
                summary: {
                    industry: '智能制造',
                    cooperationYears: 3,
                    responsiblePerson: '李强',
                    position: '销售总监'
                },
                relatedKnowledge: [
                    { title: '客户投诉处理方案', type: '文档', date: '2024/06' },
                    { title: '续约策略模板', type: '文档', date: '2024/05' },
                    { title: '竞争对手动态', type: '报告', date: '2024/04' },
                    { title: '智能制造行业分析', type: '报告', date: '2024/03' },
                    { title: '客户服务流程优化', type: '文档', date: '2024/02' }
                ],
                recentActivities: [
                    { type: '投诉', content: '产品功能问题投诉', date: '2024-07-15' },
                    { type: '会议', content: '季度业务回顾会议', date: '2024-07-10' },
                    { type: '合同', content: '年度合同续签', date: '2024-06-20' },
                    { type: '反馈', content: '新产品功能建议', date: '2024-06-15' }
                ]
            }
        };

        // 情境识别功能
        const contextRecognition = () => {
            // 模拟情境识别
            const clientName = 'XX科技公司';
            const contextData = contextKnowledge[clientName];
            
            if (contextData) {
                // 更新情境面板信息
                updateContextPanel(contextData);
                return contextData;
            }
            return null;
        };

        // 更新情境面板
        const updateContextPanel = (contextData) => {
            // 这里可以更新情境面板的内容
            // 由于HTML结构中没有具体的情境面板ID，我们可以模拟这个功能
            console.log('情境面板已更新:', contextData);
        };

        // 快速操作功能
        const quickActionBtns = document.querySelectorAll('.quick-action-btn');
        quickActionBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const action = btn.textContent.trim();
                switch (action) {
                    case '发起会议':
                        showToast('正在创建会议...');
                        setTimeout(() => {
                            showToast('会议创建成功，已邀请相关人员');
                        }, 1000);
                        break;
                    case '发送邮件':
                        showToast('正在打开邮件客户端...');
                        setTimeout(() => {
                            showToast('邮件模板已加载');
                        }, 1000);
                        break;
                    case '创建任务':
                        showToast('正在打开任务管理...');
                        setTimeout(() => {
                            showToast('任务创建界面已打开');
                        }, 1000);
                        break;
                    case '查看详情':
                        showToast('正在加载详细信息...');
                        setTimeout(() => {
                            showToast('详细信息已显示');
                        }, 1000);
                        break;
                }
            });
        });

        // 页面加载时进行情境识别
        document.addEventListener('DOMContentLoaded', () => {
            const pageContext = document.getElementById('page-context');
            if (pageContext) {
                contextRecognition();
            }
        });

        // 快速捕获工具功能
        // 保存按钮点击事件
        const saveBtns = document.querySelectorAll('.save-btn');
        saveBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                // 模拟快速捕获
                showToast('正在捕获当前内容...');
                
                // 模拟智能标注
                setTimeout(() => {
                    showToast('内容已捕获，正在进行智能标注...');
                    
                    // 模拟入库流程
                    setTimeout(() => {
                        showToast('已保存到知识熔炉待处理队列');
                    }, 1000);
                }, 1000);
            });
        });

        // 搜索按钮点击事件
        const searchBtns = document.querySelectorAll('.search-btn');
        searchBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                // 模拟知识搜索
                showToast('正在搜索相关知识...');
                
                // 模拟搜索结果展示
                setTimeout(() => {
                    showToast('搜索完成，已显示相关知识');
                }, 1000);
            });
        });

        // 快速捕获工具 - 网页剪藏功能
        const captureTool = {
            // 全页保存
            saveFullPage: () => {
                showToast('正在保存完整网页...');
                setTimeout(() => {
                    showToast('网页已保存为HTML格式');
                }, 1500);
            },
            
            // 区域截图
            captureSelection: () => {
                showToast('请选择要截图的区域...');
                // 这里可以实现实际的区域选择功能
                setTimeout(() => {
                    showToast('区域已截图并保存');
                }, 2000);
            },
            
            // 文本摘录
            extractText: () => {
                showToast('正在提取选中的文本...');
                setTimeout(() => {
                    showToast('文本已提取并保存');
                }, 1000);
            }
        };

        // 智能标注功能
        const smartAnnotate = (content) => {
            // 模拟智能标注
            return {
                title: content.substring(0, 20) + '...',
                summary: content.substring(0, 100) + '...',
                keywords: ['客户', '合同', '风险', '续约'],
                contentType: '客户信息'
            };
        };

        // 入库流程
        const submitToKnowledgeFurnace = (capturedContent, annotations) => {
            // 模拟入库流程
            showToast('正在提交到知识熔炉...');
            setTimeout(() => {
                showToast('已提交到知识熔炉待处理队列');
            }, 1500);
        };

        // 智能提醒与主动推送功能
        // 提醒数据结构
        const reminders = [
            {
                id: 1,
                type: '情境触发',
                title: 'XX科技公司合同到期提醒',
                content: 'XX科技公司的年度合同将于30天后到期，请提前准备续约事宜。',
                time: '2024-07-20 10:30',
                read: false
            },
            {
                id: 2,
                type: '定期推送',
                title: '智能制造行业动态更新',
                content: '本周智能制造行业有3篇重要报告已更新，点击查看详情。',
                time: '2024-07-20 14:00',
                read: false
            },
            {
                id: 3,
                type: '任务提醒',
                title: 'XX科技公司投诉处理跟进',
                content: '请跟进XX科技公司的产品功能问题投诉，预计今天下午完成。',
                time: '2024-07-20 16:00',
                read: false
            }
        ];

        // 智能提醒系统
        const reminderSystem = {
            // 发送提醒
            sendReminder: (reminder) => {
                // 创建提醒通知
                const notification = document.createElement('div');
                notification.className = 'notification fixed top-4 right-4 bg-white border border-line rounded-lg shadow-lg p-4 flex items-start gap-3 z-50 animate-slide-in';
                
                notification.innerHTML = `
                    <div class="text-yellow-500 text-xl"><i class="fa fa-bell"></i></div>
                    <div class="flex-1">
                        <h4 class="font-medium">${reminder.title}</h4>
                        <p class="text-xs text-muted mt-1">${reminder.content}</p>
                        <p class="text-xs text-muted mt-1">${reminder.time}</p>
                    </div>
                    <button class="close-notification text-muted hover:text-ink"><i class="fa fa-times"></i></button>
                `;
                
                // 添加到页面
                document.body.appendChild(notification);
                
                // 点击关闭按钮
                const closeBtn = notification.querySelector('.close-notification');
                closeBtn.addEventListener('click', () => {
                    notification.remove();
                });
                
                // 3秒后自动关闭
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.classList.add('animate-slide-out');
                        setTimeout(() => {
                            notification.remove();
                        }, 300);
                    }
                }, 3000);
            },
            
            // 情境触发提醒
            contextTrigger: (context) => {
                // 模拟情境触发
                const contextReminders = reminders.filter(r => r.type === '情境触发');
                contextReminders.forEach(reminder => {
                    reminderSystem.sendReminder(reminder);
                });
            },
            
            // 定期推送
            schedulePush: () => {
                // 模拟定期推送
                const scheduledReminders = reminders.filter(r => r.type === '定期推送');
                scheduledReminders.forEach(reminder => {
                    reminderSystem.sendReminder(reminder);
                });
            }
        };

        // 提醒管理功能
        const reminderManagement = {
            // 标记已读
            markAsRead: (reminderId) => {
                const reminder = reminders.find(r => r.id === reminderId);
                if (reminder) {
                    reminder.read = true;
                    showToast('提醒已标记为已读');
                }
            },
            
            // 删除提醒
            deleteReminder: (reminderId) => {
                const index = reminders.findIndex(r => r.id === reminderId);
                if (index > -1) {
                    reminders.splice(index, 1);
                    showToast('提醒已删除');
                }
            },
            
            // 获取未读提醒
            getUnreadReminders: () => {
                return reminders.filter(r => !r.read);
            },
            
            // 查看所有提醒
            viewAllReminders: () => {
                return reminders;
            }
        };

        // 模拟定期推送（每10秒）
        setInterval(() => {
            reminderSystem.schedulePush();
        }, 10000);

        // 模拟情境触发提醒
        setTimeout(() => {
            reminderSystem.contextTrigger('XX科技公司');
        }, 5000);

        // 查看提醒按钮点击事件
        const viewRemindersBtns = document.querySelectorAll('.view-reminders-btn');
        viewRemindersBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const unreadCount = reminderManagement.getUnreadReminders().length;
                showToast(`您有 ${unreadCount} 条未读提醒`);
                
                // 模拟打开提醒管理界面
                setTimeout(() => {
                    showToast('提醒管理界面已打开');
                }, 500);
            });
        });

        // 团队空间管理功能
        const teamSpaceManager = {
            // 空间数据
            spaces: [
                {
                    id: 'project-space',
                    name: 'Q1新产品开发',
                    type: '项目空间',
                    description: '2024年第一季度新产品开发项目',
                    members: 8,
                    status: '活跃',
                    healthScore: 82
                },
                {
                    id: 'team-space',
                    name: '研发中心',
                    type: '团队空间',
                    description: '公司研发中心团队协作空间',
                    members: 24,
                    status: '活跃',
                    healthScore: 79
                },
                {
                    id: 'theme-space',
                    name: '技术创新小组',
                    type: '主题空间',
                    description: '跨部门技术创新协作小组',
                    members: 12,
                    status: '活跃',
                    healthScore: 85
                }
            ],
            
            // 当前选中的空间
            currentSpace: 'project-space',
            
            // 切换空间
            switchSpace: (spaceId) => {
                const space = teamSpaceManager.spaces.find(s => s.id === spaceId);
                if (space) {
                    teamSpaceManager.currentSpace = spaceId;
                    showToast(`正在切换到 ${space.name}...`);
                    // 这里可以添加实际的空间切换逻辑
                    setTimeout(() => {
                        showToast('空间切换成功');
                        // 更新讨论区显示当前空间的讨论
                        if (typeof communicationCollaborationSystem !== 'undefined' && communicationCollaborationSystem.renderDiscussions) {
                            communicationCollaborationSystem.renderDiscussions();
                        }
                    }, 1000);
                }
            },
            
            // 创建新空间
            createSpace: (spaceData) => {
                teamSpaceManager.spaces.push(spaceData);
                showToast(`空间 ${spaceData.name} 创建成功`);
                // 更新空间选择器
                const spaceSelector = document.getElementById('space-selector');
                if (spaceSelector) {
                    const option = document.createElement('option');
                    option.value = spaceData.id;
                    option.textContent = `${spaceData.name} (${spaceData.type})`;
                    spaceSelector.appendChild(option);
                }
                
                // 更新空间统计信息
                teamSpaceManager.updateSpaceStatistics();
            },
            
            // 获取空间健康度
            getSpaceHealth: (spaceId) => {
                const space = teamSpaceManager.spaces.find(s => s.id === spaceId);
                return space ? space.healthScore : 0;
            },
            
            // 更新空间统计信息
            updateSpaceStatistics: () => {
                // 计算不同类型空间的数量
                const projectSpaces = teamSpaceManager.spaces.filter(space => space.type === '项目空间').length;
                const teamSpaces = teamSpaceManager.spaces.filter(space => space.type === '团队空间').length;
                const themeSpaces = teamSpaceManager.spaces.filter(space => space.type === '主题空间').length;
                
                // 更新项目空间统计
                const projectSpaceStat = document.querySelector('.bg-ocean p:nth-child(2)');
                if (projectSpaceStat) {
                    projectSpaceStat.textContent = `${projectSpaces}个活跃项目`;
                }
                
                // 更新团队空间统计
                const teamSpaceStat = document.querySelector('.bg-coral p:nth-child(2)');
                if (teamSpaceStat) {
                    teamSpaceStat.textContent = `${teamSpaces}个部门团队`;
                }
                
                // 更新主题空间统计
                const themeSpaceStat = document.querySelector('.bg-mist p:nth-child(2)');
                if (themeSpaceStat) {
                    themeSpaceStat.textContent = `${themeSpaces}个跨部门主题`;
                }
            }
        };

        // 空间选择器事件
        const spaceSelector = document.getElementById('space-selector');
        if (spaceSelector) {
            spaceSelector.addEventListener('change', (e) => {
                teamSpaceManager.switchSpace(e.target.value);
            });
        }

        // 创建空间按钮事件
        const createSpaceBtn = document.getElementById('create-space');
        if (createSpaceBtn) {
            createSpaceBtn.addEventListener('click', () => {
                // 打开创建空间模态框
                createSpaceModal.classList.remove('hidden');
                // 重置表单
                createSpaceForm.reset();
            });
        }
        
        // 关闭创建空间模态框
        const closeCreateSpaceModal = () => {
            createSpaceModal.classList.add('hidden');
        };
        
        // 关闭按钮事件
        if (closeCreateSpace) {
            closeCreateSpace.addEventListener('click', closeCreateSpaceModal);
        }
        
        // 取消按钮事件
        if (cancelCreateSpace) {
            cancelCreateSpace.addEventListener('click', closeCreateSpaceModal);
        }
        
        // 创建空间表单提交事件
        if (createSpaceForm) {
            createSpaceForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                // 获取表单数据
                const spaceData = {
                    id: 'space-' + Date.now(),
                    name: newSpaceName.value.trim(),
                    type: newSpaceType.value,
                    description: newSpaceDescription.value.trim(),
                    members: 1, // 默认只有创建者
                    status: '新建',
                    healthScore: 0
                };
                
                // 创建空间
                teamSpaceManager.createSpace(spaceData);
                
                // 关闭模态框
                closeCreateSpaceModal();
            });
        }

        // 空间设置按钮事件
        const spaceSettingsBtn = document.getElementById('space-settings');
        if (spaceSettingsBtn) {
            spaceSettingsBtn.addEventListener('click', () => {
                showToast('正在打开空间设置...');
                setTimeout(() => {
                    showToast('空间设置界面已打开');
                }, 1000);
            });
        }

        if (runQualityCheckBtn) {
            runQualityCheckBtn.addEventListener('click', () => {
                if (maturityLevel && qualityScore) {
                    maturityLevel.textContent = '成熟';
                    qualityScore.textContent = '86 / 100';
                }
            });
        }

        // 轻量生产工具 - 速记功能增强
        const quickNoteTitle = document.getElementById('quick-note-title');
        const voiceInputBtn = document.getElementById('voice-input-btn');
        const photoOcrBtn = document.getElementById('photo-ocr-btn');
        const scanDocBtn = document.getElementById('scan-doc-btn');
        const setReminderBtn = document.getElementById('set-reminder-btn');
        const autoTitle = document.getElementById('auto-title');
        const autoTag = document.getElementById('auto-tag');

        // 语音输入功能
        voiceInputBtn.addEventListener('click', () => {
            voiceInputBtn.innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i><span>正在录音...</span>';
            voiceInputBtn.disabled = true;
            
            setTimeout(() => {
                const sampleVoiceText = '今天的会议讨论了产品发布计划，需要在下周五前完成所有准备工作，包括市场推广材料和销售培训。';
                quickNoteInput.value = quickNoteInput.value + (quickNoteInput.value ? '\n' : '') + sampleVoiceText;
                voiceInputBtn.innerHTML = '<i class="fa fa-microphone mr-2"></i><span>语音输入</span>';
                voiceInputBtn.disabled = false;
                
                if (autoTitle.checked && !quickNoteTitle.value) {
                    quickNoteTitle.value = '会议记录 - ' + new Date().toLocaleDateString();
                }
            }, 2000);
        });

        // 拍照OCR功能
        photoOcrBtn.addEventListener('click', () => {
            photoOcrBtn.innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i><span>识别中...</span>';
            photoOcrBtn.disabled = true;
            
            setTimeout(() => {
                const sampleOcrText = '产品规格\n型号：ZH-2024\n尺寸：120x80x20mm\n重量：250g\n材质：铝合金';
                quickNoteInput.value = quickNoteInput.value + (quickNoteInput.value ? '\n\n' : '') + '【图片识别结果】\n' + sampleOcrText;
                photoOcrBtn.innerHTML = '<i class="fa fa-camera mr-2"></i><span>拍照OCR</span>';
                photoOcrBtn.disabled = false;
            }, 1500);
        });

        // 扫描文档功能
        scanDocBtn.addEventListener('click', () => {
            scanDocBtn.innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i><span>扫描中...</span>';
            scanDocBtn.disabled = true;
            
            setTimeout(() => {
                const sampleDocText = '【文档扫描】\n客户合同编号：CON-2024-001\n签约日期：2024-07-15\n合同金额：¥500,000\n有效期：12个月';
                quickNoteInput.value = quickNoteInput.value + (quickNoteInput.value ? '\n\n' : '') + sampleDocText;
                scanDocBtn.innerHTML = '<i class="fa fa-file-text-o mr-2"></i><span>扫描文档</span>';
                scanDocBtn.disabled = false;
            }, 2000);
        });

        // 设置提醒功能
        setReminderBtn.addEventListener('click', () => {
            const reminderText = prompt('请输入提醒内容：', '跟进客户合同审批');
            if (reminderText) {
                const reminderTime = prompt('请输入提醒时间（如：明天 10:00）：', '明天 10:00');
                if (reminderTime) {
                    alert(`提醒已设置：\n内容：${reminderText}\n时间：${reminderTime}`);
                }
            }
        });

        // AI自动生成标题
        autoTitle.addEventListener('change', () => {
            if (autoTitle.checked && quickNoteInput.value && !quickNoteTitle.value) {
                quickNoteTitle.value = '速记 - ' + new Date().toLocaleDateString() + ' ' + new Date().toLocaleTimeString();
            }
        });

        // 保存速记增强功能
        const saveQuickNoteBtn = document.getElementById('save-quick-note');
        saveQuickNoteBtn.addEventListener('click', () => {
            const title = quickNoteTitle.value || (autoTitle.checked ? '速记 - ' + new Date().toLocaleString() : '未命名速记');
            const content = quickNoteInput.value.trim();
            
            if (!content) return;
            
            const item = document.createElement('li');
            item.className = 'p-3 rounded-lg bg-ocean/30 border border-primary/10 transition-all hover:shadow-sm';
            item.innerHTML = `
                <div class="flex items-center justify-between mb-1">
                    <span class="font-medium">${title}</span>
                    <span class="text-xs text-muted">刚刚</span>
                </div>
                <p class="text-sm text-muted">${content.length > 50 ? content.substring(0, 50) + '...' : content}</p>
                <div class="mt-2 flex items-center gap-2">
                    <span class="px-2 py-0.5 rounded-full bg-primary/10 text-primary text-xs">${autoTag.checked ? '已加标签' : '待分类'}</span>
                    <button class="text-xs text-secondary hover:text-primary">编辑</button>
                </div>
            `;
            
            const quickNoteList = document.getElementById('quick-note-list');
            quickNoteList.prepend(item);
            
            // 清空输入
            quickNoteTitle.value = '';
            quickNoteInput.value = '';
        });

        // 轻量生产工具 - 录音功能增强
        const recordPauseBtn = document.getElementById('record-pause');
        const recordMarkBtn = document.getElementById('record-mark');
        const quickVoiceNoteBtn = document.getElementById('quick-voice-note');
        const transcriptDisplay = document.getElementById('transcript-display');
        const transcriptStats = document.getElementById('transcript-stats');
        const speakerChangeBtn = document.getElementById('speaker-change-btn');
        const exportTranscriptBtn = document.getElementById('export-transcript-btn');
        const generateSummaryBtn = document.getElementById('generate-summary-btn');
        let recordingEnhanced = false;
        let paused = false;
        let recordIntervalEnhanced = null;
        let recordSecondsEnhanced = 0;
        let currentSpeaker = 1;
        let transcriptLines = [];
        
        const recordToggleBtn = document.getElementById('record-toggle');
        const recordTimerEnhanced = document.getElementById('record-timer');
        
        // 开始/停止录音
        recordToggleBtn.addEventListener('click', () => {
            recordingEnhanced = !recordingEnhanced;
            
            if (recordingEnhanced) {
                recordToggleBtn.innerHTML = '<i class="fa fa-stop"></i>';
                recordToggleBtn.classList.remove('bg-danger');
                recordToggleBtn.classList.add('bg-success');
                recordPauseBtn.disabled = false;
                recordPauseBtn.style.opacity = '1';
                recordMarkBtn.disabled = false;
                recordMarkBtn.style.opacity = '1';
                speakerChangeBtn.disabled = false;
                speakerChangeBtn.style.opacity = '1';
                transcriptDisplay.innerHTML = '';
                transcriptLines = [];
                currentSpeaker = 1;
                
                // 开始计时
                recordIntervalEnhanced = setInterval(() => {
                    if (!paused) {
                        recordSecondsEnhanced += 1;
                        const mins = String(Math.floor(recordSecondsEnhanced / 60)).padStart(2, '0');
                        const secs = String(recordSecondsEnhanced % 60).padStart(2, '0');
                        if (recordTimerEnhanced) {
                            recordTimerEnhanced.textContent = `${mins}:${secs}`;
                        }
                        updateTranscriptStats();
                    }
                }, 1000);
                
                // 模拟实时转写
                simulateTranscript();
            } else {
                recordToggleBtn.innerHTML = '<i class="fa fa-microphone"></i>';
                recordToggleBtn.classList.remove('bg-success');
                recordToggleBtn.classList.add('bg-danger');
                recordPauseBtn.disabled = true;
                recordPauseBtn.style.opacity = '0.5';
                recordMarkBtn.disabled = true;
                recordMarkBtn.style.opacity = '0.5';
                speakerChangeBtn.disabled = true;
                speakerChangeBtn.style.opacity = '0.5';
                
                clearInterval(recordIntervalEnhanced);
                
                // 重置录音状态
                setTimeout(() => {
                    recordSecondsEnhanced = 0;
                    if (recordTimerEnhanced) {
                        recordTimerEnhanced.textContent = '00:00';
                    }
                    paused = false;
                    recordPauseBtn.innerHTML = '<i class="fa fa-pause"></i><span>暂停</span>';
                    updateTranscriptStats();
                }, 1000);
            }
        });
        
        // 暂停/继续录音
        recordPauseBtn.addEventListener('click', () => {
            paused = !paused;
            
            if (paused) {
                recordPauseBtn.innerHTML = '<i class="fa fa-play"></i><span>继续</span>';
            } else {
                recordPauseBtn.innerHTML = '<i class="fa fa-pause"></i><span>暂停</span>';
            }
        });
        
        // 标记关键点
        recordMarkBtn.addEventListener('click', () => {
            const markTime = recordTimer.textContent;
            const markItem = document.createElement('div');
            markItem.className = 'flex items-center gap-2 mt-2 text-xs text-muted bg-primary/5 p-2 rounded-lg';
            markItem.innerHTML = `
                <i class="fa fa-flag text-warning"></i>
                <span>关键点标记 - ${markTime}</span>
                <button class="ml-auto text-primary hover:text-primary-dark" onclick="editMark(this)">
                    <i class="fa fa-pencil"></i>
                </button>
            `;
            transcriptDisplay.appendChild(markItem);
        });
        
        // 快速语音备忘
        quickVoiceNoteBtn.addEventListener('click', () => {
            quickVoiceNoteBtn.innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i><span>录音中...</span>';
            quickVoiceNoteBtn.disabled = true;
            
            setTimeout(() => {
                quickVoiceNoteBtn.innerHTML = '<i class="fa fa-plus mr-2"></i><span>新建语音备忘</span>';
                quickVoiceNoteBtn.disabled = false;
                
                alert('语音备忘已创建！\n内容：下周一跟进供应商报价\n时长：30秒');
            }, 2000);
        });
        
        // 切换说话人
        if (speakerChangeBtn) {
            speakerChangeBtn.addEventListener('click', () => {
                currentSpeaker = currentSpeaker + 1 > 3 ? 1 : currentSpeaker + 1;
                const speakers = ['张', '李', '王'];
                alert(`已切换到说话人：${speakers[currentSpeaker-1]}`);
            });
        }
        
        // 导出转写文本
        if (exportTranscriptBtn) {
            exportTranscriptBtn.addEventListener('click', () => {
                if (transcriptLines.length === 0) {
                    alert('没有可导出的转写内容！');
                    return;
                }
                
                const transcriptText = transcriptLines.map(line => `${line.speaker}: ${line.text}`).join('\n');
                const blob = new Blob([transcriptText], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `transcript_${new Date().toISOString().slice(0, 10)}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            });
        }
        
        // 生成会议摘要
        if (generateSummaryBtn) {
            generateSummaryBtn.addEventListener('click', () => {
                if (transcriptLines.length === 0) {
                    alert('没有可生成摘要的内容！');
                    return;
                }
                
                const summary = `会议摘要：\n\n1. 讨论了Q3产品规划\n2. 重点关注用户增长和留存\n3. 计划优化产品体验，特别是注册流程\n4. 将制定具体的实施计划\n\n总字数：${transcriptLines.reduce((sum, line) => sum + line.text.length, 0)}字`;
                alert(summary);
            });
        }
        
        // 更新转写统计信息
        function updateTranscriptStats() {
            if (!transcriptStats) return;
            
            const totalWords = transcriptLines.reduce((sum, line) => sum + line.text.split(' ').length, 0);
            const totalSpeakers = new Set(transcriptLines.map(line => line.speaker)).size;
            
            transcriptStats.innerHTML = `
                <div class="text-center">
                    <div class="grid grid-cols-3 gap-2">
                        <div>
                            <span class="text-lg font-medium">${transcriptLines.length}</span>
                            <p class="text-xs text-muted">转写行数</p>
                        </div>
                        <div>
                            <span class="text-lg font-medium">${totalWords}</span>
                            <p class="text-xs text-muted">总字数</p>
                        </div>
                        <div>
                            <span class="text-lg font-medium">${totalSpeakers}</span>
                            <p class="text-xs text-muted">说话人数</p>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // 模拟实时转写
        function simulateTranscript() {
            const transcriptData = [
                { speaker: '张', text: '大家好，今天我们来讨论Q3的产品规划。' },
                { speaker: '李', text: '我认为我们需要重点关注用户增长和留存。' },
                { speaker: '王', text: '是的，我们应该优化产品体验，特别是注册流程。' },
                { speaker: '张', text: '好的，那我们接下来讨论具体的实施计划。' },
                { speaker: '李', text: '首先，我们需要完成用户调研，了解他们的需求。' },
                { speaker: '王', text: '然后我们可以根据调研结果制定产品功能列表。' },
                { speaker: '张', text: '最后，我们需要设定明确的时间线和里程碑。' }
            ];
            
            let lineIndex = 0;
            const transcriptInterval = setInterval(() => {
                if (lineIndex < transcriptData.length && recording && !paused) {
                    const line = transcriptData[lineIndex];
                    addTranscriptLine(line.speaker, line.text);
                    lineIndex++;
                } else if (lineIndex >= transcriptData.length) {
                    clearInterval(transcriptInterval);
                }
            }, 3000);
        }
        
        // 添加转写行
        function addTranscriptLine(speaker, text) {
            const transcriptItem = document.createElement('div');
            transcriptItem.className = 'flex items-start gap-2 p-2 rounded-lg hover:bg-primary/5 transition-colors';
            const speakerColor = speaker === '张' ? 'primary' : speaker === '李' ? 'secondary' : 'accent';
            transcriptItem.innerHTML = `
                <span class="w-6 h-6 rounded-full bg-${speakerColor} text-white text-xs flex items-center justify-center mt-0.5">${speaker}</span>
                <div class="flex-1">
                    <span class="block">${text}</span>
                    <div class="mt-1 text-xs text-muted flex items-center justify-between">
                        <span>${recordTimer.textContent}</span>
                        <div class="flex gap-2">
                            <button class="text-primary hover:text-primary-dark" onclick="editTranscriptLine(this)">
                                <i class="fa fa-pencil"></i>
                            </button>
                            <button class="text-danger hover:text-danger-dark" onclick="deleteTranscriptLine(this)">
                                <i class="fa fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
            transcriptDisplay.appendChild(transcriptItem);
            transcriptDisplay.scrollTop = transcriptDisplay.scrollHeight;
            
            // 保存到转写数组
            transcriptLines.push({ speaker, text });
            updateTranscriptStats();
        }
        
        // 编辑标记
        function editMark(btn) {
            const markItem = btn.closest('div');
            const currentText = markItem.querySelector('span').textContent;
            const newText = prompt('修改标记内容：', currentText);
            if (newText) {
                markItem.querySelector('span').textContent = newText;
            }
        }
        
        // 编辑转写行
        function editTranscriptLine(btn) {
            const transcriptItem = btn.closest('div');
            const currentText = transcriptItem.querySelector('span').textContent;
            const newText = prompt('修改转写内容：', currentText);
            if (newText) {
                transcriptItem.querySelector('span').textContent = newText;
                // 更新数组中的内容
                const index = Array.from(transcriptDisplay.children).indexOf(transcriptItem.closest('div'));
                if (index > -1) {
                    transcriptLines[index].text = newText;
                }
            }
        }
        
        // 删除转写行
        function deleteTranscriptLine(btn) {
            const transcriptItem = btn.closest('div');
            const index = Array.from(transcriptDisplay.children).indexOf(transcriptItem.closest('div'));
            if (index > -1) {
                transcriptDisplay.removeChild(transcriptItem.closest('div'));
                transcriptLines.splice(index, 1);
                updateTranscriptStats();
            }
        }

        // 轻量生产工具 - 剪藏功能增强
        const clipModeRadios = document.querySelectorAll('input[name="clip-mode"]');
        const clipFullPageBtn = document.getElementById('clip-full-page');
        const clipSelectionBtn = document.getElementById('clip-selection');
        const clipScreenshotBtn = document.getElementById('clip-screenshot');
        const clipUrlEnhanced = document.getElementById('clip-url');
        const aiSuggestionsContainer = document.getElementById('ai-suggestions-container');
        const clipPreview = document.getElementById('clip-preview');
        const contentAnalysis = document.getElementById('content-analysis');
        
        // 选择剪藏方式
        clipModeRadios.forEach(radio => {
            radio.addEventListener('change', () => {
                const selectedMode = radio.value;
                updateClipPreview(selectedMode);
                updateClipButtons(selectedMode);
            });
        });
        
        // URL输入实时预览
        clipUrlEnhanced.addEventListener('input', debounce(() => {
            const url = clipUrlEnhanced.value.trim();
            if (url && isValidUrl(url)) {
                generateContentAnalysis(url);
                updateClipPreview(document.querySelector('input[name="clip-mode"]:checked').value);
                generateAIClipSuggestions(url);
            } else {
                clearClipPreview();
                clearContentAnalysis();
                clearAIClipSuggestions();
            }
        }, 500));
        
        // 保存剪藏增强功能
        const saveClipBtn = document.getElementById('save-clip');
        saveClipBtn.addEventListener('click', () => {
            const url = clipUrl.value.trim();
            if (!url) return;
            
            const selectedMode = document.querySelector('input[name="clip-mode"]:checked').value;
            const modes = { read: '阅读模式', full: '完整页面', pdf: 'PDF快照' };
            
            // 模拟AI处理
            saveClipBtn.innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i><span>保存中...</span>';
            saveClipBtn.disabled = true;
            
            setTimeout(() => {
                const item = document.createElement('li');
                item.className = 'p-3 rounded-lg bg-ocean/30 border border-primary/10 hover:shadow-sm cursor-pointer transition-all';
                const siteName = url.split('/')[2] || '网页剪藏';
                item.innerHTML = `
                    <div class="flex items-center justify-between mb-1">
                        <div class="flex items-center gap-2">
                            <i class="fa fa-link text-primary"></i>
                            <span class="font-medium text-sm">${siteName}</span>
                        </div>
                        <span class="text-xs text-muted">刚刚</span>
                    </div>
                    <p class="text-xs text-muted truncate">${url}</p>
                    <div class="mt-1 flex items-center gap-2 text-xs">
                        <span class="px-2 py-0.5 rounded-full bg-primary/10 text-primary">${modes[selectedMode]}</span>
                        <span class="px-2 py-0.5 rounded-full bg-success/10 text-success">已入库</span>
                    </div>
                    <div class="mt-2 flex items-center justify-between">
                        <div class="text-xs text-muted flex gap-2">
                            <span><i class="fa fa-eye mr-1"></i>12</span>
                            <span><i class="fa fa-tag mr-1"></i>3</span>
                        </div>
                        <div class="flex gap-1">
                            <button class="p-1 rounded-full hover:bg-primary/5 text-primary" onclick="editClip(this)">
                                <i class="fa fa-pencil"></i>
                            </button>
                            <button class="p-1 rounded-full hover:bg-danger/5 text-danger" onclick="deleteClip(this)">
                                <i class="fa fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
                
                const clipList = document.getElementById('clip-list');
                clipList.prepend(item);
                
                // 清空输入
                clipUrl.value = '';
                clearClipPreview();
                clearContentAnalysis();
                clearAIClipSuggestions();
                
                saveClipBtn.innerHTML = '<i class="fa fa-save mr-2"></i><span>保存</span>';
                saveClipBtn.disabled = false;
                
                // 更新统计数据
                updateClipStats();
            }, 1500);
        });
        
        // 完整页面剪藏
        clipFullPageBtn.addEventListener('click', () => {
            clipFullPageBtn.innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i><span>剪藏中...</span>';
            clipFullPageBtn.disabled = true;
            
            setTimeout(() => {
                clipFullPageBtn.innerHTML = '<i class="fa fa-file-text-o mr-2"></i><span>完整页面</span>';
                clipFullPageBtn.disabled = false;
                alert('完整页面剪藏功能已启动！');
            }, 1500);
        });
        
        // 选择区域剪藏
        clipSelectionBtn.addEventListener('click', () => {
            clipSelectionBtn.innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i><span>选择中...</span>';
            clipSelectionBtn.disabled = true;
            
            setTimeout(() => {
                clipSelectionBtn.innerHTML = '<i class="fa fa-mouse-pointer mr-2"></i><span>选择区域</span>';
                clipSelectionBtn.disabled = false;
                alert('选择区域剪藏功能已启动！');
            }, 1500);
        });
        
        // 截图剪藏
        clipScreenshotBtn.addEventListener('click', () => {
            clipScreenshotBtn.innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i><span>截图中...</span>';
            clipScreenshotBtn.disabled = true;
            
            setTimeout(() => {
                clipScreenshotBtn.innerHTML = '<i class="fa fa-camera mr-2"></i><span>截图</span>';
                clipScreenshotBtn.disabled = false;
                alert('截图剪藏功能已启动！');
            }, 1500);
        });
        
        // 更新剪藏预览
        function updateClipPreview(mode) {
            if (!clipPreview) return;
            
            const url = clipUrl.value.trim();
            if (!url) return;
            
            const previews = {
                read: '<div class="p-4 rounded-lg border border-line bg-white"><h4 class="font-medium mb-2">阅读模式预览</h4><p class="text-sm text-muted">去除广告和干扰元素，专注阅读内容</p></div>',
                full: '<div class="p-4 rounded-lg border border-line bg-white"><h4 class="font-medium mb-2">完整页面预览</h4><p class="text-sm text-muted">保存整个网页的完整内容</p></div>',
                pdf: '<div class="p-4 rounded-lg border border-line bg-white"><h4 class="font-medium mb-2">PDF快照预览</h4><p class="text-sm text-muted">将网页保存为PDF文档</p></div>'
            };
            
            clipPreview.innerHTML = previews[mode] || previews.read;
        }
        
        // 清空剪藏预览
        function clearClipPreview() {
            if (clipPreview) {
                clipPreview.innerHTML = '<div class="p-4 rounded-lg border border-line bg-white text-center text-sm text-muted">输入URL查看预览</div>';
            }
        }
        
        // 更新剪藏按钮
        function updateClipButtons(mode) {
            const buttons = { clipFullPageBtn, clipSelectionBtn, clipScreenshotBtn };
            
            Object.values(buttons).forEach(btn => {
                btn.classList.remove('bg-primary', 'text-white');
                btn.classList.add('bg-primary/10', 'text-primary');
            });
            
            // 根据模式高亮不同按钮
            if (mode === 'full') {
                clipFullPageBtn.classList.remove('bg-primary/10', 'text-primary');
                clipFullPageBtn.classList.add('bg-primary', 'text-white');
            }
        }
        
        // 生成内容分析
        function generateContentAnalysis(url) {
            if (!contentAnalysis) return;
            
            // 模拟AI内容分析
            const analysis = {
                title: '智能内容分析结果',
                type: '文章',
                length: '约1500字',
                readTime: '5分钟',
                tags: ['技术', '产品', '设计'],
                sentiment: '积极'
            };
            
            contentAnalysis.innerHTML = `
                <div class="p-3 rounded-lg border border-line bg-white">
                    <h4 class="font-medium mb-3 flex items-center gap-2">
                        <i class="fa fa-bar-chart text-primary"></i>
                        ${analysis.title}
                    </h4>
                    <div class="grid grid-cols-2 gap-3 text-xs">
                        <div class="flex items-center gap-2">
                            <i class="fa fa-file-text-o text-muted"></i>
                            <span>类型：${analysis.type}</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <i class="fa fa-clock-o text-muted"></i>
                            <span>阅读时间：${analysis.readTime}</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <i class="fa fa-align-left text-muted"></i>
                            <span>字数：${analysis.length}</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <i class="fa fa-smile-o text-muted"></i>
                            <span>情感：${analysis.sentiment}</span>
                        </div>
                    </div>
                    <div class="mt-3">
                        <p class="text-xs font-medium mb-1">AI推荐标签：</p>
                        <div class="flex flex-wrap gap-1.5">
                            ${analysis.tags.map(tag => `<span class="px-2 py-0.5 rounded-full bg-primary/10 text-primary text-xs">${tag}</span>`).join('')}
                        </div>
                    </div>
                </div>
            `;
        }
        
        // 清空内容分析
        function clearContentAnalysis() {
            if (contentAnalysis) {
                contentAnalysis.innerHTML = '';
            }
        }
        
        // 生成AI剪藏建议
        function generateAIClipSuggestions(url) {
            if (!aiSuggestionsContainer) return;
            
            const suggestions = [
                { text: '保存为知识库文章', icon: 'fa-book' },
                { text: '提取关键信息', icon: 'fa-info-circle' },
                { text: '生成摘要', icon: 'fa-file-text-o' },
                { text: '翻译成中文', icon: 'fa-language' }
            ];
            
            aiSuggestionsContainer.innerHTML = suggestions.map(suggestion => `
                <div class="p-2 rounded-lg hover:bg-primary/5 cursor-pointer transition-colors flex items-center gap-2" onclick="executeClipSuggestion('${suggestion.text}')">
                    <i class="fa ${suggestion.icon} text-primary"></i>
                    <span class="text-sm">${suggestion.text}</span>
                </div>
            `).join('');
        }
        
        // 清空AI剪藏建议
        function clearAIClipSuggestions() {
            if (aiSuggestionsContainer) {
                aiSuggestionsContainer.innerHTML = '';
            }
        }
        
        // 执行剪藏建议
        function executeClipSuggestion(suggestion) {
            const url = clipUrl.value.trim();
            if (!url) return;
            
            switch (suggestion) {
                case '保存为知识库文章':
                    alert('正在将内容保存为知识库文章...');
                    break;
                case '提取关键信息':
                    alert('正在提取关键信息...');
                    break;
                case '生成摘要':
                    alert('正在生成摘要...');
                    break;
                case '翻译成中文':
                    alert('正在翻译成中文...');
                    break;
            }
        }
        
        // 更新剪藏统计
        function updateClipStats() {
            const clipCount = document.getElementById('clip-count');
            if (clipCount) {
                const currentCount = parseInt(clipCount.textContent) || 0;
                clipCount.textContent = currentCount + 1;
            }
        }
        
        // 编辑剪藏
        function editClip(btn) {
            const clipItem = btn.closest('li');
            const url = clipItem.querySelector('.text-muted').textContent;
            clipUrl.value = url;
            clipList.removeChild(clipItem);
        }
        
        // 删除剪藏
        function deleteClip(btn) {
            const clipItem = btn.closest('li');
            if (confirm('确定要删除这条剪藏吗？')) {
                clipList.removeChild(clipItem);
                updateClipStats();
            }
        }
        
        // 防抖函数
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
        
        // URL验证
        function isValidUrl(string) {
            try {
                new URL(string);
                return true;
            } catch (_) {
                return false;
            }
        }

        // 轻量生产工具 - 待处理队列增强
        const queueSelectAll = document.getElementById('queue-select-all');
        const queueItemCheckboxes = document.querySelectorAll('.queue-item-checkbox');
        const queueFilter = document.getElementById('queue-filter');
        const queueSort = document.getElementById('queue-sort');
        const loadMoreQueue = document.getElementById('load-more-queue');
        const queueList = document.getElementById('queue-list');
        
        // 全选/取消全选
        if (queueSelectAll) {
            queueSelectAll.addEventListener('change', () => {
                const isChecked = queueSelectAll.checked;
                updateQueueItemCheckboxes(isChecked);
                updateBatchActions(isChecked ? queueItemCheckboxes.length > 0 : false);
            });
        }
        
        // 单个选择
        if (queueItemCheckboxes) {
            queueItemCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', () => {
                    const checkedCount = document.querySelectorAll('.queue-item-checkbox:checked').length;
                    if (queueSelectAll) {
                        queueSelectAll.checked = checkedCount === queueItemCheckboxes.length;
                    }
                    updateBatchActions(checkedCount > 0);
                });
            });
        }
        
        // 队列过滤
        if (queueFilter) {
            queueFilter.addEventListener('change', () => {
                const filterValue = queueFilter.value;
                filterQueueItems(filterValue);
            });
        }
        
        // 队列排序
        if (queueSort) {
            queueSort.addEventListener('change', () => {
                const sortValue = queueSort.value;
                sortQueueItems(sortValue);
            });
        }
        
        // 加载更多
        if (loadMoreQueue) {
            loadMoreQueue.addEventListener('click', () => {
                loadMoreQueue.innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i><span>加载中...</span>';
                loadMoreQueue.disabled = true;
                
                setTimeout(() => {
                    loadMoreQueue.innerHTML = '<i class="fa fa-chevron-down mr-2"></i><span>加载更多</span>';
                    loadMoreQueue.disabled = false;
                    
                    // 模拟加载更多数据
                    loadMoreQueueItems();
                }, 1500);
            });
        }
        
        // 更新队列项复选框
        function updateQueueItemCheckboxes(checked) {
            const checkboxes = document.querySelectorAll('.queue-item-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = checked;
            });
        }
        
        // 更新批量操作按钮
        function updateBatchActions(hasSelection) {
            const actionButtons = document.querySelectorAll('#batch-actions button');
            actionButtons.forEach(btn => {
                if (hasSelection) {
                    btn.classList.remove('opacity-50', 'cursor-not-allowed');
                    btn.disabled = false;
                } else {
                    btn.classList.add('opacity-50', 'cursor-not-allowed');
                    btn.disabled = true;
                }
            });
        }
        
        // 过滤队列项
        function filterQueueItems(filterValue) {
            const queueItems = document.querySelectorAll('#queue-list > div');
            
            queueItems.forEach(item => {
                const itemType = item.dataset.type || 'all';
                
                if (filterValue === '全部类型' || filterValue === itemType) {
                    item.style.display = 'block';
                    // 添加淡入动画
                    item.style.opacity = '0';
                    setTimeout(() => {
                        item.style.transition = 'opacity 0.3s ease';
                        item.style.opacity = '1';
                    }, 50);
                } else {
                    item.style.display = 'none';
                }
            });
        }
        
        // 排序队列项
        function sortQueueItems(sortValue) {
            const queueItems = Array.from(document.querySelectorAll('#queue-list > div'));
            const queueListContainer = document.getElementById('queue-list');
            
            // 移除所有子元素
            queueItems.forEach(item => queueListContainer.removeChild(item));
            
            // 根据排序条件排序
            let sortedItems = queueItems;
            
            switch (sortValue) {
                case '按类型排序':
                    sortedItems = queueItems.sort((a, b) => {
                        const typeA = a.dataset.type || '';
                        const typeB = b.dataset.type || '';
                        return typeA.localeCompare(typeB);
                    });
                    break;
                case '按状态排序':
                    sortedItems = queueItems.sort((a, b) => {
                        const statusA = a.dataset.status || '';
                        const statusB = b.dataset.status || '';
                        return statusA.localeCompare(statusB);
                    });
                    break;
                case '按时间排序':
                default:
                    // 默认按时间排序（保持原顺序）
                    break;
            }
            
            // 重新添加排序后的元素
            sortedItems.forEach((item, index) => {
                queueListContainer.appendChild(item);
                // 添加淡入动画
                item.style.opacity = '0';
                item.style.transform = 'translateY(10px)';
                setTimeout(() => {
                    item.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
                    item.style.opacity = '1';
                    item.style.transform = 'translateY(0)';
                }, index * 50);
            });
        }
        
        // 加载更多队列项
        function loadMoreQueueItems() {
            const newItems = [
                {
                    type: '录音',
                    status: '已完成',
                    title: '市场分析会议',
                    description: '分析Q3市场趋势和竞争对手',
                    time: '3小时前',
                    user: '张三',
                    tags: ['会议', '市场分析'],
                    actions: ['查看转写', '分享']
                },
                {
                    type: '速记',
                    status: '待确认',
                    title: '产品需求讨论',
                    description: '新功能需求收集和讨论',
                    time: '4小时前',
                    user: '李四',
                    tags: ['产品', '需求'],
                    actions: ['编辑', '分享']
                }
            ];
            
            // 添加新的队列项
            newItems.forEach(item => {
                addQueueItem(item);
            });
            
            alert(`已加载${newItems.length}条新的队列项！`);
        }
        
        // 添加队列项
        function addQueueItem(item) {
            const queueItem = document.createElement('div');
            queueItem.className = 'p-4 rounded-lg border border-line bg-white shadow-sm hover:shadow-md transition-all';
            queueItem.dataset.type = item.type;
            queueItem.dataset.status = item.status;
            
            // 设置状态样式
            let statusClass = '';
            let statusText = '';
            
            switch (item.status) {
                case '处理中':
                    statusClass = 'bg-secondary/10 text-secondary';
                    statusText = '处理中';
                    break;
                case '已入库':
                    statusClass = 'bg-success/10 text-success';
                    statusText = '已入库';
                    break;
                case '待确认':
                    statusClass = 'bg-warning/10 text-warning';
                    statusText = '待确认';
                    break;
                case '已完成':
                    statusClass = 'bg-primary/10 text-primary';
                    statusText = '已完成';
                    break;
            }
            
            // 设置类型图标
            const typeIcons = {
                '录音': 'fa-file-audio-o',
                '速记': 'fa-pencil',
                '剪藏': 'fa-link'
            };
            
            queueItem.innerHTML = `
                <div class="flex items-start justify-between">
                    <div class="flex items-center gap-2">
                        <input type="checkbox" class="queue-item-checkbox rounded border-line text-primary focus:ring-primary mt-0.5">
                        <div class="w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center">
                            <i class="fa ${typeIcons[item.type] || 'fa-file-text-o'} text-primary"></i>
                        </div>
                        <div>
                            <p class="font-medium">${item.title}</p>
                            <p class="text-xs text-muted">${item.description}</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="px-2 py-0.5 rounded-full ${statusClass} text-xs">${statusText}</span>
                        <button class="p-2 rounded-full hover:bg-primary/5 transition-colors">
                            <i class="fa fa-ellipsis-h text-muted"></i>
                        </button>
                    </div>
                </div>
                <div class="mt-3 grid grid-cols-2 gap-3 text-xs">
                    <div class="flex items-center gap-2">
                        <i class="fa fa-clock-o text-muted"></i>
                        <span class="text-muted">${item.time}</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <i class="fa fa-user-o text-muted"></i>
                        <span class="text-muted">${item.user}</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <i class="fa fa-tags text-muted"></i>
                        <span class="text-muted">${item.tags.join(', ')}</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <i class="fa fa-check-circle text-success"></i>
                        <span class="text-success">已完成</span>
                    </div>
                </div>
                <div class="mt-3 pt-3 border-t border-line flex items-center justify-between">
                    ${item.actions.map(action => {
                        let actionIcon = '';
                        switch (action) {
                            case '查看转写':
                                actionIcon = 'fa-file-text-o';
                                break;
                            case '编辑':
                                actionIcon = 'fa-edit';
                                break;
                            case '分享':
                                actionIcon = 'fa-share';
                                break;
                        }
                        return `<button class="px-3 py-1.5 rounded-lg bg-primary/10 text-primary text-xs hover:bg-primary/20 transition-colors">
                            <i class="fa ${actionIcon} mr-1"></i>
                            <span>${action}</span>
                        </button>`;
                    }).join('')}
                </div>
            `;
            
            // 添加到队列列表
            const queueListContainer = document.getElementById('queue-list');
            queueListContainer.appendChild(queueItem);
            
            // 添加淡入动画
            queueItem.style.opacity = '0';
            queueItem.style.transform = 'translateY(10px)';
            setTimeout(() => {
                queueItem.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
                queueItem.style.opacity = '1';
                queueItem.style.transform = 'translateY(0)';
            }, 100);
            
            // 重新绑定事件
            const newCheckbox = queueItem.querySelector('.queue-item-checkbox');
            newCheckbox.addEventListener('change', () => {
                const checkedCount = document.querySelectorAll('.queue-item-checkbox:checked').length;
                queueSelectAll.checked = checkedCount === document.querySelectorAll('.queue-item-checkbox').length;
                updateBatchActions(checkedCount > 0);
            });
        }
        
        // 初始化队列项数据属性
        function initQueueItemsData() {
            const queueItems = document.querySelectorAll('#queue-list > div');
            
            queueItems.forEach((item, index) => {
                // 为每个队列项添加数据属性
                const types = ['录音', '速记', '剪藏'];
                const statuses = ['处理中', '已入库', '待确认', '已完成'];
                
                item.dataset.type = types[index % types.length];
                item.dataset.status = statuses[index % statuses.length];
            });
        }
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', () => {
            initQueueItemsData();
        });

        // 轻量生产工具 - 桌面工具增强
        const startScreenshotBtn = document.getElementById('start-screenshot');
        const startScreenRecordingBtn = document.getElementById('start-screen-recording');
        const viewClipboardHistoryBtn = document.getElementById('view-clipboard-history');
        
        // 智能截图
        startScreenshotBtn.addEventListener('click', () => {
            startScreenshotBtn.innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i><span>启动中...</span>';
            startScreenshotBtn.disabled = true;
            
            setTimeout(() => {
                startScreenshotBtn.innerHTML = '<i class="fa fa-play mr-2"></i><span>启动截图</span>';
                startScreenshotBtn.disabled = false;
                
                alert('智能截图工具已启动！\n支持：区域截图、窗口截图、滚动截图');
            }, 1500);
        });
        
        // 录屏与标注
        startScreenRecordingBtn.addEventListener('click', () => {
            startScreenRecordingBtn.innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i><span>准备中...</span>';
            startScreenRecordingBtn.disabled = true;
            
            setTimeout(() => {
                startScreenRecordingBtn.innerHTML = '<i class="fa fa-play mr-2"></i><span>开始录屏</span>';
                startScreenRecordingBtn.disabled = false;
                
                alert('录屏工具已启动！\n支持：实时标注、系统声音录制、AI视频摘要');
            }, 2000);
        });
        
        // 剪贴板历史
        viewClipboardHistoryBtn.addEventListener('click', () => {
            viewClipboardHistoryBtn.innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i><span>加载中...</span>';
            viewClipboardHistoryBtn.disabled = true;
            
            setTimeout(() => {
                viewClipboardHistoryBtn.innerHTML = '<i class="fa fa-eye mr-2"></i><span>查看历史</span>';
                viewClipboardHistoryBtn.disabled = false;
                
                alert('剪贴板历史已打开！\n包含：文本、图片、代码片段等内容');
            }, 1500);
        });

        // 优化用户交互体验和动画效果
        
        // 1. 页面加载动画
        document.addEventListener('DOMContentLoaded', () => {
            const pageElements = document.querySelectorAll('.page, .tab-panel');
            pageElements.forEach((element, index) => {
                element.style.opacity = '0';
                element.style.transform = 'translateY(20px)';
                element.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
                
                setTimeout(() => {
                    if (element.classList.contains('active')) {
                        element.style.opacity = '1';
                        element.style.transform = 'translateY(0)';
                    }
                }, 100 + (index * 50));
            });
        });
        
        // 2. 标签页切换动画
        const tabButtonsEnhanced = document.querySelectorAll('.tab-btn');
        tabButtonsEnhanced.forEach(btn => {
            btn.addEventListener('click', () => {
                // 添加按钮点击反馈
                btn.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    btn.style.transform = 'scale(1)';
                }, 100);
                
                // 标签页面板切换动画
                const tabPanelsEnhanced = document.querySelectorAll('.tab-panel');
                tabPanelsEnhanced.forEach(panel => {
                    panel.style.opacity = '0';
                    panel.style.transform = 'translateY(10px)';
                    panel.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
                });
                
                setTimeout(() => {
                    const activePanel = document.querySelector('.tab-panel.active');
                    if (activePanel) {
                        activePanel.style.opacity = '1';
                        activePanel.style.transform = 'translateY(0)';
                    }
                }, 150);
            });
        });
        
        // 3. 按钮和交互元素的悬停效果增强
        const interactiveElements = document.querySelectorAll('button, .tab-btn, .ai-suggestion-item, .queue-item-checkbox, .term-btn');
        interactiveElements.forEach(element => {
            // 添加悬停效果
            element.addEventListener('mouseenter', () => {
                element.style.transition = 'all 0.2s ease';
            });
            
            // 添加点击效果
            element.addEventListener('mousedown', () => {
                if (element.tagName === 'BUTTON') {
                    element.style.transform = 'scale(0.97)';
                }
            });
            
            element.addEventListener('mouseup', () => {
                if (element.tagName === 'BUTTON') {
                    element.style.transform = 'scale(1)';
                }
            });
        });
        
        // 4. 输入框和表单元素的交互效果
        const formElements = document.querySelectorAll('input, textarea, select');
        formElements.forEach(element => {
            element.addEventListener('focus', () => {
                element.style.transition = 'all 0.2s ease';
                element.style.boxShadow = '0 0 0 2px rgba(0, 123, 255, 0.25)';
            });
            
            element.addEventListener('blur', () => {
                element.style.boxShadow = 'none';
            });
        });
        
        // 5. 滚动动画效果
        const scrollableElements = document.querySelectorAll('.tab-panel, #queue-list, #transcript-display');
        scrollableElements.forEach(element => {
            element.addEventListener('scroll', () => {
                // 可以在这里添加滚动相关的动画效果
            });
        });
        
        // 6. 列表项的添加和删除动画
        const addListItemAnimation = (item) => {
            item.style.opacity = '0';
            item.style.transform = 'translateY(-10px)';
            item.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
            
            setTimeout(() => {
                item.style.opacity = '1';
                item.style.transform = 'translateY(0)';
            }, 100);
        };
        
        const removeListItemAnimation = (item, callback) => {
            item.style.opacity = '0';
            item.style.transform = 'translateY(-10px)';
            item.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
            
            setTimeout(() => {
                if (callback) callback();
            }, 300);
        };
        
        // 7. 模态框和抽屉的动画效果
        const modalElements = document.querySelectorAll('.modal, #capture-drawer');
        modalElements.forEach(modal => {
            const openButtons = document.querySelectorAll(`[onclick*="${modal.id}"], [data-modal="${modal.id}"]`);
            const closeButtons = modal.querySelectorAll('.close-modal, .close-drawer');
            
            openButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    modal.style.display = 'block';
                    modal.style.opacity = '0';
                    modal.style.transform = 'scale(0.95)';
                    modal.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
                    
                    setTimeout(() => {
                        modal.style.opacity = '1';
                        modal.style.transform = 'scale(1)';
                    }, 50);
                });
            });
            
            closeButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    modal.style.opacity = '0';
                    modal.style.transform = 'scale(0.95)';
                    
                    setTimeout(() => {
                        modal.style.display = 'none';
                    }, 300);
                });
            });
            
            // 点击模态框外部关闭
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.style.opacity = '0';
                    modal.style.transform = 'scale(0.95)';
                    
                    setTimeout(() => {
                        modal.style.display = 'none';
                    }, 300);
                }
            });
        
        // 8. 平滑滚动效果
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });
        
        // 9. 数据加载状态动画
        const loadingStates = document.querySelectorAll('.loading, [id*="-loading"]');
        loadingStates.forEach(element => {
            // 添加加载动画样式
            element.style.position = 'relative';
            element.innerHTML += '<div class="loading-spinner"></div>';
        });
        
        // 10. 进度条和状态指示器动画
        const progressElements = document.querySelectorAll('.progress-bar, .status-indicator');
        progressElements.forEach(element => {
            const width = element.dataset.progress || '0%';
            element.style.width = '0%';
            element.style.transition = 'width 0.8s ease';
            
            setTimeout(() => {
                element.style.width = width;
            }, 300);
        });
        
        // 重写之前的函数以支持动画
        const originalAddTranscriptLine = addTranscriptLine;
        window.addTranscriptLine = function(speaker, text) {
            originalAddTranscriptLine.call(this, speaker, text);
            // 获取最新添加的转写行元素并添加动画
            const transcriptItems = document.querySelectorAll('#transcript-display > div');
            if (transcriptItems.length > 0) {
                const newItem = transcriptItems[transcriptItems.length - 1];
                addListItemAnimation(newItem);
            }
        };
        
        const originalAddQueueItem = addQueueItem;
        window.addQueueItem = function(item) {
            originalAddQueueItem.call(this, item);
            // 获取最新添加的队列项元素并添加动画
            const queueItems = document.querySelectorAll('#queue-list > div');
            if (queueItems.length > 0) {
                const newItem = queueItems[queueItems.length - 1];
                addListItemAnimation(newItem);
            }
        };
        
        window.deleteTranscriptLine = function(btn) {
            const transcriptItem = btn.closest('div');
            removeListItemAnimation(transcriptItem, () => {
                transcriptItem.remove();
                // 更新转写统计
                transcriptLines = transcriptLines.filter(line => line !== transcriptItem);
                updateTranscriptStats();
            });
        };
        
        window.deleteClip = function(btn) {
            const clipItem = btn.closest('li');
            if (confirm('确定要删除这条剪藏吗？')) {
                removeListItemAnimation(clipItem, () => {
                    clipItem.remove();
                    updateClipStats();
                });
            }
        };

        function showToast(message) {
            if (!toast) return;
            toast.textContent = message;
            toast.classList.remove('hidden');
            setTimeout(() => toast.classList.add('hidden'), 2000);
        }

        if (saveSettings) {
            saveSettings.addEventListener('click', () => {
                showToast('设置已保存');
            });
        }

        if (actionButtons) {
            actionButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const message = btn.dataset.action || '操作已完成';
                    showToast(message);
                });
            });
        }

        if (addFlowStep) {
            addFlowStep.addEventListener('click', () => {
                const step = document.createElement('li');
                step.className = 'p-2 rounded-lg bg-mist';
                step.textContent = '新智能体步骤';
                if (agentFlow) {
                    agentFlow.appendChild(step);
                }
            });
        }

        function initSalesChart() {
            if (!salesChartCanvas) return;
            const parent = salesChartCanvas.parentElement;
            const fallbackWidth = 520;
            const fallbackHeight = 180;
            if (parent) {
                const width = parent.clientWidth || parent.offsetWidth || fallbackWidth;
                const height = parent.clientHeight || parent.offsetHeight || fallbackHeight;
                salesChartCanvas.width = width;
                salesChartCanvas.height = height;
            } else {
                salesChartCanvas.width = fallbackWidth;
                salesChartCanvas.height = fallbackHeight;
            }
            const data = {
                labels: ['1月', '2月', '3月', '4月', '5月', '6月'],
                valuesA: [120, 150, 180, 170, 210, 240],
                valuesB: [100, 120, 140, 160, 180, 200]
            };
            const ctx = salesChartCanvas.getContext('2d');
            const padding = 24;
            const maxVal = Math.max(...data.valuesA, ...data.valuesB);
            const minVal = 0;
            const chartW = salesChartCanvas.width - padding * 2;
            const chartH = salesChartCanvas.height - padding * 2;
            ctx.clearRect(0, 0, salesChartCanvas.width, salesChartCanvas.height);
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, salesChartCanvas.width, salesChartCanvas.height);
            ctx.strokeStyle = 'rgba(15, 23, 42, 0.08)';
            for (let i = 0; i <= 4; i += 1) {
                const y = padding + (chartH / 4) * i;
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(padding + chartW, y);
                ctx.stroke();
            }
            ctx.strokeStyle = 'rgba(15, 23, 42, 0.15)';
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, padding + chartH);
            ctx.lineTo(padding + chartW, padding + chartH);
            ctx.stroke();
            function drawSeries(values, color, fillColor) {
                ctx.fillStyle = fillColor;
                ctx.beginPath();
                values.forEach((val, idx) => {
                    const x = padding + (chartW / (values.length - 1)) * idx;
                    const y = padding + chartH - ((val - minVal) / (maxVal - minVal)) * chartH;
                    if (idx === 0) {
                        ctx.moveTo(x, padding + chartH);
                        ctx.lineTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                });
                ctx.lineTo(padding + chartW, padding + chartH);
                ctx.closePath();
                ctx.fill();

                ctx.strokeStyle = color;
                ctx.lineWidth = 2;
                ctx.beginPath();
                values.forEach((val, idx) => {
                    const x = padding + (chartW / (values.length - 1)) * idx;
                    const y = padding + chartH - ((val - minVal) / (maxVal - minVal)) * chartH;
                    if (idx === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                });
                ctx.stroke();
                ctx.fillStyle = color;
                values.forEach((val, idx) => {
                    const x = padding + (chartW / (values.length - 1)) * idx;
                    const y = padding + chartH - ((val - minVal) / (maxVal - minVal)) * chartH;
                    ctx.beginPath();
                    ctx.arc(x, y, 3, 0, Math.PI * 2);
                    ctx.fill();
                });
            }
            drawSeries(data.valuesA, '#1b2a4e', 'rgba(27, 42, 78, 0.12)');
            drawSeries(data.valuesB, '#00807f', 'rgba(0, 128, 127, 0.12)');
        }

        window.addEventListener('load', () => {
            initSalesChart();
            // 初始化空间统计信息
            if (typeof teamSpaceManager !== 'undefined' && teamSpaceManager.updateSpaceStatistics) {
                teamSpaceManager.updateSpaceStatistics();
            }
        });

        // 新增交互逻辑 - 文档树批量选择
        const toggleSelectMode = document.getElementById('toggle-select-mode');
        const batchActions = document.getElementById('batch-actions');
        const docCheckboxes = document.querySelectorAll('.doc-checkbox');
        const selectedCount = document.getElementById('selected-count');

        if (toggleSelectMode) {
            toggleSelectMode.addEventListener('click', () => {
                const isActive = toggleSelectMode.classList.contains('bg-primary');
                if (isActive) {
                    toggleSelectMode.classList.remove('bg-primary', 'text-white');
                    toggleSelectMode.classList.add('bg-mist');
                    docCheckboxes.forEach(cb => cb.classList.add('hidden'));
                    batchActions.classList.add('hidden');
                } else {
                    toggleSelectMode.classList.add('bg-primary', 'text-white');
                    toggleSelectMode.classList.remove('bg-mist');
                    docCheckboxes.forEach(cb => cb.classList.remove('hidden'));
                }
            });
        }

        docCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', () => {
                const checkedCount = document.querySelectorAll('.doc-checkbox:checked').length;
                if (selectedCount) selectedCount.textContent = checkedCount;
                if (batchActions) {
                    batchActions.classList.toggle('hidden', checkedCount === 0);
                }
            });
        });

        // 文件夹折叠展开
        const folderToggles = document.querySelectorAll('.folder-toggle');
        folderToggles.forEach(toggle => {
            toggle.addEventListener('click', (e) => {
                e.stopPropagation();
                const folderItem = toggle.closest('.folder-item');
                const children = folderItem.querySelector('.folder-children');
                if (children) {
                    children.classList.toggle('hidden');
                    toggle.classList.toggle('fa-angle-right');
                    toggle.classList.toggle('fa-angle-down');
                }
            });
        });

        // 树内搜索
        const treeSearchInput = document.getElementById('tree-search-input');
        if (treeSearchInput) {
            treeSearchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                const folderItems = document.querySelectorAll('.folder-item, .folder-children li');
                folderItems.forEach(item => {
                    const text = item.textContent.toLowerCase();
                    if (text.includes(searchTerm) || searchTerm === '') {
                        item.style.display = '';
                    } else {
                        item.style.display = 'none';
                    }
                });
            });
        }

        // AI助手面板切换
        const toggleAiPanel = document.getElementById('toggle-ai-panel');
        if (toggleAiPanel) {
            toggleAiPanel.addEventListener('click', () => {
                showToast('AI助手侧边栏已打开');
            });
        }

        // 知识图谱交互
        const graphNodes = document.querySelectorAll('.graph-node');
        const graphTooltip = document.getElementById('graph-tooltip');
        const selectedNodeInfo = document.getElementById('selected-node-info');

        graphNodes.forEach(node => {
            node.addEventListener('mouseenter', (e) => {
                if (graphTooltip) {
                    const nodeType = node.dataset.type;
                    const nodeText = node.textContent.trim();
                    graphTooltip.innerHTML = `
                        <p class="font-medium text-sm">${nodeText}</p>
                        <p class="text-muted mt-1">这是一个${nodeType}节点的详细信息...</p>
                        <div class="mt-2 flex gap-2">
                            <span class="px-2 py-1 bg-mist rounded">类型: ${nodeType}</span>
                            <span class="px-2 py-1 bg-mist rounded">关联: 5</span>
                        </div>
                    `;
                    graphTooltip.classList.remove('hidden');
                    graphTooltip.style.left = '50%';
                    graphTooltip.style.top = '20px';
                }
            });

            node.addEventListener('mouseleave', () => {
                if (graphTooltip) graphTooltip.classList.add('hidden');
            });

            node.addEventListener('click', () => {
                const nodeText = node.textContent.trim();
                const nodeType = node.dataset.type;
                if (selectedNodeInfo) {
                    selectedNodeInfo.innerHTML = `
                        <p class="font-medium">${nodeText}</p>
                        <p class="text-muted mt-1">类型: ${nodeType}</p>
                        <p class="text-muted">关联节点: 5个</p>
                        <button class="mt-2 px-2 py-1 rounded-full bg-primary text-white w-full text-xs">查看详情</button>
                    `;
                }
                graphNodes.forEach(n => n.querySelector('.node-circle').setAttribute('stroke', 'none'));
                node.querySelector('.node-circle').setAttribute('stroke', '#3b82f6');
                node.querySelector('.node-circle').setAttribute('stroke-width', '3');
                showToast(`已选中节点: ${nodeText}`);
            });
        });

        // 关系筛选
        const relationFilters = document.querySelectorAll('.relation-filter');
        relationFilters.forEach(filter => {
            filter.addEventListener('change', () => {
                const type = filter.dataset.type;
                const checked = filter.checked;
                const edges = document.querySelectorAll(`.graph-edge[data-type="${type}"]`);
                edges.forEach(edge => {
                    edge.style.display = checked ? '' : 'none';
                });
                showToast(`${checked ? '显示' : '隐藏'}了"${type}"关系`);
            });
        });

        // 图谱布局切换
        const graphLayout = document.getElementById('graph-layout');
        if (graphLayout) {
            graphLayout.addEventListener('change', (e) => {
                showToast(`图谱布局已切换为${e.target.selectedOptions[0].text}`);
            });
        }

        // 图谱全屏
        const graphFullscreen = document.getElementById('graph-fullscreen');
        if (graphFullscreen) {
            graphFullscreen.addEventListener('click', () => {
                showToast('图谱全屏模式已启用');
            });
        }

        // 展开节点
        const expandOneHop = document.getElementById('expand-one-hop');
        const expandTwoHop = document.getElementById('expand-two-hop');
        if (expandOneHop) {
            expandOneHop.addEventListener('click', () => {
                showToast('已展开1度关联节点(模拟)');
            });
        }
        if (expandTwoHop) {
            expandTwoHop.addEventListener('click', () => {
                showToast('已展开2度关联节点(模拟)');
            });
        }

        // 时间轴对比
        const timelineCompare = document.getElementById('timeline-compare');
        const timelineComparison = document.getElementById('timeline-comparison');
        if (timelineCompare && timelineComparison) {
            timelineCompare.addEventListener('click', () => {
                timelineComparison.classList.toggle('hidden');
            });
        }

        // 拖拽功能模拟(简单实现)
        const folderItems = document.querySelectorAll('.folder-item[draggable="true"]');
        folderItems.forEach(item => {
            item.addEventListener('dragstart', (e) => {
                item.style.opacity = '0.5';
                e.dataTransfer.effectAllowed = 'move';
            });

            item.addEventListener('dragend', () => {
                item.style.opacity = '1';
                showToast('文件已移动(模拟)');
            });

            item.addEventListener('dragover', (e) => {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
            });
        });

        // 收藏功能
        document.addEventListener('click', (e) => {
            if (e.target.closest('.fa-star-o')) {
                const star = e.target.closest('.fa-star-o') || e.target;
                star.classList.remove('fa-star-o');
                star.classList.add('fa-star');
                star.style.color = '#f59e0b';
                showToast('已添加到收藏');
            }
        });

        console.log('智能知识库全部交互功能已加载完成');
    });
</script>

    <!-- 引入增强交互逻辑 -->
    <script src="./enhanced-interactions.js"></script>

    <style>
        /* 动画效果 */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideInUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* 可编辑区域样式 */
        .editable-section:focus {
            outline: 2px solid #3b82f6;
            outline-offset: 2px;
        }

        /* 拖拽中样式 */
        .dragging {
            opacity: 0.5;
            transform: rotate(2deg);
        }

        /* Toast通知样式增强 */
        #toast {
            animation: slideInUp 0.3s ease-out;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        /* 节点悬停效果 */
        .graph-node:hover .node-circle {
            filter: brightness(1.2);
            transition: all 0.2s;
        }

        /* 平滑过渡 */
        .folder-children {
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
    </style>

</body>
</html>
