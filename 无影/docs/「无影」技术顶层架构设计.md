# 「无影」技术顶层架构设计

**版本**：V1.0  
**目标**：支撑无影作为集成赋能中台的可扩展与可治理架构  
**适用范围**：无影产品方向（中台集成赋能）

---

## 1. 架构总览

无影采用“连接器+网关+工作流”的组合架构：

1. **连接器层**：标准化适配器、同步与回写。  
2. **赋能层**：前端SDK、后端API、嵌入式组件。  
3. **触发层**：事件监听与规则编排。  
4. **安全治理层**：鉴权、脱敏、配额、审计。  

---

## 2. 关键组件与职责

- **连接器服务**：系统适配、字段映射、同步策略。  
- **嵌入式SDK服务**：前端组件、权限透传、体验一致性。  
- **API网关服务**：统一入口、鉴权、限流、计量。  
- **工作流触发器**：事件规则、编排、任务调用。  
- **安全与审计服务**：日志、合规、告警。

---

## 3. 数据与存储

- **配置存储**：连接器配置、映射规则、密钥。  
- **审计存储**：调用日志、事件轨迹、告警记录。  
- **缓存与队列**：事件流与重试机制。  

---

## 4. 服务边界与 DDD 对齐

建议的 Bounded Context：

- connector-factory  
- embedding-sdk  
- workflow-trigger  
- security-gateway  
- integration-audit  
- developer-ecosystem

各上下文内部按 DDD 四层（domain/application/infrastructure/interfaces）拆分，避免跨上下文 domain 直接耦合。

---

## 5. 核心交互流程（技术视角）

1. **连接器接入**：配置 → 同步 → 状态监控。  
2. **赋能调用**：业务系统 → SDK/API → 灵枢能力。  
3. **事件触发**：事件监听 → 规则命中 → 智能体执行。  
4. **治理闭环**：日志/告警 → 审计 → 合规策略调整。

---

## 6. 非功能与治理要求（摘要）

- 高可用：网关与连接器可水平扩展。  
- 安全：密钥加密存储、字段级脱敏。  
- 可观测：链路追踪、失败重试与告警。  
- 可扩展：连接器SDK与版本兼容策略。  

---

## 7. 组件依赖关系（顶层）

- **连接器服务** → **安全网关**（鉴权与配额）  
- **工作流触发器** ← **连接器服务**（事件源）  
- **嵌入式SDK/网关** → **灵枢 API**（能力调用）  
- **安全与审计服务** ← **全链路调用**（日志与合规）  

---

## 8. 接口清单（顶层）

- **Connector API**：连接器配置、状态、同步控制。  
- **Embedding API**：嵌入配置、组件签名、版本管理。  
- **Workflow API**：事件规则、触发执行、编排状态。  
- **Security API**：鉴权、策略、配额与脱敏。  
- **Audit API**：调用日志、审计查询、告警配置。  
